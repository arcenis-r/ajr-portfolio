{
  "hash": "49fea124993588c90194d67a48b3a6f7",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Forecasting with {modeltime} - Part I\"\nsubtitle: \"Gathering data\"\nauthor: \"Arcenis Rojas\"\ndate: \"2/12/2024\"\nbibliography: references.bib\ncategories:\n  - time series analysis\n  - REST api\n  - data viz\n  - data acquisition\nexecute:\n  warning: false\n  error: false\n  message: false\n---\n\n\n## Introduction\n\n[![Image by \\[Images Money\\](https://www.flickr.com/photos/59937401\\@N07/)](images/5474453551_afc6ded9af_w.jpg){fig-alt=\"Monopoly houses on top of increasingly tall stacks of coins\" fig-align=\"center\"}](https://www.flickr.com/photos/59937401@N07/5474453551)\n\nU.S. housing prices have been [all over the news](https://www.forbes.com/advisor/mortgages/real-estate/housing-market-predictions/) in recent times, which comes as no surprise given recent concerns about [inflation and interest rates](https://apnews.com/article/inflation-prices-interest-rates-cuts-federal-reserve-ec7773de4159f7e0f071f4e126b50158). With this in mind I thought about trying to forecast a housing price index. Over the last year the folks at [Business Science](https://www.business-science.io/) have been adding lots of tools to their suite of packages for time series analysis in R. One of the more recent packages is [modeltime](https://business-science.github.io/modeltime/). When I learned about this package I wanted an excuse to use it. My curiosity about housing price trends presented the perfect opportunity.\n\nI've broken this project into four parts:\n\n1.  Gathering Data\n\n2.  Time series analysis\n\n3.  ARIMA with global and iterative modeling processes\n\n4.  Global forecasting models\n\n5.  Iterative forecasting models\n\nThis post will cover the first part: Gathering Data.\n\n## Choosing house price data\n\nTo perform this analysis, obviously the first thing I would need is a data set. I wanted data that had sufficient observations with enough granularity to be able to identify seasonality and level changes. I also wanted to compare time series across different regions or cities of the U.S. This meant getting data that was available at a regional/metropolitan level that went back at least 10 years with very few missing values (ideally none). I looked at the data available through the [Federal Reserve Bank of St. Louis](https://www.stlouisfed.org/) which hosts one of the largest repositories of U.S. economic data available by using the [fredr](https://sboysel.github.io/fredr/reference/fredr_series_search.html) [@fredr] package and narrowed my search for data series down to either median home prices or the Case-Shiller Home Price Index. I chose the Case-Shiller HPI because I could get the data at the level of metro area rather than just U.S. region for a longer period of time, though there is the trade-off that this index only accounts for existing home sales. For my purposes this wasn't a problem.\n\nThe Case-Shiller HPI data was available through 2023, but population data (discussed below) was available only through 2022 and there were some other issues with data from before 2006, so I got data starting in January 2006 and ending in December 2022.\n\nOnce I chose a data source, the next step was to choose cities. I wanted to compare cities from different regions of the U.S. that were different in other characteristics as well, e.g., population, climate, etc., to see how forecasts might differ. I chose San Diego, Dallas, Detroit, and New York City.\n\n## Additional data\n\nOne of the benefits of using [modeltime](https://business-science.github.io/modeltime/) it has functions for running models beyond ARIMA such as Prophet and eXtreme Gradient Boosting (XGB) for time series. To take advantage of this I wanted to add some features to my data. I chose to add unemployment rates, average gas prices, variables relating to demographic composition, and population for each city at the monthly level. I got the unemployment rate and average gas prices through [fredr](https://sboysel.github.io/fredr/reference/fredr_series_search.html), population data from the U.S. Census's American Community Survey (ACS) using the [tidycensus](https://walker-data.com/tidycensus/) [@tidycensus] package, and other demographic data from the [Current Population Survey (CPS)](https://www.census.gov/programs-surveys/cps.html) (which is a joint program of the U.S. Census and the U.S. Bureau of Labor Statistics) using the [cpsR](https://github.com/matt-saenz/cpsR) [@cpsR] package.\n\n::: callout-important\nBoth `tidycensus` and `cpsR` require a [U.S. Census API key](https://api.census.gov/data/key_signup.html). This post will not go into detail on how to obtain a key or how to set it up for use with the relevant packages.\n:::\n\n::: {.callout-note collapse=\"true\" title=\"Statistical Area Definitions\"}\nSome of these data are at the metropolitan statistical area (MSA) level and others are at the core-based statistical area (CBSA) level. While these broadly overlap, which is why I didn't make a big fuss about mixing them, they are technically different. The U.S. Census provides some definitions [here](https://www.census.gov/topics/housing/housing-patterns/about/core-based-statistical-areas.html).\n:::\n\nAs usual for me, I performed data importing and wrangling using various [tidyverse](https://www.tidyverse.org/) [@tidyverse]package functions. I also used [multidplyr](https://multidplyr.tidyverse.org/) [@multidplyr] to perform some operations in parallel.\n\n## Loading Packages\n\nTo begin with, I first loaded my packages. I'll include the [gt](https://gt.rstudio.com/) package for displaying tables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(fredr)\nlibrary(tidycensus)\nlibrary(cpsR)\nlibrary(gt)\nlibrary(multidplyr)\n\nconflicted::conflict_prefer(\"filter\", \"dplyr\")\nconflicted::conflict_prefer(\"lag\", \"dplyr\")\nconflicted::conflict_prefer(\"between\", \"dplyr\")\n```\n:::\n\n\n## Getting Case-Shiller HPI data\n\nI started by getting the appropriate Case-Shiller HPI series IDs for my cities of interest.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhpi_ids <- fredr_series_search_text(\"Case-Shiller\") |>\n  filter(\n    str_detect(\n      title,\n      \"CA-San Diego|TX-Dallas|NY-New York|MI-Detroit Home Price Index\"\n    ),\n    seasonal_adjustment_short %in% \"NSA\",\n    frequency %in% \"Monthly\"\n  ) |>\n  mutate(city = str_extract(title, \"New York|Dallas|San Diego|Detroit\")) |>\n  select(city, id)\n\ngt(hpi_ids)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"tothfmyvrs\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#tothfmyvrs table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#tothfmyvrs thead, #tothfmyvrs tbody, #tothfmyvrs tfoot, #tothfmyvrs tr, #tothfmyvrs td, #tothfmyvrs th {\n  border-style: none;\n}\n\n#tothfmyvrs p {\n  margin: 0;\n  padding: 0;\n}\n\n#tothfmyvrs .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#tothfmyvrs .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#tothfmyvrs .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#tothfmyvrs .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#tothfmyvrs .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#tothfmyvrs .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#tothfmyvrs .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#tothfmyvrs .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#tothfmyvrs .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#tothfmyvrs .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#tothfmyvrs .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#tothfmyvrs .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#tothfmyvrs .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#tothfmyvrs .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#tothfmyvrs .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#tothfmyvrs .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#tothfmyvrs .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#tothfmyvrs .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#tothfmyvrs .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tothfmyvrs .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#tothfmyvrs .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#tothfmyvrs .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#tothfmyvrs .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tothfmyvrs .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#tothfmyvrs .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#tothfmyvrs .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#tothfmyvrs .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tothfmyvrs .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#tothfmyvrs .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#tothfmyvrs .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#tothfmyvrs .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#tothfmyvrs .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#tothfmyvrs .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tothfmyvrs .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#tothfmyvrs .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#tothfmyvrs .gt_left {\n  text-align: left;\n}\n\n#tothfmyvrs .gt_center {\n  text-align: center;\n}\n\n#tothfmyvrs .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#tothfmyvrs .gt_font_normal {\n  font-weight: normal;\n}\n\n#tothfmyvrs .gt_font_bold {\n  font-weight: bold;\n}\n\n#tothfmyvrs .gt_font_italic {\n  font-style: italic;\n}\n\n#tothfmyvrs .gt_super {\n  font-size: 65%;\n}\n\n#tothfmyvrs .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#tothfmyvrs .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#tothfmyvrs .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#tothfmyvrs .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#tothfmyvrs .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#tothfmyvrs .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#tothfmyvrs .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"city\">city</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"id\">id</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"id\" class=\"gt_row gt_left\">DAXRNSA</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">San Diego</td>\n<td headers=\"id\" class=\"gt_row gt_left\">SDXRNSA</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">New York</td>\n<td headers=\"id\" class=\"gt_row gt_left\">NYXRNSA</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Detroit</td>\n<td headers=\"id\" class=\"gt_row gt_left\">DEXRNSA</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nNext I read in the Case-Shiller data and kept only the necessary variables.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhpi_data <- hpi_ids |>\n  mutate(\n    data = map(\n      id,\n      \\(x) fredr(\n        series_id = x,\n        observation_start = ymd(\"2006-01-01\"),\n        observation_end = ymd(\"2023-12-31\"),\n        frequency = \"m\"\n      )\n    )\n  ) |>\n  select(-id) |>\n  unnest(data) |>\n  select(city, date, hpi = value)\n\ngt(hpi_data[1:10, ])\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"ytmourlgae\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ytmourlgae table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ytmourlgae thead, #ytmourlgae tbody, #ytmourlgae tfoot, #ytmourlgae tr, #ytmourlgae td, #ytmourlgae th {\n  border-style: none;\n}\n\n#ytmourlgae p {\n  margin: 0;\n  padding: 0;\n}\n\n#ytmourlgae .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ytmourlgae .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ytmourlgae .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ytmourlgae .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ytmourlgae .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ytmourlgae .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ytmourlgae .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ytmourlgae .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ytmourlgae .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ytmourlgae .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ytmourlgae .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ytmourlgae .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ytmourlgae .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ytmourlgae .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ytmourlgae .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ytmourlgae .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ytmourlgae .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ytmourlgae .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ytmourlgae .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ytmourlgae .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ytmourlgae .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ytmourlgae .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ytmourlgae .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ytmourlgae .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ytmourlgae .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ytmourlgae .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ytmourlgae .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ytmourlgae .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ytmourlgae .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ytmourlgae .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ytmourlgae .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ytmourlgae .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ytmourlgae .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ytmourlgae .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ytmourlgae .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ytmourlgae .gt_left {\n  text-align: left;\n}\n\n#ytmourlgae .gt_center {\n  text-align: center;\n}\n\n#ytmourlgae .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ytmourlgae .gt_font_normal {\n  font-weight: normal;\n}\n\n#ytmourlgae .gt_font_bold {\n  font-weight: bold;\n}\n\n#ytmourlgae .gt_font_italic {\n  font-style: italic;\n}\n\n#ytmourlgae .gt_super {\n  font-size: 65%;\n}\n\n#ytmourlgae .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ytmourlgae .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ytmourlgae .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ytmourlgae .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ytmourlgae .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ytmourlgae .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ytmourlgae .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"city\">city</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"date\">date</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"hpi\">hpi</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">121.9108</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-02-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">121.3285</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-03-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">121.5217</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-04-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">122.3996</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-05-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">123.2863</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-06-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">124.4985</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-07-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">125.3672</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-08-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">125.7007</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-09-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">125.1859</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-10-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">124.5813</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n## Getting unemployment rate and gas price data from FRED\n\nNext I got series IDs for both average gas prices and unemployment rates for all four cities and got the data for the appropriate time span.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get average gas price for each CBSA by month\ngas_ids <- fredr_series_search_text(\n  \"Average Price: Gasoline, Unleaded Regular\"\n) |>\n  filter(\n    str_detect(title, \"New York|Dallas|San Diego|Detroit\"),\n    frequency %in% \"Monthly\",\n    seasonal_adjustment_short %in% \"NSA\"\n  ) |>\n  mutate(city = str_extract(title, \"New York|Dallas|San Diego|Detroit\")) |>\n  select(city, id)\n\ngas_data <- gas_ids |>\n  mutate(\n    data = map(\n      id,\n      \\(x) fredr(\n        series_id = x,\n        observation_start = ymd(\"2000-01-01\"),\n        observation_end = ymd(\"2023-12-31\"),\n        frequency = \"m\"\n      )\n    )\n  ) |>\n  select(-id) |>\n  unnest(data) |>\n  select(city, date, avg_gas_price = value)\n\n# Get average unemployment rate for each MSA by month\nunemp_ids <- fredr_series_search_text(\"Unemployment: Rate\") |>\n  filter(\n    str_detect(title, \"New York|Dallas|San Diego|Detroit\"),\n    frequency %in% \"Monthly\",\n    seasonal_adjustment_short %in% \"NSA\"\n  ) |>\n  mutate(city = str_extract(title, \"New York|Dallas|San Diego|Detroit\")) |>\n  group_by(city) |>\n  mutate(\n    rnum = n(),\n    msa_str = str_detect(title, \"MSA\")\n  ) |>\n  ungroup() |>\n  filter(rnum == 1 | msa_str) |>\n  select(city, id)\n\nunemp_data <- unemp_ids |>\n  mutate(\n    data = map(\n      id,\n      \\(x) fredr(\n        series_id = x,\n        observation_start = ymd(\"2000-01-01\"),\n        observation_end = ymd(\"2023-12-31\"),\n        frequency = \"m\"\n      )\n    )\n  ) |>\n  select(-id) |>\n  unnest(data) |>\n  select(city, date, unemp_rate = value)\n```\n:::\n\n\n## Getting CPS data\n\nGetting CPS data at the MSA level is a little more complicated than it is getting data series from FRED. CPS data can contain well over 100K rows for each month because the microdata are released at the household level and each data set has hundreds of variables. It also requires filtering and grouping the data by MSA code, which means getting the MSA codes that correspond to each MSA in my analysis. However, I knew that MSAs can change over time as population shifts. I felt confident that this wouldn't be the case for my chosen cities because of their population sizes, but I wanted to check anyway. Finally, I did thought that pulling in all of that data at once then filtering and aggregating would be computationally inefficient and slow, so, instead, I wrote a function to perform all of the necessary operations and ran it in parallel. I chose the method that I did because most of the time was spent connecting to the CPS API. Once data are imported, the computations are fairly simple.\n\nThe first step was to get the MSA codes that corresponded to my cities of interest and check that I had a unique set across all of my years of interest. The data for these MSA codes came from the U.S. Census's technical documentation page and MSA definitions only change once every few years.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmsa_code_tbl <- tribble(\n  ~start_yr, ~end_yr,\n  2003, 2006,\n  2007, 2011,\n  2012, 2016,\n  2017, 2021\n) |>\n  mutate(\n    suffix = str_sub(start_yr, 3, 4),\n    msa_url = map_chr(\n      suffix,\n      \\(x) str_c(\n        \"https://www2.census.gov/programs-surveys/cbp/technical-documentation/\",\n        \"reference/metro-area-geography-reference/msa_county_reference\",\n        x,\n        \".txt\"\n      )\n    ),\n    msa_code_data = map(\n      msa_url,\n      \\(x) read_delim(x, delim = \",\", show_col_types = FALSE) |>\n        filter(\n          str_detect(\n            name_msa,\n            \"Dallas.*TX|San Diego.*CA|New York.*NY|Detroit.*MI\"\n          )\n        ) |>\n        mutate(\n          city = str_extract(name_msa, \"Dallas|New York|San Diego|Detroit\"),\n          msa = as.character(msa)\n        ) |>\n        distinct(city, msa)\n    )\n  ) |>\n  distinct(msa_code_data) |>\n  unnest(msa_code_data)\n\ngt(msa_code_tbl)\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"dybqbxvwdu\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#dybqbxvwdu table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#dybqbxvwdu thead, #dybqbxvwdu tbody, #dybqbxvwdu tfoot, #dybqbxvwdu tr, #dybqbxvwdu td, #dybqbxvwdu th {\n  border-style: none;\n}\n\n#dybqbxvwdu p {\n  margin: 0;\n  padding: 0;\n}\n\n#dybqbxvwdu .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#dybqbxvwdu .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#dybqbxvwdu .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#dybqbxvwdu .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#dybqbxvwdu .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#dybqbxvwdu .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dybqbxvwdu .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#dybqbxvwdu .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#dybqbxvwdu .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#dybqbxvwdu .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#dybqbxvwdu .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#dybqbxvwdu .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#dybqbxvwdu .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#dybqbxvwdu .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#dybqbxvwdu .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#dybqbxvwdu .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#dybqbxvwdu .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#dybqbxvwdu .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#dybqbxvwdu .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dybqbxvwdu .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#dybqbxvwdu .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#dybqbxvwdu .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#dybqbxvwdu .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dybqbxvwdu .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#dybqbxvwdu .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#dybqbxvwdu .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dybqbxvwdu .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dybqbxvwdu .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#dybqbxvwdu .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dybqbxvwdu .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#dybqbxvwdu .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dybqbxvwdu .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#dybqbxvwdu .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dybqbxvwdu .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#dybqbxvwdu .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dybqbxvwdu .gt_left {\n  text-align: left;\n}\n\n#dybqbxvwdu .gt_center {\n  text-align: center;\n}\n\n#dybqbxvwdu .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#dybqbxvwdu .gt_font_normal {\n  font-weight: normal;\n}\n\n#dybqbxvwdu .gt_font_bold {\n  font-weight: bold;\n}\n\n#dybqbxvwdu .gt_font_italic {\n  font-style: italic;\n}\n\n#dybqbxvwdu .gt_super {\n  font-size: 65%;\n}\n\n#dybqbxvwdu .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#dybqbxvwdu .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#dybqbxvwdu .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#dybqbxvwdu .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#dybqbxvwdu .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#dybqbxvwdu .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#dybqbxvwdu .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"city\">city</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"msa\">msa</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"msa\" class=\"gt_row gt_right\">19100</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Detroit</td>\n<td headers=\"msa\" class=\"gt_row gt_right\">19820</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">New York</td>\n<td headers=\"msa\" class=\"gt_row gt_right\">35620</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">San Diego</td>\n<td headers=\"msa\" class=\"gt_row gt_right\">41740</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nIn the next step I defined the function for importing, filtering, and aggregating CPS data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nget_cps_summaries <- function(cps_df, geographies) {\n  cps_df |>\n    rename(hispanic = matches(\"hspnon\"), msa = starts_with(\"gt\")) |>\n    filter(msa %in% geographies) |>\n    relocate(msa, pwsswgt, prtage, pemaritl, peeduca, hispanic) |>\n    mutate(\n      msa = as.character(msa),\n      pwsswgt = as.numeric(pwsswgt),\n      across(prtage:hispanic, as.integer),\n      across(prtage:hispanic, \\(x) na_if(x, -1)),\n      age_lt_18 = prtage < 18,\n      age_18_35 = between(prtage, 18, 35),\n      age_36_65 = between(prtage, 36, 65),\n      age_gt_65 = prtage > 65,\n      educ_hs_less = peeduca < 40,\n      educ_college = peeduca %in% 40:43,\n      educ_grad = peeduca > 43,\n      status_married = pemaritl %in% 1:2,\n      status_nev_mar = pemaritl == 6,\n      status_other = !pemaritl %in% c(1:2, 6),\n      hispanic = hispanic == 1,\n      across(\n        c(age_lt_18:status_other, hispanic),\n        \\(x) (x * pwsswgt)\n      )\n    ) |>\n    group_by(msa) |>\n    summarise(\n      across(\n        c(age_lt_18:status_other, hispanic),\n        \\(x) sum(x / sum(pwsswgt), na.rm = TRUE)\n      )\n    )\n}\n```\n:::\n\n\nWith that function now defined, I move on to get CPS data using that function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set up a cluster to get all of the CPS data aggregations\ncps_clust <- new_cluster(12)\ncluster_library(cps_clust, c(\"tidyverse\", \"cpsR\"))\ncluster_copy(cps_clust, c(\"get_cps_summaries\", \"msa_code_tbl\"))\n\n# Get CPS data aggregations\ncps_grid <- expand.grid(\n  yr = 2006:2023,\n  mo = 1:12\n) |>\n  partition(cps_clust)\n\ncps_data <- cps_grid |>\n  arrange(yr, mo) |>\n  mutate(\n    cps = map2(\n      yr, mo,\n      possibly(\n        \\(y, m) {\n          get_basic(\n            y, m,\n            c(\"gtcbsa\", \"prtage\", \"pemaritl\", \"peeduca\", \"pehspnon\", \"pwsswgt\")\n          ) |>\n            get_cps_summaries(msa_code_tbl$msa)\n        }\n      )\n    )\n  ) |>\n  collect() |>\n  unnest(cps) |>\n  mutate(msa = as.character(msa)) |>\n  left_join(msa_code_tbl, by = \"msa\") |>\n  select(-msa) |>\n  unite(\"date\", yr, mo, sep = \"-\") |>\n  mutate(date = ym(date)) |>\n  relocate(city, date)\n```\n:::\n\n\n\n\nThis is what the CPS data looked like.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ngt(head(cps_data))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"ttsuobeorv\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ttsuobeorv table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ttsuobeorv thead, #ttsuobeorv tbody, #ttsuobeorv tfoot, #ttsuobeorv tr, #ttsuobeorv td, #ttsuobeorv th {\n  border-style: none;\n}\n\n#ttsuobeorv p {\n  margin: 0;\n  padding: 0;\n}\n\n#ttsuobeorv .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ttsuobeorv .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ttsuobeorv .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ttsuobeorv .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ttsuobeorv .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ttsuobeorv .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ttsuobeorv .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ttsuobeorv .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ttsuobeorv .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ttsuobeorv .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ttsuobeorv .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ttsuobeorv .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ttsuobeorv .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ttsuobeorv .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ttsuobeorv .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ttsuobeorv .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ttsuobeorv .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ttsuobeorv .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ttsuobeorv .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ttsuobeorv .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ttsuobeorv .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ttsuobeorv .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ttsuobeorv .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ttsuobeorv .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ttsuobeorv .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ttsuobeorv .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ttsuobeorv .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ttsuobeorv .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ttsuobeorv .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ttsuobeorv .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ttsuobeorv .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ttsuobeorv .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ttsuobeorv .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ttsuobeorv .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ttsuobeorv .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ttsuobeorv .gt_left {\n  text-align: left;\n}\n\n#ttsuobeorv .gt_center {\n  text-align: center;\n}\n\n#ttsuobeorv .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ttsuobeorv .gt_font_normal {\n  font-weight: normal;\n}\n\n#ttsuobeorv .gt_font_bold {\n  font-weight: bold;\n}\n\n#ttsuobeorv .gt_font_italic {\n  font-style: italic;\n}\n\n#ttsuobeorv .gt_super {\n  font-size: 65%;\n}\n\n#ttsuobeorv .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ttsuobeorv .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ttsuobeorv .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ttsuobeorv .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ttsuobeorv .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ttsuobeorv .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ttsuobeorv .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"city\">city</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"date\">date</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"age_lt_18\">age_lt_18</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"age_18_35\">age_18_35</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"age_36_65\">age_36_65</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"age_gt_65\">age_gt_65</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"educ_hs_less\">educ_hs_less</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"educ_college\">educ_college</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"educ_grad\">educ_grad</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"status_married\">status_married</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"status_nev_mar\">status_nev_mar</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"status_other\">status_other</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"hispanic\">hispanic</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.2891927</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">0.2805833</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">0.3565649</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.07365909</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.3582388</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">0.3352050</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.06503496</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.4248964</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">0.2140741</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.3610295</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.26435629</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Detroit</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.2702241</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">0.2240328</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">0.3916348</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.11410831</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.3702413</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">0.3384275</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.06239968</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.4012264</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">0.2359013</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.3628723</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.03441875</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">New York</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.2499559</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">0.2424744</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">0.3919559</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.11561378</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.3744975</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">0.3294315</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.09275988</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.4073354</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">0.2681326</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.3245319</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.21810530</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">San Diego</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.2391931</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">0.2444161</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">0.4007565</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.11563422</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.2917841</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">0.4379721</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.07820804</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.4023657</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">0.2548609</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.3427734</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.29021086</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-03-01</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.2991726</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">0.2852235</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">0.3324601</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.08314374</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.3481381</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">0.3412725</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.06266023</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.4069059</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">0.2147862</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.3783079</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.27328065</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Detroit</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-03-01</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.2660104</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">0.2155320</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">0.4070590</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.11139867</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.3738536</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">0.3548189</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.05050216</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.4191846</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">0.2244699</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.3563455</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.03402642</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n## Getting population data\n\nOne would think that if any demographic data is simple to get, population data would be simple, right? I learned something different. I was interested in getting population data at a monthly level for each MSA of interest. I knew population was not counted monthly, but I thought I could get it from the CPS. In fact, one might notice that the code actually calls a population variable (`pwsswgt` ) to perform some calculations. The problem here was that at the MSA level population estimates varied in some cases by as much as 16%. While I I didn't know if this was true or not I did believe (subjectively) that it was unlikely and I believed that CPS weights are not calibrated to MSAs. My understanding is that they are calibrated to the national and state levels. So, I thought a reasonable alternative would be to get data from the ACS 1-year survey and interpolate data from one year to the next. In fact, the reason that I started my time series in 2006 is that the ACS 1-year and 5-year survey data became available in 2005 and I needed one year before the time series for interpolation. However, there was wrinkle caused by COVID. The 1-year ACS was not released for 2020 because of understandable challenges with data collection. So, for 2020 I used ACS 5-year survey data. I started by getting all of the ACS 1-year data. Here again, I processed the data in parallel.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a cluster for getting ACS data\nacs_clust <- new_cluster(12)\ncluster_library(acs_clust, c(\"tidyverse\", \"tidycensus\"))\n\n# Get ACS data for 2005 to 2019, 2021, and 2022\nacs1_pop_data <- tibble(year = c(2005:2019, 2021:2022)) |>\n  partition(acs_clust) |>\n  mutate(\n    pop_data = map(\n      year,\n      \\(x) get_acs(\n        year = x,\n        variables = \"B01001_001\",\n        geography = \"cbsa\",\n        survey = \"acs1\",\n        show_call = FALSE\n      ) |>\n        filter(str_detect(NAME, \"New York|Dallas|San Diego|Detroit\")) |>\n        mutate(city = str_extract(NAME, \"New York|Dallas|San Diego|Detroit\")) |>\n        select(city, population = estimate)\n    )\n  ) |>\n  collect() |>\n  unnest(pop_data) |>\n  mutate(date = str_c(year, \"12\") |> ym(), .keep = \"unused\")\n```\n:::\n\n\n\n\nNext I got the data for 2020 and combined it with the ACS 1-year data. I performed interpolation using the `ts_impute_vec()` function from the [timetk](https://business-science.github.io/timetk/) [@timetk] package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get data for 2020 separately since it wasn't available in the ACS 1-year\nacs5_pop_data <- get_acs(\n  year = 2020,\n  variables = \"B01001_001\",\n  geography = \"cbsa\",\n  survey = \"acs5\",\n  show_call = FALSE\n) |>\n  filter(str_detect(NAME, \"New York|Dallas|San Diego|Detroit\")) |>\n  mutate(\n    city = str_extract(NAME, \"New York|Dallas|San Diego|Detroit\"),\n    date = rep(ym(\"2020-12\"), 4),\n  ) |>\n  select(city, date, population = estimate)\n\n# Put together all the ACS population data and interpolate between annual\n# estimates\nacs_pop_data <- expand_grid(\n  yr = 2006:2022,\n  mo = 1:12\n) |>\n  add_row(yr = 2005, mo = 12) |>\n  expand_grid(city = c(\"New York\", \"Dallas\", \"San Diego\", \"Detroit\")) |>\n  unite(date, yr, mo, sep = \"-\", remove = TRUE) |>\n  mutate(date = ym(date)) |>\n  arrange(date, city) |>\n  left_join(\n    bind_rows(acs1_pop_data, acs5_pop_data),\n    by = c(\"city\", \"date\")\n  ) |>\n  group_by(city) |>\n  arrange(date) |>\n  mutate(\n    population = timetk::ts_impute_vec(population, period = 1),\n    pop_chg = (population / lag(population)) - 1\n  ) |>\n  drop_na(pop_chg) |>\n  ungroup() |>\n  select(!population)\n\ngt(head(acs_pop_data))\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"dynzfaczvw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#dynzfaczvw table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#dynzfaczvw thead, #dynzfaczvw tbody, #dynzfaczvw tfoot, #dynzfaczvw tr, #dynzfaczvw td, #dynzfaczvw th {\n  border-style: none;\n}\n\n#dynzfaczvw p {\n  margin: 0;\n  padding: 0;\n}\n\n#dynzfaczvw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#dynzfaczvw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#dynzfaczvw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#dynzfaczvw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#dynzfaczvw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#dynzfaczvw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dynzfaczvw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#dynzfaczvw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#dynzfaczvw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#dynzfaczvw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#dynzfaczvw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#dynzfaczvw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#dynzfaczvw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#dynzfaczvw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#dynzfaczvw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#dynzfaczvw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#dynzfaczvw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#dynzfaczvw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#dynzfaczvw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dynzfaczvw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#dynzfaczvw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#dynzfaczvw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#dynzfaczvw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dynzfaczvw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#dynzfaczvw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#dynzfaczvw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dynzfaczvw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dynzfaczvw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#dynzfaczvw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dynzfaczvw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#dynzfaczvw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dynzfaczvw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#dynzfaczvw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dynzfaczvw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#dynzfaczvw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dynzfaczvw .gt_left {\n  text-align: left;\n}\n\n#dynzfaczvw .gt_center {\n  text-align: center;\n}\n\n#dynzfaczvw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#dynzfaczvw .gt_font_normal {\n  font-weight: normal;\n}\n\n#dynzfaczvw .gt_font_bold {\n  font-weight: bold;\n}\n\n#dynzfaczvw .gt_font_italic {\n  font-style: italic;\n}\n\n#dynzfaczvw .gt_super {\n  font-size: 65%;\n}\n\n#dynzfaczvw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#dynzfaczvw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#dynzfaczvw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#dynzfaczvw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#dynzfaczvw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#dynzfaczvw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#dynzfaczvw .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"date\">date</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"city\">city</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pop_chg\">pop_chg</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"pop_chg\" class=\"gt_row gt_right\">0.0040551186</td></tr>\n    <tr><td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"city\" class=\"gt_row gt_left\">Detroit</td>\n<td headers=\"pop_chg\" class=\"gt_row gt_right\">0.0007530958</td></tr>\n    <tr><td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"city\" class=\"gt_row gt_left\">New York</td>\n<td headers=\"pop_chg\" class=\"gt_row gt_right\">0.0021226567</td></tr>\n    <tr><td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"city\" class=\"gt_row gt_left\">San Diego</td>\n<td headers=\"pop_chg\" class=\"gt_row gt_right\">0.0034579867</td></tr>\n    <tr><td headers=\"date\" class=\"gt_row gt_right\">2006-02-01</td>\n<td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"pop_chg\" class=\"gt_row gt_right\">0.0040387411</td></tr>\n    <tr><td headers=\"date\" class=\"gt_row gt_right\">2006-02-01</td>\n<td headers=\"city\" class=\"gt_row gt_left\">Detroit</td>\n<td headers=\"pop_chg\" class=\"gt_row gt_right\">0.0007525290</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n## Merge data and check\n\nWith all of the data gathered and each data set containing variables for city and date (monthly) along with at least one demographic or economic variable, they were ready to be merged.\n\n\n::: {.cell}\n\n```{.r .cell-code}\necon_data <- list(hpi_data, unemp_data, gas_data, cps_data, acs_pop_data) |>\n  reduce(inner_join, by = c(\"city\", \"date\"))\n```\n:::\n\n\nIt would be a mistake to ever think that there is no more cleaning that can be done, so I skimmed the data using the `skimr()` function from the [skimr](https://github.com/ropensci/skimr) [@skimr] package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nskimr::skim(econ_data)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |          |\n|:------------------------|:---------|\n|Name                     |econ_data |\n|Number of rows           |816       |\n|Number of columns        |17        |\n|_______________________  |          |\n|Column type frequency:   |          |\n|character                |1         |\n|Date                     |1         |\n|numeric                  |15        |\n|________________________ |          |\n|Group variables          |None      |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|city          |         0|             1|   6|   9|     0|        4|          0|\n\n\n**Variable type: Date**\n\n|skim_variable | n_missing| complete_rate|min        |max        |median     | n_unique|\n|:-------------|---------:|-------------:|:----------|:----------|:----------|--------:|\n|date          |         0|             1|2006-01-01 |2022-12-01 |2014-06-16 |      204|\n\n\n**Variable type: numeric**\n\n|skim_variable  | n_missing| complete_rate|   mean|    sd|    p0|    p25|    p50|    p75|   p100|hist  |\n|:--------------|---------:|-------------:|------:|-----:|-----:|------:|------:|------:|------:|:-----|\n|hpi            |         0|          1.00| 172.19| 64.38| 64.47| 122.40| 168.06| 203.87| 427.80| |\n|unemp_rate     |         0|          1.00|   6.50|  2.93|  2.80|   4.20|   5.60|   8.30|  23.90| |\n|avg_gas_price  |       144|          0.82|   2.95|  0.76|  1.36|   2.38|   2.84|   3.48|   6.29| |\n|age_lt_18      |         0|          1.00|   0.24|  0.02|  0.19|   0.22|   0.24|   0.25|   0.30| |\n|age_18_35      |         0|          1.00|   0.25|  0.02|  0.19|   0.24|   0.25|   0.26|   0.31| |\n|age_36_65      |         0|          1.00|   0.39|  0.02|  0.32|   0.38|   0.39|   0.40|   0.44| |\n|age_gt_65      |         0|          1.00|   0.12|  0.03|  0.07|   0.11|   0.12|   0.14|   0.24| |\n|educ_hs_less   |         0|          1.00|   0.33|  0.03|  0.24|   0.31|   0.33|   0.35|   0.39| |\n|educ_college   |         0|          1.00|   0.38|  0.03|  0.31|   0.36|   0.38|   0.40|   0.48| |\n|educ_grad      |         0|          1.00|   0.09|  0.02|  0.05|   0.08|   0.09|   0.11|   0.16| |\n|status_married |         0|          1.00|   0.40|  0.02|  0.34|   0.39|   0.40|   0.41|   0.45| |\n|status_nev_mar |         0|          1.00|   0.27|  0.03|  0.19|   0.25|   0.27|   0.29|   0.34| |\n|status_other   |         0|          1.00|   0.33|  0.02|  0.28|   0.32|   0.33|   0.34|   0.45| |\n|hispanic       |         0|          1.00|   0.22|  0.11|  0.02|   0.17|   0.25|   0.30|   0.42| |\n|pop_chg        |         0|          1.00|   0.00|  0.00|  0.00|   0.00|   0.00|   0.00|   0.00| |\n\n\n:::\n:::\n\n\nOverall the data look good except for the `avg_gas_price` variable, which is the only variable that has any missing values. I'll turn to that shortly, but I'll briefly describe the variables in the data set below:\n\n-   `city` : self-explanatory\n\n-   `date`: month expressed as the first day of the month\n\n-   `hpi`: Case-Shiller Home Price Index value\n\n-   `unemp_rate`: Unemployment rate\n\n-   `avg_gas_price`: Average gas price\n\n-   `age_lt_18`: Proportion of the population younger than 18 years old\n\n-   `age_18_35`: Proportion of the population between the ages of 18 and 35\n\n-   `age_36_65`: Proportion of the population between the ages of 36 and 65\n\n-   `age_gt_65`: Proportion of the population older than 65 years old\n\n-   `educ_hs_less`: Proportion of the population with up to a high school diploma\n\n-   `educ_college`: Proportion of the population with more than a high school diploma and up to a bachelor's degree\n\n-   `educ_grad`: Proportion of the population with education higher than a bachelor's degree\n\n-   `status_married`: Proportion of the population that is married; including separated\n\n-   `status_nev_mar`: Proportion of the population that has never been married\n\n-   `status_other`: Proportion of the population not categorized as either `status_married` or `status_nev_mar`\n\n-   `hispanic`: Proportion of the population that reported Hispanic ethnicity\n\n-   `pop_chg`: Population change from one month to the next\n\nOnce I skimmed the data, I took a closer look at the percent of `avg_gas_price` values that were missing for each city.\n\n\n::: {.cell}\n\n```{.r .cell-code}\necon_data |>\n  group_by(city) |>\n  summarise(pct_miss_gas = sum(is.na(avg_gas_price)) / n()) |>\n  ggplot(aes(y = pct_miss_gas, x = city)) +\n  geom_col(fill = \"#2c3e50\") +\n  scale_y_continuous(limits = c(-0.1, 1.1), labels = scales::percent) +\n  labs(\n    y = \"Percent Missing\",\n    x = NULL,\n    title = \"Missingness in avg_gas_price variable by city\"\n  ) + \n  theme_bw() +\n  theme(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](forecasting-with-modeltime-part-1_files/figure-html/check-avg-gas-missing-1.png){width=672}\n:::\n:::\n\n\nEvidently data were missing only for San Diego. Below are the start and end dates of average gas price data for San Diego in this data set.\n\n\n::: {.cell}\n\n```{.r .cell-code}\necon_data |>\n  filter(city %in% \"San Diego\", !is.na(avg_gas_price)) |>\n  summarise(start_date = min(date), end_date = max(date)) |>\n  gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"lzjxggqsch\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#lzjxggqsch table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#lzjxggqsch thead, #lzjxggqsch tbody, #lzjxggqsch tfoot, #lzjxggqsch tr, #lzjxggqsch td, #lzjxggqsch th {\n  border-style: none;\n}\n\n#lzjxggqsch p {\n  margin: 0;\n  padding: 0;\n}\n\n#lzjxggqsch .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#lzjxggqsch .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#lzjxggqsch .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#lzjxggqsch .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#lzjxggqsch .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#lzjxggqsch .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lzjxggqsch .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#lzjxggqsch .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#lzjxggqsch .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#lzjxggqsch .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#lzjxggqsch .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#lzjxggqsch .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#lzjxggqsch .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#lzjxggqsch .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#lzjxggqsch .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#lzjxggqsch .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#lzjxggqsch .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#lzjxggqsch .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#lzjxggqsch .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lzjxggqsch .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#lzjxggqsch .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#lzjxggqsch .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#lzjxggqsch .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lzjxggqsch .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#lzjxggqsch .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#lzjxggqsch .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lzjxggqsch .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lzjxggqsch .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#lzjxggqsch .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lzjxggqsch .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#lzjxggqsch .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#lzjxggqsch .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#lzjxggqsch .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lzjxggqsch .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#lzjxggqsch .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#lzjxggqsch .gt_left {\n  text-align: left;\n}\n\n#lzjxggqsch .gt_center {\n  text-align: center;\n}\n\n#lzjxggqsch .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#lzjxggqsch .gt_font_normal {\n  font-weight: normal;\n}\n\n#lzjxggqsch .gt_font_bold {\n  font-weight: bold;\n}\n\n#lzjxggqsch .gt_font_italic {\n  font-style: italic;\n}\n\n#lzjxggqsch .gt_super {\n  font-size: 65%;\n}\n\n#lzjxggqsch .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#lzjxggqsch .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#lzjxggqsch .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#lzjxggqsch .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#lzjxggqsch .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#lzjxggqsch .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#lzjxggqsch .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"start_date\">start_date</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"end_date\">end_date</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"start_date\" class=\"gt_row gt_right\">2018-01-01</td>\n<td headers=\"end_date\" class=\"gt_row gt_right\">2022-12-01</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nAs it turns out, reports of average gas price data for San Diego start in January of 2018, which means that 12 years of data would be missing. With that many values missing for one of the cities it makes sense to drop the average gas price variable.\n\n\n::: {.cell}\n\n```{.r .cell-code}\necon_data <- select(econ_data, !avg_gas_price)\n\necon_data |> slice(1:6) |> gt()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"ggoamtlgsw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ggoamtlgsw table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ggoamtlgsw thead, #ggoamtlgsw tbody, #ggoamtlgsw tfoot, #ggoamtlgsw tr, #ggoamtlgsw td, #ggoamtlgsw th {\n  border-style: none;\n}\n\n#ggoamtlgsw p {\n  margin: 0;\n  padding: 0;\n}\n\n#ggoamtlgsw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ggoamtlgsw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ggoamtlgsw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ggoamtlgsw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ggoamtlgsw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ggoamtlgsw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ggoamtlgsw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ggoamtlgsw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ggoamtlgsw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ggoamtlgsw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ggoamtlgsw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ggoamtlgsw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ggoamtlgsw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ggoamtlgsw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ggoamtlgsw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ggoamtlgsw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ggoamtlgsw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ggoamtlgsw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ggoamtlgsw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ggoamtlgsw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ggoamtlgsw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ggoamtlgsw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ggoamtlgsw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ggoamtlgsw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ggoamtlgsw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ggoamtlgsw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ggoamtlgsw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ggoamtlgsw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ggoamtlgsw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ggoamtlgsw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ggoamtlgsw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ggoamtlgsw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ggoamtlgsw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ggoamtlgsw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ggoamtlgsw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ggoamtlgsw .gt_left {\n  text-align: left;\n}\n\n#ggoamtlgsw .gt_center {\n  text-align: center;\n}\n\n#ggoamtlgsw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ggoamtlgsw .gt_font_normal {\n  font-weight: normal;\n}\n\n#ggoamtlgsw .gt_font_bold {\n  font-weight: bold;\n}\n\n#ggoamtlgsw .gt_font_italic {\n  font-style: italic;\n}\n\n#ggoamtlgsw .gt_super {\n  font-size: 65%;\n}\n\n#ggoamtlgsw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ggoamtlgsw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ggoamtlgsw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ggoamtlgsw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ggoamtlgsw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ggoamtlgsw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ggoamtlgsw .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"city\">city</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"date\">date</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"hpi\">hpi</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"unemp_rate\">unemp_rate</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"age_lt_18\">age_lt_18</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"age_18_35\">age_18_35</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"age_36_65\">age_36_65</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"age_gt_65\">age_gt_65</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"educ_hs_less\">educ_hs_less</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"educ_college\">educ_college</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"educ_grad\">educ_grad</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"status_married\">status_married</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"status_nev_mar\">status_nev_mar</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"status_other\">status_other</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"hispanic\">hispanic</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"pop_chg\">pop_chg</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">121.9108</td>\n<td headers=\"unemp_rate\" class=\"gt_row gt_right\">5.1</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.2891927</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">0.2805833</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">0.3565649</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.07365909</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.3582388</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">0.3352050</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.06503496</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.4248964</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">0.2140741</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.3610295</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.2643563</td>\n<td headers=\"pop_chg\" class=\"gt_row gt_right\">0.004055119</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-02-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">121.3285</td>\n<td headers=\"unemp_rate\" class=\"gt_row gt_right\">5.2</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.2894647</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">0.2715200</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">0.3474445</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.09157079</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.3543670</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">0.3517287</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.06345765</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.4104042</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">0.2209950</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.3686007</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.2612721</td>\n<td headers=\"pop_chg\" class=\"gt_row gt_right\">0.004038741</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-03-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">121.5217</td>\n<td headers=\"unemp_rate\" class=\"gt_row gt_right\">5.0</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.2991726</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">0.2852235</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">0.3324601</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.08314374</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.3481381</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">0.3412725</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.06266023</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.4069059</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">0.2147862</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.3783079</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.2732806</td>\n<td headers=\"pop_chg\" class=\"gt_row gt_right\">0.004022495</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-04-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">122.3996</td>\n<td headers=\"unemp_rate\" class=\"gt_row gt_right\">4.8</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.2938252</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">0.2784571</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">0.3445776</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.08314010</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.3324701</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">0.3589532</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.06155738</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.3932068</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">0.2133219</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.3934713</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.2540514</td>\n<td headers=\"pop_chg\" class=\"gt_row gt_right\">0.004006380</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-05-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">123.2863</td>\n<td headers=\"unemp_rate\" class=\"gt_row gt_right\">4.9</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.2744636</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">0.2824573</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">0.3631222</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.07995692</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.3610289</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">0.3519889</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.05978182</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.4005990</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">0.2167855</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.3826155</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.2722199</td>\n<td headers=\"pop_chg\" class=\"gt_row gt_right\">0.003990393</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_left\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-06-01</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">124.4985</td>\n<td headers=\"unemp_rate\" class=\"gt_row gt_right\">5.3</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.2739175</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">0.2861816</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">0.3643186</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.07558240</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.3512415</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">0.3512756</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.06253083</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.4065603</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">0.2122996</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.3811401</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.2734042</td>\n<td headers=\"pop_chg\" class=\"gt_row gt_right\">0.003974533</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nFinally, I'd like to visualize the densities of all of the variables by city just to make sure nothing jumps out that might need any correction.\n\n\n::: {.cell}\n\n```{.r .cell-code}\necon_data |>\n  select(-date) |>\n  pivot_longer(-city, names_to = \"variable\") |>\n  ggplot(aes(x = value, fill = city)) +\n  geom_density(alpha = 0.5) +\n  facet_wrap(\"variable\", scales = \"free\") +\n  theme_bw()\n```\n\n::: {.cell-output-display}\n![](forecasting-with-modeltime-part-1_files/figure-html/plot-densities-1.png){width=672}\n:::\n:::\n\n\nThere are some interesting patterns, particularly in the differences across the age groups, but there's nothing alarming. With all this data in hand, the next step is to perform some time series analysis on the Case-Shiller HPI which I'll show in Part 2 of this set of posts.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}