{
  "hash": "ca5dcd80214f2e4dc9128c914965adc3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Forecasting with {modeltime} - Part IV\"\nsubtitle: \"Tuning many global models\"\nauthor: \"Arcenis Rojas\"\ndate: \"2/20/2024\"\nbibliography: references.bib\nfig-height: 8\nfig-width: 8\ncategories:\n  - Time Series\n  - Forecasting\n  - Machine Learning\n---\n\n\n## Review\n\nUp to this point in the project I acquired data in [Forecasting with {modeltime} - Part I](../20240212-forecasting-with-modeltime-part-1/forecasting-with-modeltime-part-1.qmd), performed some standard time series analysis in [Forecasting with {modeltime} - Part II](../20240215-forecasting-with-modeltime-part-2/forecasting-with-modeltime-part-2.qmd), and explored the two types of modeling processes – global and iterative – for multiple time series in [Forecasting with {modeltime} - Part III](../20240216-forecasting-with-modeltime-part-3/forecasting-with-modeltime-part-3.qmd). In this post I'm going to tune multiple models using a global process to select a small number of them that I will run iteratively in the final post. I'll incorporate some of the other variables in the data set that I gathered in the the first post to forecast the Case-Shiller Home Price Index (HPI). Since I'll be creating variations of model specifications, I'm also going to use functions from the Tidymodels [workflowsets](https://workflowsets.tidymodels.org/) [@workflowsets] package to run the models. As before I'll be using [modeltime](https://business-science.github.io/modeltime/index.html) [@modeltime], [timetk](https://business-science.github.io/timetk/) [@timetk], [tidymodels](https://www.tidymodels.org/) [@tidymodels], [tidyverse](https://www.tidyverse.org/) [@tidyverse], and [gt](#0) [@gt]. Before jumping in, below I show a glimpse of the data that I'll be using.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(timetk)\nlibrary(modeltime)\nlibrary(tidymodels)\nlibrary(gt)\nconflicted::conflict_prefer(\"filter\", \"dplyr\")\nconflicted::conflict_prefer(\"lag\", \"dplyr\")\ntidymodels_prefer()\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nskimr::skim(econ_data)\n```\n\n::: {.cell-output-display}\n\nTable: Data summary\n\n|                         |          |\n|:------------------------|:---------|\n|Name                     |econ_data |\n|Number of rows           |816       |\n|Number of columns        |16        |\n|_______________________  |          |\n|Column type frequency:   |          |\n|character                |1         |\n|Date                     |1         |\n|numeric                  |14        |\n|________________________ |          |\n|Group variables          |None      |\n\n\n**Variable type: character**\n\n|skim_variable | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:-------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|city          |         0|             1|   6|   9|     0|        4|          0|\n\n\n**Variable type: Date**\n\n|skim_variable | n_missing| complete_rate|min        |max        |median     | n_unique|\n|:-------------|---------:|-------------:|:----------|:----------|:----------|--------:|\n|date          |         0|             1|2006-01-01 |2022-12-01 |2014-06-16 |      204|\n\n\n**Variable type: numeric**\n\n|skim_variable  | n_missing| complete_rate|       mean|         sd|         p0|        p25|        p50|         p75|        p100|hist  |\n|:--------------|---------:|-------------:|----------:|----------:|----------:|----------:|----------:|-----------:|-----------:|:-----|\n|hpi            |         0|             1|     172.19|      64.38|      64.47|     122.40|     168.06|      203.87|      427.80|▆▇▃▁▁ |\n|unemp_rate     |         0|             1|       6.50|       2.93|       2.80|       4.20|       5.60|        8.30|       23.90|▇▃▁▁▁ |\n|age_lt_18      |         0|             1|       0.24|       0.02|       0.19|       0.22|       0.24|        0.25|        0.30|▂▇▇▅▂ |\n|age_18_35      |         0|             1|       0.25|       0.02|       0.20|       0.24|       0.25|        0.26|        0.31|▁▃▇▃▁ |\n|age_36_65      |         0|             1|       0.39|       0.02|       0.33|       0.38|       0.39|        0.40|        0.44|▁▃▇▂▁ |\n|age_gt_65      |         0|             1|       0.12|       0.02|       0.07|       0.11|       0.12|        0.14|        0.19|▃▆▇▅▁ |\n|educ_hs_less   |         0|             1|       0.33|       0.03|       0.24|       0.31|       0.33|        0.35|        0.40|▁▃▇▇▃ |\n|educ_college   |         0|             1|       0.38|       0.03|       0.31|       0.36|       0.38|        0.40|        0.48|▂▇▆▃▁ |\n|educ_grad      |         0|             1|       0.10|       0.02|       0.05|       0.08|       0.10|        0.11|        0.16|▃▇▇▅▁ |\n|status_married |         0|             1|       0.40|       0.02|       0.32|       0.39|       0.40|        0.41|        0.45|▁▁▇▇▂ |\n|status_nev_mar |         0|             1|       0.27|       0.03|       0.19|       0.25|       0.27|        0.29|        0.34|▂▅▇▇▂ |\n|status_other   |         0|             1|       0.33|       0.02|       0.28|       0.32|       0.33|        0.34|        0.45|▃▇▃▁▁ |\n|hispanic       |         0|             1|       0.22|       0.11|       0.02|       0.17|       0.25|        0.30|        0.42|▅▁▆▇▂ |\n|population     |         0|             1| 8471150.57| 6499655.47| 2834025.25| 4050215.00| 5109791.12| 10555276.77| 20320876.00|▇▃▁▁▃ |\n\n\n:::\n:::\n\n\n## Splitting the data\n\nThe data split object for a global modeling process is different than that for an iterative modeling process. For the global modeling process I'll use `timetk::time_series_split()` . Below is a look at how the data are split.\n\n\n::: {.cell}\n\n```{.r .cell-code}\necon_splits <- econ_data |>\n  time_series_split(\n    assess = \"2 year\",\n    cumulative = TRUE,\n    date_var = date\n  )\n\necon_splits\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n<Analysis/Assess/Total>\n<720/96/816>\n```\n\n\n:::\n:::\n\n\n## Choosing algorithms\n\nAs with selecting the cities in the analysis I'm interested in getting a little variation in the algorithms to see how they perform and I want to vary the parameters a bit. To get something of a traditional flavor I'm going to run ARIMA models with three different model formulas:\n\n1\\) hpi \\~ date\n\n2\\) hpi \\~ date + unemployment\n\n3\\) hpi \\~ date + unemployment + demographic variables\n\nI'll also have four specifications for the algorithms. One will be the default auto-ARIMA and the other three will be auto-ARIMA specifications with different season lengths. This will give me twelve different ARIMA models (3 recipes x 4 algorithm specifications).\n\nIn much the same way I will have different sets of recipes and model specifications for the following:\n\n-   an exponential smoothing algorithm (including a Holt-Winters specification) to allow for weighting the periods exponentially\n\n-   an STLM algorithm using an ARIMA engine (STLM: **S**easonal **T**rend Decomposition using **L**oess with **M**ultiple seasonal periods)\n\n-   A feed-forward, auto-regressive neural-net algorithm because these tend to have high predictive ability\n\nSome of these algorithms allow for covariates and others (like exponential smoothing) do not. In the end I will have 90 model specifications to test. In order to do speed up the processing I'll employ [modeltime](https://business-science.github.io/modeltime/index.html)'s parallel processing feature.\n\n## Building workflow objects\n\nHere I'll write the three recipes for the ARIMA models and one for the auto-regressive neural-net model. The exponential smoothing and STLM models will both use the first of the three ARIMA recipes as neither of these algorithms can handle covariates.\n\nYou might notice in the code below that I exclude some of the demographic variables like \"educ_hs_less\" for the third ARIMA recipe. I exclude these variables because I found that including all of the variables for a demographic variable group causes the functions to error out much in the same way that including all of the categories of a factor variable would. Initially I did not expect that I would need contrasts considering that the variable values are ratios, but it seems that the fact that the sum of the ratios for a given variable group, e.g., education, is 1 for each row and for each variable group creates a need for contrasts in the regression (this is my guess).\n\n### Writing recipes\n\n::: {.callout-note title=\"Code Explanations\"}\nSome of the code chunks below contain explanations. Lines in explanations will be marked with encircled numbers. Just hover over those numbers to see the corresponding explanation.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\narima_rec1 <- recipe(hpi ~ date, data = training(econ_splits)) # <1>\n\narima_rec2 <- recipe(                                          # <2>\n  hpi ~ date + unemp_rate,\n  data = training(econ_splits)\n) |>\n  step_center(all_numeric_predictors()) |>                     # <3>\n  step_scale(all_numeric_predictors()) |>                      # <4>\n  step_lag(unemp_rate, lag = c(1, 3, 6))                       # <5>\n\nrec3_dep_vars <- econ_data |>                                  # <6>\n  select(date, unemp_rate:population) |>\n  select(!c(educ_hs_less, status_married, age_36_65)) |>\n  names() |>\n  str_flatten(collapse = \" + \")\n\narima_rec3 <- recipe(\n  formula(str_c(\"hpi\", rec3_dep_vars, sep = \" ~ \")),\n  data = training(econ_splits)\n) |>\n  step_center(all_numeric_predictors()) |>\n  step_scale(all_numeric_predictors()) |>\n  step_lag(unemp_rate, population, lag = c(1, 3, 6))\n\nnnet_rec <- recipe(\n  hpi ~ .,\n  data = training(econ_splits)\n) |>\n  update_role(city, new_role = \"ID\") |>                         # <7>\n  step_center(all_numeric_predictors()) |>\n  step_scale(all_numeric_predictors()) |>\n  step_timeseries_signature(date) |>                            # <8>\n  step_nzv(all_predictors())                                    # <9>\n```\n:::\n\n\n1.  Write a base recipe to regress HPI on the date variable\n2.  Write a recipe formula that adds unemployment as an explanatory variable\n3.  Mean-center all numeric predictors (only \"unemployment rate\" here)\n4.  Scale all numeric predictors to have a mean of \"0\" and a standard error of 1\n5.  Create lag variables for \"unemployment rate\" and \"population\"\n6.  Get the names of all the economic and demographic variables from the data set and concatenate them into a formula string to make the right side of a regression formula, i.e., \"var1 + var2 + var3...\"\n7.  Because the \"outcome \\~ .\" notation is being used, the \"city\" variable is included in the \".\", meaning it will be treated as an explanatory variable. This step changes the role of that variable from \"predictor\" to an ID variable, which modeling workflows will exclude from sets of predictors.\n8.  Add a set of variables related to the date such as day of the week of the date, day of the month, number of the week of the year, etc.\n9.  Remove any variables with zero or near-zero variance. An example of this would be a variable indicating the day of the month. Since this is monthly data, all values would be \"1\", i.e., the first day of the month.\n\nHere is a reminder of what a recipe looks like. This is the neural-net recipe.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnnet_rec\n```\n:::\n\n\nAnd this is the data set that gets created by that recipe.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnnet_rec |> prep() |> juice() |> slice(1:5) |> gt() |> gt_bold_head()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"xtqneymmqp\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#xtqneymmqp table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#xtqneymmqp thead, #xtqneymmqp tbody, #xtqneymmqp tfoot, #xtqneymmqp tr, #xtqneymmqp td, #xtqneymmqp th {\n  border-style: none;\n}\n\n#xtqneymmqp p {\n  margin: 0;\n  padding: 0;\n}\n\n#xtqneymmqp .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#xtqneymmqp .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#xtqneymmqp .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#xtqneymmqp .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#xtqneymmqp .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#xtqneymmqp .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xtqneymmqp .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#xtqneymmqp .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#xtqneymmqp .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#xtqneymmqp .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#xtqneymmqp .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#xtqneymmqp .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#xtqneymmqp .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#xtqneymmqp .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#xtqneymmqp .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#xtqneymmqp .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#xtqneymmqp .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#xtqneymmqp .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#xtqneymmqp .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xtqneymmqp .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#xtqneymmqp .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#xtqneymmqp .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#xtqneymmqp .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xtqneymmqp .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#xtqneymmqp .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#xtqneymmqp .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xtqneymmqp .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xtqneymmqp .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#xtqneymmqp .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xtqneymmqp .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#xtqneymmqp .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xtqneymmqp .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#xtqneymmqp .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xtqneymmqp .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#xtqneymmqp .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xtqneymmqp .gt_left {\n  text-align: left;\n}\n\n#xtqneymmqp .gt_center {\n  text-align: center;\n}\n\n#xtqneymmqp .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#xtqneymmqp .gt_font_normal {\n  font-weight: normal;\n}\n\n#xtqneymmqp .gt_font_bold {\n  font-weight: bold;\n}\n\n#xtqneymmqp .gt_font_italic {\n  font-style: italic;\n}\n\n#xtqneymmqp .gt_super {\n  font-size: 65%;\n}\n\n#xtqneymmqp .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#xtqneymmqp .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#xtqneymmqp .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#xtqneymmqp .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#xtqneymmqp .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#xtqneymmqp .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#xtqneymmqp .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"city\">city</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date\">date</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"unemp_rate\">unemp_rate</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"age_lt_18\">age_lt_18</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"age_18_35\">age_18_35</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"age_36_65\">age_36_65</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"age_gt_65\">age_gt_65</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"educ_hs_less\">educ_hs_less</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"educ_college\">educ_college</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"educ_grad\">educ_grad</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"status_married\">status_married</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"status_nev_mar\">status_nev_mar</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"status_other\">status_other</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"hispanic\">hispanic</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"population\">population</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"hpi\">hpi</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_index.num\">date_index.num</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_year\">date_year</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_year.iso\">date_year.iso</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_half\">date_half</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_quarter\">date_quarter</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_month\">date_month</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_month.xts\">date_month.xts</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_month.lbl\">date_month.lbl</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_wday\">date_wday</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_wday.xts\">date_wday.xts</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_wday.lbl\">date_wday.lbl</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_qday\">date_qday</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_yday\">date_yday</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_mweek\">date_mweek</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_week\">date_week</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_week.iso\">date_week.iso</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_week2\">date_week2</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_week3\">date_week3</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"date_week4\">date_week4</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"city\" class=\"gt_row gt_center\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"unemp_rate\" class=\"gt_row gt_right\">-0.5318986</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">1.9837898</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">1.2244300</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">-2.1179446</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">-1.4144536</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">1.4132488</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">-1.9352723</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">-1.0007519</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">0.7138177</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">-1.8445270</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">1.9655339</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.2421831</td>\n<td headers=\"population\" class=\"gt_row gt_right\">-0.4128166</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">121.9108</td>\n<td headers=\"date_index.num\" class=\"gt_row gt_right\">1136073600</td>\n<td headers=\"date_year\" class=\"gt_row gt_right\">2006</td>\n<td headers=\"date_year.iso\" class=\"gt_row gt_right\">2005</td>\n<td headers=\"date_half\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_quarter\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_month\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_month.xts\" class=\"gt_row gt_right\">0</td>\n<td headers=\"date_month.lbl\" class=\"gt_row gt_center\">January</td>\n<td headers=\"date_wday\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_wday.xts\" class=\"gt_row gt_right\">0</td>\n<td headers=\"date_wday.lbl\" class=\"gt_row gt_center\">Sunday</td>\n<td headers=\"date_qday\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_yday\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_mweek\" class=\"gt_row gt_right\">5</td>\n<td headers=\"date_week\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week.iso\" class=\"gt_row gt_right\">52</td>\n<td headers=\"date_week2\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week3\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week4\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_center\">San Diego</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"unemp_rate\" class=\"gt_row gt_right\">-0.8651452</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">-0.2639636</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">-0.5419655</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">-0.1248023</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.7104276</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">-0.6271533</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">1.1018075</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">-0.5165046</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">-0.8376538</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">-0.5633246</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">1.4600357</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.4759810</td>\n<td headers=\"population\" class=\"gt_row gt_right\">-0.8614678</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">247.4588</td>\n<td headers=\"date_index.num\" class=\"gt_row gt_right\">1136073600</td>\n<td headers=\"date_year\" class=\"gt_row gt_right\">2006</td>\n<td headers=\"date_year.iso\" class=\"gt_row gt_right\">2005</td>\n<td headers=\"date_half\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_quarter\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_month\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_month.xts\" class=\"gt_row gt_right\">0</td>\n<td headers=\"date_month.lbl\" class=\"gt_row gt_center\">January</td>\n<td headers=\"date_wday\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_wday.xts\" class=\"gt_row gt_right\">0</td>\n<td headers=\"date_wday.lbl\" class=\"gt_row gt_center\">Sunday</td>\n<td headers=\"date_qday\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_yday\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_mweek\" class=\"gt_row gt_right\">5</td>\n<td headers=\"date_week\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week.iso\" class=\"gt_row gt_right\">52</td>\n<td headers=\"date_week2\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week3\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week4\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_center\">New York</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"unemp_rate\" class=\"gt_row gt_right\">-0.5652232</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">0.4335013</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">-0.7101494</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">-0.3141128</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.2439870</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">1.6923074</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">-1.9655377</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">0.3044405</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">-0.5241964</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">-0.2666740</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">0.7951381</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">-0.1053321</td>\n<td headers=\"population\" class=\"gt_row gt_right\">1.5314733</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">213.4958</td>\n<td headers=\"date_index.num\" class=\"gt_row gt_right\">1136073600</td>\n<td headers=\"date_year\" class=\"gt_row gt_right\">2006</td>\n<td headers=\"date_year.iso\" class=\"gt_row gt_right\">2005</td>\n<td headers=\"date_half\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_quarter\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_month\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_month.xts\" class=\"gt_row gt_right\">0</td>\n<td headers=\"date_month.lbl\" class=\"gt_row gt_center\">January</td>\n<td headers=\"date_wday\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_wday.xts\" class=\"gt_row gt_right\">0</td>\n<td headers=\"date_wday.lbl\" class=\"gt_row gt_center\">Sunday</td>\n<td headers=\"date_qday\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_yday\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_mweek\" class=\"gt_row gt_right\">5</td>\n<td headers=\"date_week\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week.iso\" class=\"gt_row gt_right\">52</td>\n<td headers=\"date_week2\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week3\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week4\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_center\">Detroit</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-01-01</td>\n<td headers=\"unemp_rate\" class=\"gt_row gt_right\">0.1679193</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">1.1233044</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">-1.7256753</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">-0.3452176</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">0.4389330</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">1.7816712</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">-1.6797175</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">-1.2833046</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">-0.7472264</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">-1.1655961</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">2.2179937</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">-1.6335110</td>\n<td headers=\"population\" class=\"gt_row gt_right\">-0.6156132</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">126.6627</td>\n<td headers=\"date_index.num\" class=\"gt_row gt_right\">1136073600</td>\n<td headers=\"date_year\" class=\"gt_row gt_right\">2006</td>\n<td headers=\"date_year.iso\" class=\"gt_row gt_right\">2005</td>\n<td headers=\"date_half\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_quarter\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_month\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_month.xts\" class=\"gt_row gt_right\">0</td>\n<td headers=\"date_month.lbl\" class=\"gt_row gt_center\">January</td>\n<td headers=\"date_wday\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_wday.xts\" class=\"gt_row gt_right\">0</td>\n<td headers=\"date_wday.lbl\" class=\"gt_row gt_center\">Sunday</td>\n<td headers=\"date_qday\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_yday\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_mweek\" class=\"gt_row gt_right\">5</td>\n<td headers=\"date_week\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week.iso\" class=\"gt_row gt_right\">52</td>\n<td headers=\"date_week2\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week3\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week4\" class=\"gt_row gt_right\">1</td></tr>\n    <tr><td headers=\"city\" class=\"gt_row gt_center\">Dallas</td>\n<td headers=\"date\" class=\"gt_row gt_right\">2006-02-01</td>\n<td headers=\"unemp_rate\" class=\"gt_row gt_right\">-0.4985739</td>\n<td headers=\"age_lt_18\" class=\"gt_row gt_right\">2.4431155</td>\n<td headers=\"age_18_35\" class=\"gt_row gt_right\">1.3332951</td>\n<td headers=\"age_36_65\" class=\"gt_row gt_right\">-2.2373194</td>\n<td headers=\"age_gt_65\" class=\"gt_row gt_right\">-1.7310508</td>\n<td headers=\"educ_hs_less\" class=\"gt_row gt_right\">0.7705532</td>\n<td headers=\"educ_college\" class=\"gt_row gt_right\">-0.9746432</td>\n<td headers=\"educ_grad\" class=\"gt_row gt_right\">-1.6783801</td>\n<td headers=\"status_married\" class=\"gt_row gt_right\">1.0008565</td>\n<td headers=\"status_nev_mar\" class=\"gt_row gt_right\">-1.5342766</td>\n<td headers=\"status_other\" class=\"gt_row gt_right\">1.3033739</td>\n<td headers=\"hispanic\" class=\"gt_row gt_right\">0.4153678</td>\n<td headers=\"population\" class=\"gt_row gt_right\">-0.4092439</td>\n<td headers=\"hpi\" class=\"gt_row gt_right\">121.3285</td>\n<td headers=\"date_index.num\" class=\"gt_row gt_right\">1138752000</td>\n<td headers=\"date_year\" class=\"gt_row gt_right\">2006</td>\n<td headers=\"date_year.iso\" class=\"gt_row gt_right\">2006</td>\n<td headers=\"date_half\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_quarter\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_month\" class=\"gt_row gt_right\">2</td>\n<td headers=\"date_month.xts\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_month.lbl\" class=\"gt_row gt_center\">February</td>\n<td headers=\"date_wday\" class=\"gt_row gt_right\">4</td>\n<td headers=\"date_wday.xts\" class=\"gt_row gt_right\">3</td>\n<td headers=\"date_wday.lbl\" class=\"gt_row gt_center\">Wednesday</td>\n<td headers=\"date_qday\" class=\"gt_row gt_right\">32</td>\n<td headers=\"date_yday\" class=\"gt_row gt_right\">32</td>\n<td headers=\"date_mweek\" class=\"gt_row gt_right\">5</td>\n<td headers=\"date_week\" class=\"gt_row gt_right\">5</td>\n<td headers=\"date_week.iso\" class=\"gt_row gt_right\">5</td>\n<td headers=\"date_week2\" class=\"gt_row gt_right\">1</td>\n<td headers=\"date_week3\" class=\"gt_row gt_right\">2</td>\n<td headers=\"date_week4\" class=\"gt_row gt_right\">1</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n### Specifying models\n\nIn this next step I'll specify the model objects for each algorithm along with the search grids for their various hyperparameters. I chose to keep only some of the combinations of the exponential smoothing specifications to limit the number of models being run that are likely to fail.\n\n\n::: {.cell}\n\n```{.r .cell-code}\narima_default <- arima_reg() |> set_engine(\"auto_arima\")                        # <1>\n\narima_spec_grid <- tibble(seasonal_period = seq(9, 18, by = 3)) |>              # <2>\n  create_model_grid(                                                            # <3>\n    f_model_spec = arima_reg,\n    engine_name = \"auto_arima\",\n    mode = \"regression\"\n  )\n\nets_default <- exp_smoothing() |> set_engine(\"ets\")\n\nset.seed(40)                                                                    # <4>\nalpha_vals <- runif(5, 0.01, 0.5) *\n  sample(c(1, 0.1, 0.01, .001), 5, replace = TRUE)\nbeta_vals <- runif(5, 0.01, 0.2) * sample(c(1, 0.1, 0.01), 5, replace = TRUE)\ngamma_vals <- map_dbl(\n  alpha_vals,\n  \\(x) runif(1, 0, 1 - x)\n)\n\nets_spec_grid <- expand_grid(                                                   # <5>\n  smooth_level = alpha_vals[-2],\n  smooth_seasonal = gamma_vals[2:3],\n  seasonal_period = seq(9, 18, by = 3)\n) |>\n  create_model_grid(\n    f_model_spec = exp_smoothing,\n    engine_name = \"ets\",\n    mode = \"regression\",\n    error = \"auto\",\n    trend = \"auto\",\n    season = \"auto\",\n    smooth_trend = beta_vals[3]\n  )\n\nstlm_spec_grid <- expand_grid(\n  seasonal_period_2 = c(NULL, seq(6, 18, by = 3))\n) |>\n  create_model_grid(\n    f_model_spec = seasonal_reg,\n    engine_name = \"stlm_arima\",\n    mode = \"regression\",\n    seasonal_period_1 = 12\n  )\n\nnnet_default <- nnetar_reg() |> set_engine(\"nnetar\")\n\nnnet_spec_grid <- expand_grid(\n  non_seasonal_ar = 1:3,\n  hidden_units = 3:5,\n  num_networks = c(20, 25),\n  penalty = c(0.2, 0.25)\n) |>\n  create_model_grid(\n    f_model_spec = nnetar_reg,\n    engine_name = \"nnetar\",\n    mode = \"regression\",\n    seasonal_period = 12,\n    epochs = 100,\n    seasonal_ar = 1\n  )\n```\n:::\n\n\n1.  Specify an ARIMA regression model using the \"auto_arima\" engine with all default arguments\n2.  Create a 1-column `tibble` (data frame) with the `seasonal_period` argument set to vary as 9, 12, 15, and 18 (months).\n3.  `create_model_grid()` allows one to set static arguments to combine them with the arguments that vary. This is meant to serve a similar purpose as `tune::tune_grid()` from Tidymodels.\n4.  Set a random seed for reproducibility and generate vectors for the `smooth_level`, `smooth_trend`, and `smooth_seasonal` arguments. In `forecast::ets()` these are `alpha`, `beta`, and `gamma` respectively.\n5.  Use `tidyr::expand_grid()` to get all combinations of the included vectors.\n\nBelow is what a model grid looks like.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nets_spec_grid |> slice(1:5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 5 × 4\n  smooth_level smooth_seasonal seasonal_period .models  \n         <dbl>           <dbl>           <dbl> <list>   \n1       0.0345           0.569               9 <spec[+]>\n2       0.0345           0.569              12 <spec[+]>\n3       0.0345           0.569              15 <spec[+]>\n4       0.0345           0.569              18 <spec[+]>\n5       0.0345           0.763               9 <spec[+]>\n```\n\n\n:::\n:::\n\n\nThis is a glimpse of a model specification.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nets_spec_grid |> slice(1) |> pluck(\".models\", 1)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nExponential Smoothing State Space Model Specification (regression)\n\nMain Arguments:\n  seasonal_period = 9\n  error = auto\n  trend = auto\n  season = auto\n  smooth_level = 0.0344955188313033\n  smooth_trend = 0.0247416579537094\n  smooth_seasonal = 0.569256213388705\n\nComputational engine: ets \n```\n\n\n:::\n:::\n\n\n### Building workflowsets\n\nA `workflowset` is, you guessed it, a set of workflows. Mechanically it is a very convenient wrapper that can put together different combinations of recipes (pre-processors) and models. I don't want to mix all of my recipes with all of my models, however. So, in this step I'll make sets of individuals that combine the appropriate sets of recipes and models then I'll bind all of them together at the end.\n\n\n::: {.cell}\n\n```{.r .cell-code}\narima_wfset <- workflow_set(                # <1>\n  preproc = list(                           # <2>\n    base_rec = arima_rec1,\n    econ_rec = arima_rec2,\n    demog_rec = arima_rec3\n  ),\n  models = c(                               # <3>\n    arima_default = list(arima_default),\n    arima_spec = arima_spec_grid$.models\n  ),\n  cross = TRUE                              # <4>\n)\n\nets_wfset <- workflow_set(\n  preproc = list(base_rec = arima_rec1),\n  models = c(ets_default = list(ets_default), ets_spec = ets_spec_grid$.models),\n  cross = TRUE\n)\n\nstlm_wfset <- workflow_set(\n  preproc = list(base_rec = arima_rec1),\n  models = c(stlm_spec = stlm_spec_grid$.models),\n  cross = TRUE\n)\n\nnnet_wfset <- workflow_set(\n  preproc = list(nnet_rec = nnet_rec),\n  models = c(\n    nnet_default = list(nnet_default),\n    nnet_spec = nnet_spec_grid$.models\n  ),\n  cross = TRUE\n)\n```\n:::\n\n\n1.  Call `workflowsets::workflowset()`\n2.  Provide a named list of recipes to use in the `workflowset`; naming the elements at this stage makes it easier to match up the elements of the final table containing the trained models with the original recipes and model specifications\n3.  Provide a named list of model specifications by pulling the \".models\" column from each grid\n4.  Indicate that all recipes should be combined with all model specifications\n\nThe individual specifications in the final model table will be named using a combination of the name of the recipe and the name of the model specification given in the respective lists with a count added whenever there are duplicate names. For example, arima_spec_grid has four model specifications in it. The ones that are combined with the first ARIMA recipe (named \"base_rec\") will be named BASE_REC_ARIMA_SPEC1, BASE_REC_ARIMA_SPEC2, BASE_REC_ARIMA_SPEC3, and BASE_REC_ARIMA_SPEC4.\n\nWith all of the model-specific workflow sets created, now it's time to put them all together.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhpi_wfset <- bind_rows(arima_wfset, ets_wfset, stlm_wfset, nnet_wfset)\n\nhpi_wfset |> slice(1:5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A workflow set/tibble: 5 × 4\n  wflow_id               info             option    result    \n  <chr>                  <list>           <list>    <list>    \n1 base_rec_arima_default <tibble [1 × 4]> <opts[0]> <list [0]>\n2 base_rec_arima_spec1   <tibble [1 × 4]> <opts[0]> <list [0]>\n3 base_rec_arima_spec2   <tibble [1 × 4]> <opts[0]> <list [0]>\n4 base_rec_arima_spec3   <tibble [1 × 4]> <opts[0]> <list [0]>\n5 base_rec_arima_spec4   <tibble [1 × 4]> <opts[0]> <list [0]>\n```\n\n\n:::\n:::\n\n\nThat's all the heavy lifting. Now it's time to let the computer processors do their part and run the models.\n\n## Fitting the models\n\n\n::: {.cell}\n\n```{.r .cell-code}\navail_cores <- unname(parallelly::availableCores() - 1)                     # <1>\nmodulo_vec <- sapply(avail_cores:2, \\(x) nrow(hpi_wfset) %% x)              \nnum_cores <- max(                                                           # <2>\n  max(which(modulo_vec == max(modulo_vec))),\n    max(which(modulo_vec == 0))\n) + 1\n\ncl <- parallel::makePSOCKcluster(num_cores)                                 # <3>\ndoParallel::registerDoParallel(cl)                                          # <3>\ninvisible(                                                                  # <3>\n  parallel::clusterCall(cl, function(x) .libPaths(x), .libPaths())          # <3>\n)                                                                           # <3>\nparallel::clusterEvalQ(cl, set.seed(500))                                   # <3>\n\nhpi_mods_start <- proc.time()\n\nhpi_mods <- hpi_wfset |>                                                    # <4>\n  modeltime_fit_workflowset(                                                # <5>\n    data = training(econ_splits),                                           # <6>\n    control = control_fit_workflowset(verbose = FALSE, allow_par = TRUE)    # <7>\n  )\n\nhpi_mods_end <- proc.time()\n\nparallel::stopCluster(cl)                                                   # <8>\nrm(cl)\ngc()\n```\n:::\n\n\n1.  Get the number of cores available and leave one out for common tasks like running the operating system\n2.  Calculate the number of cores to use in order to maximize efficiency\n3.  Set up the cluster for parallel processing\n4.  Call the `workflowset` object containing all the workflows to run\n5.  Use `modeltime::modeltime_fit_workflowset()` to fit all of the models\n6.  Use the training portion of the split object to train the models\n7.  Set some controls for the model fitting function\n8.  Stop the parallel cluster from running\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfit_time <- (hpi_mods_end - hpi_mods_start) |>\n  enframe(\"time_metric\", \"seconds\") |>\n  drop_na(seconds)\n\nfit_time |> gt() |> gt_bold_head()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"vtzoeifemm\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#vtzoeifemm table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#vtzoeifemm thead, #vtzoeifemm tbody, #vtzoeifemm tfoot, #vtzoeifemm tr, #vtzoeifemm td, #vtzoeifemm th {\n  border-style: none;\n}\n\n#vtzoeifemm p {\n  margin: 0;\n  padding: 0;\n}\n\n#vtzoeifemm .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#vtzoeifemm .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#vtzoeifemm .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#vtzoeifemm .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#vtzoeifemm .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#vtzoeifemm .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vtzoeifemm .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#vtzoeifemm .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#vtzoeifemm .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#vtzoeifemm .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#vtzoeifemm .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#vtzoeifemm .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#vtzoeifemm .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#vtzoeifemm .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#vtzoeifemm .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#vtzoeifemm .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#vtzoeifemm .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#vtzoeifemm .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#vtzoeifemm .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vtzoeifemm .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#vtzoeifemm .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#vtzoeifemm .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#vtzoeifemm .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vtzoeifemm .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#vtzoeifemm .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#vtzoeifemm .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vtzoeifemm .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vtzoeifemm .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#vtzoeifemm .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vtzoeifemm .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#vtzoeifemm .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vtzoeifemm .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#vtzoeifemm .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vtzoeifemm .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#vtzoeifemm .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vtzoeifemm .gt_left {\n  text-align: left;\n}\n\n#vtzoeifemm .gt_center {\n  text-align: center;\n}\n\n#vtzoeifemm .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#vtzoeifemm .gt_font_normal {\n  font-weight: normal;\n}\n\n#vtzoeifemm .gt_font_bold {\n  font-weight: bold;\n}\n\n#vtzoeifemm .gt_font_italic {\n  font-style: italic;\n}\n\n#vtzoeifemm .gt_super {\n  font-size: 65%;\n}\n\n#vtzoeifemm .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#vtzoeifemm .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#vtzoeifemm .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#vtzoeifemm .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#vtzoeifemm .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#vtzoeifemm .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#vtzoeifemm .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"time_metric\">time_metric</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"seconds\">seconds</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"time_metric\" class=\"gt_row gt_left\">user.self</td>\n<td headers=\"seconds\" class=\"gt_row gt_center\">1.16</td></tr>\n    <tr><td headers=\"time_metric\" class=\"gt_row gt_left\">sys.self</td>\n<td headers=\"seconds\" class=\"gt_row gt_center\">0.12</td></tr>\n    <tr><td headers=\"time_metric\" class=\"gt_row gt_left\">elapsed</td>\n<td headers=\"seconds\" class=\"gt_row gt_center\">81.83</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nAbout 81.83 seconds elapsed during model-fitting with parallel processing. Not too bad. Unfortunately, though, some of the models failed (I suppressed error printing). So, before calibrating the models I'm going to drop those from the model output data set. But first I'll investigate the model failures a little.\n\n## Investigating failed models\n\nHere's a look at some of the models that failed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod_fail_df <- hpi_mods |>\n  mutate(mod_fail = map_lgl(.model, \\(x) is.null(x))) |>\n  select(!.model)\n\nmod_fail_df |>\n  group_by(mod_fail) |>\n  slice_min(.model_id, n = 3) |>\n  gt(groupname_col = NULL) |>\n  gt_bold_head()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"vaossgjhsw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#vaossgjhsw table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#vaossgjhsw thead, #vaossgjhsw tbody, #vaossgjhsw tfoot, #vaossgjhsw tr, #vaossgjhsw td, #vaossgjhsw th {\n  border-style: none;\n}\n\n#vaossgjhsw p {\n  margin: 0;\n  padding: 0;\n}\n\n#vaossgjhsw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#vaossgjhsw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#vaossgjhsw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#vaossgjhsw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#vaossgjhsw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#vaossgjhsw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vaossgjhsw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#vaossgjhsw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#vaossgjhsw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#vaossgjhsw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#vaossgjhsw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#vaossgjhsw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#vaossgjhsw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#vaossgjhsw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#vaossgjhsw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#vaossgjhsw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#vaossgjhsw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#vaossgjhsw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#vaossgjhsw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vaossgjhsw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#vaossgjhsw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#vaossgjhsw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#vaossgjhsw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vaossgjhsw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#vaossgjhsw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#vaossgjhsw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vaossgjhsw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vaossgjhsw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#vaossgjhsw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vaossgjhsw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#vaossgjhsw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#vaossgjhsw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#vaossgjhsw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vaossgjhsw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#vaossgjhsw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#vaossgjhsw .gt_left {\n  text-align: left;\n}\n\n#vaossgjhsw .gt_center {\n  text-align: center;\n}\n\n#vaossgjhsw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#vaossgjhsw .gt_font_normal {\n  font-weight: normal;\n}\n\n#vaossgjhsw .gt_font_bold {\n  font-weight: bold;\n}\n\n#vaossgjhsw .gt_font_italic {\n  font-style: italic;\n}\n\n#vaossgjhsw .gt_super {\n  font-size: 65%;\n}\n\n#vaossgjhsw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#vaossgjhsw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#vaossgjhsw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#vaossgjhsw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#vaossgjhsw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#vaossgjhsw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#vaossgjhsw .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\".model_id\">.model_id</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\".model_desc\">.model_desc</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"mod_fail\">mod_fail</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">1</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ARIMA_DEFAULT</td>\n<td headers=\"mod_fail\" class=\"gt_row gt_center\">FALSE</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">2</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ARIMA_SPEC1</td>\n<td headers=\"mod_fail\" class=\"gt_row gt_center\">FALSE</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">3</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ARIMA_SPEC2</td>\n<td headers=\"mod_fail\" class=\"gt_row gt_center\">FALSE</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">33</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC17</td>\n<td headers=\"mod_fail\" class=\"gt_row gt_center\">TRUE</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">34</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC18</td>\n<td headers=\"mod_fail\" class=\"gt_row gt_center\">TRUE</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">35</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC19</td>\n<td headers=\"mod_fail\" class=\"gt_row gt_center\">TRUE</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nNow I want to see the distinct names of the recipes and algorithms (model specifications) that failed.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfailure_spec_df <- mod_fail_df |>\n  filter(mod_fail) |>\n  separate_wider_delim(\n    .model_desc,\n    delim = \"_\",\n    names = c(\"rec_name\", \"rec\", \"algo\", \"spec\")\n  ) |>\n  separate_wider_regex(spec, patterns = c(spec = \"SPEC\", spec_num = \"\\\\d+\"))\n\nfailure_spec_df |> distinct(rec_name, algo, spec) |> gt() |> gt_bold_head()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"ezrmrdksxp\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ezrmrdksxp table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ezrmrdksxp thead, #ezrmrdksxp tbody, #ezrmrdksxp tfoot, #ezrmrdksxp tr, #ezrmrdksxp td, #ezrmrdksxp th {\n  border-style: none;\n}\n\n#ezrmrdksxp p {\n  margin: 0;\n  padding: 0;\n}\n\n#ezrmrdksxp .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ezrmrdksxp .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ezrmrdksxp .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ezrmrdksxp .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ezrmrdksxp .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ezrmrdksxp .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ezrmrdksxp .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ezrmrdksxp .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ezrmrdksxp .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ezrmrdksxp .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ezrmrdksxp .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ezrmrdksxp .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ezrmrdksxp .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ezrmrdksxp .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ezrmrdksxp .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ezrmrdksxp .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ezrmrdksxp .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ezrmrdksxp .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ezrmrdksxp .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ezrmrdksxp .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ezrmrdksxp .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ezrmrdksxp .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ezrmrdksxp .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ezrmrdksxp .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ezrmrdksxp .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ezrmrdksxp .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ezrmrdksxp .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ezrmrdksxp .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ezrmrdksxp .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ezrmrdksxp .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ezrmrdksxp .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ezrmrdksxp .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ezrmrdksxp .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ezrmrdksxp .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ezrmrdksxp .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ezrmrdksxp .gt_left {\n  text-align: left;\n}\n\n#ezrmrdksxp .gt_center {\n  text-align: center;\n}\n\n#ezrmrdksxp .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ezrmrdksxp .gt_font_normal {\n  font-weight: normal;\n}\n\n#ezrmrdksxp .gt_font_bold {\n  font-weight: bold;\n}\n\n#ezrmrdksxp .gt_font_italic {\n  font-style: italic;\n}\n\n#ezrmrdksxp .gt_super {\n  font-size: 65%;\n}\n\n#ezrmrdksxp .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ezrmrdksxp .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ezrmrdksxp .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ezrmrdksxp .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ezrmrdksxp .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ezrmrdksxp .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ezrmrdksxp .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"rec_name\">rec_name</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"algo\">algo</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"spec\">spec</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"rec_name\" class=\"gt_row gt_left\">BASE</td>\n<td headers=\"algo\" class=\"gt_row gt_left\">ETS</td>\n<td headers=\"spec\" class=\"gt_row gt_left\">SPEC</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nSince the failures occurred with only one algorithm they'll be easy to isolate. Now I want to get the numbers of the specifications that failed so that I can pull up the details on those specifications.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfailures <- failure_spec_df |>\n  pull(spec_num) |>\n  as.numeric()\n\nets_failed <- ets_spec_grid |>\n  slice(failures) |>\n  select(!.models)\n\nets_failed |>\n  count(smooth_level) |>\n  gt() |>\n  gt_bold_head()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"zbzttxfang\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#zbzttxfang table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#zbzttxfang thead, #zbzttxfang tbody, #zbzttxfang tfoot, #zbzttxfang tr, #zbzttxfang td, #zbzttxfang th {\n  border-style: none;\n}\n\n#zbzttxfang p {\n  margin: 0;\n  padding: 0;\n}\n\n#zbzttxfang .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#zbzttxfang .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#zbzttxfang .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#zbzttxfang .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#zbzttxfang .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#zbzttxfang .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zbzttxfang .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#zbzttxfang .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#zbzttxfang .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#zbzttxfang .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#zbzttxfang .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#zbzttxfang .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#zbzttxfang .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#zbzttxfang .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#zbzttxfang .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#zbzttxfang .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#zbzttxfang .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#zbzttxfang .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#zbzttxfang .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zbzttxfang .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#zbzttxfang .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#zbzttxfang .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#zbzttxfang .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zbzttxfang .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#zbzttxfang .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#zbzttxfang .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zbzttxfang .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zbzttxfang .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#zbzttxfang .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zbzttxfang .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#zbzttxfang .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#zbzttxfang .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#zbzttxfang .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zbzttxfang .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#zbzttxfang .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#zbzttxfang .gt_left {\n  text-align: left;\n}\n\n#zbzttxfang .gt_center {\n  text-align: center;\n}\n\n#zbzttxfang .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#zbzttxfang .gt_font_normal {\n  font-weight: normal;\n}\n\n#zbzttxfang .gt_font_bold {\n  font-weight: bold;\n}\n\n#zbzttxfang .gt_font_italic {\n  font-style: italic;\n}\n\n#zbzttxfang .gt_super {\n  font-size: 65%;\n}\n\n#zbzttxfang .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#zbzttxfang .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#zbzttxfang .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#zbzttxfang .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#zbzttxfang .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#zbzttxfang .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#zbzttxfang .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"smooth_level\">smooth_level</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"n\">n</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"smooth_level\" class=\"gt_row gt_right\">6.680868e-05</td>\n<td headers=\"n\" class=\"gt_row gt_right\">8</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nOverall there were 8 out of 32 failed exponential smoothing models. That's not terrible. I'm going to remove these specifications from the trained model data set and move on to model evaluation.\n\n## Model evaluation\n\nTo evaluate the models first I need to calibrate them. I'll remove the failed models, calibrate the successful ones, and store accuracy tables here. Below are the 10 best-performing global models, i.e., the ones that performed best on the batched series with all four cities. I defined \"best\" as the models with the lowest SMAPE (Scaled Mean Average Percent Error) values.\n\n::: {.callout-note collapse=\"true\" title=\"Breaking up calibration step\"}\nI broke up the code for calibrating the models below into two separate chunks to keep the file sizes of cached files a bit smaller. I cached the output to make the page easier to render. This step of splitting up the `modeltime_table` for calibration is not typically necessary.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhpi_mods <- hpi_mods |> slice(which(!mod_fail_df$mod_fail))\n\nnum_mods <- nrow(hpi_mods)\nhpi_mod_idx <- split(1:num_mods, ceiling(seq_along(1:num_mods) / (num_mods / 3)))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhpi_mod_calib1 <- hpi_mods |>\n  slice(hpi_mod_idx[[1]]) |>\n  modeltime_calibrate(testing(econ_splits), id = \"city\", quiet = TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhpi_mod_calib2 <- hpi_mods |>\n  slice(hpi_mod_idx[[2]]) |>\n  modeltime_calibrate(testing(econ_splits), id = \"city\", quiet = TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhpi_mod_calib3 <- hpi_mods |>\n  slice(hpi_mod_idx[[3]]) |>\n  modeltime_calibrate(testing(econ_splits), id = \"city\", quiet = TRUE)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhpi_mod_calib <- bind_rows(hpi_mod_calib1, hpi_mod_calib2)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nhpi_mod_accuracy <- hpi_mod_calib |>\n  modeltime_accuracy() |>\n  drop_na(.type)\n\nhpi_local_mod_accuracy <- hpi_mod_calib |>\n  modeltime_accuracy(acc_by_id = TRUE) |>\n  drop_na(.type)\n\nbest_global_table <- hpi_mod_accuracy |>\n  slice_min(smape, n = 10)\n\nbest_local_table <- hpi_local_mod_accuracy |>\n  group_by(city) |>\n  slice_min(smape, n = 3)\n\nbest_global_table |>\n  table_modeltime_accuracy(\n    .interactive = FALSE,\n    .title = \"Global Accuracy\"\n  ) |>\n  gt_bold_head() |>\n  tab_style(\n    style = cell_text(weight = \"bold\"),\n    locations = cells_title()\n  )\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"xqzstlgqxs\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#xqzstlgqxs table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#xqzstlgqxs thead, #xqzstlgqxs tbody, #xqzstlgqxs tfoot, #xqzstlgqxs tr, #xqzstlgqxs td, #xqzstlgqxs th {\n  border-style: none;\n}\n\n#xqzstlgqxs p {\n  margin: 0;\n  padding: 0;\n}\n\n#xqzstlgqxs .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#xqzstlgqxs .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#xqzstlgqxs .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#xqzstlgqxs .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#xqzstlgqxs .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#xqzstlgqxs .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xqzstlgqxs .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#xqzstlgqxs .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#xqzstlgqxs .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#xqzstlgqxs .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#xqzstlgqxs .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#xqzstlgqxs .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#xqzstlgqxs .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#xqzstlgqxs .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#xqzstlgqxs .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#xqzstlgqxs .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#xqzstlgqxs .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#xqzstlgqxs .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#xqzstlgqxs .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xqzstlgqxs .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#xqzstlgqxs .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#xqzstlgqxs .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#xqzstlgqxs .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xqzstlgqxs .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#xqzstlgqxs .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#xqzstlgqxs .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xqzstlgqxs .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xqzstlgqxs .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#xqzstlgqxs .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xqzstlgqxs .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#xqzstlgqxs .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#xqzstlgqxs .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#xqzstlgqxs .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xqzstlgqxs .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#xqzstlgqxs .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#xqzstlgqxs .gt_left {\n  text-align: left;\n}\n\n#xqzstlgqxs .gt_center {\n  text-align: center;\n}\n\n#xqzstlgqxs .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#xqzstlgqxs .gt_font_normal {\n  font-weight: normal;\n}\n\n#xqzstlgqxs .gt_font_bold {\n  font-weight: bold;\n}\n\n#xqzstlgqxs .gt_font_italic {\n  font-style: italic;\n}\n\n#xqzstlgqxs .gt_super {\n  font-size: 65%;\n}\n\n#xqzstlgqxs .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#xqzstlgqxs .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#xqzstlgqxs .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#xqzstlgqxs .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#xqzstlgqxs .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#xqzstlgqxs .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#xqzstlgqxs .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"9\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style=\"font-weight: bold;\">Global Accuracy</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\".model_id\">.model_id</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\".model_desc\">.model_desc</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\".type\">.type</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"mae\">mae</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"mape\">mape</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"mase\">mase</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"smape\">smape</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"rmse\">rmse</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"rsq\">rsq</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">16</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_DEFAULT</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">19.29</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">6.22</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.18</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">6.59</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">28.08</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">0.96</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">1</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ARIMA_DEFAULT</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">20.79</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">7.14</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.19</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">7.37</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">29.50</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">0.95</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">3</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ARIMA_SPEC2</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">20.79</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">7.14</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.19</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">7.37</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">29.50</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">0.95</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">30</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC14</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">20.81</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">7.48</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.19</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">7.60</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">28.89</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">0.95</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">22</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC6</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">20.80</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">7.48</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.19</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">7.60</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">28.87</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">0.95</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">46</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC30</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">22.16</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">7.53</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.21</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">7.82</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">31.18</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">0.95</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">42</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC26</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">22.31</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">7.77</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.21</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">8.00</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">31.01</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">0.95</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">53</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_STLM_SPEC5</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">30.98</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">9.75</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.29</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">10.59</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">43.56</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">0.94</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">49</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_STLM_SPEC1</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">31.20</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">9.81</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.29</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">10.68</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">43.87</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">0.93</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">52</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_STLM_SPEC4</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">32.10</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">10.02</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.30</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">10.94</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">45.27</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">0.93</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nNext is a table with the best 3 models calibrated to each city.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbest_local_table|>\n  table_modeltime_accuracy(\n    .interactive = FALSE,\n    .title = \"Accuracy by City\"\n  ) |>\n  gt_bold_head() |>\n  tab_style(\n    style = cell_text(weight = \"bold\"),\n    locations = cells_title()\n  ) |>\n  tab_style(\n    style = list(cell_text(weight = \"bold\"), cell_fill(color = \"lightgray\")),\n    locations = cells_group()\n  ) |>\n  tab_style(\n    style = cell_borders(\n      sides = c(\"top\", \"bottom\"),\n      weight = px(2),\n      style = (\"solid\")\n    ),\n    locations = cells_group()\n  )\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"etfuwndwsu\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#etfuwndwsu table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#etfuwndwsu thead, #etfuwndwsu tbody, #etfuwndwsu tfoot, #etfuwndwsu tr, #etfuwndwsu td, #etfuwndwsu th {\n  border-style: none;\n}\n\n#etfuwndwsu p {\n  margin: 0;\n  padding: 0;\n}\n\n#etfuwndwsu .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#etfuwndwsu .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#etfuwndwsu .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#etfuwndwsu .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#etfuwndwsu .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#etfuwndwsu .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#etfuwndwsu .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#etfuwndwsu .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#etfuwndwsu .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#etfuwndwsu .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#etfuwndwsu .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#etfuwndwsu .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#etfuwndwsu .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#etfuwndwsu .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#etfuwndwsu .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#etfuwndwsu .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#etfuwndwsu .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#etfuwndwsu .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#etfuwndwsu .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#etfuwndwsu .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#etfuwndwsu .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#etfuwndwsu .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#etfuwndwsu .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#etfuwndwsu .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#etfuwndwsu .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#etfuwndwsu .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#etfuwndwsu .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#etfuwndwsu .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#etfuwndwsu .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#etfuwndwsu .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#etfuwndwsu .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#etfuwndwsu .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#etfuwndwsu .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#etfuwndwsu .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#etfuwndwsu .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#etfuwndwsu .gt_left {\n  text-align: left;\n}\n\n#etfuwndwsu .gt_center {\n  text-align: center;\n}\n\n#etfuwndwsu .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#etfuwndwsu .gt_font_normal {\n  font-weight: normal;\n}\n\n#etfuwndwsu .gt_font_bold {\n  font-weight: bold;\n}\n\n#etfuwndwsu .gt_font_italic {\n  font-style: italic;\n}\n\n#etfuwndwsu .gt_super {\n  font-size: 65%;\n}\n\n#etfuwndwsu .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#etfuwndwsu .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#etfuwndwsu .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#etfuwndwsu .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#etfuwndwsu .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#etfuwndwsu .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#etfuwndwsu .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"9\" class=\"gt_heading gt_title gt_font_normal gt_bottom_border\" style=\"font-weight: bold;\">Accuracy by City</td>\n    </tr>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\".model_id\">.model_id</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\".model_desc\">.model_desc</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\".type\">.type</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"mae\">mae</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"mape\">mape</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"mase\">mase</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"smape\">smape</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"rmse\">rmse</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"rsq\">rsq</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"9\" class=\"gt_group_heading\" style=\"font-weight: bold; background-color: #D3D3D3; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"colgroup\" id=\"Dallas\">Dallas</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Dallas  .model_id\" class=\"gt_row gt_right\">12</td>\n<td headers=\"Dallas  .model_desc\" class=\"gt_row gt_left\">DEMOG_REC_ARIMA_SPEC1</td>\n<td headers=\"Dallas  .type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"Dallas  mae\" class=\"gt_row gt_right\">13.99</td>\n<td headers=\"Dallas  mape\" class=\"gt_row gt_right\">5.18</td>\n<td headers=\"Dallas  mase\" class=\"gt_row gt_right\">2.65</td>\n<td headers=\"Dallas  smape\" class=\"gt_row gt_right\">5.32</td>\n<td headers=\"Dallas  rmse\" class=\"gt_row gt_right\">15.79</td>\n<td headers=\"Dallas  rsq\" class=\"gt_row gt_right\">0.80</td></tr>\n    <tr><td headers=\"Dallas  .model_id\" class=\"gt_row gt_right\">14</td>\n<td headers=\"Dallas  .model_desc\" class=\"gt_row gt_left\">DEMOG_REC_ARIMA_SPEC3</td>\n<td headers=\"Dallas  .type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"Dallas  mae\" class=\"gt_row gt_right\">14.19</td>\n<td headers=\"Dallas  mape\" class=\"gt_row gt_right\">5.24</td>\n<td headers=\"Dallas  mase\" class=\"gt_row gt_right\">2.69</td>\n<td headers=\"Dallas  smape\" class=\"gt_row gt_right\">5.39</td>\n<td headers=\"Dallas  rmse\" class=\"gt_row gt_right\">15.97</td>\n<td headers=\"Dallas  rsq\" class=\"gt_row gt_right\">0.80</td></tr>\n    <tr><td headers=\"Dallas  .model_id\" class=\"gt_row gt_right\">22</td>\n<td headers=\"Dallas  .model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC6</td>\n<td headers=\"Dallas  .type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"Dallas  mae\" class=\"gt_row gt_right\">20.59</td>\n<td headers=\"Dallas  mape\" class=\"gt_row gt_right\">7.34</td>\n<td headers=\"Dallas  mase\" class=\"gt_row gt_right\">3.93</td>\n<td headers=\"Dallas  smape\" class=\"gt_row gt_right\">7.72</td>\n<td headers=\"Dallas  rmse\" class=\"gt_row gt_right\">24.76</td>\n<td headers=\"Dallas  rsq\" class=\"gt_row gt_right\">0.85</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"9\" class=\"gt_group_heading\" style=\"font-weight: bold; background-color: #D3D3D3; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"colgroup\" id=\"Detroit\">Detroit</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"Detroit  .model_id\" class=\"gt_row gt_right\">52</td>\n<td headers=\"Detroit  .model_desc\" class=\"gt_row gt_left\">BASE_REC_STLM_SPEC4</td>\n<td headers=\"Detroit  .type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"Detroit  mae\" class=\"gt_row gt_right\">3.02</td>\n<td headers=\"Detroit  mape\" class=\"gt_row gt_right\">1.87</td>\n<td headers=\"Detroit  mase\" class=\"gt_row gt_right\">1.72</td>\n<td headers=\"Detroit  smape\" class=\"gt_row gt_right\">1.84</td>\n<td headers=\"Detroit  rmse\" class=\"gt_row gt_right\">4.05</td>\n<td headers=\"Detroit  rsq\" class=\"gt_row gt_right\">0.90</td></tr>\n    <tr><td headers=\"Detroit  .model_id\" class=\"gt_row gt_right\">49</td>\n<td headers=\"Detroit  .model_desc\" class=\"gt_row gt_left\">BASE_REC_STLM_SPEC1</td>\n<td headers=\"Detroit  .type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"Detroit  mae\" class=\"gt_row gt_right\">3.45</td>\n<td headers=\"Detroit  mape\" class=\"gt_row gt_right\">2.11</td>\n<td headers=\"Detroit  mase\" class=\"gt_row gt_right\">1.96</td>\n<td headers=\"Detroit  smape\" class=\"gt_row gt_right\">2.07</td>\n<td headers=\"Detroit  rmse\" class=\"gt_row gt_right\">4.96</td>\n<td headers=\"Detroit  rsq\" class=\"gt_row gt_right\">0.86</td></tr>\n    <tr><td headers=\"Detroit  .model_id\" class=\"gt_row gt_right\">16</td>\n<td headers=\"Detroit  .model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_DEFAULT</td>\n<td headers=\"Detroit  .type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"Detroit  mae\" class=\"gt_row gt_right\">3.91</td>\n<td headers=\"Detroit  mape\" class=\"gt_row gt_right\">2.38</td>\n<td headers=\"Detroit  mase\" class=\"gt_row gt_right\">2.22</td>\n<td headers=\"Detroit  smape\" class=\"gt_row gt_right\">2.41</td>\n<td headers=\"Detroit  rmse\" class=\"gt_row gt_right\">4.63</td>\n<td headers=\"Detroit  rsq\" class=\"gt_row gt_right\">0.84</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"9\" class=\"gt_group_heading\" style=\"font-weight: bold; background-color: #D3D3D3; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"colgroup\" id=\"New York\">New York</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"New York  .model_id\" class=\"gt_row gt_right\">1</td>\n<td headers=\"New York  .model_desc\" class=\"gt_row gt_left\">BASE_REC_ARIMA_DEFAULT</td>\n<td headers=\"New York  .type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"New York  mae\" class=\"gt_row gt_right\">3.09</td>\n<td headers=\"New York  mape\" class=\"gt_row gt_right\">1.16</td>\n<td headers=\"New York  mase\" class=\"gt_row gt_right\">1.30</td>\n<td headers=\"New York  smape\" class=\"gt_row gt_right\">1.16</td>\n<td headers=\"New York  rmse\" class=\"gt_row gt_right\">4.41</td>\n<td headers=\"New York  rsq\" class=\"gt_row gt_right\">0.94</td></tr>\n    <tr><td headers=\"New York  .model_id\" class=\"gt_row gt_right\">3</td>\n<td headers=\"New York  .model_desc\" class=\"gt_row gt_left\">BASE_REC_ARIMA_SPEC2</td>\n<td headers=\"New York  .type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"New York  mae\" class=\"gt_row gt_right\">3.09</td>\n<td headers=\"New York  mape\" class=\"gt_row gt_right\">1.16</td>\n<td headers=\"New York  mase\" class=\"gt_row gt_right\">1.30</td>\n<td headers=\"New York  smape\" class=\"gt_row gt_right\">1.16</td>\n<td headers=\"New York  rmse\" class=\"gt_row gt_right\">4.41</td>\n<td headers=\"New York  rsq\" class=\"gt_row gt_right\">0.94</td></tr>\n    <tr><td headers=\"New York  .model_id\" class=\"gt_row gt_right\">30</td>\n<td headers=\"New York  .model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC14</td>\n<td headers=\"New York  .type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"New York  mae\" class=\"gt_row gt_right\">3.18</td>\n<td headers=\"New York  mape\" class=\"gt_row gt_right\">1.19</td>\n<td headers=\"New York  mase\" class=\"gt_row gt_right\">1.34</td>\n<td headers=\"New York  smape\" class=\"gt_row gt_right\">1.17</td>\n<td headers=\"New York  rmse\" class=\"gt_row gt_right\">5.06</td>\n<td headers=\"New York  rsq\" class=\"gt_row gt_right\">0.95</td></tr>\n    <tr class=\"gt_group_heading_row\">\n      <th colspan=\"9\" class=\"gt_group_heading\" style=\"font-weight: bold; background-color: #D3D3D3; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"colgroup\" id=\"San Diego\">San Diego</th>\n    </tr>\n    <tr class=\"gt_row_group_first\"><td headers=\"San Diego  .model_id\" class=\"gt_row gt_right\">51</td>\n<td headers=\"San Diego  .model_desc\" class=\"gt_row gt_left\">BASE_REC_STLM_SPEC3</td>\n<td headers=\"San Diego  .type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"San Diego  mae\" class=\"gt_row gt_right\">23.42</td>\n<td headers=\"San Diego  mape\" class=\"gt_row gt_right\">6.49</td>\n<td headers=\"San Diego  mase\" class=\"gt_row gt_right\">3.10</td>\n<td headers=\"San Diego  smape\" class=\"gt_row gt_right\">6.34</td>\n<td headers=\"San Diego  rmse\" class=\"gt_row gt_right\">28.83</td>\n<td headers=\"San Diego  rsq\" class=\"gt_row gt_right\">0.61</td></tr>\n    <tr><td headers=\"San Diego  .model_id\" class=\"gt_row gt_right\">12</td>\n<td headers=\"San Diego  .model_desc\" class=\"gt_row gt_left\">DEMOG_REC_ARIMA_SPEC1</td>\n<td headers=\"San Diego  .type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"San Diego  mae\" class=\"gt_row gt_right\">35.62</td>\n<td headers=\"San Diego  mape\" class=\"gt_row gt_right\">9.29</td>\n<td headers=\"San Diego  mase\" class=\"gt_row gt_right\">4.85</td>\n<td headers=\"San Diego  smape\" class=\"gt_row gt_right\">9.84</td>\n<td headers=\"San Diego  rmse\" class=\"gt_row gt_right\">39.31</td>\n<td headers=\"San Diego  rsq\" class=\"gt_row gt_right\">0.71</td></tr>\n    <tr><td headers=\"San Diego  .model_id\" class=\"gt_row gt_right\">14</td>\n<td headers=\"San Diego  .model_desc\" class=\"gt_row gt_left\">DEMOG_REC_ARIMA_SPEC3</td>\n<td headers=\"San Diego  .type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"San Diego  mae\" class=\"gt_row gt_right\">36.77</td>\n<td headers=\"San Diego  mape\" class=\"gt_row gt_right\">9.58</td>\n<td headers=\"San Diego  mase\" class=\"gt_row gt_right\">5.01</td>\n<td headers=\"San Diego  smape\" class=\"gt_row gt_right\">10.16</td>\n<td headers=\"San Diego  rmse\" class=\"gt_row gt_right\">40.32</td>\n<td headers=\"San Diego  rsq\" class=\"gt_row gt_right\">0.71</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nThere's a pretty good mix of models across the two tables including ARIMA, ETS (lots of this one), STLM, and neural-net. Among the ARIMA models there were some with the basic recipe and some with the recipe that included both economic and demographic variables.\n\nBelow are plots of forecasts of the test data period for each city using the best 3 global models.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_3_global <- best_global_table |> slice_min(smape, n = 3) |> pull(.model_id)\n\nhpi_mod_calib |>\n  filter(.model_id %in% top_3_global) |>                            \n  modeltime_forecast(                            \n    new_data = testing(econ_splits),      \n    actual_data = econ_data,                     \n    conf_by_id = TRUE,                           \n    keep_data = TRUE                             \n  ) |>\n  group_by(city) |>                             \n  plot_modeltime_forecast(                      \n    .interactive = FALSE,\n    .title = \"Forecast of Test Data\",\n    .facet_ncol = 1\n  ) +\n  theme(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](forecasting-with-modeltime-part-4_files/figure-html/fig-acc-1.png){#fig-acc width=768}\n:::\n:::\n\n\nJust for fun, here are the 5 worst-performing models (global).\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhpi_mod_accuracy |>\n  slice_max(smape, n = 5, with_ties = FALSE) |>\n  gt() |>\n  gt_bold_head()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"uzwoecgpep\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#uzwoecgpep table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#uzwoecgpep thead, #uzwoecgpep tbody, #uzwoecgpep tfoot, #uzwoecgpep tr, #uzwoecgpep td, #uzwoecgpep th {\n  border-style: none;\n}\n\n#uzwoecgpep p {\n  margin: 0;\n  padding: 0;\n}\n\n#uzwoecgpep .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#uzwoecgpep .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#uzwoecgpep .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#uzwoecgpep .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#uzwoecgpep .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#uzwoecgpep .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#uzwoecgpep .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#uzwoecgpep .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#uzwoecgpep .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#uzwoecgpep .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#uzwoecgpep .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#uzwoecgpep .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#uzwoecgpep .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#uzwoecgpep .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#uzwoecgpep .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#uzwoecgpep .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#uzwoecgpep .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#uzwoecgpep .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#uzwoecgpep .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#uzwoecgpep .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#uzwoecgpep .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#uzwoecgpep .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#uzwoecgpep .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#uzwoecgpep .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#uzwoecgpep .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#uzwoecgpep .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#uzwoecgpep .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#uzwoecgpep .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#uzwoecgpep .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#uzwoecgpep .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#uzwoecgpep .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#uzwoecgpep .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#uzwoecgpep .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#uzwoecgpep .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#uzwoecgpep .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#uzwoecgpep .gt_left {\n  text-align: left;\n}\n\n#uzwoecgpep .gt_center {\n  text-align: center;\n}\n\n#uzwoecgpep .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#uzwoecgpep .gt_font_normal {\n  font-weight: normal;\n}\n\n#uzwoecgpep .gt_font_bold {\n  font-weight: bold;\n}\n\n#uzwoecgpep .gt_font_italic {\n  font-style: italic;\n}\n\n#uzwoecgpep .gt_super {\n  font-size: 65%;\n}\n\n#uzwoecgpep .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#uzwoecgpep .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#uzwoecgpep .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#uzwoecgpep .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#uzwoecgpep .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#uzwoecgpep .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#uzwoecgpep .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\".model_id\">.model_id</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\".model_desc\">.model_desc</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\".type\">.type</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"mae\">mae</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"mape\">mape</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"mase\">mase</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"smape\">smape</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"rmse\">rmse</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\"rsq\">rsq</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">2</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ARIMA_SPEC1</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">82.07379</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">28.40303</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.7639937</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">32.64595</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">100.22516</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">0.0237270639</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">4</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ARIMA_SPEC3</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">81.85927</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">28.93424</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.7619969</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">32.63484</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">99.20593</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">0.0005985376</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">17</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC1</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">81.34845</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">28.53501</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.7572419</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">32.31949</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">99.36593</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">NA</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">19</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC3</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">81.34845</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">28.53501</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.7572419</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">32.31949</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">99.36593</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">NA</td></tr>\n    <tr><td headers=\".model_id\" class=\"gt_row gt_right\">20</td>\n<td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC4</td>\n<td headers=\".type\" class=\"gt_row gt_left\">Test</td>\n<td headers=\"mae\" class=\"gt_row gt_right\">81.34845</td>\n<td headers=\"mape\" class=\"gt_row gt_right\">28.53501</td>\n<td headers=\"mase\" class=\"gt_row gt_right\">0.7572419</td>\n<td headers=\"smape\" class=\"gt_row gt_right\">32.31949</td>\n<td headers=\"rmse\" class=\"gt_row gt_right\">99.36593</td>\n<td headers=\"rsq\" class=\"gt_row gt_right\">NA</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n## Forecasting with global models\n\nBelow are forecasts for each city using the top 3 global models.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhpi_refit <- hpi_mod_calib |>\n  filter(.model_id %in% top_3_global) |>\n  modeltime_refit(data = econ_data) \n\nhpi_future <- econ_data |>\n  group_by(city) |>\n  future_frame(.length_out = 12, .bind_data = FALSE, .date_var = date)\n\nhpi_future_forecast <- hpi_refit |>\n  modeltime_forecast(\n    new_data = hpi_future,\n    actual_data = econ_data,\n    conf_by_id = TRUE\n  )\n\nhpi_future_forecast |>\n  group_by(city) |>\n  plot_modeltime_forecast(\n    .interactive = FALSE,\n    .title = \"1 Year Forecast into the Future - Global\",\n    .facet_ncol = 1\n  ) +\n  theme(plot.title = element_text(hjust = 0.5))\n```\n\n::: {.cell-output-display}\n![](forecasting-with-modeltime-part-4_files/figure-html/forecast-global-1.png){width=768}\n:::\n:::\n\n\n## Choosing models for iterative process\n\nFor iterative modeling I'm going to use the 10 best global models and the 3 best local models for each city. The specifications that I'm going to use for iterative modeling in the next post are:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbest_global_table |>\n  slice_min(smape, n = 5) |>\n  bind_rows(best_local_table) |>\n  distinct(.model_desc) |>\n  gt() |>\n  gt_bold_head()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"dmqafflyth\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#dmqafflyth table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#dmqafflyth thead, #dmqafflyth tbody, #dmqafflyth tfoot, #dmqafflyth tr, #dmqafflyth td, #dmqafflyth th {\n  border-style: none;\n}\n\n#dmqafflyth p {\n  margin: 0;\n  padding: 0;\n}\n\n#dmqafflyth .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#dmqafflyth .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#dmqafflyth .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#dmqafflyth .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#dmqafflyth .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#dmqafflyth .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dmqafflyth .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#dmqafflyth .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#dmqafflyth .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#dmqafflyth .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#dmqafflyth .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#dmqafflyth .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#dmqafflyth .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#dmqafflyth .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#dmqafflyth .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#dmqafflyth .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#dmqafflyth .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#dmqafflyth .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#dmqafflyth .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dmqafflyth .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#dmqafflyth .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#dmqafflyth .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#dmqafflyth .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dmqafflyth .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#dmqafflyth .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#dmqafflyth .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dmqafflyth .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dmqafflyth .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#dmqafflyth .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dmqafflyth .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#dmqafflyth .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#dmqafflyth .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#dmqafflyth .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dmqafflyth .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#dmqafflyth .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#dmqafflyth .gt_left {\n  text-align: left;\n}\n\n#dmqafflyth .gt_center {\n  text-align: center;\n}\n\n#dmqafflyth .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#dmqafflyth .gt_font_normal {\n  font-weight: normal;\n}\n\n#dmqafflyth .gt_font_bold {\n  font-weight: bold;\n}\n\n#dmqafflyth .gt_font_italic {\n  font-style: italic;\n}\n\n#dmqafflyth .gt_super {\n  font-size: 65%;\n}\n\n#dmqafflyth .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#dmqafflyth .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#dmqafflyth .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#dmqafflyth .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#dmqafflyth .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#dmqafflyth .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#dmqafflyth .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" style=\"font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;\" scope=\"col\" id=\".model_desc\">.model_desc</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_DEFAULT</td></tr>\n    <tr><td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ARIMA_DEFAULT</td></tr>\n    <tr><td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ARIMA_SPEC2</td></tr>\n    <tr><td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC14</td></tr>\n    <tr><td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_ETS_SPEC6</td></tr>\n    <tr><td headers=\".model_desc\" class=\"gt_row gt_left\">DEMOG_REC_ARIMA_SPEC1</td></tr>\n    <tr><td headers=\".model_desc\" class=\"gt_row gt_left\">DEMOG_REC_ARIMA_SPEC3</td></tr>\n    <tr><td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_STLM_SPEC4</td></tr>\n    <tr><td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_STLM_SPEC1</td></tr>\n    <tr><td headers=\".model_desc\" class=\"gt_row gt_left\">BASE_REC_STLM_SPEC3</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}