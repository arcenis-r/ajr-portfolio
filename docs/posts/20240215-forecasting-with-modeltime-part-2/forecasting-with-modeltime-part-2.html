<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arcenis Rojas">
<meta name="dcterms.date" content="2024-02-15">

<title>Arcenis Rojas - Forecasting with {modeltime} - Part II</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Arcenis Rojas</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Personal Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ce-dashboards.html"> 
<span class="menu-text">Dashboards</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/arcenisrojas" target="_blank"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/arcenis-r" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#a-quick-look-at-the-case-shiller-hpi" id="toc-a-quick-look-at-the-case-shiller-hpi" class="nav-link active" data-scroll-target="#a-quick-look-at-the-case-shiller-hpi">A quick look at the Case-Shiller HPI</a></li>
  <li><a href="#time-series-analysis" id="toc-time-series-analysis" class="nav-link" data-scroll-target="#time-series-analysis">Time series analysis</a>
  <ul class="collapse">
  <li><a href="#preparing-the-data" id="toc-preparing-the-data" class="nav-link" data-scroll-target="#preparing-the-data">Preparing the data</a></li>
  <li><a href="#time-series-decomposition" id="toc-time-series-decomposition" class="nav-link" data-scroll-target="#time-series-decomposition">Time series decomposition</a></li>
  <li><a href="#augmented-dickey-fuller-test" id="toc-augmented-dickey-fuller-test" class="nav-link" data-scroll-target="#augmented-dickey-fuller-test">Augmented Dickey-Fuller Test</a></li>
  <li><a href="#acf-pacf-plots" id="toc-acf-pacf-plots" class="nav-link" data-scroll-target="#acf-pacf-plots">ACF / PACF plots</a></li>
  <li><a href="#seasonality" id="toc-seasonality" class="nav-link" data-scroll-target="#seasonality">Seasonality</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Forecasting with {modeltime} - Part II</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Time series analysis</p>
  <div class="quarto-categories">
    <div class="quarto-category">Time Series</div>
    <div class="quarto-category">Inferential Statistics</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arcenis Rojas </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 15, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>Last time on <a href="../../posts/20240212-forecasting-with-modeltime-part-1/forecasting-with-modeltime-part-1.html">Forecasting with {modeltime} - Part I</a> I wrote about gathering the data for this project from various sources. Here I’ll go into the first part of the analysis which will include visualizing the dependent variable, checking and correcting for non-stationarity, identifying seasonality, and identifying the terms (AR, MA) to use in a S-/ARIMA model.</p>
<p>Besides the usual <a href="https://www.tidyverse.org/">tidyverse</a> <span class="citation" data-cites="tidyverse">(<a href="#ref-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span>, in this post I’ll be using the <a href="https://business-science.github.io/timetk/">timetk</a> <span class="citation" data-cites="timetk">(<a href="#ref-timetk" role="doc-biblioref">Dancho and Vaughan 2023</a>)</span> package – also from the folks at <a href="https://www.business-science.io/">Business Science</a> – for performing my data analysis.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(timetk)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"lag"</span>, <span class="st">"dplyr"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="a-quick-look-at-the-case-shiller-hpi" class="level2">
<h2 class="anchored" data-anchor-id="a-quick-look-at-the-case-shiller-hpi">A quick look at the Case-Shiller HPI</h2>
<p>In this post I’ll only be looking at the Case-Shiller Home Price Index (HPI) for the four cities in my data – San Diego, Dallas, Detroit, and New York City – between January 2006 and December 2022. Here’s a quick peek at the data:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>econ_data <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="fu">slice_min</span>(date, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="fu">gt_bold_head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="owexqgeycb" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#owexqgeycb table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#owexqgeycb thead, #owexqgeycb tbody, #owexqgeycb tfoot, #owexqgeycb tr, #owexqgeycb td, #owexqgeycb th {
  border-style: none;
}

#owexqgeycb p {
  margin: 0;
  padding: 0;
}

#owexqgeycb .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#owexqgeycb .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#owexqgeycb .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#owexqgeycb .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#owexqgeycb .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#owexqgeycb .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#owexqgeycb .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#owexqgeycb .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#owexqgeycb .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#owexqgeycb .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#owexqgeycb .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#owexqgeycb .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#owexqgeycb .gt_spanner_row {
  border-bottom-style: hidden;
}

#owexqgeycb .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#owexqgeycb .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#owexqgeycb .gt_from_md > :first-child {
  margin-top: 0;
}

#owexqgeycb .gt_from_md > :last-child {
  margin-bottom: 0;
}

#owexqgeycb .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#owexqgeycb .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#owexqgeycb .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#owexqgeycb .gt_row_group_first td {
  border-top-width: 2px;
}

#owexqgeycb .gt_row_group_first th {
  border-top-width: 2px;
}

#owexqgeycb .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#owexqgeycb .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#owexqgeycb .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#owexqgeycb .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#owexqgeycb .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#owexqgeycb .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#owexqgeycb .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#owexqgeycb .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#owexqgeycb .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#owexqgeycb .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#owexqgeycb .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#owexqgeycb .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#owexqgeycb .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#owexqgeycb .gt_left {
  text-align: left;
}

#owexqgeycb .gt_center {
  text-align: center;
}

#owexqgeycb .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#owexqgeycb .gt_font_normal {
  font-weight: normal;
}

#owexqgeycb .gt_font_bold {
  font-weight: bold;
}

#owexqgeycb .gt_font_italic {
  font-style: italic;
}

#owexqgeycb .gt_super {
  font-size: 65%;
}

#owexqgeycb .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#owexqgeycb .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#owexqgeycb .gt_indent_1 {
  text-indent: 5px;
}

#owexqgeycb .gt_indent_2 {
  text-indent: 10px;
}

#owexqgeycb .gt_indent_3 {
  text-indent: 15px;
}

#owexqgeycb .gt_indent_4 {
  text-indent: 20px;
}

#owexqgeycb .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="city" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">city</th>
<th id="date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date</th>
<th id="hpi" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">hpi</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="hpi">121.9108</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-02-01</td>
<td class="gt_row gt_right" headers="hpi">121.3285</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-03-01</td>
<td class="gt_row gt_right" headers="hpi">121.5217</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Detroit</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="hpi">126.6627</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Detroit</td>
<td class="gt_row gt_right" headers="date">2006-02-01</td>
<td class="gt_row gt_right" headers="hpi">126.3886</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Detroit</td>
<td class="gt_row gt_right" headers="date">2006-03-01</td>
<td class="gt_row gt_right" headers="hpi">126.1218</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">New York</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="hpi">213.4958</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">New York</td>
<td class="gt_row gt_right" headers="date">2006-02-01</td>
<td class="gt_row gt_right" headers="hpi">214.4696</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">New York</td>
<td class="gt_row gt_right" headers="date">2006-03-01</td>
<td class="gt_row gt_right" headers="hpi">214.3266</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">San Diego</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="hpi">247.4588</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">San Diego</td>
<td class="gt_row gt_right" headers="date">2006-02-01</td>
<td class="gt_row gt_right" headers="hpi">247.8891</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">San Diego</td>
<td class="gt_row gt_right" headers="date">2006-03-01</td>
<td class="gt_row gt_right" headers="hpi">248.0924</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now I’ll look visualize the data in a line plot.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>econ_data <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, hpi, <span class="at">color =</span> city)) <span class="sc">+</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="at">y =</span> <span class="st">"HPI"</span>,</span>
<span id="cb3-7"><a href="#cb3-7"></a>    <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb3-8"><a href="#cb3-8"></a>    <span class="at">title =</span> <span class="st">"Case-Shiller HPI from 2006 through 2022"</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>  ) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>  theme_timetk <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-2_files/figure-html/initial-line-plot-1.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>Here one can see that Dallas’s HPI did not drop as much during the Great Recession and has had a fast rise relative to those of the other cities ever since. It’s also pretty clear that NYC’s HPI has experienced a relatively mild increase over the years covered. There’s also more volatility between 2010 and 2015 in the HPIs for NYC, Dallas, and Detroit than in San Diego’s.</p>
</section>
<section id="time-series-analysis" class="level2">
<h2 class="anchored" data-anchor-id="time-series-analysis">Time series analysis</h2>
<p>The goal of this initial analysis is to find the parameters to use in an ARIMA model, which means that I’ll need to ensure my data are <a href="https://en.wikipedia.org/wiki/Stationary_process">stationary</a>. I’ll try to get there through the following operations and analyses.</p>
<section id="preparing-the-data" class="level3">
<h3 class="anchored" data-anchor-id="preparing-the-data">Preparing the data</h3>
<p>Before performing any analysis I’d like to add one column with a lagged first-difference and another with a lagged twelfth-difference. To accomplish this I’ll use the <code>tk_augment_differences()</code> from the <a href="https://business-science.github.io/timetk/">timetk</a> package. I’ll store this data set in a new variable called “hpi_series”. I chose these two lagged differences because the lagged first-difference generally any stationarity rooted in a trend and the lagged twelfth-difference should deal with seasonality as my data are monthly observations and I’m operating on the assumption that the housing market cycle is annual.</p>
<p>Below is a snippet of the data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>hpi_series <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="fu">select</span>(city, date, hpi) <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="fu">tk_augment_differences</span>(</span>
<span id="cb4-5"><a href="#cb4-5"></a>    <span class="at">.value =</span> hpi,</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="at">.lags =</span> <span class="dv">1</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>    <span class="at">.differences =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb4-8"><a href="#cb4-8"></a>    <span class="at">.log =</span> <span class="cn">FALSE</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a><span class="fu">head</span>(hpi_series, <span class="dv">15</span>) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="zmuqsjrdcu" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zmuqsjrdcu table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zmuqsjrdcu thead, #zmuqsjrdcu tbody, #zmuqsjrdcu tfoot, #zmuqsjrdcu tr, #zmuqsjrdcu td, #zmuqsjrdcu th {
  border-style: none;
}

#zmuqsjrdcu p {
  margin: 0;
  padding: 0;
}

#zmuqsjrdcu .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zmuqsjrdcu .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zmuqsjrdcu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zmuqsjrdcu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zmuqsjrdcu .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zmuqsjrdcu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zmuqsjrdcu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zmuqsjrdcu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zmuqsjrdcu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zmuqsjrdcu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zmuqsjrdcu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zmuqsjrdcu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zmuqsjrdcu .gt_spanner_row {
  border-bottom-style: hidden;
}

#zmuqsjrdcu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zmuqsjrdcu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zmuqsjrdcu .gt_from_md > :first-child {
  margin-top: 0;
}

#zmuqsjrdcu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zmuqsjrdcu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zmuqsjrdcu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zmuqsjrdcu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zmuqsjrdcu .gt_row_group_first td {
  border-top-width: 2px;
}

#zmuqsjrdcu .gt_row_group_first th {
  border-top-width: 2px;
}

#zmuqsjrdcu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zmuqsjrdcu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zmuqsjrdcu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zmuqsjrdcu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zmuqsjrdcu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zmuqsjrdcu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zmuqsjrdcu .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zmuqsjrdcu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zmuqsjrdcu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zmuqsjrdcu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zmuqsjrdcu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zmuqsjrdcu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zmuqsjrdcu .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zmuqsjrdcu .gt_left {
  text-align: left;
}

#zmuqsjrdcu .gt_center {
  text-align: center;
}

#zmuqsjrdcu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zmuqsjrdcu .gt_font_normal {
  font-weight: normal;
}

#zmuqsjrdcu .gt_font_bold {
  font-weight: bold;
}

#zmuqsjrdcu .gt_font_italic {
  font-style: italic;
}

#zmuqsjrdcu .gt_super {
  font-size: 65%;
}

#zmuqsjrdcu .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zmuqsjrdcu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zmuqsjrdcu .gt_indent_1 {
  text-indent: 5px;
}

#zmuqsjrdcu .gt_indent_2 {
  text-indent: 10px;
}

#zmuqsjrdcu .gt_indent_3 {
  text-indent: 15px;
}

#zmuqsjrdcu .gt_indent_4 {
  text-indent: 20px;
}

#zmuqsjrdcu .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="city" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">city</th>
<th id="date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date</th>
<th id="hpi" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">hpi</th>
<th id="hpi_lag1_diff1" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">hpi_lag1_diff1</th>
<th id="hpi_lag1_diff12" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">hpi_lag1_diff12</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="hpi">121.9108</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">NA</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">NA</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-02-01</td>
<td class="gt_row gt_right" headers="hpi">121.3285</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">-0.58234</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">NA</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-03-01</td>
<td class="gt_row gt_right" headers="hpi">121.5217</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">0.19324</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">NA</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-04-01</td>
<td class="gt_row gt_right" headers="hpi">122.3996</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">0.87788</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">NA</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-05-01</td>
<td class="gt_row gt_right" headers="hpi">123.2863</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">0.88666</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">NA</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-06-01</td>
<td class="gt_row gt_right" headers="hpi">124.4985</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">1.21228</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">NA</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-07-01</td>
<td class="gt_row gt_right" headers="hpi">125.3672</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">0.86869</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">NA</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-08-01</td>
<td class="gt_row gt_right" headers="hpi">125.7007</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">0.33342</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">NA</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-09-01</td>
<td class="gt_row gt_right" headers="hpi">125.1859</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">-0.51474</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">NA</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-10-01</td>
<td class="gt_row gt_right" headers="hpi">124.5813</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">-0.60463</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">NA</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-11-01</td>
<td class="gt_row gt_right" headers="hpi">123.8517</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">-0.72958</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">NA</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-12-01</td>
<td class="gt_row gt_right" headers="hpi">123.6697</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">-0.18205</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">NA</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2007-01-01</td>
<td class="gt_row gt_right" headers="hpi">122.6361</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">-1.03360</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">-161.2924</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2007-02-01</td>
<td class="gt_row gt_right" headers="hpi">122.7292</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">0.09314</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">188.2084</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2007-03-01</td>
<td class="gt_row gt_right" headers="hpi">123.1562</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff1">0.42699</td>
<td class="gt_row gt_right" headers="hpi_lag1_diff12">-251.1343</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>And now I can look at line plots of the three different series with the original on the left ; the lagged first-difference in the middle; and the lagged twelfth-difference on the right with a the cities in the different rows. From left to right the plots go from being highly regular (seasonal and trending) to being less regular in the middle (only seasonal) and highly irregular on the right. That irregularity is indicative of stationarity, which is what I want to see. This also provides a sneak peak into what the following analyses will give us.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"hpi"</span>), <span class="at">names_to =</span> <span class="st">"series"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="fu">group_by</span>(city, series) <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="fu">plot_time_series</span>(</span>
<span id="cb5-5"><a href="#cb5-5"></a>    date,</span>
<span id="cb5-6"><a href="#cb5-6"></a>    value,</span>
<span id="cb5-7"><a href="#cb5-7"></a>    <span class="at">.facet_ncol =</span> <span class="dv">3</span>,</span>
<span id="cb5-8"><a href="#cb5-8"></a>    <span class="at">.title =</span> <span class="st">"Case-Shiller HPI from 2006 through 2022"</span>,</span>
<span id="cb5-9"><a href="#cb5-9"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span></span>
<span id="cb5-10"><a href="#cb5-10"></a>  ) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-2_files/figure-html/plot-lagged-diffs-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>On might ask “why not use a lagged, log difference?” The below plot shows that using a lagged, log first- and twelfth-differenced series don’t change anything compared to the lagged first- and twelfth-differenced series except for generating data with much higher relative amplitude and possibly showing outliers. This might actually introduce heteroskedasticity, which I’d like to avoid.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>econ_data <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">tk_augment_differences</span>(</span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="at">.value =</span> hpi,</span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="at">.lags =</span> <span class="dv">1</span>,</span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="at">.differences =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="at">.log =</span> <span class="cn">TRUE</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"hpi"</span>), <span class="at">names_to =</span> <span class="st">"series"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>  <span class="fu">group_by</span>(city, series) <span class="sc">|&gt;</span></span>
<span id="cb6-10"><a href="#cb6-10"></a>  <span class="fu">plot_time_series</span>(</span>
<span id="cb6-11"><a href="#cb6-11"></a>    date,</span>
<span id="cb6-12"><a href="#cb6-12"></a>    value,</span>
<span id="cb6-13"><a href="#cb6-13"></a>    <span class="at">.facet_ncol =</span> <span class="dv">3</span>,</span>
<span id="cb6-14"><a href="#cb6-14"></a>    <span class="at">.title =</span> <span class="st">"Case-Shiller HPI from 2006 through 2022"</span>,</span>
<span id="cb6-15"><a href="#cb6-15"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span></span>
<span id="cb6-16"><a href="#cb6-16"></a>  ) <span class="sc">+</span></span>
<span id="cb6-17"><a href="#cb6-17"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-2_files/figure-html/plot-lagged-log-diffs-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="time-series-decomposition" class="level3">
<h3 class="anchored" data-anchor-id="time-series-decomposition">Time series decomposition</h3>
<p>The following plot shows the Seasonal-Trend decomposition using Loess (STL), which is a common tool to determine how much of a time series’ movement is due to a trend versus that which is due to it’s seasonality. Again, here I’ll assume an annual seasonal cycle.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="fu">plot_stl_diagnostics</span>(</span>
<span id="cb7-4"><a href="#cb7-4"></a>    date,</span>
<span id="cb7-5"><a href="#cb7-5"></a>    hpi,</span>
<span id="cb7-6"><a href="#cb7-6"></a>    <span class="at">.feature_set =</span> <span class="fu">c</span>(<span class="st">"observed"</span>, <span class="st">"season"</span>, <span class="st">"trend"</span>, <span class="st">"remainder"</span>),</span>
<span id="cb7-7"><a href="#cb7-7"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb7-8"><a href="#cb7-8"></a>    <span class="at">.frequency =</span> <span class="dv">12</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  ) <span class="sc">+</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-2_files/figure-html/stl-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>According to this plot most of the movement in the HPI is determined by the trend and very little by seasonality.</p>
</section>
<section id="augmented-dickey-fuller-test" class="level3">
<h3 class="anchored" data-anchor-id="augmented-dickey-fuller-test">Augmented Dickey-Fuller Test</h3>
<p>The Augmented Dickey-Fuller Test (ADF) is commonly run to evaluate whether a time series is stationary or not. The null hypothesis of the ADF is that the time series is non-stationary, so want to reject the null hypothesis to be able to assume the alternative, i.e., that the series is stationary. The following table shows that one can reject the null hypothesis for every city but San Diego with just a lagged first-difference, but with the lagged twelfth-difference all four series can be thought of as stationary.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>hpi_adf <span class="ot">&lt;-</span> hpi_series <span class="sc">|&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(city, date), <span class="at">names_to =</span> <span class="st">"variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">group_by</span>(city, variable) <span class="sc">|&gt;</span></span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">c</span>(date, value)) <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-6"><a href="#cb8-6"></a>    <span class="at">adf_test =</span> <span class="fu">map</span>(</span>
<span id="cb8-7"><a href="#cb8-7"></a>      data,</span>
<span id="cb8-8"><a href="#cb8-8"></a>      \(x) <span class="fu">drop_na</span>(x, value) <span class="sc">|&gt;</span></span>
<span id="cb8-9"><a href="#cb8-9"></a>        <span class="fu">pull</span>(value) <span class="sc">|&gt;</span></span>
<span id="cb8-10"><a href="#cb8-10"></a>        tseries<span class="sc">::</span><span class="fu">adf.test</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11"></a>        broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-12"><a href="#cb8-12"></a>        <span class="fu">select</span>(statistic, p.value)</span>
<span id="cb8-13"><a href="#cb8-13"></a>    )</span>
<span id="cb8-14"><a href="#cb8-14"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb8-15"><a href="#cb8-15"></a>  <span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">|&gt;</span></span>
<span id="cb8-16"><a href="#cb8-16"></a>  <span class="fu">unnest</span>(adf_test) <span class="sc">|&gt;</span></span>
<span id="cb8-17"><a href="#cb8-17"></a>  <span class="fu">ungroup</span>(variable)</span>
<span id="cb8-18"><a href="#cb8-18"></a></span>
<span id="cb8-19"><a href="#cb8-19"></a>hpi_adf <span class="sc">|&gt;</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb8-21"><a href="#cb8-21"></a>  <span class="fu">group_nest</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-22"><a href="#cb8-22"></a>  <span class="fu">mutate</span>(<span class="at">data_gt =</span> <span class="fu">map</span>(data, make_adf_gt)) <span class="sc">|&gt;</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>  <span class="fu">select</span>(<span class="sc">!</span>data) <span class="sc">|&gt;</span></span>
<span id="cb8-24"><a href="#cb8-24"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> city, <span class="at">values_from =</span> data_gt) <span class="sc">|&gt;</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb8-26"><a href="#cb8-26"></a>  <span class="fu">gt_bold_head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="sifwipmhvt" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#sifwipmhvt table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#sifwipmhvt thead, #sifwipmhvt tbody, #sifwipmhvt tfoot, #sifwipmhvt tr, #sifwipmhvt td, #sifwipmhvt th {
  border-style: none;
}

#sifwipmhvt p {
  margin: 0;
  padding: 0;
}

#sifwipmhvt .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#sifwipmhvt .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#sifwipmhvt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#sifwipmhvt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#sifwipmhvt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sifwipmhvt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sifwipmhvt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#sifwipmhvt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#sifwipmhvt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#sifwipmhvt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#sifwipmhvt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#sifwipmhvt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#sifwipmhvt .gt_spanner_row {
  border-bottom-style: hidden;
}

#sifwipmhvt .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#sifwipmhvt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#sifwipmhvt .gt_from_md > :first-child {
  margin-top: 0;
}

#sifwipmhvt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#sifwipmhvt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#sifwipmhvt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#sifwipmhvt .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#sifwipmhvt .gt_row_group_first td {
  border-top-width: 2px;
}

#sifwipmhvt .gt_row_group_first th {
  border-top-width: 2px;
}

#sifwipmhvt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sifwipmhvt .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#sifwipmhvt .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#sifwipmhvt .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sifwipmhvt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#sifwipmhvt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#sifwipmhvt .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#sifwipmhvt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#sifwipmhvt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#sifwipmhvt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sifwipmhvt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sifwipmhvt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#sifwipmhvt .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#sifwipmhvt .gt_left {
  text-align: left;
}

#sifwipmhvt .gt_center {
  text-align: center;
}

#sifwipmhvt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#sifwipmhvt .gt_font_normal {
  font-weight: normal;
}

#sifwipmhvt .gt_font_bold {
  font-weight: bold;
}

#sifwipmhvt .gt_font_italic {
  font-style: italic;
}

#sifwipmhvt .gt_super {
  font-size: 65%;
}

#sifwipmhvt .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#sifwipmhvt .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#sifwipmhvt .gt_indent_1 {
  text-indent: 5px;
}

#sifwipmhvt .gt_indent_2 {
  text-indent: 10px;
}

#sifwipmhvt .gt_indent_3 {
  text-indent: 15px;
}

#sifwipmhvt .gt_indent_4 {
  text-indent: 20px;
}

#sifwipmhvt .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header gt_col_headings">
<th id="Dallas" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">Dallas</th>
<th id="Detroit" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">Detroit</th>
<th id="New York" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">New York</th>
<th id="San Diego" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">San Diego</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="Dallas"><div id="iiqachnipc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false" data-bgcolor="#FFFFFF">
<thead style="border-style: none;">
<tr class="header gt_col_headings" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
<th id="variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="text-align: left; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;" scope="col" data-bgcolor="#FFFFFF" data-valign="bottom">variable</th>
<th id="statistic" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums; font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;" scope="col" data-bgcolor="#FFFFFF" data-valign="bottom">statistic</th>
<th id="p.value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums; font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;" scope="col" data-bgcolor="#FFFFFF" data-valign="bottom">p.value</th>
</tr>
</thead>
<tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_left" headers="variable" style="text-align: left; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden;" data-valign="middle">hpi</td>
<td class="gt_row gt_right" headers="statistic" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−0.688</td>
<td class="gt_row gt_right" headers="p.value" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.970</td>
</tr>
<tr class="even" style="border-style: none;">
<td class="gt_row gt_left" headers="variable" style="text-align: left; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden;" data-valign="middle">hpi_lag1_diff1</td>
<td class="gt_row gt_right" headers="statistic" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−3.985</td>
<td class="gt_row gt_right" headers="p.value" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums; background-color: #FFFF00;" data-bgcolor="#FFFF00" data-valign="middle">0.011</td>
</tr>
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_left" headers="variable" style="text-align: left; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden;" data-valign="middle">hpi_lag1_diff12</td>
<td class="gt_row gt_right" headers="statistic" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−21.100</td>
<td class="gt_row gt_right" headers="p.value" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums; background-color: #FFFF00;" data-bgcolor="#FFFF00" data-valign="middle">0.010</td>
</tr>
</tbody>
</table>
</div></td>
<td class="gt_row gt_center" headers="Detroit"><div id="jskfngcpvp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false" data-bgcolor="#FFFFFF">
<thead style="border-style: none;">
<tr class="header gt_col_headings" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
<th id="variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="text-align: left; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;" scope="col" data-bgcolor="#FFFFFF" data-valign="bottom">variable</th>
<th id="statistic" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums; font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;" scope="col" data-bgcolor="#FFFFFF" data-valign="bottom">statistic</th>
<th id="p.value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums; font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;" scope="col" data-bgcolor="#FFFFFF" data-valign="bottom">p.value</th>
</tr>
</thead>
<tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_left" headers="variable" style="text-align: left; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden;" data-valign="middle">hpi</td>
<td class="gt_row gt_right" headers="statistic" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−2.927</td>
<td class="gt_row gt_right" headers="p.value" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.188</td>
</tr>
<tr class="even" style="border-style: none;">
<td class="gt_row gt_left" headers="variable" style="text-align: left; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden;" data-valign="middle">hpi_lag1_diff1</td>
<td class="gt_row gt_right" headers="statistic" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−6.023</td>
<td class="gt_row gt_right" headers="p.value" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums; background-color: #FFFF00;" data-bgcolor="#FFFF00" data-valign="middle">0.010</td>
</tr>
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_left" headers="variable" style="text-align: left; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden;" data-valign="middle">hpi_lag1_diff12</td>
<td class="gt_row gt_right" headers="statistic" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−21.563</td>
<td class="gt_row gt_right" headers="p.value" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums; background-color: #FFFF00;" data-bgcolor="#FFFF00" data-valign="middle">0.010</td>
</tr>
</tbody>
</table>
</div></td>
<td class="gt_row gt_center" headers="New York"><div id="wtxqrrumgx" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false" data-bgcolor="#FFFFFF">
<thead style="border-style: none;">
<tr class="header gt_col_headings" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
<th id="variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="text-align: left; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;" scope="col" data-bgcolor="#FFFFFF" data-valign="bottom">variable</th>
<th id="statistic" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums; font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;" scope="col" data-bgcolor="#FFFFFF" data-valign="bottom">statistic</th>
<th id="p.value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums; font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;" scope="col" data-bgcolor="#FFFFFF" data-valign="bottom">p.value</th>
</tr>
</thead>
<tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_left" headers="variable" style="text-align: left; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden;" data-valign="middle">hpi</td>
<td class="gt_row gt_right" headers="statistic" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−0.256</td>
<td class="gt_row gt_right" headers="p.value" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.990</td>
</tr>
<tr class="even" style="border-style: none;">
<td class="gt_row gt_left" headers="variable" style="text-align: left; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden;" data-valign="middle">hpi_lag1_diff1</td>
<td class="gt_row gt_right" headers="statistic" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−6.495</td>
<td class="gt_row gt_right" headers="p.value" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums; background-color: #FFFF00;" data-bgcolor="#FFFF00" data-valign="middle">0.010</td>
</tr>
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_left" headers="variable" style="text-align: left; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden;" data-valign="middle">hpi_lag1_diff12</td>
<td class="gt_row gt_right" headers="statistic" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−24.809</td>
<td class="gt_row gt_right" headers="p.value" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums; background-color: #FFFF00;" data-bgcolor="#FFFF00" data-valign="middle">0.010</td>
</tr>
</tbody>
</table>
</div></td>
<td class="gt_row gt_center" headers="San Diego"><div id="ocoivgipca" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false" data-bgcolor="#FFFFFF">
<thead style="border-style: none;">
<tr class="header gt_col_headings" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3;">
<th id="variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="text-align: left; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;" scope="col" data-bgcolor="#FFFFFF" data-valign="bottom">variable</th>
<th id="statistic" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums; font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;" scope="col" data-bgcolor="#FFFFFF" data-valign="bottom">statistic</th>
<th id="p.value" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="text-align: right; border-style: none; color: #333333; background-color: #FFFFFF; font-size: 100%; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 6px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; font-variant-numeric: tabular-nums; font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000;" scope="col" data-bgcolor="#FFFFFF" data-valign="bottom">p.value</th>
</tr>
</thead>
<tbody class="gt_table_body" style="border-style: none; border-top-style: solid; border-top-width: 2px; border-top-color: #D3D3D3; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D3D3D3;">
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_left" headers="variable" style="text-align: left; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden;" data-valign="middle">hpi</td>
<td class="gt_row gt_right" headers="statistic" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−2.368</td>
<td class="gt_row gt_right" headers="p.value" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.422</td>
</tr>
<tr class="even" style="border-style: none;">
<td class="gt_row gt_left" headers="variable" style="text-align: left; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden;" data-valign="middle">hpi_lag1_diff1</td>
<td class="gt_row gt_right" headers="statistic" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−2.982</td>
<td class="gt_row gt_right" headers="p.value" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">0.165</td>
</tr>
<tr class="odd" style="border-style: none;">
<td class="gt_row gt_left" headers="variable" style="text-align: left; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden;" data-valign="middle">hpi_lag1_diff12</td>
<td class="gt_row gt_right" headers="statistic" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums;" data-valign="middle">−27.132</td>
<td class="gt_row gt_right" headers="p.value" style="text-align: right; border-style: none; padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D3D3D3; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; overflow-x: hidden; font-variant-numeric: tabular-nums; background-color: #FFFF00;" data-bgcolor="#FFFF00" data-valign="middle">0.010</td>
</tr>
</tbody>
</table>
</div></td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="acf-pacf-plots" class="level3">
<h3 class="anchored" data-anchor-id="acf-pacf-plots">ACF / PACF plots</h3>
<p>The Autocorrelation Function (ACF) calculates the correlation of a value, e.g., the most recent value of the HPI, with previous values in the same series. Knowing this is very useful for determining how many Moving Average (the “MA” in ARIMA) lags to use in an ARIMA mode. The Partial Autocorrelation Function (PACF) calculates the correlation of a value with previous values in the same series after accounting for intervening correlations. This is useful to help us determine how many lags to use for the Autoregressive (the “AR” in ARIMA) part of an ARIMA model. Below are the ACF and PACF plots for the HPI series (no lagged differences) for all four cities. The timetk::<code>plot_acf_diagnostics()</code> function plots ACF on top and PACF on bottom, which is conventional. Values outside of the red, dashed lines indicate statistically significant correlations.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>  <span class="fu">plot_acf_diagnostics</span>(</span>
<span id="cb9-4"><a href="#cb9-4"></a>    date,</span>
<span id="cb9-5"><a href="#cb9-5"></a>    hpi,</span>
<span id="cb9-6"><a href="#cb9-6"></a>    <span class="at">.lags =</span> <span class="dv">60</span>,</span>
<span id="cb9-7"><a href="#cb9-7"></a>    <span class="at">.title =</span> <span class="st">"HPI Lag Diagnostics"</span>,</span>
<span id="cb9-8"><a href="#cb9-8"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb9-9"><a href="#cb9-9"></a>    <span class="at">.white_noise_line_color =</span> <span class="st">"red"</span></span>
<span id="cb9-10"><a href="#cb9-10"></a>  ) <span class="sc">+</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-2_files/figure-html/plot-acf1-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>It’s clear from the ACF plot that the trend is causing a lot of the autocorrelation in each city. Next is the same plot, but for the first-differenced values.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="fu">plot_acf_diagnostics</span>(</span>
<span id="cb10-4"><a href="#cb10-4"></a>    date,</span>
<span id="cb10-5"><a href="#cb10-5"></a>    hpi_lag1_diff1,</span>
<span id="cb10-6"><a href="#cb10-6"></a>    <span class="at">.lags =</span> <span class="dv">60</span>,</span>
<span id="cb10-7"><a href="#cb10-7"></a>    <span class="at">.title =</span> <span class="st">"First-Differenced HPI Lag Diagnostics"</span>,</span>
<span id="cb10-8"><a href="#cb10-8"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="at">.white_noise_line_color =</span> <span class="st">"red"</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>  ) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-2_files/figure-html/plot-acf2-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>The trend’s influence is significantly decreased here, but there are still some strong seasonal patterns in the data. Below is a look at the twelfth-differenced series.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb11-3"><a href="#cb11-3"></a>  <span class="fu">plot_acf_diagnostics</span>(</span>
<span id="cb11-4"><a href="#cb11-4"></a>    date,</span>
<span id="cb11-5"><a href="#cb11-5"></a>    hpi_lag1_diff12,</span>
<span id="cb11-6"><a href="#cb11-6"></a>    <span class="at">.lags =</span> <span class="dv">60</span>,</span>
<span id="cb11-7"><a href="#cb11-7"></a>    <span class="at">.title =</span> <span class="st">"Twelfth-Differenced HPI Lag Diagnostics"</span>,</span>
<span id="cb11-8"><a href="#cb11-8"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb11-9"><a href="#cb11-9"></a>    <span class="at">.white_noise_line_color =</span> <span class="st">"red"</span></span>
<span id="cb11-10"><a href="#cb11-10"></a>  ) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-2_files/figure-html/plot-acf3-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Looking at this plot over 36 months it still appears that there is a small seasonal effect in Dallas, San Diego, and Detroit with Detroit’s possibly being a shorter season. Considering the infinite number of things that could affect one of these data series one could look at hundreds of plots like this with different combinations of lags and differences for any one series and never find a perfect one. This plot is pretty good. From this plot it looks like I’m going to us an AR(3) model. San Diego’s PACF suggests that I should use two for that city, but I’m looking for one value for all four cities. The MA component is a little more challenging. It looks like I would use MA lags of 5 or 6 for Dallas, 8 for San Diego, 4 for NYC, and 4 or 5 for Detroit. I’m going to use MA(5) for my ARIMA.</p>
</section>
<section id="seasonality" class="level3">
<h3 class="anchored" data-anchor-id="seasonality">Seasonality</h3>
<p>It’s been pretty clear up to this point that seasonality is an important consideration with this data series and it’s something that I will expect to handle in the modeling portion of the analysis in a later post. If I wanted to handle seasonality in a conventional model I might run a SARIMA model, but I’m going to keep this part simple and only run ARIMA knowing that I’m partially ignoring the seasonality and only dealing with it by differencing. With that said, I’ll show two more plots here to demonstrate the <code>timetk::plot_seasonal_diagnostics()</code> . The first plot shows seasonal diagnostics for the unadjusted series and the second one for the twelfth-differenced series.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="fu">plot_seasonal_diagnostics</span>(</span>
<span id="cb12-3"><a href="#cb12-3"></a>    date,</span>
<span id="cb12-4"><a href="#cb12-4"></a>    hpi,</span>
<span id="cb12-5"><a href="#cb12-5"></a>    <span class="at">.facet_vars =</span> city,</span>
<span id="cb12-6"><a href="#cb12-6"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-7"><a href="#cb12-7"></a>    <span class="at">.title =</span> <span class="st">"HPI Seasonal Diagnostics"</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>  ) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9"></a>  <span class="fu">theme</span>(</span>
<span id="cb12-10"><a href="#cb12-10"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb12-11"><a href="#cb12-11"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb12-12"><a href="#cb12-12"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-2_files/figure-html/seas-diag1-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>This plot shows a clear pattern of HPI values being lowest in the first quarter across all four cities, highest in the second and third quarters for San Diego, and highest in the quarter for New York and December. From this data it seems that the peak in Dallas is December. This seasonality can obscure the findings of an ARIMA model.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">plot_seasonal_diagnostics</span>(</span>
<span id="cb13-3"><a href="#cb13-3"></a>    date,</span>
<span id="cb13-4"><a href="#cb13-4"></a>    hpi_lag1_diff12,</span>
<span id="cb13-5"><a href="#cb13-5"></a>    <span class="at">.facet_vars =</span> city,</span>
<span id="cb13-6"><a href="#cb13-6"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-7"><a href="#cb13-7"></a>    <span class="at">.title =</span> <span class="st">"Twelfth-Differenced HPI Seasonal Diagnostics"</span></span>
<span id="cb13-8"><a href="#cb13-8"></a>  ) <span class="sc">+</span></span>
<span id="cb13-9"><a href="#cb13-9"></a>  <span class="fu">theme</span>(</span>
<span id="cb13-10"><a href="#cb13-10"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb13-11"><a href="#cb13-11"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb13-12"><a href="#cb13-12"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-2_files/figure-html/seas-diag2-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>In this plot the patterns are generally gone across the quarterly plots. Even the trend is mostly gone from the annual plot.</p>
<p>In the next post I’ll use the AR and MA values from this post to run ARIMA models for all four cities using a global modeling process and an iterative modeling process with <a href="https://business-science.github.io/modeltime/">modeltime</a>.</p>


<!-- -->


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-timetk" class="csl-entry" role="listitem">
Dancho, Matt, and Davis Vaughan. 2023. <span>“Timetk: A Tool Kit for Working with Time Series.”</span> <a href="https://CRAN.R-project.org/package=timetk">https://CRAN.R-project.org/package=timetk</a>.
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span></span>Tidyverse<span></span>”</span> 4: 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/arcenis-r\.github\.io\/ajr-portfolio");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="arcenis-r/ajr-portfolio" data-repo-id="MDEwOlJlcG9zaXRvcnkxNzg3MDY3MTM=" data-category="General" data-category-id="DIC_kwDOCqbZGc4CdJXz" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb14" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">---</span></span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="an">title:</span><span class="co"> "Forecasting with {modeltime} - Part II"</span></span>
<span id="cb14-3"><a href="#cb14-3"></a><span class="an">subtitle:</span><span class="co"> "Time series analysis"</span></span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="an">author:</span><span class="co"> "Arcenis Rojas"</span></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="an">date:</span><span class="co"> "2/15/2024"</span></span>
<span id="cb14-6"><a href="#cb14-6"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="an">fig-height:</span><span class="co"> 9</span></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="an">fig-width:</span><span class="co"> 10</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="an">execute:</span></span>
<span id="cb14-10"><a href="#cb14-10"></a><span class="co">  warning: false</span></span>
<span id="cb14-11"><a href="#cb14-11"></a><span class="co">  error: false</span></span>
<span id="cb14-12"><a href="#cb14-12"></a><span class="co">  message: false</span></span>
<span id="cb14-13"><a href="#cb14-13"></a><span class="an">categories:</span></span>
<span id="cb14-14"><a href="#cb14-14"></a><span class="co">  - Time Series</span></span>
<span id="cb14-15"><a href="#cb14-15"></a><span class="co">  - Inferential Statistics</span></span>
<span id="cb14-16"><a href="#cb14-16"></a><span class="co">---</span></span>
<span id="cb14-17"><a href="#cb14-17"></a></span>
<span id="cb14-18"><a href="#cb14-18"></a>Last time on <span class="co">[</span><span class="ot">Forecasting with {modeltime} - Part I</span><span class="co">](../20240212-forecasting-with-modeltime-part-1/forecasting-with-modeltime-part-1.qmd)</span> I wrote about gathering the data for this project from various sources. Here I'll go into the first part of the analysis which will include visualizing the dependent variable, checking and correcting for non-stationarity, identifying seasonality, and identifying the terms (AR, MA) to use in a S-/ARIMA model.</span>
<span id="cb14-19"><a href="#cb14-19"></a></span>
<span id="cb14-20"><a href="#cb14-20"></a>Besides the usual <span class="co">[</span><span class="ot">tidyverse</span><span class="co">](https://www.tidyverse.org/)</span> <span class="co">[</span><span class="ot">@tidyverse</span><span class="co">]</span>, in this post I'll be using the <span class="co">[</span><span class="ot">timetk</span><span class="co">](https://business-science.github.io/timetk/)</span> <span class="co">[</span><span class="ot">@timetk</span><span class="co">]</span> package – also from the folks at <span class="co">[</span><span class="ot">Business Science</span><span class="co">](https://www.business-science.io/)</span> – for performing my data analysis.</span>
<span id="cb14-21"><a href="#cb14-21"></a></span>
<span id="cb14-24"><a href="#cb14-24"></a><span class="in">```{r}</span></span>
<span id="cb14-25"><a href="#cb14-25"></a><span class="co">#| label: load-packages</span></span>
<span id="cb14-26"><a href="#cb14-26"></a></span>
<span id="cb14-27"><a href="#cb14-27"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb14-28"><a href="#cb14-28"></a><span class="fu">library</span>(timetk)</span>
<span id="cb14-29"><a href="#cb14-29"></a></span>
<span id="cb14-30"><a href="#cb14-30"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb14-31"><a href="#cb14-31"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"lag"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb14-32"><a href="#cb14-32"></a><span class="in">```</span></span>
<span id="cb14-33"><a href="#cb14-33"></a></span>
<span id="cb14-36"><a href="#cb14-36"></a><span class="in">```{r}</span></span>
<span id="cb14-37"><a href="#cb14-37"></a><span class="co">#| label: import-data</span></span>
<span id="cb14-38"><a href="#cb14-38"></a><span class="co">#| include: false</span></span>
<span id="cb14-39"><a href="#cb14-39"></a></span>
<span id="cb14-40"><a href="#cb14-40"></a>econ_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"../_common-resources/econ-data.Rds"</span>)  <span class="sc">|&gt;</span></span>
<span id="cb14-41"><a href="#cb14-41"></a>  <span class="fu">select</span>(city, date, hpi)</span>
<span id="cb14-42"><a href="#cb14-42"></a></span>
<span id="cb14-43"><a href="#cb14-43"></a><span class="fu">source</span>(<span class="st">"../_common-resources/gt-bold-head.R"</span>)</span>
<span id="cb14-44"><a href="#cb14-44"></a></span>
<span id="cb14-45"><a href="#cb14-45"></a>theme_timetk <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"../_common-resources/theme-timetk.Rds"</span>)</span>
<span id="cb14-46"><a href="#cb14-46"></a></span>
<span id="cb14-47"><a href="#cb14-47"></a><span class="co"># Declare a function for making an ADF result table</span></span>
<span id="cb14-48"><a href="#cb14-48"></a>make_adf_gt <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb14-49"><a href="#cb14-49"></a>  <span class="fu">gt</span>(df) <span class="sc">|&gt;</span></span>
<span id="cb14-50"><a href="#cb14-50"></a>    <span class="fu">tab_style</span>(</span>
<span id="cb14-51"><a href="#cb14-51"></a>      <span class="at">style =</span> <span class="fu">list</span>(</span>
<span id="cb14-52"><a href="#cb14-52"></a>        <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>),</span>
<span id="cb14-53"><a href="#cb14-53"></a>        <span class="fu">cell_borders</span>(</span>
<span id="cb14-54"><a href="#cb14-54"></a>          <span class="at">sides =</span> <span class="fu">c</span>(<span class="st">"top"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb14-55"><a href="#cb14-55"></a>          <span class="at">weight =</span> <span class="fu">px</span>(<span class="dv">2</span>),</span>
<span id="cb14-56"><a href="#cb14-56"></a>          <span class="at">style =</span> (<span class="st">"solid"</span>)</span>
<span id="cb14-57"><a href="#cb14-57"></a>        )</span>
<span id="cb14-58"><a href="#cb14-58"></a>      ),</span>
<span id="cb14-59"><a href="#cb14-59"></a>      <span class="at">locations =</span> <span class="fu">cells_column_labels</span>()</span>
<span id="cb14-60"><a href="#cb14-60"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb14-61"><a href="#cb14-61"></a>    <span class="fu">tab_style</span>(</span>
<span id="cb14-62"><a href="#cb14-62"></a>      <span class="at">style =</span> <span class="fu">cell_fill</span>(<span class="st">"yellow"</span>),</span>
<span id="cb14-63"><a href="#cb14-63"></a>      <span class="at">locations =</span> <span class="fu">cells_body</span>(<span class="at">rows =</span> p.value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="at">columns =</span> p.value)</span>
<span id="cb14-64"><a href="#cb14-64"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb14-65"><a href="#cb14-65"></a>    <span class="fu">fmt_number</span>(<span class="at">decimals =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-66"><a href="#cb14-66"></a>    <span class="fu">as_raw_html</span>()</span>
<span id="cb14-67"><a href="#cb14-67"></a>}</span>
<span id="cb14-68"><a href="#cb14-68"></a></span>
<span id="cb14-69"><a href="#cb14-69"></a><span class="in">```</span></span>
<span id="cb14-70"><a href="#cb14-70"></a></span>
<span id="cb14-71"><a href="#cb14-71"></a><span class="fu">## A quick look at the Case-Shiller HPI</span></span>
<span id="cb14-72"><a href="#cb14-72"></a></span>
<span id="cb14-73"><a href="#cb14-73"></a>In this post I'll only be looking at the Case-Shiller Home Price Index (HPI) for the four cities in my data – San Diego, Dallas, Detroit, and New York City – between January 2006 and December 2022. Here's a quick peek at the data:</span>
<span id="cb14-74"><a href="#cb14-74"></a></span>
<span id="cb14-77"><a href="#cb14-77"></a><span class="in">```{r}</span></span>
<span id="cb14-78"><a href="#cb14-78"></a><span class="co">#| label: show-hpi-data</span></span>
<span id="cb14-79"><a href="#cb14-79"></a></span>
<span id="cb14-80"><a href="#cb14-80"></a>econ_data <span class="sc">|&gt;</span></span>
<span id="cb14-81"><a href="#cb14-81"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb14-82"><a href="#cb14-82"></a>  <span class="fu">slice_min</span>(date, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-83"><a href="#cb14-83"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-84"><a href="#cb14-84"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-85"><a href="#cb14-85"></a>  <span class="fu">gt_bold_head</span>()</span>
<span id="cb14-86"><a href="#cb14-86"></a></span>
<span id="cb14-87"><a href="#cb14-87"></a><span class="in">```</span></span>
<span id="cb14-88"><a href="#cb14-88"></a></span>
<span id="cb14-89"><a href="#cb14-89"></a>Now I'll look visualize the data in a line plot.</span>
<span id="cb14-90"><a href="#cb14-90"></a></span>
<span id="cb14-93"><a href="#cb14-93"></a><span class="in">```{r}</span></span>
<span id="cb14-94"><a href="#cb14-94"></a><span class="co">#| label: initial-line-plot</span></span>
<span id="cb14-95"><a href="#cb14-95"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb14-96"><a href="#cb14-96"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb14-97"><a href="#cb14-97"></a></span>
<span id="cb14-98"><a href="#cb14-98"></a>econ_data <span class="sc">|&gt;</span></span>
<span id="cb14-99"><a href="#cb14-99"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, hpi, <span class="at">color =</span> city)) <span class="sc">+</span></span>
<span id="cb14-100"><a href="#cb14-100"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb14-101"><a href="#cb14-101"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-102"><a href="#cb14-102"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-103"><a href="#cb14-103"></a>    <span class="at">y =</span> <span class="st">"HPI"</span>,</span>
<span id="cb14-104"><a href="#cb14-104"></a>    <span class="at">color =</span> <span class="cn">NULL</span>,</span>
<span id="cb14-105"><a href="#cb14-105"></a>    <span class="at">title =</span> <span class="st">"Case-Shiller HPI from 2006 through 2022"</span></span>
<span id="cb14-106"><a href="#cb14-106"></a>  ) <span class="sc">+</span></span>
<span id="cb14-107"><a href="#cb14-107"></a>  theme_timetk <span class="sc">+</span></span>
<span id="cb14-108"><a href="#cb14-108"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb14-109"><a href="#cb14-109"></a><span class="in">```</span></span>
<span id="cb14-110"><a href="#cb14-110"></a></span>
<span id="cb14-111"><a href="#cb14-111"></a>Here one can see that Dallas's HPI did not drop as much during the Great Recession and has had a fast rise relative to those of the other cities ever since. It's also pretty clear that NYC's HPI has experienced a relatively mild increase over the years covered. There's also more volatility between 2010 and 2015 in the HPIs for NYC, Dallas, and Detroit than in San Diego's.</span>
<span id="cb14-112"><a href="#cb14-112"></a></span>
<span id="cb14-113"><a href="#cb14-113"></a><span class="fu">## Time series analysis</span></span>
<span id="cb14-114"><a href="#cb14-114"></a></span>
<span id="cb14-115"><a href="#cb14-115"></a>The goal of this initial analysis is to find the parameters to use in an ARIMA model, which means that I'll need to ensure my data are <span class="co">[</span><span class="ot">stationary</span><span class="co">](https://en.wikipedia.org/wiki/Stationary_process)</span>. I'll try to get there through the following operations and analyses.</span>
<span id="cb14-116"><a href="#cb14-116"></a></span>
<span id="cb14-117"><a href="#cb14-117"></a><span class="fu">### Preparing the data</span></span>
<span id="cb14-118"><a href="#cb14-118"></a></span>
<span id="cb14-119"><a href="#cb14-119"></a>Before performing any analysis I'd like to add one column with a lagged first-difference and another with a lagged twelfth-difference. To accomplish this I'll use the <span class="in">`tk_augment_differences()`</span> from the <span class="co">[</span><span class="ot">timetk</span><span class="co">](https://business-science.github.io/timetk/)</span> package. I'll store this data set in a new variable called "hpi_series". I chose these two lagged differences because the lagged first-difference generally any stationarity rooted in a trend and the lagged twelfth-difference should deal with seasonality as my data are monthly observations and I'm operating on the assumption that the housing market cycle is annual.</span>
<span id="cb14-120"><a href="#cb14-120"></a></span>
<span id="cb14-121"><a href="#cb14-121"></a>Below is a snippet of the data.</span>
<span id="cb14-122"><a href="#cb14-122"></a></span>
<span id="cb14-125"><a href="#cb14-125"></a><span class="in">```{r}</span></span>
<span id="cb14-126"><a href="#cb14-126"></a><span class="co">#| label: add-diff-lag</span></span>
<span id="cb14-127"><a href="#cb14-127"></a></span>
<span id="cb14-128"><a href="#cb14-128"></a>hpi_series <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="cb14-129"><a href="#cb14-129"></a>  <span class="fu">select</span>(city, date, hpi) <span class="sc">|&gt;</span></span>
<span id="cb14-130"><a href="#cb14-130"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb14-131"><a href="#cb14-131"></a>  <span class="fu">tk_augment_differences</span>(</span>
<span id="cb14-132"><a href="#cb14-132"></a>    <span class="at">.value =</span> hpi,</span>
<span id="cb14-133"><a href="#cb14-133"></a>    <span class="at">.lags =</span> <span class="dv">1</span>,</span>
<span id="cb14-134"><a href="#cb14-134"></a>    <span class="at">.differences =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb14-135"><a href="#cb14-135"></a>    <span class="at">.log =</span> <span class="cn">FALSE</span></span>
<span id="cb14-136"><a href="#cb14-136"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-137"><a href="#cb14-137"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb14-138"><a href="#cb14-138"></a></span>
<span id="cb14-139"><a href="#cb14-139"></a><span class="fu">head</span>(hpi_series, <span class="dv">15</span>) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span>
<span id="cb14-140"><a href="#cb14-140"></a><span class="in">```</span></span>
<span id="cb14-141"><a href="#cb14-141"></a></span>
<span id="cb14-142"><a href="#cb14-142"></a>And now I can look at line plots of the three different series with the original on the left ; the lagged first-difference in the middle; and the lagged twelfth-difference on the right with a the cities in the different rows. From left to right the plots go from being highly regular (seasonal and trending) to being less regular in the middle (only seasonal) and highly irregular on the right. That irregularity is indicative of stationarity, which is what I want to see. This also provides a sneak peak into what the following analyses will give us.</span>
<span id="cb14-143"><a href="#cb14-143"></a></span>
<span id="cb14-146"><a href="#cb14-146"></a><span class="in">```{r}</span></span>
<span id="cb14-147"><a href="#cb14-147"></a><span class="co">#| label: plot-lagged-diffs</span></span>
<span id="cb14-148"><a href="#cb14-148"></a></span>
<span id="cb14-149"><a href="#cb14-149"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb14-150"><a href="#cb14-150"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"hpi"</span>), <span class="at">names_to =</span> <span class="st">"series"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-151"><a href="#cb14-151"></a>  <span class="fu">group_by</span>(city, series) <span class="sc">|&gt;</span></span>
<span id="cb14-152"><a href="#cb14-152"></a>  <span class="fu">plot_time_series</span>(</span>
<span id="cb14-153"><a href="#cb14-153"></a>    date,</span>
<span id="cb14-154"><a href="#cb14-154"></a>    value,</span>
<span id="cb14-155"><a href="#cb14-155"></a>    <span class="at">.facet_ncol =</span> <span class="dv">3</span>,</span>
<span id="cb14-156"><a href="#cb14-156"></a>    <span class="at">.title =</span> <span class="st">"Case-Shiller HPI from 2006 through 2022"</span>,</span>
<span id="cb14-157"><a href="#cb14-157"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span></span>
<span id="cb14-158"><a href="#cb14-158"></a>  ) <span class="sc">+</span></span>
<span id="cb14-159"><a href="#cb14-159"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb14-160"><a href="#cb14-160"></a></span>
<span id="cb14-161"><a href="#cb14-161"></a><span class="in">```</span></span>
<span id="cb14-162"><a href="#cb14-162"></a></span>
<span id="cb14-163"><a href="#cb14-163"></a>On might ask "why not use a lagged, log difference?" The below plot shows that using a lagged, log first- and twelfth-differenced series don't change anything compared to the lagged first- and twelfth-differenced series except for generating data with much higher relative amplitude and possibly showing outliers. This might actually introduce heteroskedasticity, which I'd like to avoid.</span>
<span id="cb14-164"><a href="#cb14-164"></a></span>
<span id="cb14-167"><a href="#cb14-167"></a><span class="in">```{r}</span></span>
<span id="cb14-168"><a href="#cb14-168"></a><span class="co">#| label: plot-lagged-log-diffs</span></span>
<span id="cb14-169"><a href="#cb14-169"></a></span>
<span id="cb14-170"><a href="#cb14-170"></a>econ_data <span class="sc">|&gt;</span></span>
<span id="cb14-171"><a href="#cb14-171"></a>  <span class="fu">tk_augment_differences</span>(</span>
<span id="cb14-172"><a href="#cb14-172"></a>    <span class="at">.value =</span> hpi,</span>
<span id="cb14-173"><a href="#cb14-173"></a>    <span class="at">.lags =</span> <span class="dv">1</span>,</span>
<span id="cb14-174"><a href="#cb14-174"></a>    <span class="at">.differences =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">12</span>),</span>
<span id="cb14-175"><a href="#cb14-175"></a>    <span class="at">.log =</span> <span class="cn">TRUE</span></span>
<span id="cb14-176"><a href="#cb14-176"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-177"><a href="#cb14-177"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">"hpi"</span>), <span class="at">names_to =</span> <span class="st">"series"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-178"><a href="#cb14-178"></a>  <span class="fu">group_by</span>(city, series) <span class="sc">|&gt;</span></span>
<span id="cb14-179"><a href="#cb14-179"></a>  <span class="fu">plot_time_series</span>(</span>
<span id="cb14-180"><a href="#cb14-180"></a>    date,</span>
<span id="cb14-181"><a href="#cb14-181"></a>    value,</span>
<span id="cb14-182"><a href="#cb14-182"></a>    <span class="at">.facet_ncol =</span> <span class="dv">3</span>,</span>
<span id="cb14-183"><a href="#cb14-183"></a>    <span class="at">.title =</span> <span class="st">"Case-Shiller HPI from 2006 through 2022"</span>,</span>
<span id="cb14-184"><a href="#cb14-184"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span></span>
<span id="cb14-185"><a href="#cb14-185"></a>  ) <span class="sc">+</span></span>
<span id="cb14-186"><a href="#cb14-186"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb14-187"><a href="#cb14-187"></a></span>
<span id="cb14-188"><a href="#cb14-188"></a><span class="in">```</span></span>
<span id="cb14-189"><a href="#cb14-189"></a></span>
<span id="cb14-190"><a href="#cb14-190"></a><span class="fu">### Time series decomposition</span></span>
<span id="cb14-191"><a href="#cb14-191"></a></span>
<span id="cb14-192"><a href="#cb14-192"></a>The following plot shows the Seasonal-Trend decomposition using Loess (STL), which is a common tool to determine how much of a time series' movement is due to a trend versus that which is due to it's seasonality. Again, here I'll assume an annual seasonal cycle.</span>
<span id="cb14-193"><a href="#cb14-193"></a></span>
<span id="cb14-196"><a href="#cb14-196"></a><span class="in">```{r}</span></span>
<span id="cb14-197"><a href="#cb14-197"></a><span class="co">#| label: stl</span></span>
<span id="cb14-198"><a href="#cb14-198"></a></span>
<span id="cb14-199"><a href="#cb14-199"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb14-200"><a href="#cb14-200"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb14-201"><a href="#cb14-201"></a>  <span class="fu">plot_stl_diagnostics</span>(</span>
<span id="cb14-202"><a href="#cb14-202"></a>    date,</span>
<span id="cb14-203"><a href="#cb14-203"></a>    hpi,</span>
<span id="cb14-204"><a href="#cb14-204"></a>    <span class="at">.feature_set =</span> <span class="fu">c</span>(<span class="st">"observed"</span>, <span class="st">"season"</span>, <span class="st">"trend"</span>, <span class="st">"remainder"</span>),</span>
<span id="cb14-205"><a href="#cb14-205"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-206"><a href="#cb14-206"></a>    <span class="at">.frequency =</span> <span class="dv">12</span></span>
<span id="cb14-207"><a href="#cb14-207"></a>  ) <span class="sc">+</span></span>
<span id="cb14-208"><a href="#cb14-208"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb14-209"><a href="#cb14-209"></a></span>
<span id="cb14-210"><a href="#cb14-210"></a><span class="in">```</span></span>
<span id="cb14-211"><a href="#cb14-211"></a></span>
<span id="cb14-212"><a href="#cb14-212"></a>According to this plot most of the movement in the HPI is determined by the trend and very little by seasonality.</span>
<span id="cb14-213"><a href="#cb14-213"></a></span>
<span id="cb14-214"><a href="#cb14-214"></a><span class="fu">### Augmented Dickey-Fuller Test</span></span>
<span id="cb14-215"><a href="#cb14-215"></a></span>
<span id="cb14-216"><a href="#cb14-216"></a>The Augmented Dickey-Fuller Test (ADF) is commonly run to evaluate whether a time series is stationary or not. The null hypothesis of the ADF is that the time series is non-stationary, so want to reject the null hypothesis to be able to assume the alternative, i.e., that the series is stationary. The following table shows that one can reject the null hypothesis for every city but San Diego with just a lagged first-difference, but with the lagged twelfth-difference all four series can be thought of as stationary.</span>
<span id="cb14-217"><a href="#cb14-217"></a></span>
<span id="cb14-220"><a href="#cb14-220"></a><span class="in">```{r}</span></span>
<span id="cb14-221"><a href="#cb14-221"></a><span class="co">#| label: show-adf</span></span>
<span id="cb14-222"><a href="#cb14-222"></a><span class="co">#| warning: false</span></span>
<span id="cb14-223"><a href="#cb14-223"></a></span>
<span id="cb14-224"><a href="#cb14-224"></a>hpi_adf <span class="ot">&lt;-</span> hpi_series <span class="sc">|&gt;</span></span>
<span id="cb14-225"><a href="#cb14-225"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span><span class="fu">c</span>(city, date), <span class="at">names_to =</span> <span class="st">"variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-226"><a href="#cb14-226"></a>  <span class="fu">group_by</span>(city, variable) <span class="sc">|&gt;</span></span>
<span id="cb14-227"><a href="#cb14-227"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">c</span>(date, value)) <span class="sc">|&gt;</span></span>
<span id="cb14-228"><a href="#cb14-228"></a>  <span class="fu">mutate</span>(</span>
<span id="cb14-229"><a href="#cb14-229"></a>    <span class="at">adf_test =</span> <span class="fu">map</span>(</span>
<span id="cb14-230"><a href="#cb14-230"></a>      data,</span>
<span id="cb14-231"><a href="#cb14-231"></a>      \(x) <span class="fu">drop_na</span>(x, value) <span class="sc">|&gt;</span></span>
<span id="cb14-232"><a href="#cb14-232"></a>        <span class="fu">pull</span>(value) <span class="sc">|&gt;</span></span>
<span id="cb14-233"><a href="#cb14-233"></a>        tseries<span class="sc">::</span><span class="fu">adf.test</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-234"><a href="#cb14-234"></a>        broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-235"><a href="#cb14-235"></a>        <span class="fu">select</span>(statistic, p.value)</span>
<span id="cb14-236"><a href="#cb14-236"></a>    )</span>
<span id="cb14-237"><a href="#cb14-237"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb14-238"><a href="#cb14-238"></a>  <span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">|&gt;</span></span>
<span id="cb14-239"><a href="#cb14-239"></a>  <span class="fu">unnest</span>(adf_test) <span class="sc">|&gt;</span></span>
<span id="cb14-240"><a href="#cb14-240"></a>  <span class="fu">ungroup</span>(variable)</span>
<span id="cb14-241"><a href="#cb14-241"></a></span>
<span id="cb14-242"><a href="#cb14-242"></a>hpi_adf <span class="sc">|&gt;</span></span>
<span id="cb14-243"><a href="#cb14-243"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb14-244"><a href="#cb14-244"></a>  <span class="fu">group_nest</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-245"><a href="#cb14-245"></a>  <span class="fu">mutate</span>(<span class="at">data_gt =</span> <span class="fu">map</span>(data, make_adf_gt)) <span class="sc">|&gt;</span></span>
<span id="cb14-246"><a href="#cb14-246"></a>  <span class="fu">select</span>(<span class="sc">!</span>data) <span class="sc">|&gt;</span></span>
<span id="cb14-247"><a href="#cb14-247"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> city, <span class="at">values_from =</span> data_gt) <span class="sc">|&gt;</span></span>
<span id="cb14-248"><a href="#cb14-248"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-249"><a href="#cb14-249"></a>  <span class="fu">gt_bold_head</span>()</span>
<span id="cb14-250"><a href="#cb14-250"></a></span>
<span id="cb14-251"><a href="#cb14-251"></a><span class="in">```</span></span>
<span id="cb14-252"><a href="#cb14-252"></a></span>
<span id="cb14-253"><a href="#cb14-253"></a><span class="fu">### ACF / PACF plots</span></span>
<span id="cb14-254"><a href="#cb14-254"></a></span>
<span id="cb14-255"><a href="#cb14-255"></a>The Autocorrelation Function (ACF) calculates the correlation of a value, e.g., the most recent value of the HPI, with previous values in the same series. Knowing this is very useful for determining how many Moving Average (the "MA" in ARIMA) lags to use in an ARIMA mode. The Partial Autocorrelation Function (PACF) calculates the correlation of a value with previous values in the same series after accounting for intervening correlations. This is useful to help us determine how many lags to use for the Autoregressive (the "AR" in ARIMA) part of an ARIMA model. Below are the ACF and PACF plots for the HPI series (no lagged differences) for all four cities. The timetk::<span class="in">`plot_acf_diagnostics()`</span> function plots ACF on top and PACF on bottom, which is conventional. Values outside of the red, dashed lines indicate statistically significant correlations.</span>
<span id="cb14-256"><a href="#cb14-256"></a></span>
<span id="cb14-259"><a href="#cb14-259"></a><span class="in">```{r}</span></span>
<span id="cb14-260"><a href="#cb14-260"></a><span class="co">#| label: plot-acf1</span></span>
<span id="cb14-261"><a href="#cb14-261"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb14-262"><a href="#cb14-262"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb14-263"><a href="#cb14-263"></a></span>
<span id="cb14-264"><a href="#cb14-264"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb14-265"><a href="#cb14-265"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb14-266"><a href="#cb14-266"></a>  <span class="fu">plot_acf_diagnostics</span>(</span>
<span id="cb14-267"><a href="#cb14-267"></a>    date,</span>
<span id="cb14-268"><a href="#cb14-268"></a>    hpi,</span>
<span id="cb14-269"><a href="#cb14-269"></a>    <span class="at">.lags =</span> <span class="dv">60</span>,</span>
<span id="cb14-270"><a href="#cb14-270"></a>    <span class="at">.title =</span> <span class="st">"HPI Lag Diagnostics"</span>,</span>
<span id="cb14-271"><a href="#cb14-271"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-272"><a href="#cb14-272"></a>    <span class="at">.white_noise_line_color =</span> <span class="st">"red"</span></span>
<span id="cb14-273"><a href="#cb14-273"></a>  ) <span class="sc">+</span></span>
<span id="cb14-274"><a href="#cb14-274"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb14-275"><a href="#cb14-275"></a></span>
<span id="cb14-276"><a href="#cb14-276"></a><span class="in">```</span></span>
<span id="cb14-277"><a href="#cb14-277"></a></span>
<span id="cb14-278"><a href="#cb14-278"></a>It's clear from the ACF plot that the trend is causing a lot of the autocorrelation in each city. Next is the same plot, but for the first-differenced values.</span>
<span id="cb14-279"><a href="#cb14-279"></a></span>
<span id="cb14-282"><a href="#cb14-282"></a><span class="in">```{r}</span></span>
<span id="cb14-283"><a href="#cb14-283"></a><span class="co">#| label: plot-acf2</span></span>
<span id="cb14-284"><a href="#cb14-284"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb14-285"><a href="#cb14-285"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb14-286"><a href="#cb14-286"></a></span>
<span id="cb14-287"><a href="#cb14-287"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb14-288"><a href="#cb14-288"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb14-289"><a href="#cb14-289"></a>  <span class="fu">plot_acf_diagnostics</span>(</span>
<span id="cb14-290"><a href="#cb14-290"></a>    date,</span>
<span id="cb14-291"><a href="#cb14-291"></a>    hpi_lag1_diff1,</span>
<span id="cb14-292"><a href="#cb14-292"></a>    <span class="at">.lags =</span> <span class="dv">60</span>,</span>
<span id="cb14-293"><a href="#cb14-293"></a>    <span class="at">.title =</span> <span class="st">"First-Differenced HPI Lag Diagnostics"</span>,</span>
<span id="cb14-294"><a href="#cb14-294"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-295"><a href="#cb14-295"></a>    <span class="at">.white_noise_line_color =</span> <span class="st">"red"</span></span>
<span id="cb14-296"><a href="#cb14-296"></a>  ) <span class="sc">+</span></span>
<span id="cb14-297"><a href="#cb14-297"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb14-298"><a href="#cb14-298"></a></span>
<span id="cb14-299"><a href="#cb14-299"></a><span class="in">```</span></span>
<span id="cb14-300"><a href="#cb14-300"></a></span>
<span id="cb14-301"><a href="#cb14-301"></a>The trend's influence is significantly decreased here, but there are still some strong seasonal patterns in the data. Below is a look at the twelfth-differenced series.</span>
<span id="cb14-302"><a href="#cb14-302"></a></span>
<span id="cb14-305"><a href="#cb14-305"></a><span class="in">```{r}</span></span>
<span id="cb14-306"><a href="#cb14-306"></a><span class="co">#| label: plot-acf3</span></span>
<span id="cb14-307"><a href="#cb14-307"></a><span class="co">#| fig-width: 8</span></span>
<span id="cb14-308"><a href="#cb14-308"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb14-309"><a href="#cb14-309"></a></span>
<span id="cb14-310"><a href="#cb14-310"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb14-311"><a href="#cb14-311"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb14-312"><a href="#cb14-312"></a>  <span class="fu">plot_acf_diagnostics</span>(</span>
<span id="cb14-313"><a href="#cb14-313"></a>    date,</span>
<span id="cb14-314"><a href="#cb14-314"></a>    hpi_lag1_diff12,</span>
<span id="cb14-315"><a href="#cb14-315"></a>    <span class="at">.lags =</span> <span class="dv">60</span>,</span>
<span id="cb14-316"><a href="#cb14-316"></a>    <span class="at">.title =</span> <span class="st">"Twelfth-Differenced HPI Lag Diagnostics"</span>,</span>
<span id="cb14-317"><a href="#cb14-317"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-318"><a href="#cb14-318"></a>    <span class="at">.white_noise_line_color =</span> <span class="st">"red"</span></span>
<span id="cb14-319"><a href="#cb14-319"></a>  ) <span class="sc">+</span></span>
<span id="cb14-320"><a href="#cb14-320"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb14-321"><a href="#cb14-321"></a></span>
<span id="cb14-322"><a href="#cb14-322"></a><span class="in">```</span></span>
<span id="cb14-323"><a href="#cb14-323"></a></span>
<span id="cb14-324"><a href="#cb14-324"></a>Looking at this plot over 36 months it still appears that there is a small seasonal effect in Dallas, San Diego, and Detroit with Detroit's possibly being a shorter season. Considering the infinite number of things that could affect one of these data series one could look at hundreds of plots like this with different combinations of lags and differences for any one series and never find a perfect one. This plot is pretty good. From this plot it looks like I'm going to us an AR(3) model. San Diego's PACF suggests that I should use two for that city, but I'm looking for one value for all four cities. The MA component is a little more challenging. It looks like I would use MA lags of 5 or 6 for Dallas, 8 for San Diego, 4 for NYC, and 4 or 5 for Detroit. I'm going to use MA(5) for my ARIMA.</span>
<span id="cb14-325"><a href="#cb14-325"></a></span>
<span id="cb14-326"><a href="#cb14-326"></a><span class="fu">### Seasonality</span></span>
<span id="cb14-327"><a href="#cb14-327"></a></span>
<span id="cb14-328"><a href="#cb14-328"></a>It's been pretty clear up to this point that seasonality is an important consideration with this data series and it's something that I will expect to handle in the modeling portion of the analysis in a later post. If I wanted to handle seasonality in a conventional model I might run a SARIMA model, but I'm going to keep this part simple and only run ARIMA knowing that I'm partially ignoring the seasonality and only dealing with it by differencing. With that said, I'll show two more plots here to demonstrate the <span class="in">`timetk::plot_seasonal_diagnostics()`</span> . The first plot shows seasonal diagnostics for the unadjusted series and the second one for the twelfth-differenced series.</span>
<span id="cb14-329"><a href="#cb14-329"></a></span>
<span id="cb14-332"><a href="#cb14-332"></a><span class="in">```{r}</span></span>
<span id="cb14-333"><a href="#cb14-333"></a><span class="co">#| label: seas-diag1</span></span>
<span id="cb14-334"><a href="#cb14-334"></a></span>
<span id="cb14-335"><a href="#cb14-335"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb14-336"><a href="#cb14-336"></a>  <span class="fu">plot_seasonal_diagnostics</span>(</span>
<span id="cb14-337"><a href="#cb14-337"></a>    date,</span>
<span id="cb14-338"><a href="#cb14-338"></a>    hpi,</span>
<span id="cb14-339"><a href="#cb14-339"></a>    <span class="at">.facet_vars =</span> city,</span>
<span id="cb14-340"><a href="#cb14-340"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-341"><a href="#cb14-341"></a>    <span class="at">.title =</span> <span class="st">"HPI Seasonal Diagnostics"</span></span>
<span id="cb14-342"><a href="#cb14-342"></a>  ) <span class="sc">+</span></span>
<span id="cb14-343"><a href="#cb14-343"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-344"><a href="#cb14-344"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb14-345"><a href="#cb14-345"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb14-346"><a href="#cb14-346"></a>  )</span>
<span id="cb14-347"><a href="#cb14-347"></a></span>
<span id="cb14-348"><a href="#cb14-348"></a><span class="in">```</span></span>
<span id="cb14-349"><a href="#cb14-349"></a></span>
<span id="cb14-350"><a href="#cb14-350"></a>This plot shows a clear pattern of HPI values being lowest in the first quarter across all four cities, highest in the second and third quarters for San Diego, and highest in the quarter for New York and December. From this data it seems that the peak in Dallas is December. This seasonality can obscure the findings of an ARIMA model.</span>
<span id="cb14-351"><a href="#cb14-351"></a></span>
<span id="cb14-354"><a href="#cb14-354"></a><span class="in">```{r}</span></span>
<span id="cb14-355"><a href="#cb14-355"></a><span class="co">#| label: seas-diag2</span></span>
<span id="cb14-356"><a href="#cb14-356"></a></span>
<span id="cb14-357"><a href="#cb14-357"></a>hpi_series <span class="sc">|&gt;</span></span>
<span id="cb14-358"><a href="#cb14-358"></a>  <span class="fu">plot_seasonal_diagnostics</span>(</span>
<span id="cb14-359"><a href="#cb14-359"></a>    date,</span>
<span id="cb14-360"><a href="#cb14-360"></a>    hpi_lag1_diff12,</span>
<span id="cb14-361"><a href="#cb14-361"></a>    <span class="at">.facet_vars =</span> city,</span>
<span id="cb14-362"><a href="#cb14-362"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-363"><a href="#cb14-363"></a>    <span class="at">.title =</span> <span class="st">"Twelfth-Differenced HPI Seasonal Diagnostics"</span></span>
<span id="cb14-364"><a href="#cb14-364"></a>  ) <span class="sc">+</span></span>
<span id="cb14-365"><a href="#cb14-365"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-366"><a href="#cb14-366"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb14-367"><a href="#cb14-367"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb14-368"><a href="#cb14-368"></a>  )</span>
<span id="cb14-369"><a href="#cb14-369"></a></span>
<span id="cb14-370"><a href="#cb14-370"></a><span class="in">```</span></span>
<span id="cb14-371"><a href="#cb14-371"></a></span>
<span id="cb14-372"><a href="#cb14-372"></a>In this plot the patterns are generally gone across the quarterly plots. Even the trend is mostly gone from the annual plot.</span>
<span id="cb14-373"><a href="#cb14-373"></a></span>
<span id="cb14-374"><a href="#cb14-374"></a>In the next post I'll use the AR and MA values from this post to run ARIMA models for all four cities using a global modeling process and an iterative modeling process with <span class="co">[</span><span class="ot">modeltime</span><span class="co">](https://business-science.github.io/modeltime/)</span>.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>