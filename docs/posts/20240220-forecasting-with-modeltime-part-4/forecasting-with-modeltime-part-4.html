<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arcenis Rojas">
<meta name="dcterms.date" content="2024-02-20">

<title>Arcenis Rojas - Forecasting with {modeltime} - Part IV</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Arcenis Rojas</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Personal Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ce-dashboards.html"> 
<span class="menu-text">Dashboards</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/arcenisrojas" target="_blank"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/arcenis-r" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#review" id="toc-review" class="nav-link active" data-scroll-target="#review">Review</a></li>
  <li><a href="#splitting-the-data" id="toc-splitting-the-data" class="nav-link" data-scroll-target="#splitting-the-data">Splitting the data</a></li>
  <li><a href="#choosing-algorithms" id="toc-choosing-algorithms" class="nav-link" data-scroll-target="#choosing-algorithms">Choosing algorithms</a></li>
  <li><a href="#building-workflow-objects" id="toc-building-workflow-objects" class="nav-link" data-scroll-target="#building-workflow-objects">Building workflow objects</a>
  <ul class="collapse">
  <li><a href="#writing-recipes" id="toc-writing-recipes" class="nav-link" data-scroll-target="#writing-recipes">Writing recipes</a></li>
  <li><a href="#specifying-models" id="toc-specifying-models" class="nav-link" data-scroll-target="#specifying-models">Specifying models</a></li>
  <li><a href="#building-workflowsets" id="toc-building-workflowsets" class="nav-link" data-scroll-target="#building-workflowsets">Building workflowsets</a></li>
  </ul></li>
  <li><a href="#fitting-the-models" id="toc-fitting-the-models" class="nav-link" data-scroll-target="#fitting-the-models">Fitting the models</a></li>
  <li><a href="#investigating-failed-models" id="toc-investigating-failed-models" class="nav-link" data-scroll-target="#investigating-failed-models">Investigating failed models</a></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">Model evaluation</a></li>
  <li><a href="#forecasting-with-global-models" id="toc-forecasting-with-global-models" class="nav-link" data-scroll-target="#forecasting-with-global-models">Forecasting with global models</a></li>
  <li><a href="#choosing-models-for-iterative-process" id="toc-choosing-models-for-iterative-process" class="nav-link" data-scroll-target="#choosing-models-for-iterative-process">Choosing models for iterative process</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Forecasting with {modeltime} - Part IV</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Tuning many global models</p>
  <div class="quarto-categories">
    <div class="quarto-category">Time Series</div>
    <div class="quarto-category">Forecasting</div>
    <div class="quarto-category">Machine Learning</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arcenis Rojas </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 20, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="review" class="level2">
<h2 class="anchored" data-anchor-id="review">Review</h2>
<p>Up to this point in the project I acquired data in <a href="../../posts/20240212-forecasting-with-modeltime-part-1/forecasting-with-modeltime-part-1.html">Forecasting with {modeltime} - Part I</a>, performed some standard time series analysis in <a href="../../posts/20240215-forecasting-with-modeltime-part-2/forecasting-with-modeltime-part-2.html">Forecasting with {modeltime} - Part II</a>, and explored the two types of modeling processes – global and iterative – for multiple time series in <a href="../../posts/20240216-forecasting-with-modeltime-part-3/forecasting-with-modeltime-part-3.html">Forecasting with {modeltime} - Part III</a>. In this post I’m going to tune multiple models using a global process to select a small number of them that I will run iteratively in the final post. I’ll incorporate some of the other variables in the data set that I gathered in the the first post to forecast the Case-Shiller Home Price Index (HPI). Since I’ll be creating variations of model specifications, I’m also going to use functions from the Tidymodels <a href="https://workflowsets.tidymodels.org/">workflowsets</a> <span class="citation" data-cites="workflowsets">(<a href="#ref-workflowsets" role="doc-biblioref">Kuhn and Couch 2023</a>)</span> package to run the models. As before I’ll be using <a href="https://business-science.github.io/modeltime/index.html">modeltime</a> <span class="citation" data-cites="modeltime">(<a href="#ref-modeltime" role="doc-biblioref">Dancho 2023</a>)</span>, <a href="https://business-science.github.io/timetk/">timetk</a> <span class="citation" data-cites="timetk">(<a href="#ref-timetk" role="doc-biblioref">Dancho and Vaughan 2023</a>)</span>, <a href="https://www.tidymodels.org/">tidymodels</a> <span class="citation" data-cites="tidymodels">(<a href="#ref-tidymodels" role="doc-biblioref">Kuhn and Wickham 2020</a>)</span>, <a href="https://www.tidyverse.org/">tidyverse</a> <span class="citation" data-cites="tidyverse">(<a href="#ref-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span>, and <a href="#0">gt</a> <span class="citation" data-cites="gt">(<a href="#ref-gt" role="doc-biblioref">Iannone et al. 2024</a>)</span>. Before jumping in, below I show a glimpse of the data that I’ll be using.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(timetk)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(modeltime)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-6"><a href="#cb1-6"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"lag"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">tidymodels_prefer</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(econ_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">econ_data</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">816</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">16</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Date</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">city</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: Date</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">min</th>
<th style="text-align: left;">max</th>
<th style="text-align: left;">median</th>
<th style="text-align: right;">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">date</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2006-01-01</td>
<td style="text-align: left;">2022-12-01</td>
<td style="text-align: left;">2014-06-16</td>
<td style="text-align: right;">204</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">hpi</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">172.19</td>
<td style="text-align: right;">64.38</td>
<td style="text-align: right;">64.47</td>
<td style="text-align: right;">122.40</td>
<td style="text-align: right;">168.06</td>
<td style="text-align: right;">203.87</td>
<td style="text-align: right;">427.80</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">unemp_rate</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.50</td>
<td style="text-align: right;">2.93</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">4.20</td>
<td style="text-align: right;">5.60</td>
<td style="text-align: right;">8.30</td>
<td style="text-align: right;">23.90</td>
<td style="text-align: left;">▇▃▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age_lt_18</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: left;">▂▇▇▅▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_18_35</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: left;">▁▃▇▃▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age_36_65</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: left;">▁▃▇▂▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_gt_65</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: left;">▃▆▇▅▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">educ_hs_less</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: left;">▁▃▇▇▃</td>
</tr>
<tr class="even">
<td style="text-align: left;">educ_college</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: left;">▂▇▆▃▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">educ_grad</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: left;">▃▇▇▅▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">status_married</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: left;">▁▁▇▇▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">status_nev_mar</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.29</td>
<td style="text-align: right;">0.34</td>
<td style="text-align: left;">▂▅▇▇▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">status_other</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.34</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: left;">▃▇▃▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hispanic</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: left;">▅▁▆▇▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">population</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8471150.57</td>
<td style="text-align: right;">6499655.47</td>
<td style="text-align: right;">2834025.25</td>
<td style="text-align: right;">4050215.00</td>
<td style="text-align: right;">5109791.12</td>
<td style="text-align: right;">10555276.77</td>
<td style="text-align: right;">20320876.00</td>
<td style="text-align: left;">▇▃▁▁▃</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="splitting-the-data" class="level2">
<h2 class="anchored" data-anchor-id="splitting-the-data">Splitting the data</h2>
<p>The data split object for a global modeling process is different than that for an iterative modeling process. For the global modeling process I’ll use <code>timetk::time_series_split()</code> . Below is a look at how the data are split.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>econ_splits <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">time_series_split</span>(</span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="at">assess =</span> <span class="st">"2 year"</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="at">cumulative =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-5"><a href="#cb3-5"></a>    <span class="at">date_var =</span> date</span>
<span id="cb3-6"><a href="#cb3-6"></a>  )</span>
<span id="cb3-7"><a href="#cb3-7"></a></span>
<span id="cb3-8"><a href="#cb3-8"></a>econ_splits</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Analysis/Assess/Total&gt;
&lt;720/96/816&gt;</code></pre>
</div>
</div>
</section>
<section id="choosing-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="choosing-algorithms">Choosing algorithms</h2>
<p>As with selecting the cities in the analysis I’m interested in getting a little variation in the algorithms to see how they perform and I want to vary the parameters a bit. To get something of a traditional flavor I’m going to run ARIMA models with three different model formulas:</p>
<p>1) hpi ~ date</p>
<p>2) hpi ~ date + unemployment</p>
<p>3) hpi ~ date + unemployment + demographic variables</p>
<p>I’ll also have four specifications for the algorithms. One will be the default auto-ARIMA and the other three will be auto-ARIMA specifications with different season lengths. This will give me twelve different ARIMA models (3 recipes x 4 algorithm specifications).</p>
<p>In much the same way I will have different sets of recipes and model specifications for the following:</p>
<ul>
<li><p>an exponential smoothing algorithm (including a Holt-Winters specification) to allow for weighting the periods exponentially</p></li>
<li><p>an STLM algorithm using an ARIMA engine (STLM: <strong>S</strong>easonal <strong>T</strong>rend Decomposition using <strong>L</strong>oess with <strong>M</strong>ultiple seasonal periods)</p></li>
<li><p>A feed-forward, auto-regressive neural-net algorithm because these tend to have high predictive ability</p></li>
</ul>
<p>Some of these algorithms allow for covariates and others (like exponential smoothing) do not. In the end I will have 90 model specifications to test. In order to do speed up the processing I’ll employ <a href="https://business-science.github.io/modeltime/index.html">modeltime</a>’s parallel processing feature.</p>
</section>
<section id="building-workflow-objects" class="level2">
<h2 class="anchored" data-anchor-id="building-workflow-objects">Building workflow objects</h2>
<p>Here I’ll write the three recipes for the ARIMA models and one for the auto-regressive neural-net model. The exponential smoothing and STLM models will both use the first of the three ARIMA recipes as neither of these algorithms can handle covariates.</p>
<p>You might notice in the code below that I exclude some of the demographic variables like “educ_hs_less” for the third ARIMA recipe. I exclude these variables because I found that including all of the variables for a demographic variable group causes the functions to error out much in the same way that including all of the categories of a factor variable would. Initially I did not expect that I would need contrasts considering that the variable values are ratios, but it seems that the fact that the sum of the ratios for a given variable group, e.g., education, is 1 for each row and for each variable group creates a need for contrasts in the regression (this is my guess).</p>
<section id="writing-recipes" class="level3">
<h3 class="anchored" data-anchor-id="writing-recipes">Writing recipes</h3>
<div class="callout callout-style-default callout-note callout-titled" title="Code Explanations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code Explanations
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some of the code chunks below contain explanations. Lines in explanations will be marked with encircled numbers. Just hover over those numbers to see the corresponding explanation.</p>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-1" class="code-annotation-target"><a href="#annotated-cell-4-1"></a>arima_rec1 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(hpi <span class="sc">~</span> date, <span class="at">data =</span> <span class="fu">training</span>(econ_splits))</span>
<span id="annotated-cell-4-2"><a href="#annotated-cell-4-2"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2">2</button><span id="annotated-cell-4-3" class="code-annotation-target"><a href="#annotated-cell-4-3"></a>arima_rec2 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="annotated-cell-4-4"><a href="#annotated-cell-4-4"></a>  hpi <span class="sc">~</span> date <span class="sc">+</span> unemp_rate,</span>
<span id="annotated-cell-4-5"><a href="#annotated-cell-4-5"></a>  <span class="at">data =</span> <span class="fu">training</span>(econ_splits)</span>
<span id="annotated-cell-4-6"><a href="#annotated-cell-4-6"></a>) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="3">3</button><span id="annotated-cell-4-7" class="code-annotation-target"><a href="#annotated-cell-4-7"></a>  <span class="fu">step_center</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="4">4</button><span id="annotated-cell-4-8" class="code-annotation-target"><a href="#annotated-cell-4-8"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="5">5</button><span id="annotated-cell-4-9" class="code-annotation-target"><a href="#annotated-cell-4-9"></a>  <span class="fu">step_lag</span>(unemp_rate, <span class="at">lag =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>))</span>
<span id="annotated-cell-4-10"><a href="#annotated-cell-4-10"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="6">6</button><span id="annotated-cell-4-11" class="code-annotation-target"><a href="#annotated-cell-4-11"></a>rec3_dep_vars <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="annotated-cell-4-12"><a href="#annotated-cell-4-12"></a>  <span class="fu">select</span>(date, unemp_rate<span class="sc">:</span>population) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-4-13"><a href="#annotated-cell-4-13"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(educ_hs_less, status_married, age_36_65)) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-4-14"><a href="#annotated-cell-4-14"></a>  <span class="fu">names</span>() <span class="sc">|&gt;</span></span>
<span id="annotated-cell-4-15"><a href="#annotated-cell-4-15"></a>  <span class="fu">str_flatten</span>(<span class="at">collapse =</span> <span class="st">" + "</span>)</span>
<span id="annotated-cell-4-16"><a href="#annotated-cell-4-16"></a></span>
<span id="annotated-cell-4-17"><a href="#annotated-cell-4-17"></a>arima_rec3 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="annotated-cell-4-18"><a href="#annotated-cell-4-18"></a>  <span class="fu">formula</span>(<span class="fu">str_c</span>(<span class="st">"hpi"</span>, rec3_dep_vars, <span class="at">sep =</span> <span class="st">" ~ "</span>)),</span>
<span id="annotated-cell-4-19"><a href="#annotated-cell-4-19"></a>  <span class="at">data =</span> <span class="fu">training</span>(econ_splits)</span>
<span id="annotated-cell-4-20"><a href="#annotated-cell-4-20"></a>) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-4-21"><a href="#annotated-cell-4-21"></a>  <span class="fu">step_center</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-4-22"><a href="#annotated-cell-4-22"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-4-23"><a href="#annotated-cell-4-23"></a>  <span class="fu">step_lag</span>(unemp_rate, population, <span class="at">lag =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>))</span>
<span id="annotated-cell-4-24"><a href="#annotated-cell-4-24"></a></span>
<span id="annotated-cell-4-25"><a href="#annotated-cell-4-25"></a>nnet_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="annotated-cell-4-26"><a href="#annotated-cell-4-26"></a>  hpi <span class="sc">~</span> .,</span>
<span id="annotated-cell-4-27"><a href="#annotated-cell-4-27"></a>  <span class="at">data =</span> <span class="fu">training</span>(econ_splits)</span>
<span id="annotated-cell-4-28"><a href="#annotated-cell-4-28"></a>) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="7">7</button><span id="annotated-cell-4-29" class="code-annotation-target"><a href="#annotated-cell-4-29"></a>  <span class="fu">update_role</span>(city, <span class="at">new_role =</span> <span class="st">"ID"</span>) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-4-30"><a href="#annotated-cell-4-30"></a>  <span class="fu">step_center</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-4-31"><a href="#annotated-cell-4-31"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="8">8</button><span id="annotated-cell-4-32" class="code-annotation-target"><a href="#annotated-cell-4-32"></a>  <span class="fu">step_timeseries_signature</span>(date) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="9">9</button><span id="annotated-cell-4-33" class="code-annotation-target"><a href="#annotated-cell-4-33"></a>  <span class="fu">step_nzv</span>(<span class="fu">all_predictors</span>())</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="1" data-code-annotation="1">Write a base recipe to regress HPI on the date variable</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="3" data-code-annotation="2">Write a recipe formula that adds unemployment as an explanatory variable</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="7" data-code-annotation="3">Mean-center all numeric predictors (only “unemployment rate” here)</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="8" data-code-annotation="4">Scale all numeric predictors to have a mean of “0” and a standard error of 1</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="9" data-code-annotation="5">Create lag variables for “unemployment rate” and “population”</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="11" data-code-annotation="6">Get the names of all the economic and demographic variables from the data set and concatenate them into a formula string to make the right side of a regression formula, i.e., “var1 + var2 + var3…”</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="29" data-code-annotation="7">Because the “outcome ~ .” notation is being used, the “city” variable is included in the “.”, meaning it will be treated as an explanatory variable. This step changes the role of that variable from “predictor” to an ID variable, which modeling workflows will exclude from sets of predictors.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="32" data-code-annotation="8">Add a set of variables related to the date such as day of the week of the date, day of the month, number of the week of the year, etc.</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="9">9</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="33" data-code-annotation="9">Remove any variables with zero or near-zero variance. An example of this would be a variable indicating the day of the month. Since this is monthly data, all values would be “1”, i.e., the first day of the month.</span>
</dd>
</dl>
</div>
</div>
<p>Here is a reminder of what a recipe looks like. This is the neural-net recipe.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>nnet_rec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And this is the data set that gets created by that recipe.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>nnet_rec <span class="sc">|&gt;</span> <span class="fu">prep</span>() <span class="sc">|&gt;</span> <span class="fu">juice</span>() <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="xtqneymmqp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#xtqneymmqp table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#xtqneymmqp thead, #xtqneymmqp tbody, #xtqneymmqp tfoot, #xtqneymmqp tr, #xtqneymmqp td, #xtqneymmqp th {
  border-style: none;
}

#xtqneymmqp p {
  margin: 0;
  padding: 0;
}

#xtqneymmqp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xtqneymmqp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xtqneymmqp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xtqneymmqp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xtqneymmqp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xtqneymmqp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xtqneymmqp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xtqneymmqp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xtqneymmqp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xtqneymmqp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xtqneymmqp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xtqneymmqp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xtqneymmqp .gt_spanner_row {
  border-bottom-style: hidden;
}

#xtqneymmqp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xtqneymmqp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xtqneymmqp .gt_from_md > :first-child {
  margin-top: 0;
}

#xtqneymmqp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xtqneymmqp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xtqneymmqp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xtqneymmqp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xtqneymmqp .gt_row_group_first td {
  border-top-width: 2px;
}

#xtqneymmqp .gt_row_group_first th {
  border-top-width: 2px;
}

#xtqneymmqp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xtqneymmqp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xtqneymmqp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xtqneymmqp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xtqneymmqp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xtqneymmqp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xtqneymmqp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#xtqneymmqp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xtqneymmqp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xtqneymmqp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xtqneymmqp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xtqneymmqp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xtqneymmqp .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xtqneymmqp .gt_left {
  text-align: left;
}

#xtqneymmqp .gt_center {
  text-align: center;
}

#xtqneymmqp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xtqneymmqp .gt_font_normal {
  font-weight: normal;
}

#xtqneymmqp .gt_font_bold {
  font-weight: bold;
}

#xtqneymmqp .gt_font_italic {
  font-style: italic;
}

#xtqneymmqp .gt_super {
  font-size: 65%;
}

#xtqneymmqp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#xtqneymmqp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xtqneymmqp .gt_indent_1 {
  text-indent: 5px;
}

#xtqneymmqp .gt_indent_2 {
  text-indent: 10px;
}

#xtqneymmqp .gt_indent_3 {
  text-indent: 15px;
}

#xtqneymmqp .gt_indent_4 {
  text-indent: 20px;
}

#xtqneymmqp .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="city" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">city</th>
<th id="date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date</th>
<th id="unemp_rate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">unemp_rate</th>
<th id="age_lt_18" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">age_lt_18</th>
<th id="age_18_35" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">age_18_35</th>
<th id="age_36_65" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">age_36_65</th>
<th id="age_gt_65" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">age_gt_65</th>
<th id="educ_hs_less" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">educ_hs_less</th>
<th id="educ_college" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">educ_college</th>
<th id="educ_grad" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">educ_grad</th>
<th id="status_married" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">status_married</th>
<th id="status_nev_mar" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">status_nev_mar</th>
<th id="status_other" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">status_other</th>
<th id="hispanic" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">hispanic</th>
<th id="population" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">population</th>
<th id="hpi" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">hpi</th>
<th id="date_index.num" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_index.num</th>
<th id="date_year" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_year</th>
<th id="date_year.iso" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_year.iso</th>
<th id="date_half" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_half</th>
<th id="date_quarter" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_quarter</th>
<th id="date_month" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_month</th>
<th id="date_month.xts" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_month.xts</th>
<th id="date_month.lbl" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_month.lbl</th>
<th id="date_wday" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_wday</th>
<th id="date_wday.xts" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_wday.xts</th>
<th id="date_wday.lbl" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_wday.lbl</th>
<th id="date_qday" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_qday</th>
<th id="date_yday" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_yday</th>
<th id="date_mweek" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_mweek</th>
<th id="date_week" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_week</th>
<th id="date_week.iso" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_week.iso</th>
<th id="date_week2" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_week2</th>
<th id="date_week3" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_week3</th>
<th id="date_week4" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date_week4</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="unemp_rate">-0.5318986</td>
<td class="gt_row gt_right" headers="age_lt_18">1.9837898</td>
<td class="gt_row gt_right" headers="age_18_35">1.2244300</td>
<td class="gt_row gt_right" headers="age_36_65">-2.1179446</td>
<td class="gt_row gt_right" headers="age_gt_65">-1.4144536</td>
<td class="gt_row gt_right" headers="educ_hs_less">1.4132488</td>
<td class="gt_row gt_right" headers="educ_college">-1.9352723</td>
<td class="gt_row gt_right" headers="educ_grad">-1.0007519</td>
<td class="gt_row gt_right" headers="status_married">0.7138177</td>
<td class="gt_row gt_right" headers="status_nev_mar">-1.8445270</td>
<td class="gt_row gt_right" headers="status_other">1.9655339</td>
<td class="gt_row gt_right" headers="hispanic">0.2421831</td>
<td class="gt_row gt_right" headers="population">-0.4128166</td>
<td class="gt_row gt_right" headers="hpi">121.9108</td>
<td class="gt_row gt_right" headers="date_index.num">1136073600</td>
<td class="gt_row gt_right" headers="date_year">2006</td>
<td class="gt_row gt_right" headers="date_year.iso">2005</td>
<td class="gt_row gt_right" headers="date_half">1</td>
<td class="gt_row gt_right" headers="date_quarter">1</td>
<td class="gt_row gt_right" headers="date_month">1</td>
<td class="gt_row gt_right" headers="date_month.xts">0</td>
<td class="gt_row gt_center" headers="date_month.lbl">January</td>
<td class="gt_row gt_right" headers="date_wday">1</td>
<td class="gt_row gt_right" headers="date_wday.xts">0</td>
<td class="gt_row gt_center" headers="date_wday.lbl">Sunday</td>
<td class="gt_row gt_right" headers="date_qday">1</td>
<td class="gt_row gt_right" headers="date_yday">1</td>
<td class="gt_row gt_right" headers="date_mweek">5</td>
<td class="gt_row gt_right" headers="date_week">1</td>
<td class="gt_row gt_right" headers="date_week.iso">52</td>
<td class="gt_row gt_right" headers="date_week2">1</td>
<td class="gt_row gt_right" headers="date_week3">1</td>
<td class="gt_row gt_right" headers="date_week4">1</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="city">San Diego</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="unemp_rate">-0.8651452</td>
<td class="gt_row gt_right" headers="age_lt_18">-0.2639636</td>
<td class="gt_row gt_right" headers="age_18_35">-0.5419655</td>
<td class="gt_row gt_right" headers="age_36_65">-0.1248023</td>
<td class="gt_row gt_right" headers="age_gt_65">0.7104276</td>
<td class="gt_row gt_right" headers="educ_hs_less">-0.6271533</td>
<td class="gt_row gt_right" headers="educ_college">1.1018075</td>
<td class="gt_row gt_right" headers="educ_grad">-0.5165046</td>
<td class="gt_row gt_right" headers="status_married">-0.8376538</td>
<td class="gt_row gt_right" headers="status_nev_mar">-0.5633246</td>
<td class="gt_row gt_right" headers="status_other">1.4600357</td>
<td class="gt_row gt_right" headers="hispanic">0.4759810</td>
<td class="gt_row gt_right" headers="population">-0.8614678</td>
<td class="gt_row gt_right" headers="hpi">247.4588</td>
<td class="gt_row gt_right" headers="date_index.num">1136073600</td>
<td class="gt_row gt_right" headers="date_year">2006</td>
<td class="gt_row gt_right" headers="date_year.iso">2005</td>
<td class="gt_row gt_right" headers="date_half">1</td>
<td class="gt_row gt_right" headers="date_quarter">1</td>
<td class="gt_row gt_right" headers="date_month">1</td>
<td class="gt_row gt_right" headers="date_month.xts">0</td>
<td class="gt_row gt_center" headers="date_month.lbl">January</td>
<td class="gt_row gt_right" headers="date_wday">1</td>
<td class="gt_row gt_right" headers="date_wday.xts">0</td>
<td class="gt_row gt_center" headers="date_wday.lbl">Sunday</td>
<td class="gt_row gt_right" headers="date_qday">1</td>
<td class="gt_row gt_right" headers="date_yday">1</td>
<td class="gt_row gt_right" headers="date_mweek">5</td>
<td class="gt_row gt_right" headers="date_week">1</td>
<td class="gt_row gt_right" headers="date_week.iso">52</td>
<td class="gt_row gt_right" headers="date_week2">1</td>
<td class="gt_row gt_right" headers="date_week3">1</td>
<td class="gt_row gt_right" headers="date_week4">1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="city">New York</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="unemp_rate">-0.5652232</td>
<td class="gt_row gt_right" headers="age_lt_18">0.4335013</td>
<td class="gt_row gt_right" headers="age_18_35">-0.7101494</td>
<td class="gt_row gt_right" headers="age_36_65">-0.3141128</td>
<td class="gt_row gt_right" headers="age_gt_65">0.2439870</td>
<td class="gt_row gt_right" headers="educ_hs_less">1.6923074</td>
<td class="gt_row gt_right" headers="educ_college">-1.9655377</td>
<td class="gt_row gt_right" headers="educ_grad">0.3044405</td>
<td class="gt_row gt_right" headers="status_married">-0.5241964</td>
<td class="gt_row gt_right" headers="status_nev_mar">-0.2666740</td>
<td class="gt_row gt_right" headers="status_other">0.7951381</td>
<td class="gt_row gt_right" headers="hispanic">-0.1053321</td>
<td class="gt_row gt_right" headers="population">1.5314733</td>
<td class="gt_row gt_right" headers="hpi">213.4958</td>
<td class="gt_row gt_right" headers="date_index.num">1136073600</td>
<td class="gt_row gt_right" headers="date_year">2006</td>
<td class="gt_row gt_right" headers="date_year.iso">2005</td>
<td class="gt_row gt_right" headers="date_half">1</td>
<td class="gt_row gt_right" headers="date_quarter">1</td>
<td class="gt_row gt_right" headers="date_month">1</td>
<td class="gt_row gt_right" headers="date_month.xts">0</td>
<td class="gt_row gt_center" headers="date_month.lbl">January</td>
<td class="gt_row gt_right" headers="date_wday">1</td>
<td class="gt_row gt_right" headers="date_wday.xts">0</td>
<td class="gt_row gt_center" headers="date_wday.lbl">Sunday</td>
<td class="gt_row gt_right" headers="date_qday">1</td>
<td class="gt_row gt_right" headers="date_yday">1</td>
<td class="gt_row gt_right" headers="date_mweek">5</td>
<td class="gt_row gt_right" headers="date_week">1</td>
<td class="gt_row gt_right" headers="date_week.iso">52</td>
<td class="gt_row gt_right" headers="date_week2">1</td>
<td class="gt_row gt_right" headers="date_week3">1</td>
<td class="gt_row gt_right" headers="date_week4">1</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="city">Detroit</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="unemp_rate">0.1679193</td>
<td class="gt_row gt_right" headers="age_lt_18">1.1233044</td>
<td class="gt_row gt_right" headers="age_18_35">-1.7256753</td>
<td class="gt_row gt_right" headers="age_36_65">-0.3452176</td>
<td class="gt_row gt_right" headers="age_gt_65">0.4389330</td>
<td class="gt_row gt_right" headers="educ_hs_less">1.7816712</td>
<td class="gt_row gt_right" headers="educ_college">-1.6797175</td>
<td class="gt_row gt_right" headers="educ_grad">-1.2833046</td>
<td class="gt_row gt_right" headers="status_married">-0.7472264</td>
<td class="gt_row gt_right" headers="status_nev_mar">-1.1655961</td>
<td class="gt_row gt_right" headers="status_other">2.2179937</td>
<td class="gt_row gt_right" headers="hispanic">-1.6335110</td>
<td class="gt_row gt_right" headers="population">-0.6156132</td>
<td class="gt_row gt_right" headers="hpi">126.6627</td>
<td class="gt_row gt_right" headers="date_index.num">1136073600</td>
<td class="gt_row gt_right" headers="date_year">2006</td>
<td class="gt_row gt_right" headers="date_year.iso">2005</td>
<td class="gt_row gt_right" headers="date_half">1</td>
<td class="gt_row gt_right" headers="date_quarter">1</td>
<td class="gt_row gt_right" headers="date_month">1</td>
<td class="gt_row gt_right" headers="date_month.xts">0</td>
<td class="gt_row gt_center" headers="date_month.lbl">January</td>
<td class="gt_row gt_right" headers="date_wday">1</td>
<td class="gt_row gt_right" headers="date_wday.xts">0</td>
<td class="gt_row gt_center" headers="date_wday.lbl">Sunday</td>
<td class="gt_row gt_right" headers="date_qday">1</td>
<td class="gt_row gt_right" headers="date_yday">1</td>
<td class="gt_row gt_right" headers="date_mweek">5</td>
<td class="gt_row gt_right" headers="date_week">1</td>
<td class="gt_row gt_right" headers="date_week.iso">52</td>
<td class="gt_row gt_right" headers="date_week2">1</td>
<td class="gt_row gt_right" headers="date_week3">1</td>
<td class="gt_row gt_right" headers="date_week4">1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-02-01</td>
<td class="gt_row gt_right" headers="unemp_rate">-0.4985739</td>
<td class="gt_row gt_right" headers="age_lt_18">2.4431155</td>
<td class="gt_row gt_right" headers="age_18_35">1.3332951</td>
<td class="gt_row gt_right" headers="age_36_65">-2.2373194</td>
<td class="gt_row gt_right" headers="age_gt_65">-1.7310508</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.7705532</td>
<td class="gt_row gt_right" headers="educ_college">-0.9746432</td>
<td class="gt_row gt_right" headers="educ_grad">-1.6783801</td>
<td class="gt_row gt_right" headers="status_married">1.0008565</td>
<td class="gt_row gt_right" headers="status_nev_mar">-1.5342766</td>
<td class="gt_row gt_right" headers="status_other">1.3033739</td>
<td class="gt_row gt_right" headers="hispanic">0.4153678</td>
<td class="gt_row gt_right" headers="population">-0.4092439</td>
<td class="gt_row gt_right" headers="hpi">121.3285</td>
<td class="gt_row gt_right" headers="date_index.num">1138752000</td>
<td class="gt_row gt_right" headers="date_year">2006</td>
<td class="gt_row gt_right" headers="date_year.iso">2006</td>
<td class="gt_row gt_right" headers="date_half">1</td>
<td class="gt_row gt_right" headers="date_quarter">1</td>
<td class="gt_row gt_right" headers="date_month">2</td>
<td class="gt_row gt_right" headers="date_month.xts">1</td>
<td class="gt_row gt_center" headers="date_month.lbl">February</td>
<td class="gt_row gt_right" headers="date_wday">4</td>
<td class="gt_row gt_right" headers="date_wday.xts">3</td>
<td class="gt_row gt_center" headers="date_wday.lbl">Wednesday</td>
<td class="gt_row gt_right" headers="date_qday">32</td>
<td class="gt_row gt_right" headers="date_yday">32</td>
<td class="gt_row gt_right" headers="date_mweek">5</td>
<td class="gt_row gt_right" headers="date_week">5</td>
<td class="gt_row gt_right" headers="date_week.iso">5</td>
<td class="gt_row gt_right" headers="date_week2">1</td>
<td class="gt_row gt_right" headers="date_week3">2</td>
<td class="gt_row gt_right" headers="date_week4">1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="specifying-models" class="level3">
<h3 class="anchored" data-anchor-id="specifying-models">Specifying models</h3>
<p>In this next step I’ll specify the model objects for each algorithm along with the search grids for their various hyperparameters. I chose to keep only some of the combinations of the exponential smoothing specifications to limit the number of models being run that are likely to fail.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-7"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="1">1</button><span id="annotated-cell-7-1" class="code-annotation-target"><a href="#annotated-cell-7-1"></a>arima_default <span class="ot">&lt;-</span> <span class="fu">arima_reg</span>() <span class="sc">|&gt;</span> <span class="fu">set_engine</span>(<span class="st">"auto_arima"</span>)</span>
<span id="annotated-cell-7-2"><a href="#annotated-cell-7-2"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="2">2</button><span id="annotated-cell-7-3" class="code-annotation-target"><a href="#annotated-cell-7-3"></a>arima_spec_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">seasonal_period =</span> <span class="fu">seq</span>(<span class="dv">9</span>, <span class="dv">18</span>, <span class="at">by =</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="3">3</button><span id="annotated-cell-7-4" class="code-annotation-target"><a href="#annotated-cell-7-4"></a>  <span class="fu">create_model_grid</span>(</span>
<span id="annotated-cell-7-5"><a href="#annotated-cell-7-5"></a>    <span class="at">f_model_spec =</span> arima_reg,</span>
<span id="annotated-cell-7-6"><a href="#annotated-cell-7-6"></a>    <span class="at">engine_name =</span> <span class="st">"auto_arima"</span>,</span>
<span id="annotated-cell-7-7"><a href="#annotated-cell-7-7"></a>    <span class="at">mode =</span> <span class="st">"regression"</span></span>
<span id="annotated-cell-7-8"><a href="#annotated-cell-7-8"></a>  )</span>
<span id="annotated-cell-7-9"><a href="#annotated-cell-7-9"></a></span>
<span id="annotated-cell-7-10"><a href="#annotated-cell-7-10"></a>ets_default <span class="ot">&lt;-</span> <span class="fu">exp_smoothing</span>() <span class="sc">|&gt;</span> <span class="fu">set_engine</span>(<span class="st">"ets"</span>)</span>
<span id="annotated-cell-7-11"><a href="#annotated-cell-7-11"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="4">4</button><span id="annotated-cell-7-12" class="code-annotation-target"><a href="#annotated-cell-7-12"></a><span class="fu">set.seed</span>(<span class="dv">40</span>)</span>
<span id="annotated-cell-7-13"><a href="#annotated-cell-7-13"></a>alpha_vals <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">5</span>, <span class="fl">0.01</span>, <span class="fl">0.5</span>) <span class="sc">*</span></span>
<span id="annotated-cell-7-14"><a href="#annotated-cell-7-14"></a>  <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>, .<span class="dv">001</span>), <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="annotated-cell-7-15"><a href="#annotated-cell-7-15"></a>beta_vals <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">5</span>, <span class="fl">0.01</span>, <span class="fl">0.2</span>) <span class="sc">*</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>), <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="annotated-cell-7-16"><a href="#annotated-cell-7-16"></a>gamma_vals <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(</span>
<span id="annotated-cell-7-17"><a href="#annotated-cell-7-17"></a>  alpha_vals,</span>
<span id="annotated-cell-7-18"><a href="#annotated-cell-7-18"></a>  \(x) <span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span> <span class="sc">-</span> x)</span>
<span id="annotated-cell-7-19"><a href="#annotated-cell-7-19"></a>)</span>
<span id="annotated-cell-7-20"><a href="#annotated-cell-7-20"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-7" data-target-annotation="5">5</button><span id="annotated-cell-7-21" class="code-annotation-target"><a href="#annotated-cell-7-21"></a>ets_spec_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="annotated-cell-7-22"><a href="#annotated-cell-7-22"></a>  <span class="at">smooth_level =</span> alpha_vals[<span class="sc">-</span><span class="dv">2</span>],</span>
<span id="annotated-cell-7-23"><a href="#annotated-cell-7-23"></a>  <span class="at">smooth_seasonal =</span> gamma_vals[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="annotated-cell-7-24"><a href="#annotated-cell-7-24"></a>  <span class="at">seasonal_period =</span> <span class="fu">seq</span>(<span class="dv">9</span>, <span class="dv">18</span>, <span class="at">by =</span> <span class="dv">3</span>)</span>
<span id="annotated-cell-7-25"><a href="#annotated-cell-7-25"></a>) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-7-26"><a href="#annotated-cell-7-26"></a>  <span class="fu">create_model_grid</span>(</span>
<span id="annotated-cell-7-27"><a href="#annotated-cell-7-27"></a>    <span class="at">f_model_spec =</span> exp_smoothing,</span>
<span id="annotated-cell-7-28"><a href="#annotated-cell-7-28"></a>    <span class="at">engine_name =</span> <span class="st">"ets"</span>,</span>
<span id="annotated-cell-7-29"><a href="#annotated-cell-7-29"></a>    <span class="at">mode =</span> <span class="st">"regression"</span>,</span>
<span id="annotated-cell-7-30"><a href="#annotated-cell-7-30"></a>    <span class="at">error =</span> <span class="st">"auto"</span>,</span>
<span id="annotated-cell-7-31"><a href="#annotated-cell-7-31"></a>    <span class="at">trend =</span> <span class="st">"auto"</span>,</span>
<span id="annotated-cell-7-32"><a href="#annotated-cell-7-32"></a>    <span class="at">season =</span> <span class="st">"auto"</span>,</span>
<span id="annotated-cell-7-33"><a href="#annotated-cell-7-33"></a>    <span class="at">smooth_trend =</span> beta_vals[<span class="dv">3</span>]</span>
<span id="annotated-cell-7-34"><a href="#annotated-cell-7-34"></a>  )</span>
<span id="annotated-cell-7-35"><a href="#annotated-cell-7-35"></a></span>
<span id="annotated-cell-7-36"><a href="#annotated-cell-7-36"></a>stlm_spec_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="annotated-cell-7-37"><a href="#annotated-cell-7-37"></a>  <span class="at">seasonal_period_2 =</span> <span class="fu">c</span>(<span class="cn">NULL</span>, <span class="fu">seq</span>(<span class="dv">6</span>, <span class="dv">18</span>, <span class="at">by =</span> <span class="dv">3</span>))</span>
<span id="annotated-cell-7-38"><a href="#annotated-cell-7-38"></a>) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-7-39"><a href="#annotated-cell-7-39"></a>  <span class="fu">create_model_grid</span>(</span>
<span id="annotated-cell-7-40"><a href="#annotated-cell-7-40"></a>    <span class="at">f_model_spec =</span> seasonal_reg,</span>
<span id="annotated-cell-7-41"><a href="#annotated-cell-7-41"></a>    <span class="at">engine_name =</span> <span class="st">"stlm_arima"</span>,</span>
<span id="annotated-cell-7-42"><a href="#annotated-cell-7-42"></a>    <span class="at">mode =</span> <span class="st">"regression"</span>,</span>
<span id="annotated-cell-7-43"><a href="#annotated-cell-7-43"></a>    <span class="at">seasonal_period_1 =</span> <span class="dv">12</span></span>
<span id="annotated-cell-7-44"><a href="#annotated-cell-7-44"></a>  )</span>
<span id="annotated-cell-7-45"><a href="#annotated-cell-7-45"></a></span>
<span id="annotated-cell-7-46"><a href="#annotated-cell-7-46"></a>nnet_default <span class="ot">&lt;-</span> <span class="fu">nnetar_reg</span>() <span class="sc">|&gt;</span> <span class="fu">set_engine</span>(<span class="st">"nnetar"</span>)</span>
<span id="annotated-cell-7-47"><a href="#annotated-cell-7-47"></a></span>
<span id="annotated-cell-7-48"><a href="#annotated-cell-7-48"></a>nnet_spec_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="annotated-cell-7-49"><a href="#annotated-cell-7-49"></a>  <span class="at">non_seasonal_ar =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="annotated-cell-7-50"><a href="#annotated-cell-7-50"></a>  <span class="at">hidden_units =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="annotated-cell-7-51"><a href="#annotated-cell-7-51"></a>  <span class="at">num_networks =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">25</span>),</span>
<span id="annotated-cell-7-52"><a href="#annotated-cell-7-52"></a>  <span class="at">penalty =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.25</span>)</span>
<span id="annotated-cell-7-53"><a href="#annotated-cell-7-53"></a>) <span class="sc">|&gt;</span></span>
<span id="annotated-cell-7-54"><a href="#annotated-cell-7-54"></a>  <span class="fu">create_model_grid</span>(</span>
<span id="annotated-cell-7-55"><a href="#annotated-cell-7-55"></a>    <span class="at">f_model_spec =</span> nnetar_reg,</span>
<span id="annotated-cell-7-56"><a href="#annotated-cell-7-56"></a>    <span class="at">engine_name =</span> <span class="st">"nnetar"</span>,</span>
<span id="annotated-cell-7-57"><a href="#annotated-cell-7-57"></a>    <span class="at">mode =</span> <span class="st">"regression"</span>,</span>
<span id="annotated-cell-7-58"><a href="#annotated-cell-7-58"></a>    <span class="at">seasonal_period =</span> <span class="dv">12</span>,</span>
<span id="annotated-cell-7-59"><a href="#annotated-cell-7-59"></a>    <span class="at">epochs =</span> <span class="dv">100</span>,</span>
<span id="annotated-cell-7-60"><a href="#annotated-cell-7-60"></a>    <span class="at">seasonal_ar =</span> <span class="dv">1</span></span>
<span id="annotated-cell-7-61"><a href="#annotated-cell-7-61"></a>  )</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-7" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="1" data-code-annotation="1">Specify an ARIMA regression model using the “auto_arima” engine with all default arguments</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="3" data-code-annotation="2">Create a 1-column <code>tibble</code> (data frame) with the <code>seasonal_period</code> argument set to vary as 9, 12, 15, and 18 (months).</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="4" data-code-annotation="3"><code>create_model_grid()</code> allows one to set static arguments to combine them with the arguments that vary. This is meant to serve a similar purpose as <code>tune::tune_grid()</code> from Tidymodels.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="12" data-code-annotation="4">Set a random seed for reproducibility and generate vectors for the <code>smooth_level</code>, <code>smooth_trend</code>, and <code>smooth_seasonal</code> arguments. In <code>forecast::ets()</code> these are <code>alpha</code>, <code>beta</code>, and <code>gamma</code> respectively.</span>
</dd>
<dt data-target-cell="annotated-cell-7" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-7" data-code-lines="21" data-code-annotation="5">Use <code>tidyr::expand_grid()</code> to get all combinations of the included vectors.</span>
</dd>
</dl>
</div>
</div>
<p>Below is what a model grid looks like.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>ets_spec_grid <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  smooth_level smooth_seasonal seasonal_period .models  
         &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt; &lt;list&gt;   
1       0.0345           0.569               9 &lt;spec[+]&gt;
2       0.0345           0.569              12 &lt;spec[+]&gt;
3       0.0345           0.569              15 &lt;spec[+]&gt;
4       0.0345           0.569              18 &lt;spec[+]&gt;
5       0.0345           0.763               9 &lt;spec[+]&gt;</code></pre>
</div>
</div>
<p>This is a glimpse of a model specification.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>ets_spec_grid <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">pluck</span>(<span class="st">".models"</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Exponential Smoothing State Space Model Specification (regression)

Main Arguments:
  seasonal_period = 9
  error = auto
  trend = auto
  season = auto
  smooth_level = 0.0344955188313033
  smooth_trend = 0.0247416579537094
  smooth_seasonal = 0.569256213388705

Computational engine: ets </code></pre>
</div>
</div>
</section>
<section id="building-workflowsets" class="level3">
<h3 class="anchored" data-anchor-id="building-workflowsets">Building workflowsets</h3>
<p>A <code>workflowset</code> is, you guessed it, a set of workflows. Mechanically it is a very convenient wrapper that can put together different combinations of recipes (pre-processors) and models. I don’t want to mix all of my recipes with all of my models, however. So, in this step I’ll make sets of individuals that combine the appropriate sets of recipes and models then I’ll bind all of them together at the end.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-10"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="1">1</button><span id="annotated-cell-10-1" class="code-annotation-target"><a href="#annotated-cell-10-1"></a>arima_wfset <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="2">2</button><span id="annotated-cell-10-2" class="code-annotation-target"><a href="#annotated-cell-10-2"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(</span>
<span id="annotated-cell-10-3"><a href="#annotated-cell-10-3"></a>    <span class="at">base_rec =</span> arima_rec1,</span>
<span id="annotated-cell-10-4"><a href="#annotated-cell-10-4"></a>    <span class="at">econ_rec =</span> arima_rec2,</span>
<span id="annotated-cell-10-5"><a href="#annotated-cell-10-5"></a>    <span class="at">demog_rec =</span> arima_rec3</span>
<span id="annotated-cell-10-6"><a href="#annotated-cell-10-6"></a>  ),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="3">3</button><span id="annotated-cell-10-7" class="code-annotation-target"><a href="#annotated-cell-10-7"></a>  <span class="at">models =</span> <span class="fu">c</span>(</span>
<span id="annotated-cell-10-8"><a href="#annotated-cell-10-8"></a>    <span class="at">arima_default =</span> <span class="fu">list</span>(arima_default),</span>
<span id="annotated-cell-10-9"><a href="#annotated-cell-10-9"></a>    <span class="at">arima_spec =</span> arima_spec_grid<span class="sc">$</span>.models</span>
<span id="annotated-cell-10-10"><a href="#annotated-cell-10-10"></a>  ),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-10" data-target-annotation="4">4</button><span id="annotated-cell-10-11" class="code-annotation-target"><a href="#annotated-cell-10-11"></a>  <span class="at">cross =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-10-12"><a href="#annotated-cell-10-12"></a>)</span>
<span id="annotated-cell-10-13"><a href="#annotated-cell-10-13"></a></span>
<span id="annotated-cell-10-14"><a href="#annotated-cell-10-14"></a>ets_wfset <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(</span>
<span id="annotated-cell-10-15"><a href="#annotated-cell-10-15"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">base_rec =</span> arima_rec1),</span>
<span id="annotated-cell-10-16"><a href="#annotated-cell-10-16"></a>  <span class="at">models =</span> <span class="fu">c</span>(<span class="at">ets_default =</span> <span class="fu">list</span>(ets_default), <span class="at">ets_spec =</span> ets_spec_grid<span class="sc">$</span>.models),</span>
<span id="annotated-cell-10-17"><a href="#annotated-cell-10-17"></a>  <span class="at">cross =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-10-18"><a href="#annotated-cell-10-18"></a>)</span>
<span id="annotated-cell-10-19"><a href="#annotated-cell-10-19"></a></span>
<span id="annotated-cell-10-20"><a href="#annotated-cell-10-20"></a>stlm_wfset <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(</span>
<span id="annotated-cell-10-21"><a href="#annotated-cell-10-21"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">base_rec =</span> arima_rec1),</span>
<span id="annotated-cell-10-22"><a href="#annotated-cell-10-22"></a>  <span class="at">models =</span> <span class="fu">c</span>(<span class="at">stlm_spec =</span> stlm_spec_grid<span class="sc">$</span>.models),</span>
<span id="annotated-cell-10-23"><a href="#annotated-cell-10-23"></a>  <span class="at">cross =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-10-24"><a href="#annotated-cell-10-24"></a>)</span>
<span id="annotated-cell-10-25"><a href="#annotated-cell-10-25"></a></span>
<span id="annotated-cell-10-26"><a href="#annotated-cell-10-26"></a>nnet_wfset <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(</span>
<span id="annotated-cell-10-27"><a href="#annotated-cell-10-27"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">nnet_rec =</span> nnet_rec),</span>
<span id="annotated-cell-10-28"><a href="#annotated-cell-10-28"></a>  <span class="at">models =</span> <span class="fu">c</span>(</span>
<span id="annotated-cell-10-29"><a href="#annotated-cell-10-29"></a>    <span class="at">nnet_default =</span> <span class="fu">list</span>(nnet_default),</span>
<span id="annotated-cell-10-30"><a href="#annotated-cell-10-30"></a>    <span class="at">nnet_spec =</span> nnet_spec_grid<span class="sc">$</span>.models</span>
<span id="annotated-cell-10-31"><a href="#annotated-cell-10-31"></a>  ),</span>
<span id="annotated-cell-10-32"><a href="#annotated-cell-10-32"></a>  <span class="at">cross =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-10-33"><a href="#annotated-cell-10-33"></a>)</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-10" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="1" data-code-annotation="1">Call <code>workflowsets::workflowset()</code></span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="2" data-code-annotation="2">Provide a named list of recipes to use in the <code>workflowset</code>; naming the elements at this stage makes it easier to match up the elements of the final table containing the trained models with the original recipes and model specifications</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="7" data-code-annotation="3">Provide a named list of model specifications by pulling the “.models” column from each grid</span>
</dd>
<dt data-target-cell="annotated-cell-10" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-10" data-code-lines="11" data-code-annotation="4">Indicate that all recipes should be combined with all model specifications</span>
</dd>
</dl>
</div>
</div>
<p>The individual specifications in the final model table will be named using a combination of the name of the recipe and the name of the model specification given in the respective lists with a count added whenever there are duplicate names. For example, arima_spec_grid has four model specifications in it. The ones that are combined with the first ARIMA recipe (named “base_rec”) will be named BASE_REC_ARIMA_SPEC1, BASE_REC_ARIMA_SPEC2, BASE_REC_ARIMA_SPEC3, and BASE_REC_ARIMA_SPEC4.</p>
<p>With all of the model-specific workflow sets created, now it’s time to put them all together.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>hpi_wfset <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(arima_wfset, ets_wfset, stlm_wfset, nnet_wfset)</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>hpi_wfset <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A workflow set/tibble: 5 × 4
  wflow_id               info             option    result    
  &lt;chr&gt;                  &lt;list&gt;           &lt;list&gt;    &lt;list&gt;    
1 base_rec_arima_default &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;
2 base_rec_arima_spec1   &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;
3 base_rec_arima_spec2   &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;
4 base_rec_arima_spec3   &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;
5 base_rec_arima_spec4   &lt;tibble [1 × 4]&gt; &lt;opts[0]&gt; &lt;list [0]&gt;</code></pre>
</div>
</div>
<p>That’s all the heavy lifting. Now it’s time to let the computer processors do their part and run the models.</p>
</section>
</section>
<section id="fitting-the-models" class="level2">
<h2 class="anchored" data-anchor-id="fitting-the-models">Fitting the models</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-12"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="1">1</button><span id="annotated-cell-12-1" class="code-annotation-target"><a href="#annotated-cell-12-1"></a>avail_cores <span class="ot">&lt;-</span> <span class="fu">unname</span>(parallelly<span class="sc">::</span><span class="fu">availableCores</span>() <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="annotated-cell-12-2"><a href="#annotated-cell-12-2"></a>modulo_vec <span class="ot">&lt;-</span> <span class="fu">sapply</span>(avail_cores<span class="sc">:</span><span class="dv">2</span>, \(x) <span class="fu">nrow</span>(hpi_wfset) <span class="sc">%%</span> x)              </span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="2">2</button><span id="annotated-cell-12-3" class="code-annotation-target"><a href="#annotated-cell-12-3"></a>num_cores <span class="ot">&lt;-</span> <span class="fu">max</span>(</span>
<span id="annotated-cell-12-4"><a href="#annotated-cell-12-4"></a>  <span class="fu">max</span>(<span class="fu">which</span>(modulo_vec <span class="sc">==</span> <span class="fu">max</span>(modulo_vec))),</span>
<span id="annotated-cell-12-5"><a href="#annotated-cell-12-5"></a>    <span class="fu">max</span>(<span class="fu">which</span>(modulo_vec <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="annotated-cell-12-6"><a href="#annotated-cell-12-6"></a>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="annotated-cell-12-7"><a href="#annotated-cell-12-7"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="3">3</button><span id="annotated-cell-12-8" class="code-annotation-target"><a href="#annotated-cell-12-8"></a>cl <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">makePSOCKcluster</span>(num_cores)</span>
<span id="annotated-cell-12-9"><a href="#annotated-cell-12-9"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(cl)</span>
<span id="annotated-cell-12-10"><a href="#annotated-cell-12-10"></a><span class="fu">invisible</span>(</span>
<span id="annotated-cell-12-11"><a href="#annotated-cell-12-11"></a>  parallel<span class="sc">::</span><span class="fu">clusterCall</span>(cl, <span class="cf">function</span>(x) <span class="fu">.libPaths</span>(x), <span class="fu">.libPaths</span>())</span>
<span id="annotated-cell-12-12"><a href="#annotated-cell-12-12"></a>)</span>
<span id="annotated-cell-12-13"><a href="#annotated-cell-12-13"></a>parallel<span class="sc">::</span><span class="fu">clusterEvalQ</span>(cl, <span class="fu">set.seed</span>(<span class="dv">500</span>))</span>
<span id="annotated-cell-12-14"><a href="#annotated-cell-12-14"></a></span>
<span id="annotated-cell-12-15"><a href="#annotated-cell-12-15"></a>hpi_mods_start <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="annotated-cell-12-16"><a href="#annotated-cell-12-16"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="4">4</button><span id="annotated-cell-12-17" class="code-annotation-target"><a href="#annotated-cell-12-17"></a>hpi_mods <span class="ot">&lt;-</span> hpi_wfset <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="5">5</button><span id="annotated-cell-12-18" class="code-annotation-target"><a href="#annotated-cell-12-18"></a>  <span class="fu">modeltime_fit_workflowset</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="6">6</button><span id="annotated-cell-12-19" class="code-annotation-target"><a href="#annotated-cell-12-19"></a>    <span class="at">data =</span> <span class="fu">training</span>(econ_splits),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="7">7</button><span id="annotated-cell-12-20" class="code-annotation-target"><a href="#annotated-cell-12-20"></a>    <span class="at">control =</span> <span class="fu">control_fit_workflowset</span>(<span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">allow_par =</span> <span class="cn">TRUE</span>)</span>
<span id="annotated-cell-12-21"><a href="#annotated-cell-12-21"></a>  )</span>
<span id="annotated-cell-12-22"><a href="#annotated-cell-12-22"></a></span>
<span id="annotated-cell-12-23"><a href="#annotated-cell-12-23"></a>hpi_mods_end <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="annotated-cell-12-24"><a href="#annotated-cell-12-24"></a></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-12" data-target-annotation="8">8</button><span id="annotated-cell-12-25" class="code-annotation-target"><a href="#annotated-cell-12-25"></a>parallel<span class="sc">::</span><span class="fu">stopCluster</span>(cl)</span>
<span id="annotated-cell-12-26"><a href="#annotated-cell-12-26"></a><span class="fu">rm</span>(cl)</span>
<span id="annotated-cell-12-27"><a href="#annotated-cell-12-27"></a><span class="fu">gc</span>()</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-12" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="1" data-code-annotation="1">Get the number of cores available and leave one out for common tasks like running the operating system</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="3" data-code-annotation="2">Calculate the number of cores to use in order to maximize efficiency</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="8,9,10,11,12,13" data-code-annotation="3">Set up the cluster for parallel processing</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="17" data-code-annotation="4">Call the <code>workflowset</code> object containing all the workflows to run</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="18" data-code-annotation="5">Use <code>modeltime::modeltime_fit_workflowset()</code> to fit all of the models</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="19" data-code-annotation="6">Use the training portion of the split object to train the models</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="20" data-code-annotation="7">Set some controls for the model fitting function</span>
</dd>
<dt data-target-cell="annotated-cell-12" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-12" data-code-lines="25" data-code-annotation="8">Stop the parallel cluster from running</span>
</dd>
</dl>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>fit_time <span class="ot">&lt;-</span> (hpi_mods_end <span class="sc">-</span> hpi_mods_start) <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">enframe</span>(<span class="st">"time_metric"</span>, <span class="st">"seconds"</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">drop_na</span>(seconds)</span>
<span id="cb13-4"><a href="#cb13-4"></a></span>
<span id="cb13-5"><a href="#cb13-5"></a>fit_time <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="vtzoeifemm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#vtzoeifemm table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#vtzoeifemm thead, #vtzoeifemm tbody, #vtzoeifemm tfoot, #vtzoeifemm tr, #vtzoeifemm td, #vtzoeifemm th {
  border-style: none;
}

#vtzoeifemm p {
  margin: 0;
  padding: 0;
}

#vtzoeifemm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vtzoeifemm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vtzoeifemm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vtzoeifemm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vtzoeifemm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vtzoeifemm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vtzoeifemm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vtzoeifemm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vtzoeifemm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vtzoeifemm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vtzoeifemm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vtzoeifemm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vtzoeifemm .gt_spanner_row {
  border-bottom-style: hidden;
}

#vtzoeifemm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vtzoeifemm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vtzoeifemm .gt_from_md > :first-child {
  margin-top: 0;
}

#vtzoeifemm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vtzoeifemm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vtzoeifemm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vtzoeifemm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vtzoeifemm .gt_row_group_first td {
  border-top-width: 2px;
}

#vtzoeifemm .gt_row_group_first th {
  border-top-width: 2px;
}

#vtzoeifemm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vtzoeifemm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vtzoeifemm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vtzoeifemm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vtzoeifemm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vtzoeifemm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vtzoeifemm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#vtzoeifemm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vtzoeifemm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vtzoeifemm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vtzoeifemm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vtzoeifemm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vtzoeifemm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vtzoeifemm .gt_left {
  text-align: left;
}

#vtzoeifemm .gt_center {
  text-align: center;
}

#vtzoeifemm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vtzoeifemm .gt_font_normal {
  font-weight: normal;
}

#vtzoeifemm .gt_font_bold {
  font-weight: bold;
}

#vtzoeifemm .gt_font_italic {
  font-style: italic;
}

#vtzoeifemm .gt_super {
  font-size: 65%;
}

#vtzoeifemm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#vtzoeifemm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vtzoeifemm .gt_indent_1 {
  text-indent: 5px;
}

#vtzoeifemm .gt_indent_2 {
  text-indent: 10px;
}

#vtzoeifemm .gt_indent_3 {
  text-indent: 15px;
}

#vtzoeifemm .gt_indent_4 {
  text-indent: 20px;
}

#vtzoeifemm .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="time_metric" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">time_metric</th>
<th id="seconds" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">seconds</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="time_metric">user.self</td>
<td class="gt_row gt_center" headers="seconds">1.16</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="time_metric">sys.self</td>
<td class="gt_row gt_center" headers="seconds">0.12</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="time_metric">elapsed</td>
<td class="gt_row gt_center" headers="seconds">81.83</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>About 81.83 seconds elapsed during model-fitting with parallel processing. Not too bad. Unfortunately, though, some of the models failed (I suppressed error printing). So, before calibrating the models I’m going to drop those from the model output data set. But first I’ll investigate the model failures a little.</p>
</section>
<section id="investigating-failed-models" class="level2">
<h2 class="anchored" data-anchor-id="investigating-failed-models">Investigating failed models</h2>
<p>Here’s a look at some of the models that failed.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>mod_fail_df <span class="ot">&lt;-</span> hpi_mods <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">mutate</span>(<span class="at">mod_fail =</span> <span class="fu">map_lgl</span>(.model, \(x) <span class="fu">is.null</span>(x))) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">select</span>(<span class="sc">!</span>.model)</span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a>mod_fail_df <span class="sc">|&gt;</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>  <span class="fu">group_by</span>(mod_fail) <span class="sc">|&gt;</span></span>
<span id="cb14-7"><a href="#cb14-7"></a>  <span class="fu">slice_min</span>(.model_id, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>  <span class="fu">gt</span>(<span class="at">groupname_col =</span> <span class="cn">NULL</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-9"><a href="#cb14-9"></a>  <span class="fu">gt_bold_head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="vaossgjhsw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#vaossgjhsw table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#vaossgjhsw thead, #vaossgjhsw tbody, #vaossgjhsw tfoot, #vaossgjhsw tr, #vaossgjhsw td, #vaossgjhsw th {
  border-style: none;
}

#vaossgjhsw p {
  margin: 0;
  padding: 0;
}

#vaossgjhsw .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#vaossgjhsw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#vaossgjhsw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#vaossgjhsw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#vaossgjhsw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vaossgjhsw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vaossgjhsw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#vaossgjhsw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#vaossgjhsw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#vaossgjhsw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#vaossgjhsw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#vaossgjhsw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#vaossgjhsw .gt_spanner_row {
  border-bottom-style: hidden;
}

#vaossgjhsw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#vaossgjhsw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#vaossgjhsw .gt_from_md > :first-child {
  margin-top: 0;
}

#vaossgjhsw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#vaossgjhsw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#vaossgjhsw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#vaossgjhsw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#vaossgjhsw .gt_row_group_first td {
  border-top-width: 2px;
}

#vaossgjhsw .gt_row_group_first th {
  border-top-width: 2px;
}

#vaossgjhsw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vaossgjhsw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#vaossgjhsw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#vaossgjhsw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vaossgjhsw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#vaossgjhsw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#vaossgjhsw .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#vaossgjhsw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#vaossgjhsw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#vaossgjhsw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vaossgjhsw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vaossgjhsw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#vaossgjhsw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#vaossgjhsw .gt_left {
  text-align: left;
}

#vaossgjhsw .gt_center {
  text-align: center;
}

#vaossgjhsw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#vaossgjhsw .gt_font_normal {
  font-weight: normal;
}

#vaossgjhsw .gt_font_bold {
  font-weight: bold;
}

#vaossgjhsw .gt_font_italic {
  font-style: italic;
}

#vaossgjhsw .gt_super {
  font-size: 65%;
}

#vaossgjhsw .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#vaossgjhsw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#vaossgjhsw .gt_indent_1 {
  text-indent: 5px;
}

#vaossgjhsw .gt_indent_2 {
  text-indent: 10px;
}

#vaossgjhsw .gt_indent_3 {
  text-indent: 15px;
}

#vaossgjhsw .gt_indent_4 {
  text-indent: 20px;
}

#vaossgjhsw .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id=".model_id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">.model_id</th>
<th id=".model_desc" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">.model_desc</th>
<th id="mod_fail" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">mod_fail</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">1</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ARIMA_DEFAULT</td>
<td class="gt_row gt_center" headers="mod_fail">FALSE</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers=".model_id">2</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ARIMA_SPEC1</td>
<td class="gt_row gt_center" headers="mod_fail">FALSE</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">3</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ARIMA_SPEC2</td>
<td class="gt_row gt_center" headers="mod_fail">FALSE</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers=".model_id">33</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_SPEC17</td>
<td class="gt_row gt_center" headers="mod_fail">TRUE</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">34</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_SPEC18</td>
<td class="gt_row gt_center" headers="mod_fail">TRUE</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers=".model_id">35</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_SPEC19</td>
<td class="gt_row gt_center" headers="mod_fail">TRUE</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Now I want to see the distinct names of the recipes and algorithms (model specifications) that failed.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>failure_spec_df <span class="ot">&lt;-</span> mod_fail_df <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>  <span class="fu">filter</span>(mod_fail) <span class="sc">|&gt;</span></span>
<span id="cb15-3"><a href="#cb15-3"></a>  <span class="fu">separate_wider_delim</span>(</span>
<span id="cb15-4"><a href="#cb15-4"></a>    .model_desc,</span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="at">delim =</span> <span class="st">"_"</span>,</span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"rec_name"</span>, <span class="st">"rec"</span>, <span class="st">"algo"</span>, <span class="st">"spec"</span>)</span>
<span id="cb15-7"><a href="#cb15-7"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>  <span class="fu">separate_wider_regex</span>(spec, <span class="at">patterns =</span> <span class="fu">c</span>(<span class="at">spec =</span> <span class="st">"SPEC"</span>, <span class="at">spec_num =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>))</span>
<span id="cb15-9"><a href="#cb15-9"></a></span>
<span id="cb15-10"><a href="#cb15-10"></a>failure_spec_df <span class="sc">|&gt;</span> <span class="fu">distinct</span>(rec_name, algo, spec) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="ezrmrdksxp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ezrmrdksxp table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ezrmrdksxp thead, #ezrmrdksxp tbody, #ezrmrdksxp tfoot, #ezrmrdksxp tr, #ezrmrdksxp td, #ezrmrdksxp th {
  border-style: none;
}

#ezrmrdksxp p {
  margin: 0;
  padding: 0;
}

#ezrmrdksxp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ezrmrdksxp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ezrmrdksxp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ezrmrdksxp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ezrmrdksxp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ezrmrdksxp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ezrmrdksxp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ezrmrdksxp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ezrmrdksxp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ezrmrdksxp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ezrmrdksxp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ezrmrdksxp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ezrmrdksxp .gt_spanner_row {
  border-bottom-style: hidden;
}

#ezrmrdksxp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ezrmrdksxp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ezrmrdksxp .gt_from_md > :first-child {
  margin-top: 0;
}

#ezrmrdksxp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ezrmrdksxp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ezrmrdksxp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ezrmrdksxp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ezrmrdksxp .gt_row_group_first td {
  border-top-width: 2px;
}

#ezrmrdksxp .gt_row_group_first th {
  border-top-width: 2px;
}

#ezrmrdksxp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ezrmrdksxp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ezrmrdksxp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ezrmrdksxp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ezrmrdksxp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ezrmrdksxp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ezrmrdksxp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ezrmrdksxp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ezrmrdksxp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ezrmrdksxp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ezrmrdksxp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ezrmrdksxp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ezrmrdksxp .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ezrmrdksxp .gt_left {
  text-align: left;
}

#ezrmrdksxp .gt_center {
  text-align: center;
}

#ezrmrdksxp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ezrmrdksxp .gt_font_normal {
  font-weight: normal;
}

#ezrmrdksxp .gt_font_bold {
  font-weight: bold;
}

#ezrmrdksxp .gt_font_italic {
  font-style: italic;
}

#ezrmrdksxp .gt_super {
  font-size: 65%;
}

#ezrmrdksxp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ezrmrdksxp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ezrmrdksxp .gt_indent_1 {
  text-indent: 5px;
}

#ezrmrdksxp .gt_indent_2 {
  text-indent: 10px;
}

#ezrmrdksxp .gt_indent_3 {
  text-indent: 15px;
}

#ezrmrdksxp .gt_indent_4 {
  text-indent: 20px;
}

#ezrmrdksxp .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="rec_name" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">rec_name</th>
<th id="algo" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">algo</th>
<th id="spec" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">spec</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="rec_name">BASE</td>
<td class="gt_row gt_left" headers="algo">ETS</td>
<td class="gt_row gt_left" headers="spec">SPEC</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Since the failures occurred with only one algorithm they’ll be easy to isolate. Now I want to get the numbers of the specifications that failed so that I can pull up the details on those specifications.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>failures <span class="ot">&lt;-</span> failure_spec_df <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">pull</span>(spec_num) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a>ets_failed <span class="ot">&lt;-</span> ets_spec_grid <span class="sc">|&gt;</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="fu">slice</span>(failures) <span class="sc">|&gt;</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>  <span class="fu">select</span>(<span class="sc">!</span>.models)</span>
<span id="cb16-8"><a href="#cb16-8"></a></span>
<span id="cb16-9"><a href="#cb16-9"></a>ets_failed <span class="sc">|&gt;</span></span>
<span id="cb16-10"><a href="#cb16-10"></a>  <span class="fu">count</span>(smooth_level) <span class="sc">|&gt;</span></span>
<span id="cb16-11"><a href="#cb16-11"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb16-12"><a href="#cb16-12"></a>  <span class="fu">gt_bold_head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="zbzttxfang" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zbzttxfang table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zbzttxfang thead, #zbzttxfang tbody, #zbzttxfang tfoot, #zbzttxfang tr, #zbzttxfang td, #zbzttxfang th {
  border-style: none;
}

#zbzttxfang p {
  margin: 0;
  padding: 0;
}

#zbzttxfang .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zbzttxfang .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zbzttxfang .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zbzttxfang .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zbzttxfang .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zbzttxfang .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zbzttxfang .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zbzttxfang .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zbzttxfang .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zbzttxfang .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zbzttxfang .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zbzttxfang .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zbzttxfang .gt_spanner_row {
  border-bottom-style: hidden;
}

#zbzttxfang .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zbzttxfang .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zbzttxfang .gt_from_md > :first-child {
  margin-top: 0;
}

#zbzttxfang .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zbzttxfang .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zbzttxfang .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zbzttxfang .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zbzttxfang .gt_row_group_first td {
  border-top-width: 2px;
}

#zbzttxfang .gt_row_group_first th {
  border-top-width: 2px;
}

#zbzttxfang .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zbzttxfang .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zbzttxfang .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zbzttxfang .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zbzttxfang .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zbzttxfang .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zbzttxfang .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zbzttxfang .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zbzttxfang .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zbzttxfang .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zbzttxfang .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zbzttxfang .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zbzttxfang .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zbzttxfang .gt_left {
  text-align: left;
}

#zbzttxfang .gt_center {
  text-align: center;
}

#zbzttxfang .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zbzttxfang .gt_font_normal {
  font-weight: normal;
}

#zbzttxfang .gt_font_bold {
  font-weight: bold;
}

#zbzttxfang .gt_font_italic {
  font-style: italic;
}

#zbzttxfang .gt_super {
  font-size: 65%;
}

#zbzttxfang .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zbzttxfang .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zbzttxfang .gt_indent_1 {
  text-indent: 5px;
}

#zbzttxfang .gt_indent_2 {
  text-indent: 10px;
}

#zbzttxfang .gt_indent_3 {
  text-indent: 15px;
}

#zbzttxfang .gt_indent_4 {
  text-indent: 20px;
}

#zbzttxfang .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="smooth_level" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">smooth_level</th>
<th id="n" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">n</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="smooth_level">6.680868e-05</td>
<td class="gt_row gt_right" headers="n">8</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Overall there were 8 out of 32 failed exponential smoothing models. That’s not terrible. I’m going to remove these specifications from the trained model data set and move on to model evaluation.</p>
</section>
<section id="model-evaluation" class="level2">
<h2 class="anchored" data-anchor-id="model-evaluation">Model evaluation</h2>
<p>To evaluate the models first I need to calibrate them. I’ll remove the failed models, calibrate the successful ones, and store accuracy tables here. Below are the 10 best-performing global models, i.e., the ones that performed best on the batched series with all four cities. I defined “best” as the models with the lowest SMAPE (Scaled Mean Average Percent Error) values.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Breaking up calibration step">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Breaking up calibration step
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>I broke up the code for calibrating the models below into two separate chunks to keep the file sizes of cached files a bit smaller. I cached the output to make the page easier to render. This step of splitting up the <code>modeltime_table</code> for calibration is not typically necessary.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>hpi_mods <span class="ot">&lt;-</span> hpi_mods <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="fu">which</span>(<span class="sc">!</span>mod_fail_df<span class="sc">$</span>mod_fail))</span>
<span id="cb17-2"><a href="#cb17-2"></a></span>
<span id="cb17-3"><a href="#cb17-3"></a>num_mods <span class="ot">&lt;-</span> <span class="fu">nrow</span>(hpi_mods)</span>
<span id="cb17-4"><a href="#cb17-4"></a>hpi_mod_idx <span class="ot">&lt;-</span> <span class="fu">split</span>(<span class="dv">1</span><span class="sc">:</span>num_mods, <span class="fu">ceiling</span>(<span class="fu">seq_along</span>(<span class="dv">1</span><span class="sc">:</span>num_mods) <span class="sc">/</span> (num_mods <span class="sc">/</span> <span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>hpi_mod_calib1 <span class="ot">&lt;-</span> hpi_mods <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">slice</span>(hpi_mod_idx[[<span class="dv">1</span>]]) <span class="sc">|&gt;</span></span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">modeltime_calibrate</span>(<span class="fu">testing</span>(econ_splits), <span class="at">id =</span> <span class="st">"city"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>hpi_mod_calib2 <span class="ot">&lt;-</span> hpi_mods <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">slice</span>(hpi_mod_idx[[<span class="dv">2</span>]]) <span class="sc">|&gt;</span></span>
<span id="cb19-3"><a href="#cb19-3"></a>  <span class="fu">modeltime_calibrate</span>(<span class="fu">testing</span>(econ_splits), <span class="at">id =</span> <span class="st">"city"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>hpi_mod_calib3 <span class="ot">&lt;-</span> hpi_mods <span class="sc">|&gt;</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">slice</span>(hpi_mod_idx[[<span class="dv">3</span>]]) <span class="sc">|&gt;</span></span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="fu">modeltime_calibrate</span>(<span class="fu">testing</span>(econ_splits), <span class="at">id =</span> <span class="st">"city"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>hpi_mod_calib <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(hpi_mod_calib1, hpi_mod_calib2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>hpi_mod_accuracy <span class="ot">&lt;-</span> hpi_mod_calib <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="fu">modeltime_accuracy</span>() <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">drop_na</span>(.type)</span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a>hpi_local_mod_accuracy <span class="ot">&lt;-</span> hpi_mod_calib <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>  <span class="fu">modeltime_accuracy</span>(<span class="at">acc_by_id =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7"></a>  <span class="fu">drop_na</span>(.type)</span>
<span id="cb22-8"><a href="#cb22-8"></a></span>
<span id="cb22-9"><a href="#cb22-9"></a>best_global_table <span class="ot">&lt;-</span> hpi_mod_accuracy <span class="sc">|&gt;</span></span>
<span id="cb22-10"><a href="#cb22-10"></a>  <span class="fu">slice_min</span>(smape, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb22-11"><a href="#cb22-11"></a></span>
<span id="cb22-12"><a href="#cb22-12"></a>best_local_table <span class="ot">&lt;-</span> hpi_local_mod_accuracy <span class="sc">|&gt;</span></span>
<span id="cb22-13"><a href="#cb22-13"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb22-14"><a href="#cb22-14"></a>  <span class="fu">slice_min</span>(smape, <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb22-15"><a href="#cb22-15"></a></span>
<span id="cb22-16"><a href="#cb22-16"></a>best_global_table <span class="sc">|&gt;</span></span>
<span id="cb22-17"><a href="#cb22-17"></a>  <span class="fu">table_modeltime_accuracy</span>(</span>
<span id="cb22-18"><a href="#cb22-18"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb22-19"><a href="#cb22-19"></a>    <span class="at">.title =</span> <span class="st">"Global Accuracy"</span></span>
<span id="cb22-20"><a href="#cb22-20"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb22-21"><a href="#cb22-21"></a>  <span class="fu">gt_bold_head</span>() <span class="sc">|&gt;</span></span>
<span id="cb22-22"><a href="#cb22-22"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb22-23"><a href="#cb22-23"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>),</span>
<span id="cb22-24"><a href="#cb22-24"></a>    <span class="at">locations =</span> <span class="fu">cells_title</span>()</span>
<span id="cb22-25"><a href="#cb22-25"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="xqzstlgqxs" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#xqzstlgqxs table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#xqzstlgqxs thead, #xqzstlgqxs tbody, #xqzstlgqxs tfoot, #xqzstlgqxs tr, #xqzstlgqxs td, #xqzstlgqxs th {
  border-style: none;
}

#xqzstlgqxs p {
  margin: 0;
  padding: 0;
}

#xqzstlgqxs .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xqzstlgqxs .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#xqzstlgqxs .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xqzstlgqxs .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xqzstlgqxs .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xqzstlgqxs .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xqzstlgqxs .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xqzstlgqxs .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xqzstlgqxs .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xqzstlgqxs .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xqzstlgqxs .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xqzstlgqxs .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xqzstlgqxs .gt_spanner_row {
  border-bottom-style: hidden;
}

#xqzstlgqxs .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#xqzstlgqxs .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xqzstlgqxs .gt_from_md > :first-child {
  margin-top: 0;
}

#xqzstlgqxs .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xqzstlgqxs .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xqzstlgqxs .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#xqzstlgqxs .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#xqzstlgqxs .gt_row_group_first td {
  border-top-width: 2px;
}

#xqzstlgqxs .gt_row_group_first th {
  border-top-width: 2px;
}

#xqzstlgqxs .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xqzstlgqxs .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#xqzstlgqxs .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#xqzstlgqxs .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xqzstlgqxs .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xqzstlgqxs .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xqzstlgqxs .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#xqzstlgqxs .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xqzstlgqxs .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xqzstlgqxs .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xqzstlgqxs .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xqzstlgqxs .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xqzstlgqxs .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#xqzstlgqxs .gt_left {
  text-align: left;
}

#xqzstlgqxs .gt_center {
  text-align: center;
}

#xqzstlgqxs .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xqzstlgqxs .gt_font_normal {
  font-weight: normal;
}

#xqzstlgqxs .gt_font_bold {
  font-weight: bold;
}

#xqzstlgqxs .gt_font_italic {
  font-style: italic;
}

#xqzstlgqxs .gt_super {
  font-size: 65%;
}

#xqzstlgqxs .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#xqzstlgqxs .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#xqzstlgqxs .gt_indent_1 {
  text-indent: 5px;
}

#xqzstlgqxs .gt_indent_2 {
  text-indent: 10px;
}

#xqzstlgqxs .gt_indent_3 {
  text-indent: 15px;
}

#xqzstlgqxs .gt_indent_4 {
  text-indent: 20px;
}

#xqzstlgqxs .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="9" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="font-weight: bold">Global Accuracy</th>
</tr>
<tr class="odd gt_col_headings">
<th id=".model_id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">.model_id</th>
<th id=".model_desc" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">.model_desc</th>
<th id=".type" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">.type</th>
<th id="mae" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">mae</th>
<th id="mape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">mape</th>
<th id="mase" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">mase</th>
<th id="smape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">smape</th>
<th id="rmse" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">rmse</th>
<th id="rsq" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">rsq</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">16</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_DEFAULT</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">19.29</td>
<td class="gt_row gt_right" headers="mape">6.22</td>
<td class="gt_row gt_right" headers="mase">0.18</td>
<td class="gt_row gt_right" headers="smape">6.59</td>
<td class="gt_row gt_right" headers="rmse">28.08</td>
<td class="gt_row gt_right" headers="rsq">0.96</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers=".model_id">1</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ARIMA_DEFAULT</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">20.79</td>
<td class="gt_row gt_right" headers="mape">7.14</td>
<td class="gt_row gt_right" headers="mase">0.19</td>
<td class="gt_row gt_right" headers="smape">7.37</td>
<td class="gt_row gt_right" headers="rmse">29.50</td>
<td class="gt_row gt_right" headers="rsq">0.95</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">3</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ARIMA_SPEC2</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">20.79</td>
<td class="gt_row gt_right" headers="mape">7.14</td>
<td class="gt_row gt_right" headers="mase">0.19</td>
<td class="gt_row gt_right" headers="smape">7.37</td>
<td class="gt_row gt_right" headers="rmse">29.50</td>
<td class="gt_row gt_right" headers="rsq">0.95</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers=".model_id">30</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_SPEC14</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">20.81</td>
<td class="gt_row gt_right" headers="mape">7.48</td>
<td class="gt_row gt_right" headers="mase">0.19</td>
<td class="gt_row gt_right" headers="smape">7.60</td>
<td class="gt_row gt_right" headers="rmse">28.89</td>
<td class="gt_row gt_right" headers="rsq">0.95</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">22</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_SPEC6</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">20.80</td>
<td class="gt_row gt_right" headers="mape">7.48</td>
<td class="gt_row gt_right" headers="mase">0.19</td>
<td class="gt_row gt_right" headers="smape">7.60</td>
<td class="gt_row gt_right" headers="rmse">28.87</td>
<td class="gt_row gt_right" headers="rsq">0.95</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers=".model_id">46</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_SPEC30</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">22.16</td>
<td class="gt_row gt_right" headers="mape">7.53</td>
<td class="gt_row gt_right" headers="mase">0.21</td>
<td class="gt_row gt_right" headers="smape">7.82</td>
<td class="gt_row gt_right" headers="rmse">31.18</td>
<td class="gt_row gt_right" headers="rsq">0.95</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">42</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_SPEC26</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">22.31</td>
<td class="gt_row gt_right" headers="mape">7.77</td>
<td class="gt_row gt_right" headers="mase">0.21</td>
<td class="gt_row gt_right" headers="smape">8.00</td>
<td class="gt_row gt_right" headers="rmse">31.01</td>
<td class="gt_row gt_right" headers="rsq">0.95</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers=".model_id">53</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_STLM_SPEC5</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">30.98</td>
<td class="gt_row gt_right" headers="mape">9.75</td>
<td class="gt_row gt_right" headers="mase">0.29</td>
<td class="gt_row gt_right" headers="smape">10.59</td>
<td class="gt_row gt_right" headers="rmse">43.56</td>
<td class="gt_row gt_right" headers="rsq">0.94</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">49</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_STLM_SPEC1</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">31.20</td>
<td class="gt_row gt_right" headers="mape">9.81</td>
<td class="gt_row gt_right" headers="mase">0.29</td>
<td class="gt_row gt_right" headers="smape">10.68</td>
<td class="gt_row gt_right" headers="rmse">43.87</td>
<td class="gt_row gt_right" headers="rsq">0.93</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers=".model_id">52</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_STLM_SPEC4</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">32.10</td>
<td class="gt_row gt_right" headers="mape">10.02</td>
<td class="gt_row gt_right" headers="mase">0.30</td>
<td class="gt_row gt_right" headers="smape">10.94</td>
<td class="gt_row gt_right" headers="rmse">45.27</td>
<td class="gt_row gt_right" headers="rsq">0.93</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Next is a table with the best 3 models calibrated to each city.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>best_local_table<span class="sc">|&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>  <span class="fu">table_modeltime_accuracy</span>(</span>
<span id="cb23-3"><a href="#cb23-3"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb23-4"><a href="#cb23-4"></a>    <span class="at">.title =</span> <span class="st">"Accuracy by City"</span></span>
<span id="cb23-5"><a href="#cb23-5"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-6"><a href="#cb23-6"></a>  <span class="fu">gt_bold_head</span>() <span class="sc">|&gt;</span></span>
<span id="cb23-7"><a href="#cb23-7"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb23-8"><a href="#cb23-8"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>),</span>
<span id="cb23-9"><a href="#cb23-9"></a>    <span class="at">locations =</span> <span class="fu">cells_title</span>()</span>
<span id="cb23-10"><a href="#cb23-10"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb23-12"><a href="#cb23-12"></a>    <span class="at">style =</span> <span class="fu">list</span>(<span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>), <span class="fu">cell_fill</span>(<span class="at">color =</span> <span class="st">"lightgray"</span>)),</span>
<span id="cb23-13"><a href="#cb23-13"></a>    <span class="at">locations =</span> <span class="fu">cells_group</span>()</span>
<span id="cb23-14"><a href="#cb23-14"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb23-15"><a href="#cb23-15"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb23-16"><a href="#cb23-16"></a>    <span class="at">style =</span> <span class="fu">cell_borders</span>(</span>
<span id="cb23-17"><a href="#cb23-17"></a>      <span class="at">sides =</span> <span class="fu">c</span>(<span class="st">"top"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb23-18"><a href="#cb23-18"></a>      <span class="at">weight =</span> <span class="fu">px</span>(<span class="dv">2</span>),</span>
<span id="cb23-19"><a href="#cb23-19"></a>      <span class="at">style =</span> (<span class="st">"solid"</span>)</span>
<span id="cb23-20"><a href="#cb23-20"></a>    ),</span>
<span id="cb23-21"><a href="#cb23-21"></a>    <span class="at">locations =</span> <span class="fu">cells_group</span>()</span>
<span id="cb23-22"><a href="#cb23-22"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="etfuwndwsu" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#etfuwndwsu table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#etfuwndwsu thead, #etfuwndwsu tbody, #etfuwndwsu tfoot, #etfuwndwsu tr, #etfuwndwsu td, #etfuwndwsu th {
  border-style: none;
}

#etfuwndwsu p {
  margin: 0;
  padding: 0;
}

#etfuwndwsu .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#etfuwndwsu .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#etfuwndwsu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#etfuwndwsu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#etfuwndwsu .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#etfuwndwsu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#etfuwndwsu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#etfuwndwsu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#etfuwndwsu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#etfuwndwsu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#etfuwndwsu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#etfuwndwsu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#etfuwndwsu .gt_spanner_row {
  border-bottom-style: hidden;
}

#etfuwndwsu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#etfuwndwsu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#etfuwndwsu .gt_from_md > :first-child {
  margin-top: 0;
}

#etfuwndwsu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#etfuwndwsu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#etfuwndwsu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#etfuwndwsu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#etfuwndwsu .gt_row_group_first td {
  border-top-width: 2px;
}

#etfuwndwsu .gt_row_group_first th {
  border-top-width: 2px;
}

#etfuwndwsu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#etfuwndwsu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#etfuwndwsu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#etfuwndwsu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#etfuwndwsu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#etfuwndwsu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#etfuwndwsu .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#etfuwndwsu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#etfuwndwsu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#etfuwndwsu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#etfuwndwsu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#etfuwndwsu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#etfuwndwsu .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#etfuwndwsu .gt_left {
  text-align: left;
}

#etfuwndwsu .gt_center {
  text-align: center;
}

#etfuwndwsu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#etfuwndwsu .gt_font_normal {
  font-weight: normal;
}

#etfuwndwsu .gt_font_bold {
  font-weight: bold;
}

#etfuwndwsu .gt_font_italic {
  font-style: italic;
}

#etfuwndwsu .gt_super {
  font-size: 65%;
}

#etfuwndwsu .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#etfuwndwsu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#etfuwndwsu .gt_indent_1 {
  text-indent: 5px;
}

#etfuwndwsu .gt_indent_2 {
  text-indent: 10px;
}

#etfuwndwsu .gt_indent_3 {
  text-indent: 15px;
}

#etfuwndwsu .gt_indent_4 {
  text-indent: 20px;
}

#etfuwndwsu .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="9" class="gt_heading gt_title gt_font_normal gt_bottom_border" style="font-weight: bold">Accuracy by City</th>
</tr>
<tr class="odd gt_col_headings">
<th id=".model_id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">.model_id</th>
<th id=".model_desc" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">.model_desc</th>
<th id=".type" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">.type</th>
<th id="mae" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">mae</th>
<th id="mape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">mape</th>
<th id="mase" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">mase</th>
<th id="smape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">smape</th>
<th id="rmse" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">rmse</th>
<th id="rsq" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">rsq</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd gt_group_heading_row">
<td colspan="9" id="Dallas" class="gt_group_heading" data-quarto-table-cell-role="th" style="font-weight: bold; background-color: #D3D3D3; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="colgroup">Dallas</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_right" headers="Dallas  .model_id">12</td>
<td class="gt_row gt_left" headers="Dallas  .model_desc">DEMOG_REC_ARIMA_SPEC1</td>
<td class="gt_row gt_left" headers="Dallas  .type">Test</td>
<td class="gt_row gt_right" headers="Dallas  mae">13.99</td>
<td class="gt_row gt_right" headers="Dallas  mape">5.18</td>
<td class="gt_row gt_right" headers="Dallas  mase">2.65</td>
<td class="gt_row gt_right" headers="Dallas  smape">5.32</td>
<td class="gt_row gt_right" headers="Dallas  rmse">15.79</td>
<td class="gt_row gt_right" headers="Dallas  rsq">0.80</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Dallas  .model_id">14</td>
<td class="gt_row gt_left" headers="Dallas  .model_desc">DEMOG_REC_ARIMA_SPEC3</td>
<td class="gt_row gt_left" headers="Dallas  .type">Test</td>
<td class="gt_row gt_right" headers="Dallas  mae">14.19</td>
<td class="gt_row gt_right" headers="Dallas  mape">5.24</td>
<td class="gt_row gt_right" headers="Dallas  mase">2.69</td>
<td class="gt_row gt_right" headers="Dallas  smape">5.39</td>
<td class="gt_row gt_right" headers="Dallas  rmse">15.97</td>
<td class="gt_row gt_right" headers="Dallas  rsq">0.80</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Dallas  .model_id">22</td>
<td class="gt_row gt_left" headers="Dallas  .model_desc">BASE_REC_ETS_SPEC6</td>
<td class="gt_row gt_left" headers="Dallas  .type">Test</td>
<td class="gt_row gt_right" headers="Dallas  mae">20.59</td>
<td class="gt_row gt_right" headers="Dallas  mape">7.34</td>
<td class="gt_row gt_right" headers="Dallas  mase">3.93</td>
<td class="gt_row gt_right" headers="Dallas  smape">7.72</td>
<td class="gt_row gt_right" headers="Dallas  rmse">24.76</td>
<td class="gt_row gt_right" headers="Dallas  rsq">0.85</td>
</tr>
<tr class="odd gt_group_heading_row">
<td colspan="9" id="Detroit" class="gt_group_heading" data-quarto-table-cell-role="th" style="font-weight: bold; background-color: #D3D3D3; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="colgroup">Detroit</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_right" headers="Detroit  .model_id">52</td>
<td class="gt_row gt_left" headers="Detroit  .model_desc">BASE_REC_STLM_SPEC4</td>
<td class="gt_row gt_left" headers="Detroit  .type">Test</td>
<td class="gt_row gt_right" headers="Detroit  mae">3.02</td>
<td class="gt_row gt_right" headers="Detroit  mape">1.87</td>
<td class="gt_row gt_right" headers="Detroit  mase">1.72</td>
<td class="gt_row gt_right" headers="Detroit  smape">1.84</td>
<td class="gt_row gt_right" headers="Detroit  rmse">4.05</td>
<td class="gt_row gt_right" headers="Detroit  rsq">0.90</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="Detroit  .model_id">49</td>
<td class="gt_row gt_left" headers="Detroit  .model_desc">BASE_REC_STLM_SPEC1</td>
<td class="gt_row gt_left" headers="Detroit  .type">Test</td>
<td class="gt_row gt_right" headers="Detroit  mae">3.45</td>
<td class="gt_row gt_right" headers="Detroit  mape">2.11</td>
<td class="gt_row gt_right" headers="Detroit  mase">1.96</td>
<td class="gt_row gt_right" headers="Detroit  smape">2.07</td>
<td class="gt_row gt_right" headers="Detroit  rmse">4.96</td>
<td class="gt_row gt_right" headers="Detroit  rsq">0.86</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="Detroit  .model_id">16</td>
<td class="gt_row gt_left" headers="Detroit  .model_desc">BASE_REC_ETS_DEFAULT</td>
<td class="gt_row gt_left" headers="Detroit  .type">Test</td>
<td class="gt_row gt_right" headers="Detroit  mae">3.91</td>
<td class="gt_row gt_right" headers="Detroit  mape">2.38</td>
<td class="gt_row gt_right" headers="Detroit  mase">2.22</td>
<td class="gt_row gt_right" headers="Detroit  smape">2.41</td>
<td class="gt_row gt_right" headers="Detroit  rmse">4.63</td>
<td class="gt_row gt_right" headers="Detroit  rsq">0.84</td>
</tr>
<tr class="odd gt_group_heading_row">
<td colspan="9" id="New York" class="gt_group_heading" data-quarto-table-cell-role="th" style="font-weight: bold; background-color: #D3D3D3; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="colgroup">New York</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_right" headers="New York  .model_id">1</td>
<td class="gt_row gt_left" headers="New York  .model_desc">BASE_REC_ARIMA_DEFAULT</td>
<td class="gt_row gt_left" headers="New York  .type">Test</td>
<td class="gt_row gt_right" headers="New York  mae">3.09</td>
<td class="gt_row gt_right" headers="New York  mape">1.16</td>
<td class="gt_row gt_right" headers="New York  mase">1.30</td>
<td class="gt_row gt_right" headers="New York  smape">1.16</td>
<td class="gt_row gt_right" headers="New York  rmse">4.41</td>
<td class="gt_row gt_right" headers="New York  rsq">0.94</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="New York  .model_id">3</td>
<td class="gt_row gt_left" headers="New York  .model_desc">BASE_REC_ARIMA_SPEC2</td>
<td class="gt_row gt_left" headers="New York  .type">Test</td>
<td class="gt_row gt_right" headers="New York  mae">3.09</td>
<td class="gt_row gt_right" headers="New York  mape">1.16</td>
<td class="gt_row gt_right" headers="New York  mase">1.30</td>
<td class="gt_row gt_right" headers="New York  smape">1.16</td>
<td class="gt_row gt_right" headers="New York  rmse">4.41</td>
<td class="gt_row gt_right" headers="New York  rsq">0.94</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="New York  .model_id">30</td>
<td class="gt_row gt_left" headers="New York  .model_desc">BASE_REC_ETS_SPEC14</td>
<td class="gt_row gt_left" headers="New York  .type">Test</td>
<td class="gt_row gt_right" headers="New York  mae">3.18</td>
<td class="gt_row gt_right" headers="New York  mape">1.19</td>
<td class="gt_row gt_right" headers="New York  mase">1.34</td>
<td class="gt_row gt_right" headers="New York  smape">1.17</td>
<td class="gt_row gt_right" headers="New York  rmse">5.06</td>
<td class="gt_row gt_right" headers="New York  rsq">0.95</td>
</tr>
<tr class="odd gt_group_heading_row">
<td colspan="9" id="San Diego" class="gt_group_heading" data-quarto-table-cell-role="th" style="font-weight: bold; background-color: #D3D3D3; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="colgroup">San Diego</td>
</tr>
<tr class="even gt_row_group_first">
<td class="gt_row gt_right" headers="San Diego  .model_id">51</td>
<td class="gt_row gt_left" headers="San Diego  .model_desc">BASE_REC_STLM_SPEC3</td>
<td class="gt_row gt_left" headers="San Diego  .type">Test</td>
<td class="gt_row gt_right" headers="San Diego  mae">23.42</td>
<td class="gt_row gt_right" headers="San Diego  mape">6.49</td>
<td class="gt_row gt_right" headers="San Diego  mase">3.10</td>
<td class="gt_row gt_right" headers="San Diego  smape">6.34</td>
<td class="gt_row gt_right" headers="San Diego  rmse">28.83</td>
<td class="gt_row gt_right" headers="San Diego  rsq">0.61</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="San Diego  .model_id">12</td>
<td class="gt_row gt_left" headers="San Diego  .model_desc">DEMOG_REC_ARIMA_SPEC1</td>
<td class="gt_row gt_left" headers="San Diego  .type">Test</td>
<td class="gt_row gt_right" headers="San Diego  mae">35.62</td>
<td class="gt_row gt_right" headers="San Diego  mape">9.29</td>
<td class="gt_row gt_right" headers="San Diego  mase">4.85</td>
<td class="gt_row gt_right" headers="San Diego  smape">9.84</td>
<td class="gt_row gt_right" headers="San Diego  rmse">39.31</td>
<td class="gt_row gt_right" headers="San Diego  rsq">0.71</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="San Diego  .model_id">14</td>
<td class="gt_row gt_left" headers="San Diego  .model_desc">DEMOG_REC_ARIMA_SPEC3</td>
<td class="gt_row gt_left" headers="San Diego  .type">Test</td>
<td class="gt_row gt_right" headers="San Diego  mae">36.77</td>
<td class="gt_row gt_right" headers="San Diego  mape">9.58</td>
<td class="gt_row gt_right" headers="San Diego  mase">5.01</td>
<td class="gt_row gt_right" headers="San Diego  smape">10.16</td>
<td class="gt_row gt_right" headers="San Diego  rmse">40.32</td>
<td class="gt_row gt_right" headers="San Diego  rsq">0.71</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>There’s a pretty good mix of models across the two tables including ARIMA, ETS (lots of this one), STLM, and neural-net. Among the ARIMA models there were some with the basic recipe and some with the recipe that included both economic and demographic variables.</p>
<p>Below are plots of forecasts of the test data period for each city using the best 3 global models.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>top_3_global <span class="ot">&lt;-</span> best_global_table <span class="sc">|&gt;</span> <span class="fu">slice_min</span>(smape, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(.model_id)</span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a>hpi_mod_calib <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">filter</span>(.model_id <span class="sc">%in%</span> top_3_global) <span class="sc">|&gt;</span>                            </span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="fu">modeltime_forecast</span>(                            </span>
<span id="cb24-6"><a href="#cb24-6"></a>    <span class="at">new_data =</span> <span class="fu">testing</span>(econ_splits),      </span>
<span id="cb24-7"><a href="#cb24-7"></a>    <span class="at">actual_data =</span> econ_data,                     </span>
<span id="cb24-8"><a href="#cb24-8"></a>    <span class="at">conf_by_id =</span> <span class="cn">TRUE</span>,                           </span>
<span id="cb24-9"><a href="#cb24-9"></a>    <span class="at">keep_data =</span> <span class="cn">TRUE</span>                             </span>
<span id="cb24-10"><a href="#cb24-10"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb24-11"><a href="#cb24-11"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span>                             </span>
<span id="cb24-12"><a href="#cb24-12"></a>  <span class="fu">plot_modeltime_forecast</span>(                      </span>
<span id="cb24-13"><a href="#cb24-13"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb24-14"><a href="#cb24-14"></a>    <span class="at">.title =</span> <span class="st">"Forecast of Test Data"</span>,</span>
<span id="cb24-15"><a href="#cb24-15"></a>    <span class="at">.facet_ncol =</span> <span class="dv">1</span></span>
<span id="cb24-16"><a href="#cb24-16"></a>  ) <span class="sc">+</span></span>
<span id="cb24-17"><a href="#cb24-17"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-acc" class="quarto-figure quarto-figure-center quarto-float anchored" width="768">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-acc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="forecasting-with-modeltime-part-4_files/figure-html/fig-acc-1.png" id="fig-acc" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-acc-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1
</figcaption>
</figure>
</div>
</div>
</div>
<p>Just for fun, here are the 5 worst-performing models (global).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>hpi_mod_accuracy <span class="sc">|&gt;</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>  <span class="fu">slice_max</span>(smape, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb25-4"><a href="#cb25-4"></a>  <span class="fu">gt_bold_head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="uzwoecgpep" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#uzwoecgpep table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#uzwoecgpep thead, #uzwoecgpep tbody, #uzwoecgpep tfoot, #uzwoecgpep tr, #uzwoecgpep td, #uzwoecgpep th {
  border-style: none;
}

#uzwoecgpep p {
  margin: 0;
  padding: 0;
}

#uzwoecgpep .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#uzwoecgpep .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#uzwoecgpep .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#uzwoecgpep .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#uzwoecgpep .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uzwoecgpep .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uzwoecgpep .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#uzwoecgpep .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#uzwoecgpep .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#uzwoecgpep .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#uzwoecgpep .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#uzwoecgpep .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#uzwoecgpep .gt_spanner_row {
  border-bottom-style: hidden;
}

#uzwoecgpep .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#uzwoecgpep .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#uzwoecgpep .gt_from_md > :first-child {
  margin-top: 0;
}

#uzwoecgpep .gt_from_md > :last-child {
  margin-bottom: 0;
}

#uzwoecgpep .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#uzwoecgpep .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#uzwoecgpep .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#uzwoecgpep .gt_row_group_first td {
  border-top-width: 2px;
}

#uzwoecgpep .gt_row_group_first th {
  border-top-width: 2px;
}

#uzwoecgpep .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uzwoecgpep .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#uzwoecgpep .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#uzwoecgpep .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uzwoecgpep .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#uzwoecgpep .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#uzwoecgpep .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#uzwoecgpep .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#uzwoecgpep .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#uzwoecgpep .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uzwoecgpep .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uzwoecgpep .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#uzwoecgpep .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#uzwoecgpep .gt_left {
  text-align: left;
}

#uzwoecgpep .gt_center {
  text-align: center;
}

#uzwoecgpep .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#uzwoecgpep .gt_font_normal {
  font-weight: normal;
}

#uzwoecgpep .gt_font_bold {
  font-weight: bold;
}

#uzwoecgpep .gt_font_italic {
  font-style: italic;
}

#uzwoecgpep .gt_super {
  font-size: 65%;
}

#uzwoecgpep .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#uzwoecgpep .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#uzwoecgpep .gt_indent_1 {
  text-indent: 5px;
}

#uzwoecgpep .gt_indent_2 {
  text-indent: 10px;
}

#uzwoecgpep .gt_indent_3 {
  text-indent: 15px;
}

#uzwoecgpep .gt_indent_4 {
  text-indent: 20px;
}

#uzwoecgpep .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id=".model_id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">.model_id</th>
<th id=".model_desc" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">.model_desc</th>
<th id=".type" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">.type</th>
<th id="mae" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">mae</th>
<th id="mape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">mape</th>
<th id="mase" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">mase</th>
<th id="smape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">smape</th>
<th id="rmse" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">rmse</th>
<th id="rsq" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">rsq</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">2</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ARIMA_SPEC1</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">82.07379</td>
<td class="gt_row gt_right" headers="mape">28.40303</td>
<td class="gt_row gt_right" headers="mase">0.7639937</td>
<td class="gt_row gt_right" headers="smape">32.64595</td>
<td class="gt_row gt_right" headers="rmse">100.22516</td>
<td class="gt_row gt_right" headers="rsq">0.0237270639</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers=".model_id">4</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ARIMA_SPEC3</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">81.85927</td>
<td class="gt_row gt_right" headers="mape">28.93424</td>
<td class="gt_row gt_right" headers="mase">0.7619969</td>
<td class="gt_row gt_right" headers="smape">32.63484</td>
<td class="gt_row gt_right" headers="rmse">99.20593</td>
<td class="gt_row gt_right" headers="rsq">0.0005985376</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">17</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_SPEC1</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">81.34845</td>
<td class="gt_row gt_right" headers="mape">28.53501</td>
<td class="gt_row gt_right" headers="mase">0.7572419</td>
<td class="gt_row gt_right" headers="smape">32.31949</td>
<td class="gt_row gt_right" headers="rmse">99.36593</td>
<td class="gt_row gt_right" headers="rsq">NA</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers=".model_id">19</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_SPEC3</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">81.34845</td>
<td class="gt_row gt_right" headers="mape">28.53501</td>
<td class="gt_row gt_right" headers="mase">0.7572419</td>
<td class="gt_row gt_right" headers="smape">32.31949</td>
<td class="gt_row gt_right" headers="rmse">99.36593</td>
<td class="gt_row gt_right" headers="rsq">NA</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">20</td>
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_SPEC4</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">81.34845</td>
<td class="gt_row gt_right" headers="mape">28.53501</td>
<td class="gt_row gt_right" headers="mase">0.7572419</td>
<td class="gt_row gt_right" headers="smape">32.31949</td>
<td class="gt_row gt_right" headers="rmse">99.36593</td>
<td class="gt_row gt_right" headers="rsq">NA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="forecasting-with-global-models" class="level2">
<h2 class="anchored" data-anchor-id="forecasting-with-global-models">Forecasting with global models</h2>
<p>Below are forecasts for each city using the top 3 global models.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>hpi_refit <span class="ot">&lt;-</span> hpi_mod_calib <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">filter</span>(.model_id <span class="sc">%in%</span> top_3_global) <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">modeltime_refit</span>(<span class="at">data =</span> econ_data) </span>
<span id="cb26-4"><a href="#cb26-4"></a></span>
<span id="cb26-5"><a href="#cb26-5"></a>hpi_future <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="cb26-6"><a href="#cb26-6"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb26-7"><a href="#cb26-7"></a>  <span class="fu">future_frame</span>(<span class="at">.length_out =</span> <span class="dv">12</span>, <span class="at">.bind_data =</span> <span class="cn">FALSE</span>, <span class="at">.date_var =</span> date)</span>
<span id="cb26-8"><a href="#cb26-8"></a></span>
<span id="cb26-9"><a href="#cb26-9"></a>hpi_future_forecast <span class="ot">&lt;-</span> hpi_refit <span class="sc">|&gt;</span></span>
<span id="cb26-10"><a href="#cb26-10"></a>  <span class="fu">modeltime_forecast</span>(</span>
<span id="cb26-11"><a href="#cb26-11"></a>    <span class="at">new_data =</span> hpi_future,</span>
<span id="cb26-12"><a href="#cb26-12"></a>    <span class="at">actual_data =</span> econ_data,</span>
<span id="cb26-13"><a href="#cb26-13"></a>    <span class="at">conf_by_id =</span> <span class="cn">TRUE</span></span>
<span id="cb26-14"><a href="#cb26-14"></a>  )</span>
<span id="cb26-15"><a href="#cb26-15"></a></span>
<span id="cb26-16"><a href="#cb26-16"></a>hpi_future_forecast <span class="sc">|&gt;</span></span>
<span id="cb26-17"><a href="#cb26-17"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb26-18"><a href="#cb26-18"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="cb26-19"><a href="#cb26-19"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb26-20"><a href="#cb26-20"></a>    <span class="at">.title =</span> <span class="st">"1 Year Forecast into the Future - Global"</span>,</span>
<span id="cb26-21"><a href="#cb26-21"></a>    <span class="at">.facet_ncol =</span> <span class="dv">1</span></span>
<span id="cb26-22"><a href="#cb26-22"></a>  ) <span class="sc">+</span></span>
<span id="cb26-23"><a href="#cb26-23"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-4_files/figure-html/forecast-global-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="choosing-models-for-iterative-process" class="level2">
<h2 class="anchored" data-anchor-id="choosing-models-for-iterative-process">Choosing models for iterative process</h2>
<p>For iterative modeling I’m going to use the 10 best global models and the 3 best local models for each city. The specifications that I’m going to use for iterative modeling in the next post are:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>best_global_table <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">slice_min</span>(smape, <span class="at">n =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">bind_rows</span>(best_local_table) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="fu">distinct</span>(.model_desc) <span class="sc">|&gt;</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="fu">gt_bold_head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="dmqafflyth" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#dmqafflyth table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dmqafflyth thead, #dmqafflyth tbody, #dmqafflyth tfoot, #dmqafflyth tr, #dmqafflyth td, #dmqafflyth th {
  border-style: none;
}

#dmqafflyth p {
  margin: 0;
  padding: 0;
}

#dmqafflyth .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dmqafflyth .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dmqafflyth .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dmqafflyth .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dmqafflyth .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dmqafflyth .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dmqafflyth .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dmqafflyth .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dmqafflyth .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dmqafflyth .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dmqafflyth .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dmqafflyth .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dmqafflyth .gt_spanner_row {
  border-bottom-style: hidden;
}

#dmqafflyth .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dmqafflyth .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dmqafflyth .gt_from_md > :first-child {
  margin-top: 0;
}

#dmqafflyth .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dmqafflyth .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dmqafflyth .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dmqafflyth .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dmqafflyth .gt_row_group_first td {
  border-top-width: 2px;
}

#dmqafflyth .gt_row_group_first th {
  border-top-width: 2px;
}

#dmqafflyth .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dmqafflyth .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dmqafflyth .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dmqafflyth .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dmqafflyth .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dmqafflyth .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dmqafflyth .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dmqafflyth .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dmqafflyth .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dmqafflyth .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dmqafflyth .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dmqafflyth .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dmqafflyth .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dmqafflyth .gt_left {
  text-align: left;
}

#dmqafflyth .gt_center {
  text-align: center;
}

#dmqafflyth .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dmqafflyth .gt_font_normal {
  font-weight: normal;
}

#dmqafflyth .gt_font_bold {
  font-weight: bold;
}

#dmqafflyth .gt_font_italic {
  font-style: italic;
}

#dmqafflyth .gt_super {
  font-size: 65%;
}

#dmqafflyth .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dmqafflyth .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dmqafflyth .gt_indent_1 {
  text-indent: 5px;
}

#dmqafflyth .gt_indent_2 {
  text-indent: 10px;
}

#dmqafflyth .gt_indent_3 {
  text-indent: 15px;
}

#dmqafflyth .gt_indent_4 {
  text-indent: 20px;
}

#dmqafflyth .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id=".model_desc" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">.model_desc</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_DEFAULT</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ARIMA_DEFAULT</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ARIMA_SPEC2</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_SPEC14</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_ETS_SPEC6</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=".model_desc">DEMOG_REC_ARIMA_SPEC1</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=".model_desc">DEMOG_REC_ARIMA_SPEC3</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_STLM_SPEC4</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_STLM_SPEC1</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=".model_desc">BASE_REC_STLM_SPEC3</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>


<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-modeltime" class="csl-entry" role="listitem">
Dancho, Matt. 2023. <span>“Modeltime: The Tidymodels Extension for Time Series Modeling.”</span> <a href="https://CRAN.R-project.org/package=modeltime">https://CRAN.R-project.org/package=modeltime</a>.
</div>
<div id="ref-timetk" class="csl-entry" role="listitem">
Dancho, Matt, and Davis Vaughan. 2023. <span>“Timetk: A Tool Kit for Working with Time Series.”</span> <a href="https://CRAN.R-project.org/package=timetk">https://CRAN.R-project.org/package=timetk</a>.
</div>
<div id="ref-gt" class="csl-entry" role="listitem">
Iannone, Richard, Joe Cheng, Barret Schloerke, Ellis Hughes, Alexandra Lauer, and JooYoung Seo. 2024. <span>“Gt: Easily Create Presentation-Ready Display Tables.”</span> <a href="https://CRAN.R-project.org/package=gt">https://CRAN.R-project.org/package=gt</a>.
</div>
<div id="ref-workflowsets" class="csl-entry" role="listitem">
Kuhn, Max, and Simon Couch. 2023. <span>“Workflowsets: Create a Collection of ’Tidymodels’ Workflows.”</span> <a href="https://CRAN.R-project.org/package=workflowsets">https://CRAN.R-project.org/package=workflowsets</a>.
</div>
<div id="ref-tidymodels" class="csl-entry" role="listitem">
Kuhn, Max, and Hadley Wickham. 2020. <span>“Tidymodels: A Collection of Packages for Modeling and Machine Learning Using Tidyverse Principles.”</span> <a href="https://www.tidymodels.org">https://www.tidymodels.org</a>.
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span></span>Tidyverse<span></span>”</span> 4: 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/arcenis-r\.github\.io\/ajr-portfolio");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="arcenis-r/ajr-portfolio" data-repo-id="MDEwOlJlcG9zaXRvcnkxNzg3MDY3MTM=" data-category="General" data-category-id="DIC_kwDOCqbZGc4CdJXz" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb28" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb28-1"><a href="#cb28-1"></a><span class="co">---</span></span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="an">title:</span><span class="co"> "Forecasting with {modeltime} - Part IV"</span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="an">subtitle:</span><span class="co"> "Tuning many global models"</span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="an">author:</span><span class="co"> "Arcenis Rojas"</span></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="an">date:</span><span class="co"> "2/20/2024"</span></span>
<span id="cb28-6"><a href="#cb28-6"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="an">fig-height:</span><span class="co"> 8</span></span>
<span id="cb28-8"><a href="#cb28-8"></a><span class="an">fig-width:</span><span class="co"> 8</span></span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="an">categories:</span></span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="co">  - Time Series</span></span>
<span id="cb28-11"><a href="#cb28-11"></a><span class="co">  - Forecasting</span></span>
<span id="cb28-12"><a href="#cb28-12"></a><span class="co">  - Machine Learning</span></span>
<span id="cb28-13"><a href="#cb28-13"></a><span class="co">---</span></span>
<span id="cb28-14"><a href="#cb28-14"></a></span>
<span id="cb28-15"><a href="#cb28-15"></a><span class="fu">## Review</span></span>
<span id="cb28-16"><a href="#cb28-16"></a></span>
<span id="cb28-17"><a href="#cb28-17"></a>Up to this point in the project I acquired data in <span class="co">[</span><span class="ot">Forecasting with {modeltime} - Part I</span><span class="co">](../20240212-forecasting-with-modeltime-part-1/forecasting-with-modeltime-part-1.qmd)</span>, performed some standard time series analysis in <span class="co">[</span><span class="ot">Forecasting with {modeltime} - Part II</span><span class="co">](../20240215-forecasting-with-modeltime-part-2/forecasting-with-modeltime-part-2.qmd)</span>, and explored the two types of modeling processes – global and iterative – for multiple time series in <span class="co">[</span><span class="ot">Forecasting with {modeltime} - Part III</span><span class="co">](../20240216-forecasting-with-modeltime-part-3/forecasting-with-modeltime-part-3.qmd)</span>. In this post I'm going to tune multiple models using a global process to select a small number of them that I will run iteratively in the final post. I'll incorporate some of the other variables in the data set that I gathered in the the first post to forecast the Case-Shiller Home Price Index (HPI). Since I'll be creating variations of model specifications, I'm also going to use functions from the Tidymodels <span class="co">[</span><span class="ot">workflowsets</span><span class="co">](https://workflowsets.tidymodels.org/)</span> <span class="co">[</span><span class="ot">@workflowsets</span><span class="co">]</span> package to run the models. As before I'll be using <span class="co">[</span><span class="ot">modeltime</span><span class="co">](https://business-science.github.io/modeltime/index.html)</span> <span class="co">[</span><span class="ot">@modeltime</span><span class="co">]</span>, <span class="co">[</span><span class="ot">timetk</span><span class="co">](https://business-science.github.io/timetk/)</span> <span class="co">[</span><span class="ot">@timetk</span><span class="co">]</span>, <span class="co">[</span><span class="ot">tidymodels</span><span class="co">](https://www.tidymodels.org/)</span> <span class="co">[</span><span class="ot">@tidymodels</span><span class="co">]</span>, <span class="co">[</span><span class="ot">tidyverse</span><span class="co">](https://www.tidyverse.org/)</span> <span class="co">[</span><span class="ot">@tidyverse</span><span class="co">]</span>, and <span class="co">[</span><span class="ot">gt</span><span class="co">](#0)</span> <span class="co">[</span><span class="ot">@gt</span><span class="co">]</span>. Before jumping in, below I show a glimpse of the data that I'll be using.</span>
<span id="cb28-18"><a href="#cb28-18"></a></span>
<span id="cb28-21"><a href="#cb28-21"></a><span class="in">```{r}</span></span>
<span id="cb28-22"><a href="#cb28-22"></a><span class="co">#| label: load-packages</span></span>
<span id="cb28-23"><a href="#cb28-23"></a></span>
<span id="cb28-24"><a href="#cb28-24"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb28-25"><a href="#cb28-25"></a><span class="fu">library</span>(timetk)</span>
<span id="cb28-26"><a href="#cb28-26"></a><span class="fu">library</span>(modeltime)</span>
<span id="cb28-27"><a href="#cb28-27"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb28-28"><a href="#cb28-28"></a><span class="fu">library</span>(gt)</span>
<span id="cb28-29"><a href="#cb28-29"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb28-30"><a href="#cb28-30"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"lag"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb28-31"><a href="#cb28-31"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb28-32"><a href="#cb28-32"></a><span class="in">```</span></span>
<span id="cb28-33"><a href="#cb28-33"></a></span>
<span id="cb28-36"><a href="#cb28-36"></a><span class="in">```{r}</span></span>
<span id="cb28-37"><a href="#cb28-37"></a><span class="co">#| label: import-data</span></span>
<span id="cb28-38"><a href="#cb28-38"></a><span class="co">#| include: false</span></span>
<span id="cb28-39"><a href="#cb28-39"></a></span>
<span id="cb28-40"><a href="#cb28-40"></a>econ_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"../_common-resources/econ-data.Rds"</span>)</span>
<span id="cb28-41"><a href="#cb28-41"></a></span>
<span id="cb28-42"><a href="#cb28-42"></a><span class="fu">source</span>(<span class="st">"../_common-resources/gt-bold-head.R"</span>)</span>
<span id="cb28-43"><a href="#cb28-43"></a></span>
<span id="cb28-44"><a href="#cb28-44"></a><span class="in">```</span></span>
<span id="cb28-45"><a href="#cb28-45"></a></span>
<span id="cb28-48"><a href="#cb28-48"></a><span class="in">```{r}</span></span>
<span id="cb28-49"><a href="#cb28-49"></a><span class="co">#| label: glimpse-data</span></span>
<span id="cb28-50"><a href="#cb28-50"></a></span>
<span id="cb28-51"><a href="#cb28-51"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(econ_data)</span>
<span id="cb28-52"><a href="#cb28-52"></a></span>
<span id="cb28-53"><a href="#cb28-53"></a><span class="in">```</span></span>
<span id="cb28-54"><a href="#cb28-54"></a></span>
<span id="cb28-55"><a href="#cb28-55"></a><span class="fu">## Splitting the data</span></span>
<span id="cb28-56"><a href="#cb28-56"></a></span>
<span id="cb28-57"><a href="#cb28-57"></a>The data split object for a global modeling process is different than that for an iterative modeling process. For the global modeling process I'll use <span class="in">`timetk::time_series_split()`</span> . Below is a look at how the data are split.</span>
<span id="cb28-58"><a href="#cb28-58"></a></span>
<span id="cb28-61"><a href="#cb28-61"></a><span class="in">```{r}</span></span>
<span id="cb28-62"><a href="#cb28-62"></a><span class="co">#| label: split-data</span></span>
<span id="cb28-63"><a href="#cb28-63"></a></span>
<span id="cb28-64"><a href="#cb28-64"></a>econ_splits <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="cb28-65"><a href="#cb28-65"></a>  <span class="fu">time_series_split</span>(</span>
<span id="cb28-66"><a href="#cb28-66"></a>    <span class="at">assess =</span> <span class="st">"2 year"</span>,</span>
<span id="cb28-67"><a href="#cb28-67"></a>    <span class="at">cumulative =</span> <span class="cn">TRUE</span>,</span>
<span id="cb28-68"><a href="#cb28-68"></a>    <span class="at">date_var =</span> date</span>
<span id="cb28-69"><a href="#cb28-69"></a>  )</span>
<span id="cb28-70"><a href="#cb28-70"></a></span>
<span id="cb28-71"><a href="#cb28-71"></a>econ_splits</span>
<span id="cb28-72"><a href="#cb28-72"></a></span>
<span id="cb28-73"><a href="#cb28-73"></a><span class="in">```</span></span>
<span id="cb28-74"><a href="#cb28-74"></a></span>
<span id="cb28-75"><a href="#cb28-75"></a><span class="fu">## Choosing algorithms</span></span>
<span id="cb28-76"><a href="#cb28-76"></a></span>
<span id="cb28-77"><a href="#cb28-77"></a>As with selecting the cities in the analysis I'm interested in getting a little variation in the algorithms to see how they perform and I want to vary the parameters a bit. To get something of a traditional flavor I'm going to run ARIMA models with three different model formulas:</span>
<span id="cb28-78"><a href="#cb28-78"></a></span>
<span id="cb28-79"><a href="#cb28-79"></a>1<span class="sc">\)</span> hpi \~ date</span>
<span id="cb28-80"><a href="#cb28-80"></a></span>
<span id="cb28-81"><a href="#cb28-81"></a>2<span class="sc">\)</span> hpi \~ date + unemployment</span>
<span id="cb28-82"><a href="#cb28-82"></a></span>
<span id="cb28-83"><a href="#cb28-83"></a>3<span class="sc">\)</span> hpi \~ date + unemployment + demographic variables</span>
<span id="cb28-84"><a href="#cb28-84"></a></span>
<span id="cb28-85"><a href="#cb28-85"></a>I'll also have four specifications for the algorithms. One will be the default auto-ARIMA and the other three will be auto-ARIMA specifications with different season lengths. This will give me twelve different ARIMA models (3 recipes x 4 algorithm specifications).</span>
<span id="cb28-86"><a href="#cb28-86"></a></span>
<span id="cb28-87"><a href="#cb28-87"></a>In much the same way I will have different sets of recipes and model specifications for the following:</span>
<span id="cb28-88"><a href="#cb28-88"></a></span>
<span id="cb28-89"><a href="#cb28-89"></a><span class="ss">-   </span>an exponential smoothing algorithm (including a Holt-Winters specification) to allow for weighting the periods exponentially</span>
<span id="cb28-90"><a href="#cb28-90"></a></span>
<span id="cb28-91"><a href="#cb28-91"></a><span class="ss">-   </span>an STLM algorithm using an ARIMA engine (STLM: **S**easonal **T**rend Decomposition using **L**oess with **M**ultiple seasonal periods)</span>
<span id="cb28-92"><a href="#cb28-92"></a></span>
<span id="cb28-93"><a href="#cb28-93"></a><span class="ss">-   </span>A feed-forward, auto-regressive neural-net algorithm because these tend to have high predictive ability</span>
<span id="cb28-94"><a href="#cb28-94"></a></span>
<span id="cb28-95"><a href="#cb28-95"></a>Some of these algorithms allow for covariates and others (like exponential smoothing) do not. In the end I will have 90 model specifications to test. In order to do speed up the processing I'll employ <span class="co">[</span><span class="ot">modeltime</span><span class="co">](https://business-science.github.io/modeltime/index.html)</span>'s parallel processing feature.</span>
<span id="cb28-96"><a href="#cb28-96"></a></span>
<span id="cb28-97"><a href="#cb28-97"></a><span class="fu">## Building workflow objects</span></span>
<span id="cb28-98"><a href="#cb28-98"></a></span>
<span id="cb28-99"><a href="#cb28-99"></a>Here I'll write the three recipes for the ARIMA models and one for the auto-regressive neural-net model. The exponential smoothing and STLM models will both use the first of the three ARIMA recipes as neither of these algorithms can handle covariates.</span>
<span id="cb28-100"><a href="#cb28-100"></a></span>
<span id="cb28-101"><a href="#cb28-101"></a>You might notice in the code below that I exclude some of the demographic variables like "educ_hs_less" for the third ARIMA recipe. I exclude these variables because I found that including all of the variables for a demographic variable group causes the functions to error out much in the same way that including all of the categories of a factor variable would. Initially I did not expect that I would need contrasts considering that the variable values are ratios, but it seems that the fact that the sum of the ratios for a given variable group, e.g., education, is 1 for each row and for each variable group creates a need for contrasts in the regression (this is my guess).</span>
<span id="cb28-102"><a href="#cb28-102"></a></span>
<span id="cb28-103"><a href="#cb28-103"></a><span class="fu">### Writing recipes</span></span>
<span id="cb28-104"><a href="#cb28-104"></a></span>
<span id="cb28-105"><a href="#cb28-105"></a>::: {.callout-note title="Code Explanations"}</span>
<span id="cb28-106"><a href="#cb28-106"></a>Some of the code chunks below contain explanations. Lines in explanations will be marked with encircled numbers. Just hover over those numbers to see the corresponding explanation.</span>
<span id="cb28-107"><a href="#cb28-107"></a>:::</span>
<span id="cb28-108"><a href="#cb28-108"></a></span>
<span id="cb28-111"><a href="#cb28-111"></a><span class="in">```{r}</span></span>
<span id="cb28-112"><a href="#cb28-112"></a><span class="co">#| label: write-recs</span></span>
<span id="cb28-113"><a href="#cb28-113"></a></span>
<span id="cb28-114"><a href="#cb28-114"></a>arima_rec1 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(hpi <span class="sc">~</span> date, <span class="at">data =</span> <span class="fu">training</span>(econ_splits)) <span class="co"># &lt;1&gt;</span></span>
<span id="cb28-115"><a href="#cb28-115"></a></span>
<span id="cb28-116"><a href="#cb28-116"></a>arima_rec2 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(                                          <span class="co"># &lt;2&gt;</span></span>
<span id="cb28-117"><a href="#cb28-117"></a>  hpi <span class="sc">~</span> date <span class="sc">+</span> unemp_rate,</span>
<span id="cb28-118"><a href="#cb28-118"></a>  <span class="at">data =</span> <span class="fu">training</span>(econ_splits)</span>
<span id="cb28-119"><a href="#cb28-119"></a>) <span class="sc">|&gt;</span></span>
<span id="cb28-120"><a href="#cb28-120"></a>  <span class="fu">step_center</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span>                     <span class="co"># &lt;3&gt;</span></span>
<span id="cb28-121"><a href="#cb28-121"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span>                      <span class="co"># &lt;4&gt;</span></span>
<span id="cb28-122"><a href="#cb28-122"></a>  <span class="fu">step_lag</span>(unemp_rate, <span class="at">lag =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>))                       <span class="co"># &lt;5&gt;</span></span>
<span id="cb28-123"><a href="#cb28-123"></a></span>
<span id="cb28-124"><a href="#cb28-124"></a>rec3_dep_vars <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span>                                  <span class="co"># &lt;6&gt;</span></span>
<span id="cb28-125"><a href="#cb28-125"></a>  <span class="fu">select</span>(date, unemp_rate<span class="sc">:</span>population) <span class="sc">|&gt;</span></span>
<span id="cb28-126"><a href="#cb28-126"></a>  <span class="fu">select</span>(<span class="sc">!</span><span class="fu">c</span>(educ_hs_less, status_married, age_36_65)) <span class="sc">|&gt;</span></span>
<span id="cb28-127"><a href="#cb28-127"></a>  <span class="fu">names</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-128"><a href="#cb28-128"></a>  <span class="fu">str_flatten</span>(<span class="at">collapse =</span> <span class="st">" + "</span>)</span>
<span id="cb28-129"><a href="#cb28-129"></a></span>
<span id="cb28-130"><a href="#cb28-130"></a>arima_rec3 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb28-131"><a href="#cb28-131"></a>  <span class="fu">formula</span>(<span class="fu">str_c</span>(<span class="st">"hpi"</span>, rec3_dep_vars, <span class="at">sep =</span> <span class="st">" ~ "</span>)),</span>
<span id="cb28-132"><a href="#cb28-132"></a>  <span class="at">data =</span> <span class="fu">training</span>(econ_splits)</span>
<span id="cb28-133"><a href="#cb28-133"></a>) <span class="sc">|&gt;</span></span>
<span id="cb28-134"><a href="#cb28-134"></a>  <span class="fu">step_center</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb28-135"><a href="#cb28-135"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb28-136"><a href="#cb28-136"></a>  <span class="fu">step_lag</span>(unemp_rate, population, <span class="at">lag =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>))</span>
<span id="cb28-137"><a href="#cb28-137"></a></span>
<span id="cb28-138"><a href="#cb28-138"></a>nnet_rec <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb28-139"><a href="#cb28-139"></a>  hpi <span class="sc">~</span> .,</span>
<span id="cb28-140"><a href="#cb28-140"></a>  <span class="at">data =</span> <span class="fu">training</span>(econ_splits)</span>
<span id="cb28-141"><a href="#cb28-141"></a>) <span class="sc">|&gt;</span></span>
<span id="cb28-142"><a href="#cb28-142"></a>  <span class="fu">update_role</span>(city, <span class="at">new_role =</span> <span class="st">"ID"</span>) <span class="sc">|&gt;</span>                         <span class="co"># &lt;7&gt;</span></span>
<span id="cb28-143"><a href="#cb28-143"></a>  <span class="fu">step_center</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb28-144"><a href="#cb28-144"></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span></span>
<span id="cb28-145"><a href="#cb28-145"></a>  <span class="fu">step_timeseries_signature</span>(date) <span class="sc">|&gt;</span>                            <span class="co"># &lt;8&gt;</span></span>
<span id="cb28-146"><a href="#cb28-146"></a>  <span class="fu">step_nzv</span>(<span class="fu">all_predictors</span>())                                    <span class="co"># &lt;9&gt;</span></span>
<span id="cb28-147"><a href="#cb28-147"></a></span>
<span id="cb28-148"><a href="#cb28-148"></a><span class="in">```</span></span>
<span id="cb28-149"><a href="#cb28-149"></a></span>
<span id="cb28-150"><a href="#cb28-150"></a><span class="ss">1.  </span>Write a base recipe to regress HPI on the date variable</span>
<span id="cb28-151"><a href="#cb28-151"></a><span class="ss">2.  </span>Write a recipe formula that adds unemployment as an explanatory variable</span>
<span id="cb28-152"><a href="#cb28-152"></a><span class="ss">3.  </span>Mean-center all numeric predictors (only "unemployment rate" here)</span>
<span id="cb28-153"><a href="#cb28-153"></a><span class="ss">4.  </span>Scale all numeric predictors to have a mean of "0" and a standard error of 1</span>
<span id="cb28-154"><a href="#cb28-154"></a><span class="ss">5.  </span>Create lag variables for "unemployment rate" and "population"</span>
<span id="cb28-155"><a href="#cb28-155"></a><span class="ss">6.  </span>Get the names of all the economic and demographic variables from the data set and concatenate them into a formula string to make the right side of a regression formula, i.e., "var1 + var2 + var3..."</span>
<span id="cb28-156"><a href="#cb28-156"></a><span class="ss">7.  </span>Because the "outcome \~ ." notation is being used, the "city" variable is included in the ".", meaning it will be treated as an explanatory variable. This step changes the role of that variable from "predictor" to an ID variable, which modeling workflows will exclude from sets of predictors.</span>
<span id="cb28-157"><a href="#cb28-157"></a><span class="ss">8.  </span>Add a set of variables related to the date such as day of the week of the date, day of the month, number of the week of the year, etc.</span>
<span id="cb28-158"><a href="#cb28-158"></a><span class="ss">9.  </span>Remove any variables with zero or near-zero variance. An example of this would be a variable indicating the day of the month. Since this is monthly data, all values would be "1", i.e., the first day of the month.</span>
<span id="cb28-159"><a href="#cb28-159"></a></span>
<span id="cb28-160"><a href="#cb28-160"></a>Here is a reminder of what a recipe looks like. This is the neural-net recipe.</span>
<span id="cb28-161"><a href="#cb28-161"></a></span>
<span id="cb28-164"><a href="#cb28-164"></a><span class="in">```{r}</span></span>
<span id="cb28-165"><a href="#cb28-165"></a><span class="co">#| label: show-rec</span></span>
<span id="cb28-166"><a href="#cb28-166"></a></span>
<span id="cb28-167"><a href="#cb28-167"></a>nnet_rec</span>
<span id="cb28-168"><a href="#cb28-168"></a></span>
<span id="cb28-169"><a href="#cb28-169"></a><span class="in">```</span></span>
<span id="cb28-170"><a href="#cb28-170"></a></span>
<span id="cb28-171"><a href="#cb28-171"></a>And this is the data set that gets created by that recipe.</span>
<span id="cb28-172"><a href="#cb28-172"></a></span>
<span id="cb28-175"><a href="#cb28-175"></a><span class="in">```{r}</span></span>
<span id="cb28-176"><a href="#cb28-176"></a><span class="co">#| label: show-rec-juiced</span></span>
<span id="cb28-177"><a href="#cb28-177"></a></span>
<span id="cb28-178"><a href="#cb28-178"></a>nnet_rec <span class="sc">|&gt;</span> <span class="fu">prep</span>() <span class="sc">|&gt;</span> <span class="fu">juice</span>() <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span>
<span id="cb28-179"><a href="#cb28-179"></a></span>
<span id="cb28-180"><a href="#cb28-180"></a><span class="in">```</span></span>
<span id="cb28-181"><a href="#cb28-181"></a></span>
<span id="cb28-182"><a href="#cb28-182"></a><span class="fu">### Specifying models</span></span>
<span id="cb28-183"><a href="#cb28-183"></a></span>
<span id="cb28-184"><a href="#cb28-184"></a>In this next step I'll specify the model objects for each algorithm along with the search grids for their various hyperparameters. I chose to keep only some of the combinations of the exponential smoothing specifications to limit the number of models being run that are likely to fail.</span>
<span id="cb28-185"><a href="#cb28-185"></a></span>
<span id="cb28-188"><a href="#cb28-188"></a><span class="in">```{r}</span></span>
<span id="cb28-189"><a href="#cb28-189"></a><span class="co">#| label: specify-models</span></span>
<span id="cb28-190"><a href="#cb28-190"></a></span>
<span id="cb28-191"><a href="#cb28-191"></a>arima_default <span class="ot">&lt;-</span> <span class="fu">arima_reg</span>() <span class="sc">|&gt;</span> <span class="fu">set_engine</span>(<span class="st">"auto_arima"</span>)                        <span class="co"># &lt;1&gt;</span></span>
<span id="cb28-192"><a href="#cb28-192"></a></span>
<span id="cb28-193"><a href="#cb28-193"></a>arima_spec_grid <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">seasonal_period =</span> <span class="fu">seq</span>(<span class="dv">9</span>, <span class="dv">18</span>, <span class="at">by =</span> <span class="dv">3</span>)) <span class="sc">|&gt;</span>              <span class="co"># &lt;2&gt;</span></span>
<span id="cb28-194"><a href="#cb28-194"></a>  <span class="fu">create_model_grid</span>(                                                            <span class="co"># &lt;3&gt;</span></span>
<span id="cb28-195"><a href="#cb28-195"></a>    <span class="at">f_model_spec =</span> arima_reg,</span>
<span id="cb28-196"><a href="#cb28-196"></a>    <span class="at">engine_name =</span> <span class="st">"auto_arima"</span>,</span>
<span id="cb28-197"><a href="#cb28-197"></a>    <span class="at">mode =</span> <span class="st">"regression"</span></span>
<span id="cb28-198"><a href="#cb28-198"></a>  )</span>
<span id="cb28-199"><a href="#cb28-199"></a></span>
<span id="cb28-200"><a href="#cb28-200"></a>ets_default <span class="ot">&lt;-</span> <span class="fu">exp_smoothing</span>() <span class="sc">|&gt;</span> <span class="fu">set_engine</span>(<span class="st">"ets"</span>)</span>
<span id="cb28-201"><a href="#cb28-201"></a></span>
<span id="cb28-202"><a href="#cb28-202"></a><span class="fu">set.seed</span>(<span class="dv">40</span>)                                                                    <span class="co"># &lt;4&gt;</span></span>
<span id="cb28-203"><a href="#cb28-203"></a>alpha_vals <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">5</span>, <span class="fl">0.01</span>, <span class="fl">0.5</span>) <span class="sc">*</span></span>
<span id="cb28-204"><a href="#cb28-204"></a>  <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>, .<span class="dv">001</span>), <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-205"><a href="#cb28-205"></a>beta_vals <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">5</span>, <span class="fl">0.01</span>, <span class="fl">0.2</span>) <span class="sc">*</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="fl">0.1</span>, <span class="fl">0.01</span>), <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-206"><a href="#cb28-206"></a>gamma_vals <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(</span>
<span id="cb28-207"><a href="#cb28-207"></a>  alpha_vals,</span>
<span id="cb28-208"><a href="#cb28-208"></a>  \(x) <span class="fu">runif</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span> <span class="sc">-</span> x)</span>
<span id="cb28-209"><a href="#cb28-209"></a>)</span>
<span id="cb28-210"><a href="#cb28-210"></a></span>
<span id="cb28-211"><a href="#cb28-211"></a>ets_spec_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(                                                   <span class="co"># &lt;5&gt;</span></span>
<span id="cb28-212"><a href="#cb28-212"></a>  <span class="at">smooth_level =</span> alpha_vals[<span class="sc">-</span><span class="dv">2</span>],</span>
<span id="cb28-213"><a href="#cb28-213"></a>  <span class="at">smooth_seasonal =</span> gamma_vals[<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>],</span>
<span id="cb28-214"><a href="#cb28-214"></a>  <span class="at">seasonal_period =</span> <span class="fu">seq</span>(<span class="dv">9</span>, <span class="dv">18</span>, <span class="at">by =</span> <span class="dv">3</span>)</span>
<span id="cb28-215"><a href="#cb28-215"></a>) <span class="sc">|&gt;</span></span>
<span id="cb28-216"><a href="#cb28-216"></a>  <span class="fu">create_model_grid</span>(</span>
<span id="cb28-217"><a href="#cb28-217"></a>    <span class="at">f_model_spec =</span> exp_smoothing,</span>
<span id="cb28-218"><a href="#cb28-218"></a>    <span class="at">engine_name =</span> <span class="st">"ets"</span>,</span>
<span id="cb28-219"><a href="#cb28-219"></a>    <span class="at">mode =</span> <span class="st">"regression"</span>,</span>
<span id="cb28-220"><a href="#cb28-220"></a>    <span class="at">error =</span> <span class="st">"auto"</span>,</span>
<span id="cb28-221"><a href="#cb28-221"></a>    <span class="at">trend =</span> <span class="st">"auto"</span>,</span>
<span id="cb28-222"><a href="#cb28-222"></a>    <span class="at">season =</span> <span class="st">"auto"</span>,</span>
<span id="cb28-223"><a href="#cb28-223"></a>    <span class="at">smooth_trend =</span> beta_vals[<span class="dv">3</span>]</span>
<span id="cb28-224"><a href="#cb28-224"></a>  )</span>
<span id="cb28-225"><a href="#cb28-225"></a></span>
<span id="cb28-226"><a href="#cb28-226"></a>stlm_spec_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb28-227"><a href="#cb28-227"></a>  <span class="at">seasonal_period_2 =</span> <span class="fu">c</span>(<span class="cn">NULL</span>, <span class="fu">seq</span>(<span class="dv">6</span>, <span class="dv">18</span>, <span class="at">by =</span> <span class="dv">3</span>))</span>
<span id="cb28-228"><a href="#cb28-228"></a>) <span class="sc">|&gt;</span></span>
<span id="cb28-229"><a href="#cb28-229"></a>  <span class="fu">create_model_grid</span>(</span>
<span id="cb28-230"><a href="#cb28-230"></a>    <span class="at">f_model_spec =</span> seasonal_reg,</span>
<span id="cb28-231"><a href="#cb28-231"></a>    <span class="at">engine_name =</span> <span class="st">"stlm_arima"</span>,</span>
<span id="cb28-232"><a href="#cb28-232"></a>    <span class="at">mode =</span> <span class="st">"regression"</span>,</span>
<span id="cb28-233"><a href="#cb28-233"></a>    <span class="at">seasonal_period_1 =</span> <span class="dv">12</span></span>
<span id="cb28-234"><a href="#cb28-234"></a>  )</span>
<span id="cb28-235"><a href="#cb28-235"></a></span>
<span id="cb28-236"><a href="#cb28-236"></a>nnet_default <span class="ot">&lt;-</span> <span class="fu">nnetar_reg</span>() <span class="sc">|&gt;</span> <span class="fu">set_engine</span>(<span class="st">"nnetar"</span>)</span>
<span id="cb28-237"><a href="#cb28-237"></a></span>
<span id="cb28-238"><a href="#cb28-238"></a>nnet_spec_grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb28-239"><a href="#cb28-239"></a>  <span class="at">non_seasonal_ar =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb28-240"><a href="#cb28-240"></a>  <span class="at">hidden_units =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb28-241"><a href="#cb28-241"></a>  <span class="at">num_networks =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">25</span>),</span>
<span id="cb28-242"><a href="#cb28-242"></a>  <span class="at">penalty =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.25</span>)</span>
<span id="cb28-243"><a href="#cb28-243"></a>) <span class="sc">|&gt;</span></span>
<span id="cb28-244"><a href="#cb28-244"></a>  <span class="fu">create_model_grid</span>(</span>
<span id="cb28-245"><a href="#cb28-245"></a>    <span class="at">f_model_spec =</span> nnetar_reg,</span>
<span id="cb28-246"><a href="#cb28-246"></a>    <span class="at">engine_name =</span> <span class="st">"nnetar"</span>,</span>
<span id="cb28-247"><a href="#cb28-247"></a>    <span class="at">mode =</span> <span class="st">"regression"</span>,</span>
<span id="cb28-248"><a href="#cb28-248"></a>    <span class="at">seasonal_period =</span> <span class="dv">12</span>,</span>
<span id="cb28-249"><a href="#cb28-249"></a>    <span class="at">epochs =</span> <span class="dv">100</span>,</span>
<span id="cb28-250"><a href="#cb28-250"></a>    <span class="at">seasonal_ar =</span> <span class="dv">1</span></span>
<span id="cb28-251"><a href="#cb28-251"></a>  )</span>
<span id="cb28-252"><a href="#cb28-252"></a></span>
<span id="cb28-253"><a href="#cb28-253"></a><span class="in">```</span></span>
<span id="cb28-254"><a href="#cb28-254"></a></span>
<span id="cb28-255"><a href="#cb28-255"></a><span class="ss">1.  </span>Specify an ARIMA regression model using the "auto_arima" engine with all default arguments</span>
<span id="cb28-256"><a href="#cb28-256"></a><span class="ss">2.  </span>Create a 1-column <span class="in">`tibble`</span> (data frame) with the <span class="in">`seasonal_period`</span> argument set to vary as 9, 12, 15, and 18 (months).</span>
<span id="cb28-257"><a href="#cb28-257"></a><span class="ss">3.  </span><span class="in">`create_model_grid()`</span> allows one to set static arguments to combine them with the arguments that vary. This is meant to serve a similar purpose as <span class="in">`tune::tune_grid()`</span> from Tidymodels.</span>
<span id="cb28-258"><a href="#cb28-258"></a><span class="ss">4.  </span>Set a random seed for reproducibility and generate vectors for the <span class="in">`smooth_level`</span>, <span class="in">`smooth_trend`</span>, and <span class="in">`smooth_seasonal`</span> arguments. In <span class="in">`forecast::ets()`</span> these are <span class="in">`alpha`</span>, <span class="in">`beta`</span>, and <span class="in">`gamma`</span> respectively.</span>
<span id="cb28-259"><a href="#cb28-259"></a><span class="ss">5.  </span>Use <span class="in">`tidyr::expand_grid()`</span> to get all combinations of the included vectors.</span>
<span id="cb28-260"><a href="#cb28-260"></a></span>
<span id="cb28-261"><a href="#cb28-261"></a>Below is what a model grid looks like.</span>
<span id="cb28-262"><a href="#cb28-262"></a></span>
<span id="cb28-265"><a href="#cb28-265"></a><span class="in">```{r}</span></span>
<span id="cb28-266"><a href="#cb28-266"></a><span class="co">#| label: show-mod-grid</span></span>
<span id="cb28-267"><a href="#cb28-267"></a></span>
<span id="cb28-268"><a href="#cb28-268"></a>ets_spec_grid <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb28-269"><a href="#cb28-269"></a><span class="in">```</span></span>
<span id="cb28-270"><a href="#cb28-270"></a></span>
<span id="cb28-271"><a href="#cb28-271"></a>This is a glimpse of a model specification.</span>
<span id="cb28-272"><a href="#cb28-272"></a></span>
<span id="cb28-275"><a href="#cb28-275"></a><span class="in">```{r}</span></span>
<span id="cb28-276"><a href="#cb28-276"></a><span class="co">#| label: show-mod-spec</span></span>
<span id="cb28-277"><a href="#cb28-277"></a></span>
<span id="cb28-278"><a href="#cb28-278"></a>ets_spec_grid <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">pluck</span>(<span class="st">".models"</span>, <span class="dv">1</span>)</span>
<span id="cb28-279"><a href="#cb28-279"></a><span class="in">```</span></span>
<span id="cb28-280"><a href="#cb28-280"></a></span>
<span id="cb28-281"><a href="#cb28-281"></a><span class="fu">### Building workflowsets</span></span>
<span id="cb28-282"><a href="#cb28-282"></a></span>
<span id="cb28-283"><a href="#cb28-283"></a>A <span class="in">`workflowset`</span> is, you guessed it, a set of workflows. Mechanically it is a very convenient wrapper that can put together different combinations of recipes (pre-processors) and models. I don't want to mix all of my recipes with all of my models, however. So, in this step I'll make sets of individuals that combine the appropriate sets of recipes and models then I'll bind all of them together at the end.</span>
<span id="cb28-284"><a href="#cb28-284"></a></span>
<span id="cb28-287"><a href="#cb28-287"></a><span class="in">```{r}</span></span>
<span id="cb28-288"><a href="#cb28-288"></a><span class="co">#| label: make-workflowsets</span></span>
<span id="cb28-289"><a href="#cb28-289"></a></span>
<span id="cb28-290"><a href="#cb28-290"></a>arima_wfset <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(                <span class="co"># &lt;1&gt;</span></span>
<span id="cb28-291"><a href="#cb28-291"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(                           <span class="co"># &lt;2&gt;</span></span>
<span id="cb28-292"><a href="#cb28-292"></a>    <span class="at">base_rec =</span> arima_rec1,</span>
<span id="cb28-293"><a href="#cb28-293"></a>    <span class="at">econ_rec =</span> arima_rec2,</span>
<span id="cb28-294"><a href="#cb28-294"></a>    <span class="at">demog_rec =</span> arima_rec3</span>
<span id="cb28-295"><a href="#cb28-295"></a>  ),</span>
<span id="cb28-296"><a href="#cb28-296"></a>  <span class="at">models =</span> <span class="fu">c</span>(                               <span class="co"># &lt;3&gt;</span></span>
<span id="cb28-297"><a href="#cb28-297"></a>    <span class="at">arima_default =</span> <span class="fu">list</span>(arima_default),</span>
<span id="cb28-298"><a href="#cb28-298"></a>    <span class="at">arima_spec =</span> arima_spec_grid<span class="sc">$</span>.models</span>
<span id="cb28-299"><a href="#cb28-299"></a>  ),</span>
<span id="cb28-300"><a href="#cb28-300"></a>  <span class="at">cross =</span> <span class="cn">TRUE</span>                              <span class="co"># &lt;4&gt;</span></span>
<span id="cb28-301"><a href="#cb28-301"></a>)</span>
<span id="cb28-302"><a href="#cb28-302"></a></span>
<span id="cb28-303"><a href="#cb28-303"></a>ets_wfset <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(</span>
<span id="cb28-304"><a href="#cb28-304"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">base_rec =</span> arima_rec1),</span>
<span id="cb28-305"><a href="#cb28-305"></a>  <span class="at">models =</span> <span class="fu">c</span>(<span class="at">ets_default =</span> <span class="fu">list</span>(ets_default), <span class="at">ets_spec =</span> ets_spec_grid<span class="sc">$</span>.models),</span>
<span id="cb28-306"><a href="#cb28-306"></a>  <span class="at">cross =</span> <span class="cn">TRUE</span></span>
<span id="cb28-307"><a href="#cb28-307"></a>)</span>
<span id="cb28-308"><a href="#cb28-308"></a></span>
<span id="cb28-309"><a href="#cb28-309"></a>stlm_wfset <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(</span>
<span id="cb28-310"><a href="#cb28-310"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">base_rec =</span> arima_rec1),</span>
<span id="cb28-311"><a href="#cb28-311"></a>  <span class="at">models =</span> <span class="fu">c</span>(<span class="at">stlm_spec =</span> stlm_spec_grid<span class="sc">$</span>.models),</span>
<span id="cb28-312"><a href="#cb28-312"></a>  <span class="at">cross =</span> <span class="cn">TRUE</span></span>
<span id="cb28-313"><a href="#cb28-313"></a>)</span>
<span id="cb28-314"><a href="#cb28-314"></a></span>
<span id="cb28-315"><a href="#cb28-315"></a>nnet_wfset <span class="ot">&lt;-</span> <span class="fu">workflow_set</span>(</span>
<span id="cb28-316"><a href="#cb28-316"></a>  <span class="at">preproc =</span> <span class="fu">list</span>(<span class="at">nnet_rec =</span> nnet_rec),</span>
<span id="cb28-317"><a href="#cb28-317"></a>  <span class="at">models =</span> <span class="fu">c</span>(</span>
<span id="cb28-318"><a href="#cb28-318"></a>    <span class="at">nnet_default =</span> <span class="fu">list</span>(nnet_default),</span>
<span id="cb28-319"><a href="#cb28-319"></a>    <span class="at">nnet_spec =</span> nnet_spec_grid<span class="sc">$</span>.models</span>
<span id="cb28-320"><a href="#cb28-320"></a>  ),</span>
<span id="cb28-321"><a href="#cb28-321"></a>  <span class="at">cross =</span> <span class="cn">TRUE</span></span>
<span id="cb28-322"><a href="#cb28-322"></a>)</span>
<span id="cb28-323"><a href="#cb28-323"></a></span>
<span id="cb28-324"><a href="#cb28-324"></a><span class="in">```</span></span>
<span id="cb28-325"><a href="#cb28-325"></a></span>
<span id="cb28-326"><a href="#cb28-326"></a><span class="ss">1.  </span>Call <span class="in">`workflowsets::workflowset()`</span></span>
<span id="cb28-327"><a href="#cb28-327"></a><span class="ss">2.  </span>Provide a named list of recipes to use in the <span class="in">`workflowset`</span>; naming the elements at this stage makes it easier to match up the elements of the final table containing the trained models with the original recipes and model specifications</span>
<span id="cb28-328"><a href="#cb28-328"></a><span class="ss">3.  </span>Provide a named list of model specifications by pulling the ".models" column from each grid</span>
<span id="cb28-329"><a href="#cb28-329"></a><span class="ss">4.  </span>Indicate that all recipes should be combined with all model specifications</span>
<span id="cb28-330"><a href="#cb28-330"></a></span>
<span id="cb28-331"><a href="#cb28-331"></a>The individual specifications in the final model table will be named using a combination of the name of the recipe and the name of the model specification given in the respective lists with a count added whenever there are duplicate names. For example, arima_spec_grid has four model specifications in it. The ones that are combined with the first ARIMA recipe (named "base_rec") will be named BASE_REC_ARIMA_SPEC1, BASE_REC_ARIMA_SPEC2, BASE_REC_ARIMA_SPEC3, and BASE_REC_ARIMA_SPEC4.</span>
<span id="cb28-332"><a href="#cb28-332"></a></span>
<span id="cb28-333"><a href="#cb28-333"></a>With all of the model-specific workflow sets created, now it's time to put them all together.</span>
<span id="cb28-334"><a href="#cb28-334"></a></span>
<span id="cb28-337"><a href="#cb28-337"></a><span class="in">```{r}</span></span>
<span id="cb28-338"><a href="#cb28-338"></a><span class="co">#| label: bind-workflowsets</span></span>
<span id="cb28-339"><a href="#cb28-339"></a></span>
<span id="cb28-340"><a href="#cb28-340"></a>hpi_wfset <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(arima_wfset, ets_wfset, stlm_wfset, nnet_wfset)</span>
<span id="cb28-341"><a href="#cb28-341"></a></span>
<span id="cb28-342"><a href="#cb28-342"></a>hpi_wfset <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>)</span>
<span id="cb28-343"><a href="#cb28-343"></a></span>
<span id="cb28-344"><a href="#cb28-344"></a><span class="in">```</span></span>
<span id="cb28-345"><a href="#cb28-345"></a></span>
<span id="cb28-346"><a href="#cb28-346"></a>That's all the heavy lifting. Now it's time to let the computer processors do their part and run the models.</span>
<span id="cb28-347"><a href="#cb28-347"></a></span>
<span id="cb28-348"><a href="#cb28-348"></a><span class="fu">## Fitting the models</span></span>
<span id="cb28-349"><a href="#cb28-349"></a></span>
<span id="cb28-352"><a href="#cb28-352"></a><span class="in">```{r}</span></span>
<span id="cb28-353"><a href="#cb28-353"></a><span class="co">#| label: run-models</span></span>
<span id="cb28-354"><a href="#cb28-354"></a><span class="co">#| output: false</span></span>
<span id="cb28-355"><a href="#cb28-355"></a><span class="co">#| cache: true</span></span>
<span id="cb28-356"><a href="#cb28-356"></a></span>
<span id="cb28-357"><a href="#cb28-357"></a>avail_cores <span class="ot">&lt;-</span> <span class="fu">unname</span>(parallelly<span class="sc">::</span><span class="fu">availableCores</span>() <span class="sc">-</span> <span class="dv">1</span>)                     <span class="co"># &lt;1&gt;</span></span>
<span id="cb28-358"><a href="#cb28-358"></a>modulo_vec <span class="ot">&lt;-</span> <span class="fu">sapply</span>(avail_cores<span class="sc">:</span><span class="dv">2</span>, \(x) <span class="fu">nrow</span>(hpi_wfset) <span class="sc">%%</span> x)              </span>
<span id="cb28-359"><a href="#cb28-359"></a>num_cores <span class="ot">&lt;-</span> <span class="fu">max</span>(                                                           <span class="co"># &lt;2&gt;</span></span>
<span id="cb28-360"><a href="#cb28-360"></a>  <span class="fu">max</span>(<span class="fu">which</span>(modulo_vec <span class="sc">==</span> <span class="fu">max</span>(modulo_vec))),</span>
<span id="cb28-361"><a href="#cb28-361"></a>    <span class="fu">max</span>(<span class="fu">which</span>(modulo_vec <span class="sc">==</span> <span class="dv">0</span>))</span>
<span id="cb28-362"><a href="#cb28-362"></a>) <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb28-363"><a href="#cb28-363"></a></span>
<span id="cb28-364"><a href="#cb28-364"></a>cl <span class="ot">&lt;-</span> parallel<span class="sc">::</span><span class="fu">makePSOCKcluster</span>(num_cores)                                 <span class="co"># &lt;3&gt;</span></span>
<span id="cb28-365"><a href="#cb28-365"></a>doParallel<span class="sc">::</span><span class="fu">registerDoParallel</span>(cl)                                          <span class="co"># &lt;3&gt;</span></span>
<span id="cb28-366"><a href="#cb28-366"></a><span class="fu">invisible</span>(                                                                  <span class="co"># &lt;3&gt;</span></span>
<span id="cb28-367"><a href="#cb28-367"></a>  parallel<span class="sc">::</span><span class="fu">clusterCall</span>(cl, <span class="cf">function</span>(x) <span class="fu">.libPaths</span>(x), <span class="fu">.libPaths</span>())          <span class="co"># &lt;3&gt;</span></span>
<span id="cb28-368"><a href="#cb28-368"></a>)                                                                           <span class="co"># &lt;3&gt;</span></span>
<span id="cb28-369"><a href="#cb28-369"></a>parallel<span class="sc">::</span><span class="fu">clusterEvalQ</span>(cl, <span class="fu">set.seed</span>(<span class="dv">500</span>))                                   <span class="co"># &lt;3&gt;</span></span>
<span id="cb28-370"><a href="#cb28-370"></a></span>
<span id="cb28-371"><a href="#cb28-371"></a>hpi_mods_start <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb28-372"><a href="#cb28-372"></a></span>
<span id="cb28-373"><a href="#cb28-373"></a>hpi_mods <span class="ot">&lt;-</span> hpi_wfset <span class="sc">|&gt;</span>                                                    <span class="co"># &lt;4&gt;</span></span>
<span id="cb28-374"><a href="#cb28-374"></a>  <span class="fu">modeltime_fit_workflowset</span>(                                                <span class="co"># &lt;5&gt;</span></span>
<span id="cb28-375"><a href="#cb28-375"></a>    <span class="at">data =</span> <span class="fu">training</span>(econ_splits),                                           <span class="co"># &lt;6&gt;</span></span>
<span id="cb28-376"><a href="#cb28-376"></a>    <span class="at">control =</span> <span class="fu">control_fit_workflowset</span>(<span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">allow_par =</span> <span class="cn">TRUE</span>)    <span class="co"># &lt;7&gt;</span></span>
<span id="cb28-377"><a href="#cb28-377"></a>  )</span>
<span id="cb28-378"><a href="#cb28-378"></a></span>
<span id="cb28-379"><a href="#cb28-379"></a>hpi_mods_end <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb28-380"><a href="#cb28-380"></a></span>
<span id="cb28-381"><a href="#cb28-381"></a>parallel<span class="sc">::</span><span class="fu">stopCluster</span>(cl)                                                   <span class="co"># &lt;8&gt;</span></span>
<span id="cb28-382"><a href="#cb28-382"></a><span class="fu">rm</span>(cl)</span>
<span id="cb28-383"><a href="#cb28-383"></a><span class="fu">gc</span>()</span>
<span id="cb28-384"><a href="#cb28-384"></a></span>
<span id="cb28-385"><a href="#cb28-385"></a><span class="in">```</span></span>
<span id="cb28-386"><a href="#cb28-386"></a></span>
<span id="cb28-387"><a href="#cb28-387"></a><span class="ss">1.  </span>Get the number of cores available and leave one out for common tasks like running the operating system</span>
<span id="cb28-388"><a href="#cb28-388"></a><span class="ss">2.  </span>Calculate the number of cores to use in order to maximize efficiency</span>
<span id="cb28-389"><a href="#cb28-389"></a><span class="ss">3.  </span>Set up the cluster for parallel processing</span>
<span id="cb28-390"><a href="#cb28-390"></a><span class="ss">4.  </span>Call the <span class="in">`workflowset`</span> object containing all the workflows to run</span>
<span id="cb28-391"><a href="#cb28-391"></a><span class="ss">5.  </span>Use <span class="in">`modeltime::modeltime_fit_workflowset()`</span> to fit all of the models</span>
<span id="cb28-392"><a href="#cb28-392"></a><span class="ss">6.  </span>Use the training portion of the split object to train the models</span>
<span id="cb28-393"><a href="#cb28-393"></a><span class="ss">7.  </span>Set some controls for the model fitting function</span>
<span id="cb28-394"><a href="#cb28-394"></a><span class="ss">8.  </span>Stop the parallel cluster from running</span>
<span id="cb28-395"><a href="#cb28-395"></a></span>
<span id="cb28-398"><a href="#cb28-398"></a><span class="in">```{r}</span></span>
<span id="cb28-399"><a href="#cb28-399"></a><span class="co">#| label: show-fitting-time</span></span>
<span id="cb28-400"><a href="#cb28-400"></a></span>
<span id="cb28-401"><a href="#cb28-401"></a>fit_time <span class="ot">&lt;-</span> (hpi_mods_end <span class="sc">-</span> hpi_mods_start) <span class="sc">|&gt;</span></span>
<span id="cb28-402"><a href="#cb28-402"></a>  <span class="fu">enframe</span>(<span class="st">"time_metric"</span>, <span class="st">"seconds"</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-403"><a href="#cb28-403"></a>  <span class="fu">drop_na</span>(seconds)</span>
<span id="cb28-404"><a href="#cb28-404"></a></span>
<span id="cb28-405"><a href="#cb28-405"></a>fit_time <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span>
<span id="cb28-406"><a href="#cb28-406"></a></span>
<span id="cb28-407"><a href="#cb28-407"></a><span class="in">```</span></span>
<span id="cb28-408"><a href="#cb28-408"></a></span>
<span id="cb28-409"><a href="#cb28-409"></a>About <span class="in">`r fit_time |&gt; filter(time_metric == "elapsed") |&gt; pull(seconds)`</span> seconds elapsed during model-fitting with parallel processing. Not too bad. Unfortunately, though, some of the models failed (I suppressed error printing). So, before calibrating the models I'm going to drop those from the model output data set. But first I'll investigate the model failures a little.</span>
<span id="cb28-410"><a href="#cb28-410"></a></span>
<span id="cb28-411"><a href="#cb28-411"></a><span class="fu">## Investigating failed models</span></span>
<span id="cb28-412"><a href="#cb28-412"></a></span>
<span id="cb28-413"><a href="#cb28-413"></a>Here's a look at some of the models that failed.</span>
<span id="cb28-414"><a href="#cb28-414"></a></span>
<span id="cb28-417"><a href="#cb28-417"></a><span class="in">```{r}</span></span>
<span id="cb28-418"><a href="#cb28-418"></a><span class="co">#| label: make-mod-fail-df</span></span>
<span id="cb28-419"><a href="#cb28-419"></a></span>
<span id="cb28-420"><a href="#cb28-420"></a>mod_fail_df <span class="ot">&lt;-</span> hpi_mods <span class="sc">|&gt;</span></span>
<span id="cb28-421"><a href="#cb28-421"></a>  <span class="fu">mutate</span>(<span class="at">mod_fail =</span> <span class="fu">map_lgl</span>(.model, \(x) <span class="fu">is.null</span>(x))) <span class="sc">|&gt;</span></span>
<span id="cb28-422"><a href="#cb28-422"></a>  <span class="fu">select</span>(<span class="sc">!</span>.model)</span>
<span id="cb28-423"><a href="#cb28-423"></a></span>
<span id="cb28-424"><a href="#cb28-424"></a>mod_fail_df <span class="sc">|&gt;</span></span>
<span id="cb28-425"><a href="#cb28-425"></a>  <span class="fu">group_by</span>(mod_fail) <span class="sc">|&gt;</span></span>
<span id="cb28-426"><a href="#cb28-426"></a>  <span class="fu">slice_min</span>(.model_id, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-427"><a href="#cb28-427"></a>  <span class="fu">gt</span>(<span class="at">groupname_col =</span> <span class="cn">NULL</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-428"><a href="#cb28-428"></a>  <span class="fu">gt_bold_head</span>()</span>
<span id="cb28-429"><a href="#cb28-429"></a></span>
<span id="cb28-430"><a href="#cb28-430"></a><span class="in">```</span></span>
<span id="cb28-431"><a href="#cb28-431"></a></span>
<span id="cb28-432"><a href="#cb28-432"></a>Now I want to see the distinct names of the recipes and algorithms (model specifications) that failed.</span>
<span id="cb28-433"><a href="#cb28-433"></a></span>
<span id="cb28-436"><a href="#cb28-436"></a><span class="in">```{r}</span></span>
<span id="cb28-437"><a href="#cb28-437"></a><span class="co">#| label: get-failed-mod-names</span></span>
<span id="cb28-438"><a href="#cb28-438"></a></span>
<span id="cb28-439"><a href="#cb28-439"></a>failure_spec_df <span class="ot">&lt;-</span> mod_fail_df <span class="sc">|&gt;</span></span>
<span id="cb28-440"><a href="#cb28-440"></a>  <span class="fu">filter</span>(mod_fail) <span class="sc">|&gt;</span></span>
<span id="cb28-441"><a href="#cb28-441"></a>  <span class="fu">separate_wider_delim</span>(</span>
<span id="cb28-442"><a href="#cb28-442"></a>    .model_desc,</span>
<span id="cb28-443"><a href="#cb28-443"></a>    <span class="at">delim =</span> <span class="st">"_"</span>,</span>
<span id="cb28-444"><a href="#cb28-444"></a>    <span class="at">names =</span> <span class="fu">c</span>(<span class="st">"rec_name"</span>, <span class="st">"rec"</span>, <span class="st">"algo"</span>, <span class="st">"spec"</span>)</span>
<span id="cb28-445"><a href="#cb28-445"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb28-446"><a href="#cb28-446"></a>  <span class="fu">separate_wider_regex</span>(spec, <span class="at">patterns =</span> <span class="fu">c</span>(<span class="at">spec =</span> <span class="st">"SPEC"</span>, <span class="at">spec_num =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>))</span>
<span id="cb28-447"><a href="#cb28-447"></a></span>
<span id="cb28-448"><a href="#cb28-448"></a>failure_spec_df <span class="sc">|&gt;</span> <span class="fu">distinct</span>(rec_name, algo, spec) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span>
<span id="cb28-449"><a href="#cb28-449"></a></span>
<span id="cb28-450"><a href="#cb28-450"></a><span class="in">```</span></span>
<span id="cb28-451"><a href="#cb28-451"></a></span>
<span id="cb28-452"><a href="#cb28-452"></a>Since the failures occurred with only one algorithm they'll be easy to isolate. Now I want to get the numbers of the specifications that failed so that I can pull up the details on those specifications.</span>
<span id="cb28-453"><a href="#cb28-453"></a></span>
<span id="cb28-456"><a href="#cb28-456"></a><span class="in">```{r}</span></span>
<span id="cb28-457"><a href="#cb28-457"></a><span class="co">#| label: get-failed-spec-nums</span></span>
<span id="cb28-458"><a href="#cb28-458"></a></span>
<span id="cb28-459"><a href="#cb28-459"></a>failures <span class="ot">&lt;-</span> failure_spec_df <span class="sc">|&gt;</span></span>
<span id="cb28-460"><a href="#cb28-460"></a>  <span class="fu">pull</span>(spec_num) <span class="sc">|&gt;</span></span>
<span id="cb28-461"><a href="#cb28-461"></a>  <span class="fu">as.numeric</span>()</span>
<span id="cb28-462"><a href="#cb28-462"></a></span>
<span id="cb28-463"><a href="#cb28-463"></a>ets_failed <span class="ot">&lt;-</span> ets_spec_grid <span class="sc">|&gt;</span></span>
<span id="cb28-464"><a href="#cb28-464"></a>  <span class="fu">slice</span>(failures) <span class="sc">|&gt;</span></span>
<span id="cb28-465"><a href="#cb28-465"></a>  <span class="fu">select</span>(<span class="sc">!</span>.models)</span>
<span id="cb28-466"><a href="#cb28-466"></a></span>
<span id="cb28-467"><a href="#cb28-467"></a>ets_failed <span class="sc">|&gt;</span></span>
<span id="cb28-468"><a href="#cb28-468"></a>  <span class="fu">count</span>(smooth_level) <span class="sc">|&gt;</span></span>
<span id="cb28-469"><a href="#cb28-469"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-470"><a href="#cb28-470"></a>  <span class="fu">gt_bold_head</span>()</span>
<span id="cb28-471"><a href="#cb28-471"></a></span>
<span id="cb28-472"><a href="#cb28-472"></a><span class="in">```</span></span>
<span id="cb28-473"><a href="#cb28-473"></a></span>
<span id="cb28-474"><a href="#cb28-474"></a>Overall there were <span class="in">`r nrow(failure_spec_df)`</span> out of <span class="in">`r nrow(ets_spec_grid)`</span> failed exponential smoothing models. That's not terrible. I'm going to remove these specifications from the trained model data set and move on to model evaluation.</span>
<span id="cb28-475"><a href="#cb28-475"></a></span>
<span id="cb28-476"><a href="#cb28-476"></a><span class="fu">## Model evaluation</span></span>
<span id="cb28-477"><a href="#cb28-477"></a></span>
<span id="cb28-478"><a href="#cb28-478"></a>To evaluate the models first I need to calibrate them. I'll remove the failed models, calibrate the successful ones, and store accuracy tables here. Below are the 10 best-performing global models, i.e., the ones that performed best on the batched series with all four cities. I defined "best" as the models with the lowest SMAPE (Scaled Mean Average Percent Error) values.</span>
<span id="cb28-479"><a href="#cb28-479"></a></span>
<span id="cb28-480"><a href="#cb28-480"></a>::: {.callout-note collapse="true" title="Breaking up calibration step"}</span>
<span id="cb28-481"><a href="#cb28-481"></a>I broke up the code for calibrating the models below into two separate chunks to keep the file sizes of cached files a bit smaller. I cached the output to make the page easier to render. This step of splitting up the <span class="in">`modeltime_table`</span> for calibration is not typically necessary.</span>
<span id="cb28-482"><a href="#cb28-482"></a>:::</span>
<span id="cb28-483"><a href="#cb28-483"></a></span>
<span id="cb28-486"><a href="#cb28-486"></a><span class="in">```{r}</span></span>
<span id="cb28-487"><a href="#cb28-487"></a><span class="co">#| label: filter-mods</span></span>
<span id="cb28-488"><a href="#cb28-488"></a></span>
<span id="cb28-489"><a href="#cb28-489"></a>hpi_mods <span class="ot">&lt;-</span> hpi_mods <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="fu">which</span>(<span class="sc">!</span>mod_fail_df<span class="sc">$</span>mod_fail))</span>
<span id="cb28-490"><a href="#cb28-490"></a></span>
<span id="cb28-491"><a href="#cb28-491"></a>num_mods <span class="ot">&lt;-</span> <span class="fu">nrow</span>(hpi_mods)</span>
<span id="cb28-492"><a href="#cb28-492"></a>hpi_mod_idx <span class="ot">&lt;-</span> <span class="fu">split</span>(<span class="dv">1</span><span class="sc">:</span>num_mods, <span class="fu">ceiling</span>(<span class="fu">seq_along</span>(<span class="dv">1</span><span class="sc">:</span>num_mods) <span class="sc">/</span> (num_mods <span class="sc">/</span> <span class="dv">3</span>)))</span>
<span id="cb28-493"><a href="#cb28-493"></a></span>
<span id="cb28-494"><a href="#cb28-494"></a><span class="in">```</span></span>
<span id="cb28-495"><a href="#cb28-495"></a></span>
<span id="cb28-498"><a href="#cb28-498"></a><span class="in">```{r}</span></span>
<span id="cb28-499"><a href="#cb28-499"></a><span class="co">#| label: calibrate-mods1</span></span>
<span id="cb28-500"><a href="#cb28-500"></a><span class="co">#| cache: true</span></span>
<span id="cb28-501"><a href="#cb28-501"></a></span>
<span id="cb28-502"><a href="#cb28-502"></a>hpi_mod_calib1 <span class="ot">&lt;-</span> hpi_mods <span class="sc">|&gt;</span></span>
<span id="cb28-503"><a href="#cb28-503"></a>  <span class="fu">slice</span>(hpi_mod_idx[[<span class="dv">1</span>]]) <span class="sc">|&gt;</span></span>
<span id="cb28-504"><a href="#cb28-504"></a>  <span class="fu">modeltime_calibrate</span>(<span class="fu">testing</span>(econ_splits), <span class="at">id =</span> <span class="st">"city"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-505"><a href="#cb28-505"></a></span>
<span id="cb28-506"><a href="#cb28-506"></a><span class="in">```</span></span>
<span id="cb28-507"><a href="#cb28-507"></a></span>
<span id="cb28-510"><a href="#cb28-510"></a><span class="in">```{r}</span></span>
<span id="cb28-511"><a href="#cb28-511"></a><span class="co">#| label: calibrate-mods2</span></span>
<span id="cb28-512"><a href="#cb28-512"></a><span class="co">#| cache: true</span></span>
<span id="cb28-513"><a href="#cb28-513"></a></span>
<span id="cb28-514"><a href="#cb28-514"></a>hpi_mod_calib2 <span class="ot">&lt;-</span> hpi_mods <span class="sc">|&gt;</span></span>
<span id="cb28-515"><a href="#cb28-515"></a>  <span class="fu">slice</span>(hpi_mod_idx[[<span class="dv">2</span>]]) <span class="sc">|&gt;</span></span>
<span id="cb28-516"><a href="#cb28-516"></a>  <span class="fu">modeltime_calibrate</span>(<span class="fu">testing</span>(econ_splits), <span class="at">id =</span> <span class="st">"city"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-517"><a href="#cb28-517"></a><span class="in">```</span></span>
<span id="cb28-518"><a href="#cb28-518"></a></span>
<span id="cb28-521"><a href="#cb28-521"></a><span class="in">```{r}</span></span>
<span id="cb28-522"><a href="#cb28-522"></a><span class="co">#| label: calibrate-mods3</span></span>
<span id="cb28-523"><a href="#cb28-523"></a><span class="co">#| cache: true</span></span>
<span id="cb28-524"><a href="#cb28-524"></a></span>
<span id="cb28-525"><a href="#cb28-525"></a>hpi_mod_calib3 <span class="ot">&lt;-</span> hpi_mods <span class="sc">|&gt;</span></span>
<span id="cb28-526"><a href="#cb28-526"></a>  <span class="fu">slice</span>(hpi_mod_idx[[<span class="dv">3</span>]]) <span class="sc">|&gt;</span></span>
<span id="cb28-527"><a href="#cb28-527"></a>  <span class="fu">modeltime_calibrate</span>(<span class="fu">testing</span>(econ_splits), <span class="at">id =</span> <span class="st">"city"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-528"><a href="#cb28-528"></a></span>
<span id="cb28-529"><a href="#cb28-529"></a><span class="in">```</span></span>
<span id="cb28-530"><a href="#cb28-530"></a></span>
<span id="cb28-533"><a href="#cb28-533"></a><span class="in">```{r}</span></span>
<span id="cb28-534"><a href="#cb28-534"></a><span class="co">#| label: combine-calib-tbls</span></span>
<span id="cb28-535"><a href="#cb28-535"></a></span>
<span id="cb28-536"><a href="#cb28-536"></a>hpi_mod_calib <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(hpi_mod_calib1, hpi_mod_calib2)</span>
<span id="cb28-537"><a href="#cb28-537"></a></span>
<span id="cb28-538"><a href="#cb28-538"></a><span class="in">```</span></span>
<span id="cb28-539"><a href="#cb28-539"></a></span>
<span id="cb28-542"><a href="#cb28-542"></a><span class="in">```{r}</span></span>
<span id="cb28-543"><a href="#cb28-543"></a><span class="co">#| label: get-mod-accuracy</span></span>
<span id="cb28-544"><a href="#cb28-544"></a></span>
<span id="cb28-545"><a href="#cb28-545"></a>hpi_mod_accuracy <span class="ot">&lt;-</span> hpi_mod_calib <span class="sc">|&gt;</span></span>
<span id="cb28-546"><a href="#cb28-546"></a>  <span class="fu">modeltime_accuracy</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-547"><a href="#cb28-547"></a>  <span class="fu">drop_na</span>(.type)</span>
<span id="cb28-548"><a href="#cb28-548"></a></span>
<span id="cb28-549"><a href="#cb28-549"></a>hpi_local_mod_accuracy <span class="ot">&lt;-</span> hpi_mod_calib <span class="sc">|&gt;</span></span>
<span id="cb28-550"><a href="#cb28-550"></a>  <span class="fu">modeltime_accuracy</span>(<span class="at">acc_by_id =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-551"><a href="#cb28-551"></a>  <span class="fu">drop_na</span>(.type)</span>
<span id="cb28-552"><a href="#cb28-552"></a></span>
<span id="cb28-553"><a href="#cb28-553"></a>best_global_table <span class="ot">&lt;-</span> hpi_mod_accuracy <span class="sc">|&gt;</span></span>
<span id="cb28-554"><a href="#cb28-554"></a>  <span class="fu">slice_min</span>(smape, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb28-555"><a href="#cb28-555"></a></span>
<span id="cb28-556"><a href="#cb28-556"></a>best_local_table <span class="ot">&lt;-</span> hpi_local_mod_accuracy <span class="sc">|&gt;</span></span>
<span id="cb28-557"><a href="#cb28-557"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb28-558"><a href="#cb28-558"></a>  <span class="fu">slice_min</span>(smape, <span class="at">n =</span> <span class="dv">3</span>)</span>
<span id="cb28-559"><a href="#cb28-559"></a></span>
<span id="cb28-560"><a href="#cb28-560"></a>best_global_table <span class="sc">|&gt;</span></span>
<span id="cb28-561"><a href="#cb28-561"></a>  <span class="fu">table_modeltime_accuracy</span>(</span>
<span id="cb28-562"><a href="#cb28-562"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-563"><a href="#cb28-563"></a>    <span class="at">.title =</span> <span class="st">"Global Accuracy"</span></span>
<span id="cb28-564"><a href="#cb28-564"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb28-565"><a href="#cb28-565"></a>  <span class="fu">gt_bold_head</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-566"><a href="#cb28-566"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb28-567"><a href="#cb28-567"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>),</span>
<span id="cb28-568"><a href="#cb28-568"></a>    <span class="at">locations =</span> <span class="fu">cells_title</span>()</span>
<span id="cb28-569"><a href="#cb28-569"></a>  )</span>
<span id="cb28-570"><a href="#cb28-570"></a></span>
<span id="cb28-571"><a href="#cb28-571"></a><span class="in">```</span></span>
<span id="cb28-572"><a href="#cb28-572"></a></span>
<span id="cb28-573"><a href="#cb28-573"></a>Next is a table with the best 3 models calibrated to each city.</span>
<span id="cb28-574"><a href="#cb28-574"></a></span>
<span id="cb28-577"><a href="#cb28-577"></a><span class="in">```{r}</span></span>
<span id="cb28-578"><a href="#cb28-578"></a><span class="co">#| label: show-best-local-mods</span></span>
<span id="cb28-579"><a href="#cb28-579"></a></span>
<span id="cb28-580"><a href="#cb28-580"></a>best_local_table<span class="sc">|&gt;</span></span>
<span id="cb28-581"><a href="#cb28-581"></a>  <span class="fu">table_modeltime_accuracy</span>(</span>
<span id="cb28-582"><a href="#cb28-582"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-583"><a href="#cb28-583"></a>    <span class="at">.title =</span> <span class="st">"Accuracy by City"</span></span>
<span id="cb28-584"><a href="#cb28-584"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb28-585"><a href="#cb28-585"></a>  <span class="fu">gt_bold_head</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-586"><a href="#cb28-586"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb28-587"><a href="#cb28-587"></a>    <span class="at">style =</span> <span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>),</span>
<span id="cb28-588"><a href="#cb28-588"></a>    <span class="at">locations =</span> <span class="fu">cells_title</span>()</span>
<span id="cb28-589"><a href="#cb28-589"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb28-590"><a href="#cb28-590"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb28-591"><a href="#cb28-591"></a>    <span class="at">style =</span> <span class="fu">list</span>(<span class="fu">cell_text</span>(<span class="at">weight =</span> <span class="st">"bold"</span>), <span class="fu">cell_fill</span>(<span class="at">color =</span> <span class="st">"lightgray"</span>)),</span>
<span id="cb28-592"><a href="#cb28-592"></a>    <span class="at">locations =</span> <span class="fu">cells_group</span>()</span>
<span id="cb28-593"><a href="#cb28-593"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb28-594"><a href="#cb28-594"></a>  <span class="fu">tab_style</span>(</span>
<span id="cb28-595"><a href="#cb28-595"></a>    <span class="at">style =</span> <span class="fu">cell_borders</span>(</span>
<span id="cb28-596"><a href="#cb28-596"></a>      <span class="at">sides =</span> <span class="fu">c</span>(<span class="st">"top"</span>, <span class="st">"bottom"</span>),</span>
<span id="cb28-597"><a href="#cb28-597"></a>      <span class="at">weight =</span> <span class="fu">px</span>(<span class="dv">2</span>),</span>
<span id="cb28-598"><a href="#cb28-598"></a>      <span class="at">style =</span> (<span class="st">"solid"</span>)</span>
<span id="cb28-599"><a href="#cb28-599"></a>    ),</span>
<span id="cb28-600"><a href="#cb28-600"></a>    <span class="at">locations =</span> <span class="fu">cells_group</span>()</span>
<span id="cb28-601"><a href="#cb28-601"></a>  )</span>
<span id="cb28-602"><a href="#cb28-602"></a></span>
<span id="cb28-603"><a href="#cb28-603"></a><span class="in">```</span></span>
<span id="cb28-604"><a href="#cb28-604"></a></span>
<span id="cb28-605"><a href="#cb28-605"></a>There's a pretty good mix of models across the two tables including ARIMA, ETS (lots of this one), STLM, and neural-net. Among the ARIMA models there were some with the basic recipe and some with the recipe that included both economic and demographic variables.</span>
<span id="cb28-606"><a href="#cb28-606"></a></span>
<span id="cb28-607"><a href="#cb28-607"></a>Below are plots of forecasts of the test data period for each city using the best 3 global models.</span>
<span id="cb28-608"><a href="#cb28-608"></a></span>
<span id="cb28-611"><a href="#cb28-611"></a><span class="in">```{r}</span></span>
<span id="cb28-612"><a href="#cb28-612"></a><span class="co">#| label: fig-acc</span></span>
<span id="cb28-613"><a href="#cb28-613"></a></span>
<span id="cb28-614"><a href="#cb28-614"></a>top_3_global <span class="ot">&lt;-</span> best_global_table <span class="sc">|&gt;</span> <span class="fu">slice_min</span>(smape, <span class="at">n =</span> <span class="dv">3</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(.model_id)</span>
<span id="cb28-615"><a href="#cb28-615"></a></span>
<span id="cb28-616"><a href="#cb28-616"></a>hpi_mod_calib <span class="sc">|&gt;</span></span>
<span id="cb28-617"><a href="#cb28-617"></a>  <span class="fu">filter</span>(.model_id <span class="sc">%in%</span> top_3_global) <span class="sc">|&gt;</span>                            </span>
<span id="cb28-618"><a href="#cb28-618"></a>  <span class="fu">modeltime_forecast</span>(                            </span>
<span id="cb28-619"><a href="#cb28-619"></a>    <span class="at">new_data =</span> <span class="fu">testing</span>(econ_splits),      </span>
<span id="cb28-620"><a href="#cb28-620"></a>    <span class="at">actual_data =</span> econ_data,                     </span>
<span id="cb28-621"><a href="#cb28-621"></a>    <span class="at">conf_by_id =</span> <span class="cn">TRUE</span>,                           </span>
<span id="cb28-622"><a href="#cb28-622"></a>    <span class="at">keep_data =</span> <span class="cn">TRUE</span>                             </span>
<span id="cb28-623"><a href="#cb28-623"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb28-624"><a href="#cb28-624"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span>                             </span>
<span id="cb28-625"><a href="#cb28-625"></a>  <span class="fu">plot_modeltime_forecast</span>(                      </span>
<span id="cb28-626"><a href="#cb28-626"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-627"><a href="#cb28-627"></a>    <span class="at">.title =</span> <span class="st">"Forecast of Test Data"</span>,</span>
<span id="cb28-628"><a href="#cb28-628"></a>    <span class="at">.facet_ncol =</span> <span class="dv">1</span></span>
<span id="cb28-629"><a href="#cb28-629"></a>  ) <span class="sc">+</span></span>
<span id="cb28-630"><a href="#cb28-630"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb28-631"><a href="#cb28-631"></a></span>
<span id="cb28-632"><a href="#cb28-632"></a><span class="in">```</span></span>
<span id="cb28-633"><a href="#cb28-633"></a></span>
<span id="cb28-634"><a href="#cb28-634"></a>Just for fun, here are the 5 worst-performing models (global).</span>
<span id="cb28-635"><a href="#cb28-635"></a></span>
<span id="cb28-638"><a href="#cb28-638"></a><span class="in">```{r}</span></span>
<span id="cb28-639"><a href="#cb28-639"></a><span class="co">#| label: show-worst-mods</span></span>
<span id="cb28-640"><a href="#cb28-640"></a></span>
<span id="cb28-641"><a href="#cb28-641"></a>hpi_mod_accuracy <span class="sc">|&gt;</span></span>
<span id="cb28-642"><a href="#cb28-642"></a>  <span class="fu">slice_max</span>(smape, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-643"><a href="#cb28-643"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-644"><a href="#cb28-644"></a>  <span class="fu">gt_bold_head</span>()</span>
<span id="cb28-645"><a href="#cb28-645"></a></span>
<span id="cb28-646"><a href="#cb28-646"></a><span class="in">```</span></span>
<span id="cb28-647"><a href="#cb28-647"></a></span>
<span id="cb28-648"><a href="#cb28-648"></a><span class="fu">## Forecasting with global models</span></span>
<span id="cb28-649"><a href="#cb28-649"></a></span>
<span id="cb28-650"><a href="#cb28-650"></a>Below are forecasts for each city using the top 3 global models.</span>
<span id="cb28-651"><a href="#cb28-651"></a></span>
<span id="cb28-654"><a href="#cb28-654"></a><span class="in">```{r}</span></span>
<span id="cb28-655"><a href="#cb28-655"></a><span class="co">#| label: forecast-global</span></span>
<span id="cb28-656"><a href="#cb28-656"></a></span>
<span id="cb28-657"><a href="#cb28-657"></a>hpi_refit <span class="ot">&lt;-</span> hpi_mod_calib <span class="sc">|&gt;</span></span>
<span id="cb28-658"><a href="#cb28-658"></a>  <span class="fu">filter</span>(.model_id <span class="sc">%in%</span> top_3_global) <span class="sc">|&gt;</span></span>
<span id="cb28-659"><a href="#cb28-659"></a>  <span class="fu">modeltime_refit</span>(<span class="at">data =</span> econ_data) </span>
<span id="cb28-660"><a href="#cb28-660"></a></span>
<span id="cb28-661"><a href="#cb28-661"></a>hpi_future <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="cb28-662"><a href="#cb28-662"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb28-663"><a href="#cb28-663"></a>  <span class="fu">future_frame</span>(<span class="at">.length_out =</span> <span class="dv">12</span>, <span class="at">.bind_data =</span> <span class="cn">FALSE</span>, <span class="at">.date_var =</span> date)</span>
<span id="cb28-664"><a href="#cb28-664"></a></span>
<span id="cb28-665"><a href="#cb28-665"></a>hpi_future_forecast <span class="ot">&lt;-</span> hpi_refit <span class="sc">|&gt;</span></span>
<span id="cb28-666"><a href="#cb28-666"></a>  <span class="fu">modeltime_forecast</span>(</span>
<span id="cb28-667"><a href="#cb28-667"></a>    <span class="at">new_data =</span> hpi_future,</span>
<span id="cb28-668"><a href="#cb28-668"></a>    <span class="at">actual_data =</span> econ_data,</span>
<span id="cb28-669"><a href="#cb28-669"></a>    <span class="at">conf_by_id =</span> <span class="cn">TRUE</span></span>
<span id="cb28-670"><a href="#cb28-670"></a>  )</span>
<span id="cb28-671"><a href="#cb28-671"></a></span>
<span id="cb28-672"><a href="#cb28-672"></a>hpi_future_forecast <span class="sc">|&gt;</span></span>
<span id="cb28-673"><a href="#cb28-673"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb28-674"><a href="#cb28-674"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="cb28-675"><a href="#cb28-675"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb28-676"><a href="#cb28-676"></a>    <span class="at">.title =</span> <span class="st">"1 Year Forecast into the Future - Global"</span>,</span>
<span id="cb28-677"><a href="#cb28-677"></a>    <span class="at">.facet_ncol =</span> <span class="dv">1</span></span>
<span id="cb28-678"><a href="#cb28-678"></a>  ) <span class="sc">+</span></span>
<span id="cb28-679"><a href="#cb28-679"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb28-680"><a href="#cb28-680"></a></span>
<span id="cb28-681"><a href="#cb28-681"></a><span class="in">```</span></span>
<span id="cb28-682"><a href="#cb28-682"></a></span>
<span id="cb28-683"><a href="#cb28-683"></a><span class="fu">## Choosing models for iterative process</span></span>
<span id="cb28-684"><a href="#cb28-684"></a></span>
<span id="cb28-685"><a href="#cb28-685"></a>For iterative modeling I'm going to use the 10 best global models and the 3 best local models for each city. The specifications that I'm going to use for iterative modeling in the next post are:</span>
<span id="cb28-686"><a href="#cb28-686"></a></span>
<span id="cb28-689"><a href="#cb28-689"></a><span class="in">```{r}</span></span>
<span id="cb28-690"><a href="#cb28-690"></a><span class="co">#| label: store-best-specs</span></span>
<span id="cb28-691"><a href="#cb28-691"></a></span>
<span id="cb28-692"><a href="#cb28-692"></a>best_global_table <span class="sc">|&gt;</span></span>
<span id="cb28-693"><a href="#cb28-693"></a>  <span class="fu">slice_min</span>(smape, <span class="at">n =</span> <span class="dv">5</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-694"><a href="#cb28-694"></a>  <span class="fu">bind_rows</span>(best_local_table) <span class="sc">|&gt;</span></span>
<span id="cb28-695"><a href="#cb28-695"></a>  <span class="fu">distinct</span>(.model_desc) <span class="sc">|&gt;</span></span>
<span id="cb28-696"><a href="#cb28-696"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb28-697"><a href="#cb28-697"></a>  <span class="fu">gt_bold_head</span>()</span>
<span id="cb28-698"><a href="#cb28-698"></a></span>
<span id="cb28-699"><a href="#cb28-699"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>