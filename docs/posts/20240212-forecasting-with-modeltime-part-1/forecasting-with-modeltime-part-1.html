<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arcenis Rojas">
<meta name="dcterms.date" content="2024-02-12">

<title>Forecasting with {modeltime} - Part I – Arcenis Rojas</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dc55a5b9e770e841cd82e46aadbfb9b0.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-c70c0031252f74d50129453a9c8e908e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Arcenis Rojas</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Personal Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../dashboards.html"> 
<span class="menu-text">Dashboards</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/arcenisrojas" target="_blank"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/arcenis-r" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#choosing-house-price-data" id="toc-choosing-house-price-data" class="nav-link" data-scroll-target="#choosing-house-price-data">Choosing house price data</a></li>
  <li><a href="#additional-data" id="toc-additional-data" class="nav-link" data-scroll-target="#additional-data">Additional data</a></li>
  <li><a href="#loading-packages" id="toc-loading-packages" class="nav-link" data-scroll-target="#loading-packages">Loading Packages</a></li>
  <li><a href="#getting-case-shiller-hpi-data" id="toc-getting-case-shiller-hpi-data" class="nav-link" data-scroll-target="#getting-case-shiller-hpi-data">Getting Case-Shiller HPI data</a></li>
  <li><a href="#getting-unemployment-rate-and-gas-price-data-from-fred" id="toc-getting-unemployment-rate-and-gas-price-data-from-fred" class="nav-link" data-scroll-target="#getting-unemployment-rate-and-gas-price-data-from-fred">Getting unemployment rate and gas price data from FRED</a></li>
  <li><a href="#getting-cps-data" id="toc-getting-cps-data" class="nav-link" data-scroll-target="#getting-cps-data">Getting CPS data</a></li>
  <li><a href="#getting-population-data" id="toc-getting-population-data" class="nav-link" data-scroll-target="#getting-population-data">Getting population data</a></li>
  <li><a href="#merge-data-and-check" id="toc-merge-data-and-check" class="nav-link" data-scroll-target="#merge-data-and-check">Merge data and check</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Forecasting with {modeltime} - Part I</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Gathering data</p>
  <div class="quarto-categories">
    <div class="quarto-category">Time Series</div>
    <div class="quarto-category">Data Acquisition</div>
    <div class="quarto-category">Data Wrangling</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arcenis Rojas </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 12, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://www.flickr.com/photos/59937401@N07/5474453551"><img src="images/5474453551_afc6ded9af_w.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Monopoly houses on top of increasingly tall stacks of coins"></a></p>
</figure>
</div>
<figcaption>Image by [Images Money](https://www.flickr.com/photos/59937401@N07/)</figcaption>
</figure>
</div>
<p>I learned about the <a href="https://business-science.github.io/modeltime/">modeltime</a> <span class="citation" data-cites="modeltime">(<a href="#ref-modeltime" role="doc-biblioref">Dancho 2023</a>)</span> package – developed by the folks at <a href="https://www.business-science.io/">Business Science</a> – in 2021 and hadn’t had much chance to use it except for a few small coding exercises. With U.S. housing prices have being <a href="https://www.forbes.com/advisor/mortgages/real-estate/housing-market-predictions/">all over the news</a> in recent times I thought about trying to forecast a housing price metric. My curiosity about housing price trends presented the perfect opportunity to take on a small project using <a href="https://business-science.github.io/modeltime/">modeltime</a>. My goal for this project will be to model multiple time series together using various algorithms through a global modeling process then select the best models from that process and use those algorithms to run an iterative modeling process on the time series to try to get the best forecasts.</p>
<p>I’ve broken this project into five parts:</p>
<ol type="1">
<li><p>Gathering Data</p></li>
<li><p>Time series analysis</p></li>
<li><p>ARIMA with global and iterative modeling processes</p></li>
<li><p>Global forecasting models</p></li>
<li><p>Iterative forecasting models</p></li>
</ol>
<p>This post will cover the first part: Gathering Data.</p>
</section>
<section id="choosing-house-price-data" class="level2">
<h2 class="anchored" data-anchor-id="choosing-house-price-data">Choosing house price data</h2>
<p>To perform this analysis, obviously the first thing I would need is a data set. I wanted data that had sufficient observations with enough granularity to be able to identify seasonality and level changes. I also wanted to compare time series across different regions or cities of the U.S. This meant getting data that was available at a regional/metropolitan level that went back at least 10 years with very few missing values (ideally none). I looked at the data available through the <a href="https://www.stlouisfed.org/">Federal Reserve Bank of St.&nbsp;Louis</a> which hosts one of the largest repositories of U.S. economic data available by using the <a href="https://sboysel.github.io/fredr/reference/fredr_series_search.html">fredr</a> <span class="citation" data-cites="fredr">(<a href="#ref-fredr" role="doc-biblioref">Boysel and Vaughan 2021</a>)</span> package and narrowed my search for data series down to either median home prices or the Case-Shiller Home Price Index. I chose the Case-Shiller HPI because I could get the data at the level of metro area rather than just U.S. region for a longer period of time, though there is the trade-off that this index only accounts for existing home sales. For my purposes this wasn’t a problem.</p>
<p>The Case-Shiller HPI data was available through 2023, but population data (discussed below) was available only through 2022 and there were some other issues with data from before 2006, so I got data starting in January 2006 and ending in December 2022.</p>
<p>Once I chose a data source, the next step was to choose cities. I wanted to compare cities from different regions of the U.S. that were different in other characteristics as well, e.g., population, climate, etc., to see how forecasts might differ. I chose San Diego, Dallas, Detroit, and New York City.</p>
</section>
<section id="additional-data" class="level2">
<h2 class="anchored" data-anchor-id="additional-data">Additional data</h2>
<p>One of the benefits of using <a href="https://business-science.github.io/modeltime/">modeltime</a> it has functions for running models beyond ARIMA such as Prophet and eXtreme Gradient Boosting (XGB) for time series. To take advantage of this I wanted to add some features to my data. I chose to add unemployment rates, average gas prices, variables relating to demographic composition, and population for each city at the monthly level. I got the unemployment rate and average gas prices through <a href="https://sboysel.github.io/fredr/reference/fredr_series_search.html">fredr</a>, population data from the U.S. Census’s American Community Survey (ACS) using the <a href="https://walker-data.com/tidycensus/">tidycensus</a> <span class="citation" data-cites="tidycensus">(<a href="#ref-tidycensus" role="doc-biblioref">Walker and Herman 2024</a>)</span> package, and other demographic data from the <a href="https://www.census.gov/programs-surveys/cps.html">Current Population Survey (CPS)</a> (which is a joint program of the U.S. Census and the U.S. Bureau of Labor Statistics) using the <a href="https://github.com/matt-saenz/cpsR">cpsR</a> <span class="citation" data-cites="cpsR">(<a href="#ref-cpsR" role="doc-biblioref">Saenz 2023</a>)</span> package.</p>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>Both <code>tidycensus</code> and <code>cpsR</code> require a <a href="https://api.census.gov/data/key_signup.html">U.S. Census API key</a>. This post will not go into detail on how to obtain a key or how to set it up for use with the relevant packages.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Statistical Area Definitions">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Statistical Area Definitions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Some of these data are at the metropolitan statistical area (MSA) level and others are at the core-based statistical area (CBSA) level. While these broadly overlap, which is why I didn’t make a big fuss about mixing them, they are technically different. The U.S. Census provides some definitions <a href="https://www.census.gov/topics/housing/housing-patterns/about/core-based-statistical-areas.html">here</a>.</p>
</div>
</div>
</div>
<p>As usual for me, I performed data importing and wrangling using various <a href="https://www.tidyverse.org/">tidyverse</a> <span class="citation" data-cites="tidyverse">(<a href="#ref-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span>package functions. I also used <a href="https://multidplyr.tidyverse.org/">multidplyr</a> <span class="citation" data-cites="multidplyr">(<a href="#ref-multidplyr" role="doc-biblioref">Wickham 2023</a>)</span> to perform some operations in parallel.</p>
</section>
<section id="loading-packages" class="level2">
<h2 class="anchored" data-anchor-id="loading-packages">Loading Packages</h2>
<p>To begin with, I first loaded my packages. I’ll include the <a href="https://gt.rstudio.com/">gt</a> package for displaying tables.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(fredr)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(cpsR)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="fu">library</span>(multidplyr)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"lag"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb1-10"><a href="#cb1-10"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"between"</span>, <span class="st">"dplyr"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="getting-case-shiller-hpi-data" class="level2">
<h2 class="anchored" data-anchor-id="getting-case-shiller-hpi-data">Getting Case-Shiller HPI data</h2>
<p>I started by getting the appropriate Case-Shiller HPI series IDs for my cities of interest.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>hpi_ids <span class="ot">&lt;-</span> <span class="fu">fredr_series_search_text</span>(<span class="st">"Case-Shiller"</span>) <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">filter</span>(</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="fu">str_detect</span>(</span>
<span id="cb2-4"><a href="#cb2-4"></a>      title,</span>
<span id="cb2-5"><a href="#cb2-5"></a>      <span class="st">"CA-San Diego|TX-Dallas|NY-New York|MI-Detroit Home Price Index"</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>    ),</span>
<span id="cb2-7"><a href="#cb2-7"></a>    seasonal_adjustment_short <span class="sc">%in%</span> <span class="st">"NSA"</span>,</span>
<span id="cb2-8"><a href="#cb2-8"></a>    frequency <span class="sc">%in%</span> <span class="st">"Monthly"</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">str_extract</span>(title, <span class="st">"New York|Dallas|San Diego|Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="fu">select</span>(city, id)</span>
<span id="cb2-12"><a href="#cb2-12"></a></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="fu">gt</span>(hpi_ids) <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="stwypfzekz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#stwypfzekz table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#stwypfzekz thead, #stwypfzekz tbody, #stwypfzekz tfoot, #stwypfzekz tr, #stwypfzekz td, #stwypfzekz th {
  border-style: none;
}

#stwypfzekz p {
  margin: 0;
  padding: 0;
}

#stwypfzekz .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#stwypfzekz .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#stwypfzekz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#stwypfzekz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#stwypfzekz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#stwypfzekz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#stwypfzekz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#stwypfzekz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#stwypfzekz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#stwypfzekz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#stwypfzekz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#stwypfzekz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#stwypfzekz .gt_spanner_row {
  border-bottom-style: hidden;
}

#stwypfzekz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#stwypfzekz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#stwypfzekz .gt_from_md > :first-child {
  margin-top: 0;
}

#stwypfzekz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#stwypfzekz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#stwypfzekz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#stwypfzekz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#stwypfzekz .gt_row_group_first td {
  border-top-width: 2px;
}

#stwypfzekz .gt_row_group_first th {
  border-top-width: 2px;
}

#stwypfzekz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#stwypfzekz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#stwypfzekz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#stwypfzekz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#stwypfzekz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#stwypfzekz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#stwypfzekz .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#stwypfzekz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#stwypfzekz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#stwypfzekz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#stwypfzekz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#stwypfzekz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#stwypfzekz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#stwypfzekz .gt_left {
  text-align: left;
}

#stwypfzekz .gt_center {
  text-align: center;
}

#stwypfzekz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#stwypfzekz .gt_font_normal {
  font-weight: normal;
}

#stwypfzekz .gt_font_bold {
  font-weight: bold;
}

#stwypfzekz .gt_font_italic {
  font-style: italic;
}

#stwypfzekz .gt_super {
  font-size: 65%;
}

#stwypfzekz .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#stwypfzekz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#stwypfzekz .gt_indent_1 {
  text-indent: 5px;
}

#stwypfzekz .gt_indent_2 {
  text-indent: 10px;
}

#stwypfzekz .gt_indent_3 {
  text-indent: 15px;
}

#stwypfzekz .gt_indent_4 {
  text-indent: 20px;
}

#stwypfzekz .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="city" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">city</th>
<th id="id" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">id</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="city">San Diego</td>
<td class="gt_row gt_left" headers="id">SDXRNSA</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_left" headers="id">DAXRNSA</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">New York</td>
<td class="gt_row gt_left" headers="id">NYXRNSA</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Detroit</td>
<td class="gt_row gt_left" headers="id">DEXRNSA</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Next I read in the Case-Shiller data and kept only the necessary variables.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>hpi_data <span class="ot">&lt;-</span> hpi_ids <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  <span class="fu">mutate</span>(</span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="at">data =</span> <span class="fu">map</span>(</span>
<span id="cb3-4"><a href="#cb3-4"></a>      id,</span>
<span id="cb3-5"><a href="#cb3-5"></a>      \(x) <span class="fu">fredr</span>(</span>
<span id="cb3-6"><a href="#cb3-6"></a>        <span class="at">series_id =</span> x,</span>
<span id="cb3-7"><a href="#cb3-7"></a>        <span class="at">observation_start =</span> <span class="fu">ymd</span>(<span class="st">"2006-01-01"</span>),</span>
<span id="cb3-8"><a href="#cb3-8"></a>        <span class="at">observation_end =</span> <span class="fu">ymd</span>(<span class="st">"2023-12-31"</span>),</span>
<span id="cb3-9"><a href="#cb3-9"></a>        <span class="at">frequency =</span> <span class="st">"m"</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>      )</span>
<span id="cb3-11"><a href="#cb3-11"></a>    )</span>
<span id="cb3-12"><a href="#cb3-12"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">|&gt;</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>  <span class="fu">unnest</span>(data) <span class="sc">|&gt;</span></span>
<span id="cb3-15"><a href="#cb3-15"></a>  <span class="fu">select</span>(city, date, <span class="at">hpi =</span> value)</span>
<span id="cb3-16"><a href="#cb3-16"></a></span>
<span id="cb3-17"><a href="#cb3-17"></a>hpi_data[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ] <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="rcreaxedvc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#rcreaxedvc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#rcreaxedvc thead, #rcreaxedvc tbody, #rcreaxedvc tfoot, #rcreaxedvc tr, #rcreaxedvc td, #rcreaxedvc th {
  border-style: none;
}

#rcreaxedvc p {
  margin: 0;
  padding: 0;
}

#rcreaxedvc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rcreaxedvc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#rcreaxedvc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rcreaxedvc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rcreaxedvc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rcreaxedvc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rcreaxedvc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rcreaxedvc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rcreaxedvc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rcreaxedvc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rcreaxedvc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rcreaxedvc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rcreaxedvc .gt_spanner_row {
  border-bottom-style: hidden;
}

#rcreaxedvc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#rcreaxedvc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rcreaxedvc .gt_from_md > :first-child {
  margin-top: 0;
}

#rcreaxedvc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rcreaxedvc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rcreaxedvc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#rcreaxedvc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#rcreaxedvc .gt_row_group_first td {
  border-top-width: 2px;
}

#rcreaxedvc .gt_row_group_first th {
  border-top-width: 2px;
}

#rcreaxedvc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rcreaxedvc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#rcreaxedvc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#rcreaxedvc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rcreaxedvc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rcreaxedvc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rcreaxedvc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#rcreaxedvc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rcreaxedvc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rcreaxedvc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rcreaxedvc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rcreaxedvc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rcreaxedvc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#rcreaxedvc .gt_left {
  text-align: left;
}

#rcreaxedvc .gt_center {
  text-align: center;
}

#rcreaxedvc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rcreaxedvc .gt_font_normal {
  font-weight: normal;
}

#rcreaxedvc .gt_font_bold {
  font-weight: bold;
}

#rcreaxedvc .gt_font_italic {
  font-style: italic;
}

#rcreaxedvc .gt_super {
  font-size: 65%;
}

#rcreaxedvc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#rcreaxedvc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#rcreaxedvc .gt_indent_1 {
  text-indent: 5px;
}

#rcreaxedvc .gt_indent_2 {
  text-indent: 10px;
}

#rcreaxedvc .gt_indent_3 {
  text-indent: 15px;
}

#rcreaxedvc .gt_indent_4 {
  text-indent: 20px;
}

#rcreaxedvc .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="city" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">city</th>
<th id="date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date</th>
<th id="hpi" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">hpi</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="hpi">121.9108</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-02-01</td>
<td class="gt_row gt_right" headers="hpi">121.3285</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-03-01</td>
<td class="gt_row gt_right" headers="hpi">121.5217</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-04-01</td>
<td class="gt_row gt_right" headers="hpi">122.3996</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-05-01</td>
<td class="gt_row gt_right" headers="hpi">123.2863</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-06-01</td>
<td class="gt_row gt_right" headers="hpi">124.4985</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-07-01</td>
<td class="gt_row gt_right" headers="hpi">125.3672</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-08-01</td>
<td class="gt_row gt_right" headers="hpi">125.7007</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-09-01</td>
<td class="gt_row gt_right" headers="hpi">125.1859</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-10-01</td>
<td class="gt_row gt_right" headers="hpi">124.5813</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="getting-unemployment-rate-and-gas-price-data-from-fred" class="level2">
<h2 class="anchored" data-anchor-id="getting-unemployment-rate-and-gas-price-data-from-fred">Getting unemployment rate and gas price data from FRED</h2>
<p>Next I got series IDs for both average gas prices and unemployment rates for all four cities and got the data for the appropriate time span.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Get average gas price for each CBSA by month</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>gas_ids <span class="ot">&lt;-</span> <span class="fu">fredr_series_search_text</span>(</span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="st">"Average Price: Gasoline, Unleaded Regular"</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>) <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="fu">filter</span>(</span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="fu">str_detect</span>(title, <span class="st">"New York|Dallas|San Diego|Detroit"</span>),</span>
<span id="cb4-7"><a href="#cb4-7"></a>    frequency <span class="sc">%in%</span> <span class="st">"Monthly"</span>,</span>
<span id="cb4-8"><a href="#cb4-8"></a>    seasonal_adjustment_short <span class="sc">%in%</span> <span class="st">"NSA"</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">str_extract</span>(title, <span class="st">"New York|Dallas|San Diego|Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-11"><a href="#cb4-11"></a>  <span class="fu">select</span>(city, id)</span>
<span id="cb4-12"><a href="#cb4-12"></a></span>
<span id="cb4-13"><a href="#cb4-13"></a>gas_data <span class="ot">&lt;-</span> gas_ids <span class="sc">|&gt;</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-15"><a href="#cb4-15"></a>    <span class="at">data =</span> <span class="fu">map</span>(</span>
<span id="cb4-16"><a href="#cb4-16"></a>      id,</span>
<span id="cb4-17"><a href="#cb4-17"></a>      \(x) <span class="fu">fredr</span>(</span>
<span id="cb4-18"><a href="#cb4-18"></a>        <span class="at">series_id =</span> x,</span>
<span id="cb4-19"><a href="#cb4-19"></a>        <span class="at">observation_start =</span> <span class="fu">ymd</span>(<span class="st">"2000-01-01"</span>),</span>
<span id="cb4-20"><a href="#cb4-20"></a>        <span class="at">observation_end =</span> <span class="fu">ymd</span>(<span class="st">"2023-12-31"</span>),</span>
<span id="cb4-21"><a href="#cb4-21"></a>        <span class="at">frequency =</span> <span class="st">"m"</span></span>
<span id="cb4-22"><a href="#cb4-22"></a>      )</span>
<span id="cb4-23"><a href="#cb4-23"></a>    )</span>
<span id="cb4-24"><a href="#cb4-24"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-25"><a href="#cb4-25"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">|&gt;</span></span>
<span id="cb4-26"><a href="#cb4-26"></a>  <span class="fu">unnest</span>(data) <span class="sc">|&gt;</span></span>
<span id="cb4-27"><a href="#cb4-27"></a>  <span class="fu">select</span>(city, date, <span class="at">avg_gas_price =</span> value)</span>
<span id="cb4-28"><a href="#cb4-28"></a></span>
<span id="cb4-29"><a href="#cb4-29"></a><span class="co"># Get average unemployment rate for each MSA by month</span></span>
<span id="cb4-30"><a href="#cb4-30"></a>unemp_ids <span class="ot">&lt;-</span> <span class="fu">fredr_series_search_text</span>(<span class="st">"Unemployment: Rate"</span>) <span class="sc">|&gt;</span></span>
<span id="cb4-31"><a href="#cb4-31"></a>  <span class="fu">filter</span>(</span>
<span id="cb4-32"><a href="#cb4-32"></a>    <span class="fu">str_detect</span>(title, <span class="st">"New York|Dallas|San Diego|Detroit"</span>),</span>
<span id="cb4-33"><a href="#cb4-33"></a>    frequency <span class="sc">%in%</span> <span class="st">"Monthly"</span>,</span>
<span id="cb4-34"><a href="#cb4-34"></a>    seasonal_adjustment_short <span class="sc">%in%</span> <span class="st">"NSA"</span></span>
<span id="cb4-35"><a href="#cb4-35"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-36"><a href="#cb4-36"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">str_extract</span>(title, <span class="st">"New York|Dallas|San Diego|Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb4-37"><a href="#cb4-37"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb4-38"><a href="#cb4-38"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-39"><a href="#cb4-39"></a>    <span class="at">rnum =</span> <span class="fu">n</span>(),</span>
<span id="cb4-40"><a href="#cb4-40"></a>    <span class="at">msa_str =</span> <span class="fu">str_detect</span>(title, <span class="st">"MSA"</span>)</span>
<span id="cb4-41"><a href="#cb4-41"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-42"><a href="#cb4-42"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb4-43"><a href="#cb4-43"></a>  <span class="fu">filter</span>(rnum <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> msa_str) <span class="sc">|&gt;</span></span>
<span id="cb4-44"><a href="#cb4-44"></a>  <span class="fu">select</span>(city, id)</span>
<span id="cb4-45"><a href="#cb4-45"></a></span>
<span id="cb4-46"><a href="#cb4-46"></a>unemp_data <span class="ot">&lt;-</span> unemp_ids <span class="sc">|&gt;</span></span>
<span id="cb4-47"><a href="#cb4-47"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-48"><a href="#cb4-48"></a>    <span class="at">data =</span> <span class="fu">map</span>(</span>
<span id="cb4-49"><a href="#cb4-49"></a>      id,</span>
<span id="cb4-50"><a href="#cb4-50"></a>      \(x) <span class="fu">fredr</span>(</span>
<span id="cb4-51"><a href="#cb4-51"></a>        <span class="at">series_id =</span> x,</span>
<span id="cb4-52"><a href="#cb4-52"></a>        <span class="at">observation_start =</span> <span class="fu">ymd</span>(<span class="st">"2000-01-01"</span>),</span>
<span id="cb4-53"><a href="#cb4-53"></a>        <span class="at">observation_end =</span> <span class="fu">ymd</span>(<span class="st">"2023-12-31"</span>),</span>
<span id="cb4-54"><a href="#cb4-54"></a>        <span class="at">frequency =</span> <span class="st">"m"</span></span>
<span id="cb4-55"><a href="#cb4-55"></a>      )</span>
<span id="cb4-56"><a href="#cb4-56"></a>    )</span>
<span id="cb4-57"><a href="#cb4-57"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb4-58"><a href="#cb4-58"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">|&gt;</span></span>
<span id="cb4-59"><a href="#cb4-59"></a>  <span class="fu">unnest</span>(data) <span class="sc">|&gt;</span></span>
<span id="cb4-60"><a href="#cb4-60"></a>  <span class="fu">select</span>(city, date, <span class="at">unemp_rate =</span> value)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="getting-cps-data" class="level2">
<h2 class="anchored" data-anchor-id="getting-cps-data">Getting CPS data</h2>
<p>Getting CPS data at the MSA level is a little more complicated than it is getting data series from FRED. CPS data can contain well over 100K rows for each month because the microdata are released at the household level and each data set has hundreds of variables. It also requires filtering and grouping the data by MSA code, which means getting the MSA codes that correspond to each MSA in my analysis. However, I knew that MSAs can change over time as population shifts. I felt confident that this wouldn’t be the case for my chosen cities because of their population sizes, but I wanted to check anyway. Finally, I did thought that pulling in all of that data at once then filtering and aggregating would be computationally inefficient and slow, so, instead, I wrote a function to perform all of the necessary operations and ran it in parallel. I chose the method that I did because most of the time was spent connecting to the CPS API. Once data are imported, the computations are fairly simple.</p>
<p>The first step was to get the MSA codes that corresponded to my cities of interest and check that I had a unique set across all of my years of interest. The data for these MSA codes came from the U.S. Census’s technical documentation page and MSA definitions only change once every few years.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>msa_code_tbl <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="sc">~</span>start_yr, <span class="sc">~</span>end_yr,</span>
<span id="cb5-3"><a href="#cb5-3"></a>  <span class="dv">2003</span>, <span class="dv">2006</span>,</span>
<span id="cb5-4"><a href="#cb5-4"></a>  <span class="dv">2007</span>, <span class="dv">2011</span>,</span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="dv">2012</span>, <span class="dv">2016</span>,</span>
<span id="cb5-6"><a href="#cb5-6"></a>  <span class="dv">2017</span>, <span class="dv">2021</span></span>
<span id="cb5-7"><a href="#cb5-7"></a>) <span class="sc">|&gt;</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-9"><a href="#cb5-9"></a>    <span class="at">suffix =</span> <span class="fu">str_sub</span>(start_yr, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb5-10"><a href="#cb5-10"></a>    <span class="at">msa_url =</span> <span class="fu">map_chr</span>(</span>
<span id="cb5-11"><a href="#cb5-11"></a>      suffix,</span>
<span id="cb5-12"><a href="#cb5-12"></a>      \(x) <span class="fu">str_c</span>(</span>
<span id="cb5-13"><a href="#cb5-13"></a>        <span class="st">"https://www2.census.gov/programs-surveys/cbp/technical-documentation/"</span>,</span>
<span id="cb5-14"><a href="#cb5-14"></a>        <span class="st">"reference/metro-area-geography-reference/msa_county_reference"</span>,</span>
<span id="cb5-15"><a href="#cb5-15"></a>        x,</span>
<span id="cb5-16"><a href="#cb5-16"></a>        <span class="st">".txt"</span></span>
<span id="cb5-17"><a href="#cb5-17"></a>      )</span>
<span id="cb5-18"><a href="#cb5-18"></a>    ),</span>
<span id="cb5-19"><a href="#cb5-19"></a>    <span class="at">msa_code_data =</span> <span class="fu">map</span>(</span>
<span id="cb5-20"><a href="#cb5-20"></a>      msa_url,</span>
<span id="cb5-21"><a href="#cb5-21"></a>      \(x) <span class="fu">read_delim</span>(x, <span class="at">delim =</span> <span class="st">","</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb5-22"><a href="#cb5-22"></a>        <span class="fu">filter</span>(</span>
<span id="cb5-23"><a href="#cb5-23"></a>          <span class="fu">str_detect</span>(</span>
<span id="cb5-24"><a href="#cb5-24"></a>            name_msa,</span>
<span id="cb5-25"><a href="#cb5-25"></a>            <span class="st">"Dallas.*TX|San Diego.*CA|New York.*NY|Detroit.*MI"</span></span>
<span id="cb5-26"><a href="#cb5-26"></a>          )</span>
<span id="cb5-27"><a href="#cb5-27"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb5-28"><a href="#cb5-28"></a>        <span class="fu">mutate</span>(</span>
<span id="cb5-29"><a href="#cb5-29"></a>          <span class="at">city =</span> <span class="fu">str_extract</span>(name_msa, <span class="st">"Dallas|New York|San Diego|Detroit"</span>),</span>
<span id="cb5-30"><a href="#cb5-30"></a>          <span class="at">msa =</span> <span class="fu">as.character</span>(msa)</span>
<span id="cb5-31"><a href="#cb5-31"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb5-32"><a href="#cb5-32"></a>        <span class="fu">distinct</span>(city, msa)</span>
<span id="cb5-33"><a href="#cb5-33"></a>    )</span>
<span id="cb5-34"><a href="#cb5-34"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb5-35"><a href="#cb5-35"></a>  <span class="fu">distinct</span>(msa_code_data) <span class="sc">|&gt;</span></span>
<span id="cb5-36"><a href="#cb5-36"></a>  <span class="fu">unnest</span>(msa_code_data)</span>
<span id="cb5-37"><a href="#cb5-37"></a></span>
<span id="cb5-38"><a href="#cb5-38"></a>msa_code_tbl <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="dybqbxvwdu" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#dybqbxvwdu table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dybqbxvwdu thead, #dybqbxvwdu tbody, #dybqbxvwdu tfoot, #dybqbxvwdu tr, #dybqbxvwdu td, #dybqbxvwdu th {
  border-style: none;
}

#dybqbxvwdu p {
  margin: 0;
  padding: 0;
}

#dybqbxvwdu .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dybqbxvwdu .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dybqbxvwdu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dybqbxvwdu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dybqbxvwdu .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dybqbxvwdu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dybqbxvwdu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dybqbxvwdu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dybqbxvwdu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dybqbxvwdu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dybqbxvwdu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dybqbxvwdu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dybqbxvwdu .gt_spanner_row {
  border-bottom-style: hidden;
}

#dybqbxvwdu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dybqbxvwdu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dybqbxvwdu .gt_from_md > :first-child {
  margin-top: 0;
}

#dybqbxvwdu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dybqbxvwdu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dybqbxvwdu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dybqbxvwdu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dybqbxvwdu .gt_row_group_first td {
  border-top-width: 2px;
}

#dybqbxvwdu .gt_row_group_first th {
  border-top-width: 2px;
}

#dybqbxvwdu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dybqbxvwdu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dybqbxvwdu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dybqbxvwdu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dybqbxvwdu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dybqbxvwdu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dybqbxvwdu .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dybqbxvwdu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dybqbxvwdu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dybqbxvwdu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dybqbxvwdu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dybqbxvwdu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dybqbxvwdu .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dybqbxvwdu .gt_left {
  text-align: left;
}

#dybqbxvwdu .gt_center {
  text-align: center;
}

#dybqbxvwdu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dybqbxvwdu .gt_font_normal {
  font-weight: normal;
}

#dybqbxvwdu .gt_font_bold {
  font-weight: bold;
}

#dybqbxvwdu .gt_font_italic {
  font-style: italic;
}

#dybqbxvwdu .gt_super {
  font-size: 65%;
}

#dybqbxvwdu .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dybqbxvwdu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dybqbxvwdu .gt_indent_1 {
  text-indent: 5px;
}

#dybqbxvwdu .gt_indent_2 {
  text-indent: 10px;
}

#dybqbxvwdu .gt_indent_3 {
  text-indent: 15px;
}

#dybqbxvwdu .gt_indent_4 {
  text-indent: 20px;
}

#dybqbxvwdu .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="city" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">city</th>
<th id="msa" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">msa</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="msa">19100</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Detroit</td>
<td class="gt_row gt_right" headers="msa">19820</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">New York</td>
<td class="gt_row gt_right" headers="msa">35620</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">San Diego</td>
<td class="gt_row gt_right" headers="msa">41740</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>In the next step I defined the function for importing, filtering, and aggregating CPS data.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>get_cps_summaries <span class="ot">&lt;-</span> <span class="cf">function</span>(cps_df, geographies) {</span>
<span id="cb6-2"><a href="#cb6-2"></a>  cps_df <span class="sc">|&gt;</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>    <span class="fu">rename</span>(<span class="at">hispanic =</span> <span class="fu">matches</span>(<span class="st">"hspnon"</span>), <span class="at">msa =</span> <span class="fu">starts_with</span>(<span class="st">"gt"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>    <span class="fu">filter</span>(msa <span class="sc">%in%</span> geographies) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>    <span class="fu">relocate</span>(msa, pwsswgt, prtage, pemaritl, peeduca, hispanic) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>    <span class="fu">mutate</span>(</span>
<span id="cb6-7"><a href="#cb6-7"></a>      <span class="at">msa =</span> <span class="fu">as.character</span>(msa),</span>
<span id="cb6-8"><a href="#cb6-8"></a>      <span class="at">pwsswgt =</span> <span class="fu">as.numeric</span>(pwsswgt),</span>
<span id="cb6-9"><a href="#cb6-9"></a>      <span class="fu">across</span>(prtage<span class="sc">:</span>hispanic, as.integer),</span>
<span id="cb6-10"><a href="#cb6-10"></a>      <span class="fu">across</span>(prtage<span class="sc">:</span>hispanic, \(x) <span class="fu">na_if</span>(x, <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb6-11"><a href="#cb6-11"></a>      <span class="at">age_lt_18 =</span> prtage <span class="sc">&lt;</span> <span class="dv">18</span>,</span>
<span id="cb6-12"><a href="#cb6-12"></a>      <span class="at">age_18_35 =</span> <span class="fu">between</span>(prtage, <span class="dv">18</span>, <span class="dv">35</span>),</span>
<span id="cb6-13"><a href="#cb6-13"></a>      <span class="at">age_36_65 =</span> <span class="fu">between</span>(prtage, <span class="dv">36</span>, <span class="dv">65</span>),</span>
<span id="cb6-14"><a href="#cb6-14"></a>      <span class="at">age_gt_65 =</span> prtage <span class="sc">&gt;</span> <span class="dv">65</span>,</span>
<span id="cb6-15"><a href="#cb6-15"></a>      <span class="at">educ_hs_less =</span> peeduca <span class="sc">&lt;</span> <span class="dv">40</span>,</span>
<span id="cb6-16"><a href="#cb6-16"></a>      <span class="at">educ_college =</span> peeduca <span class="sc">%in%</span> <span class="dv">40</span><span class="sc">:</span><span class="dv">43</span>,</span>
<span id="cb6-17"><a href="#cb6-17"></a>      <span class="at">educ_grad =</span> peeduca <span class="sc">&gt;</span> <span class="dv">43</span>,</span>
<span id="cb6-18"><a href="#cb6-18"></a>      <span class="at">status_married =</span> pemaritl <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb6-19"><a href="#cb6-19"></a>      <span class="at">status_nev_mar =</span> pemaritl <span class="sc">==</span> <span class="dv">6</span>,</span>
<span id="cb6-20"><a href="#cb6-20"></a>      <span class="at">status_other =</span> <span class="sc">!</span>pemaritl <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">6</span>),</span>
<span id="cb6-21"><a href="#cb6-21"></a>      <span class="at">hispanic =</span> hispanic <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb6-22"><a href="#cb6-22"></a>      <span class="fu">across</span>(</span>
<span id="cb6-23"><a href="#cb6-23"></a>        <span class="fu">c</span>(age_lt_18<span class="sc">:</span>status_other, hispanic),</span>
<span id="cb6-24"><a href="#cb6-24"></a>        \(x) (x <span class="sc">*</span> pwsswgt)</span>
<span id="cb6-25"><a href="#cb6-25"></a>      )</span>
<span id="cb6-26"><a href="#cb6-26"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb6-27"><a href="#cb6-27"></a>    <span class="fu">group_by</span>(msa) <span class="sc">|&gt;</span></span>
<span id="cb6-28"><a href="#cb6-28"></a>    <span class="fu">summarise</span>(</span>
<span id="cb6-29"><a href="#cb6-29"></a>      <span class="fu">across</span>(</span>
<span id="cb6-30"><a href="#cb6-30"></a>        <span class="fu">c</span>(age_lt_18<span class="sc">:</span>status_other, hispanic),</span>
<span id="cb6-31"><a href="#cb6-31"></a>        \(x) <span class="fu">sum</span>(x <span class="sc">/</span> <span class="fu">sum</span>(pwsswgt), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-32"><a href="#cb6-32"></a>      )</span>
<span id="cb6-33"><a href="#cb6-33"></a>    )</span>
<span id="cb6-34"><a href="#cb6-34"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>With that function now defined, I move on to get CPS data using that function.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Set up a cluster to get all of the CPS data aggregations</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>cps_clust <span class="ot">&lt;-</span> <span class="fu">new_cluster</span>(<span class="dv">12</span>)</span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="fu">cluster_library</span>(cps_clust, <span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"cpsR"</span>))</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="fu">cluster_copy</span>(cps_clust, <span class="fu">c</span>(<span class="st">"get_cps_summaries"</span>, <span class="st">"msa_code_tbl"</span>))</span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a><span class="co"># Get CPS data aggregations</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>cps_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="at">yr =</span> <span class="dv">2006</span><span class="sc">:</span><span class="dv">2023</span>,</span>
<span id="cb7-9"><a href="#cb7-9"></a>  <span class="at">mo =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>) <span class="sc">|&gt;</span></span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="fu">partition</span>(cps_clust)</span>
<span id="cb7-12"><a href="#cb7-12"></a></span>
<span id="cb7-13"><a href="#cb7-13"></a>cps_data <span class="ot">&lt;-</span> cps_grid <span class="sc">|&gt;</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  <span class="fu">arrange</span>(yr, mo) <span class="sc">|&gt;</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>  <span class="fu">mutate</span>(</span>
<span id="cb7-16"><a href="#cb7-16"></a>    <span class="at">cps =</span> <span class="fu">map2</span>(</span>
<span id="cb7-17"><a href="#cb7-17"></a>      yr, mo,</span>
<span id="cb7-18"><a href="#cb7-18"></a>      <span class="fu">possibly</span>(</span>
<span id="cb7-19"><a href="#cb7-19"></a>        \(y, m) {</span>
<span id="cb7-20"><a href="#cb7-20"></a>          <span class="fu">get_basic</span>(</span>
<span id="cb7-21"><a href="#cb7-21"></a>            y, m,</span>
<span id="cb7-22"><a href="#cb7-22"></a>            <span class="fu">c</span>(<span class="st">"gtcbsa"</span>, <span class="st">"prtage"</span>, <span class="st">"pemaritl"</span>, <span class="st">"peeduca"</span>, <span class="st">"pehspnon"</span>, <span class="st">"pwsswgt"</span>)</span>
<span id="cb7-23"><a href="#cb7-23"></a>          ) <span class="sc">|&gt;</span></span>
<span id="cb7-24"><a href="#cb7-24"></a>            <span class="fu">get_cps_summaries</span>(msa_code_tbl<span class="sc">$</span>msa)</span>
<span id="cb7-25"><a href="#cb7-25"></a>        }</span>
<span id="cb7-26"><a href="#cb7-26"></a>      )</span>
<span id="cb7-27"><a href="#cb7-27"></a>    )</span>
<span id="cb7-28"><a href="#cb7-28"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb7-29"><a href="#cb7-29"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb7-30"><a href="#cb7-30"></a>  <span class="fu">unnest</span>(cps) <span class="sc">|&gt;</span></span>
<span id="cb7-31"><a href="#cb7-31"></a>  <span class="fu">mutate</span>(<span class="at">msa =</span> <span class="fu">as.character</span>(msa)) <span class="sc">|&gt;</span></span>
<span id="cb7-32"><a href="#cb7-32"></a>  <span class="fu">left_join</span>(msa_code_tbl, <span class="at">by =</span> <span class="st">"msa"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-33"><a href="#cb7-33"></a>  <span class="fu">select</span>(<span class="sc">-</span>msa) <span class="sc">|&gt;</span></span>
<span id="cb7-34"><a href="#cb7-34"></a>  <span class="fu">unite</span>(<span class="st">"date"</span>, yr, mo, <span class="at">sep =</span> <span class="st">"-"</span>) <span class="sc">|&gt;</span></span>
<span id="cb7-35"><a href="#cb7-35"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ym</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb7-36"><a href="#cb7-36"></a>  <span class="fu">relocate</span>(city, date)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>This is what the CPS data looked like.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="fu">head</span>(cps_data) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="ttsuobeorv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ttsuobeorv table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ttsuobeorv thead, #ttsuobeorv tbody, #ttsuobeorv tfoot, #ttsuobeorv tr, #ttsuobeorv td, #ttsuobeorv th {
  border-style: none;
}

#ttsuobeorv p {
  margin: 0;
  padding: 0;
}

#ttsuobeorv .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ttsuobeorv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ttsuobeorv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ttsuobeorv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ttsuobeorv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ttsuobeorv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ttsuobeorv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ttsuobeorv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ttsuobeorv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ttsuobeorv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ttsuobeorv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ttsuobeorv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ttsuobeorv .gt_spanner_row {
  border-bottom-style: hidden;
}

#ttsuobeorv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ttsuobeorv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ttsuobeorv .gt_from_md > :first-child {
  margin-top: 0;
}

#ttsuobeorv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ttsuobeorv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ttsuobeorv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ttsuobeorv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ttsuobeorv .gt_row_group_first td {
  border-top-width: 2px;
}

#ttsuobeorv .gt_row_group_first th {
  border-top-width: 2px;
}

#ttsuobeorv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ttsuobeorv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ttsuobeorv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ttsuobeorv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ttsuobeorv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ttsuobeorv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ttsuobeorv .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ttsuobeorv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ttsuobeorv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ttsuobeorv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ttsuobeorv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ttsuobeorv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ttsuobeorv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ttsuobeorv .gt_left {
  text-align: left;
}

#ttsuobeorv .gt_center {
  text-align: center;
}

#ttsuobeorv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ttsuobeorv .gt_font_normal {
  font-weight: normal;
}

#ttsuobeorv .gt_font_bold {
  font-weight: bold;
}

#ttsuobeorv .gt_font_italic {
  font-style: italic;
}

#ttsuobeorv .gt_super {
  font-size: 65%;
}

#ttsuobeorv .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ttsuobeorv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ttsuobeorv .gt_indent_1 {
  text-indent: 5px;
}

#ttsuobeorv .gt_indent_2 {
  text-indent: 10px;
}

#ttsuobeorv .gt_indent_3 {
  text-indent: 15px;
}

#ttsuobeorv .gt_indent_4 {
  text-indent: 20px;
}

#ttsuobeorv .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="city" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">city</th>
<th id="date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date</th>
<th id="age_lt_18" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">age_lt_18</th>
<th id="age_18_35" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">age_18_35</th>
<th id="age_36_65" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">age_36_65</th>
<th id="age_gt_65" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">age_gt_65</th>
<th id="educ_hs_less" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">educ_hs_less</th>
<th id="educ_college" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">educ_college</th>
<th id="educ_grad" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">educ_grad</th>
<th id="status_married" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">status_married</th>
<th id="status_nev_mar" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">status_nev_mar</th>
<th id="status_other" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">status_other</th>
<th id="hispanic" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">hispanic</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="age_lt_18">0.2839770</td>
<td class="gt_row gt_right" headers="age_18_35">0.2751600</td>
<td class="gt_row gt_right" headers="age_36_65">0.3507462</td>
<td class="gt_row gt_right" headers="age_gt_65">0.08780246</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.3612863</td>
<td class="gt_row gt_right" headers="educ_college">0.3246959</td>
<td class="gt_row gt_right" headers="educ_grad">0.06969308</td>
<td class="gt_row gt_right" headers="status_married">0.4193003</td>
<td class="gt_row gt_right" headers="status_nev_mar">0.2093507</td>
<td class="gt_row gt_right" headers="status_other">0.3713489</td>
<td class="gt_row gt_right" headers="hispanic">0.23589661</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Detroit</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="age_lt_18">0.2633059</td>
<td class="gt_row gt_right" headers="age_18_35">0.2178059</td>
<td class="gt_row gt_right" headers="age_36_65">0.3914485</td>
<td class="gt_row gt_right" headers="age_gt_65">0.12411556</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.3647213</td>
<td class="gt_row gt_right" headers="educ_college">0.3357047</td>
<td class="gt_row gt_right" headers="educ_grad">0.07179506</td>
<td class="gt_row gt_right" headers="status_married">0.4001588</td>
<td class="gt_row gt_right" headers="status_nev_mar">0.2336782</td>
<td class="gt_row gt_right" headers="status_other">0.3661630</td>
<td class="gt_row gt_right" headers="hispanic">0.03352171</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">New York</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="age_lt_18">0.2420728</td>
<td class="gt_row gt_right" headers="age_18_35">0.2408729</td>
<td class="gt_row gt_right" headers="age_36_65">0.3889675</td>
<td class="gt_row gt_right" headers="age_gt_65">0.12649394</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.3721424</td>
<td class="gt_row gt_right" headers="educ_college">0.3287271</td>
<td class="gt_row gt_right" headers="educ_grad">0.09625312</td>
<td class="gt_row gt_right" headers="status_married">0.4060160</td>
<td class="gt_row gt_right" headers="status_nev_mar">0.2625960</td>
<td class="gt_row gt_right" headers="status_other">0.3313880</td>
<td class="gt_row gt_right" headers="hispanic">0.19769087</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">San Diego</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="age_lt_18">0.2398891</td>
<td class="gt_row gt_right" headers="age_18_35">0.2393884</td>
<td class="gt_row gt_right" headers="age_36_65">0.3969656</td>
<td class="gt_row gt_right" headers="age_gt_65">0.12375698</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.2819756</td>
<td class="gt_row gt_right" headers="educ_college">0.4378574</td>
<td class="gt_row gt_right" headers="educ_grad">0.08594332</td>
<td class="gt_row gt_right" headers="status_married">0.3991201</td>
<td class="gt_row gt_right" headers="status_nev_mar">0.2550806</td>
<td class="gt_row gt_right" headers="status_other">0.3457992</td>
<td class="gt_row gt_right" headers="hispanic">0.24626772</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-03-01</td>
<td class="gt_row gt_right" headers="age_lt_18">0.2991726</td>
<td class="gt_row gt_right" headers="age_18_35">0.2852235</td>
<td class="gt_row gt_right" headers="age_36_65">0.3324601</td>
<td class="gt_row gt_right" headers="age_gt_65">0.08314374</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.3481381</td>
<td class="gt_row gt_right" headers="educ_college">0.3412725</td>
<td class="gt_row gt_right" headers="educ_grad">0.06266023</td>
<td class="gt_row gt_right" headers="status_married">0.4069059</td>
<td class="gt_row gt_right" headers="status_nev_mar">0.2147862</td>
<td class="gt_row gt_right" headers="status_other">0.3783079</td>
<td class="gt_row gt_right" headers="hispanic">0.27328065</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Detroit</td>
<td class="gt_row gt_right" headers="date">2006-03-01</td>
<td class="gt_row gt_right" headers="age_lt_18">0.2660104</td>
<td class="gt_row gt_right" headers="age_18_35">0.2155320</td>
<td class="gt_row gt_right" headers="age_36_65">0.4070590</td>
<td class="gt_row gt_right" headers="age_gt_65">0.11139867</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.3738536</td>
<td class="gt_row gt_right" headers="educ_college">0.3548189</td>
<td class="gt_row gt_right" headers="educ_grad">0.05050216</td>
<td class="gt_row gt_right" headers="status_married">0.4191846</td>
<td class="gt_row gt_right" headers="status_nev_mar">0.2244699</td>
<td class="gt_row gt_right" headers="status_other">0.3563455</td>
<td class="gt_row gt_right" headers="hispanic">0.03402642</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="getting-population-data" class="level2">
<h2 class="anchored" data-anchor-id="getting-population-data">Getting population data</h2>
<p>One would think that if any demographic data is simple to get, population data would be simple, right? I learned something different. I was interested in getting population data at a monthly level for each MSA of interest. I knew population was not counted monthly, but I thought I could get it from the CPS. In fact, one might notice that the code actually calls a population variable (<code>pwsswgt</code> ) to perform some calculations. The problem here was that at the MSA level population estimates varied in some cases by as much as 16%. While I I didn’t know if this was true or not I did believe (subjectively) that it was unlikely and I believed that CPS weights are not calibrated to MSAs. My understanding is that they are calibrated to the national and state levels. So, I thought a reasonable alternative would be to get data from the ACS 1-year survey and interpolate data from one year to the next. In fact, the reason that I started my time series in 2006 is that the ACS 1-year and 5-year survey data became available in 2005 and I needed one year before the time series for interpolation. However, there was wrinkle caused by COVID. The 1-year ACS was not released for 2020 because of understandable challenges with data collection. So, for 2020 I used ACS 5-year survey data. I started by getting all of the ACS 1-year data. Here again, I processed the data in parallel.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># Create a cluster for getting ACS data</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>acs_clust <span class="ot">&lt;-</span> <span class="fu">new_cluster</span>(<span class="dv">12</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a><span class="fu">cluster_library</span>(acs_clust, <span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"tidycensus"</span>))</span>
<span id="cb9-4"><a href="#cb9-4"></a></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co"># Get ACS data for 2005 to 2019, 2021, and 2022</span></span>
<span id="cb9-6"><a href="#cb9-6"></a>acs1_pop_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2005</span><span class="sc">:</span><span class="dv">2019</span>, <span class="dv">2021</span><span class="sc">:</span><span class="dv">2022</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-7"><a href="#cb9-7"></a>  <span class="fu">partition</span>(acs_clust) <span class="sc">|&gt;</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-9"><a href="#cb9-9"></a>    <span class="at">pop_data =</span> <span class="fu">map</span>(</span>
<span id="cb9-10"><a href="#cb9-10"></a>      year,</span>
<span id="cb9-11"><a href="#cb9-11"></a>      \(x) <span class="fu">get_acs</span>(</span>
<span id="cb9-12"><a href="#cb9-12"></a>        <span class="at">year =</span> x,</span>
<span id="cb9-13"><a href="#cb9-13"></a>        <span class="at">variables =</span> <span class="st">"B01001_001"</span>,</span>
<span id="cb9-14"><a href="#cb9-14"></a>        <span class="at">geography =</span> <span class="st">"cbsa"</span>,</span>
<span id="cb9-15"><a href="#cb9-15"></a>        <span class="at">survey =</span> <span class="st">"acs1"</span>,</span>
<span id="cb9-16"><a href="#cb9-16"></a>        <span class="at">show_call =</span> <span class="cn">FALSE</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>        <span class="fu">filter</span>(<span class="fu">str_detect</span>(NAME, <span class="st">"New York|Dallas|San Diego|Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-19"><a href="#cb9-19"></a>        <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">str_extract</span>(NAME, <span class="st">"New York|Dallas|San Diego|Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb9-20"><a href="#cb9-20"></a>        <span class="fu">select</span>(city, <span class="at">population =</span> estimate)</span>
<span id="cb9-21"><a href="#cb9-21"></a>    )</span>
<span id="cb9-22"><a href="#cb9-22"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb9-23"><a href="#cb9-23"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb9-24"><a href="#cb9-24"></a>  <span class="fu">unnest</span>(pop_data) <span class="sc">|&gt;</span></span>
<span id="cb9-25"><a href="#cb9-25"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">str_c</span>(year, <span class="st">"12"</span>) <span class="sc">|&gt;</span> <span class="fu">ym</span>(), <span class="at">.keep =</span> <span class="st">"unused"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Next I got the data for 2020 and combined it with the ACS 1-year data. I performed interpolation using the <code>ts_impute_vec()</code> function from the <a href="https://business-science.github.io/timetk/">timetk</a> <span class="citation" data-cites="timetk">(<a href="#ref-timetk" role="doc-biblioref">Dancho and Vaughan 2023</a>)</span> package.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Get data for 2020 separately since it wasn't available in the ACS 1-year</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>acs5_pop_data <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb10-3"><a href="#cb10-3"></a>  <span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb10-4"><a href="#cb10-4"></a>  <span class="at">variables =</span> <span class="st">"B01001_001"</span>,</span>
<span id="cb10-5"><a href="#cb10-5"></a>  <span class="at">geography =</span> <span class="st">"cbsa"</span>,</span>
<span id="cb10-6"><a href="#cb10-6"></a>  <span class="at">survey =</span> <span class="st">"acs5"</span>,</span>
<span id="cb10-7"><a href="#cb10-7"></a>  <span class="at">show_call =</span> <span class="cn">FALSE</span></span>
<span id="cb10-8"><a href="#cb10-8"></a>) <span class="sc">|&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(NAME, <span class="st">"New York|Dallas|San Diego|Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-11"><a href="#cb10-11"></a>    <span class="at">city =</span> <span class="fu">str_extract</span>(NAME, <span class="st">"New York|Dallas|San Diego|Detroit"</span>),</span>
<span id="cb10-12"><a href="#cb10-12"></a>    <span class="at">date =</span> <span class="fu">rep</span>(<span class="fu">ym</span>(<span class="st">"2020-12"</span>), <span class="dv">4</span>),</span>
<span id="cb10-13"><a href="#cb10-13"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-14"><a href="#cb10-14"></a>  <span class="fu">select</span>(city, date, <span class="at">population =</span> estimate)</span>
<span id="cb10-15"><a href="#cb10-15"></a></span>
<span id="cb10-16"><a href="#cb10-16"></a><span class="co"># Put together all the ACS population data and interpolate between annual</span></span>
<span id="cb10-17"><a href="#cb10-17"></a><span class="co"># estimates</span></span>
<span id="cb10-18"><a href="#cb10-18"></a>acs_pop_data <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb10-19"><a href="#cb10-19"></a>  <span class="at">yr =</span> <span class="dv">2006</span><span class="sc">:</span><span class="dv">2022</span>,</span>
<span id="cb10-20"><a href="#cb10-20"></a>  <span class="at">mo =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb10-21"><a href="#cb10-21"></a>) <span class="sc">|&gt;</span></span>
<span id="cb10-22"><a href="#cb10-22"></a>  <span class="fu">add_row</span>(<span class="at">yr =</span> <span class="dv">2005</span>, <span class="at">mo =</span> <span class="dv">12</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-23"><a href="#cb10-23"></a>  <span class="fu">expand_grid</span>(<span class="at">city =</span> <span class="fu">c</span>(<span class="st">"New York"</span>, <span class="st">"Dallas"</span>, <span class="st">"San Diego"</span>, <span class="st">"Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb10-24"><a href="#cb10-24"></a>  <span class="fu">unite</span>(date, yr, mo, <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb10-25"><a href="#cb10-25"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ym</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb10-26"><a href="#cb10-26"></a>  <span class="fu">arrange</span>(date, city) <span class="sc">|&gt;</span></span>
<span id="cb10-27"><a href="#cb10-27"></a>  <span class="fu">left_join</span>(</span>
<span id="cb10-28"><a href="#cb10-28"></a>    <span class="fu">bind_rows</span>(acs1_pop_data, acs5_pop_data),</span>
<span id="cb10-29"><a href="#cb10-29"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"city"</span>, <span class="st">"date"</span>)</span>
<span id="cb10-30"><a href="#cb10-30"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-31"><a href="#cb10-31"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb10-32"><a href="#cb10-32"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb10-33"><a href="#cb10-33"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-34"><a href="#cb10-34"></a>    <span class="at">population =</span> timetk<span class="sc">::</span><span class="fu">ts_impute_vec</span>(population, <span class="at">period =</span> <span class="dv">1</span>),</span>
<span id="cb10-35"><a href="#cb10-35"></a>    <span class="at">pop_chg =</span> (population <span class="sc">/</span> <span class="fu">lag</span>(population)) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb10-36"><a href="#cb10-36"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb10-37"><a href="#cb10-37"></a>  <span class="fu">drop_na</span>(pop_chg) <span class="sc">|&gt;</span></span>
<span id="cb10-38"><a href="#cb10-38"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb10-39"><a href="#cb10-39"></a>  <span class="fu">select</span>(<span class="sc">!</span>population)</span>
<span id="cb10-40"><a href="#cb10-40"></a></span>
<span id="cb10-41"><a href="#cb10-41"></a><span class="fu">head</span>(acs_pop_data) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="dynzfaczvw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#dynzfaczvw table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#dynzfaczvw thead, #dynzfaczvw tbody, #dynzfaczvw tfoot, #dynzfaczvw tr, #dynzfaczvw td, #dynzfaczvw th {
  border-style: none;
}

#dynzfaczvw p {
  margin: 0;
  padding: 0;
}

#dynzfaczvw .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dynzfaczvw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dynzfaczvw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dynzfaczvw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dynzfaczvw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dynzfaczvw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dynzfaczvw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dynzfaczvw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dynzfaczvw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dynzfaczvw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dynzfaczvw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dynzfaczvw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dynzfaczvw .gt_spanner_row {
  border-bottom-style: hidden;
}

#dynzfaczvw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dynzfaczvw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dynzfaczvw .gt_from_md > :first-child {
  margin-top: 0;
}

#dynzfaczvw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dynzfaczvw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dynzfaczvw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dynzfaczvw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dynzfaczvw .gt_row_group_first td {
  border-top-width: 2px;
}

#dynzfaczvw .gt_row_group_first th {
  border-top-width: 2px;
}

#dynzfaczvw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dynzfaczvw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dynzfaczvw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dynzfaczvw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dynzfaczvw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dynzfaczvw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dynzfaczvw .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#dynzfaczvw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dynzfaczvw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dynzfaczvw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dynzfaczvw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dynzfaczvw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dynzfaczvw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dynzfaczvw .gt_left {
  text-align: left;
}

#dynzfaczvw .gt_center {
  text-align: center;
}

#dynzfaczvw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dynzfaczvw .gt_font_normal {
  font-weight: normal;
}

#dynzfaczvw .gt_font_bold {
  font-weight: bold;
}

#dynzfaczvw .gt_font_italic {
  font-style: italic;
}

#dynzfaczvw .gt_super {
  font-size: 65%;
}

#dynzfaczvw .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#dynzfaczvw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dynzfaczvw .gt_indent_1 {
  text-indent: 5px;
}

#dynzfaczvw .gt_indent_2 {
  text-indent: 10px;
}

#dynzfaczvw .gt_indent_3 {
  text-indent: 15px;
}

#dynzfaczvw .gt_indent_4 {
  text-indent: 20px;
}

#dynzfaczvw .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date</th>
<th id="city" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">city</th>
<th id="pop_chg" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">pop_chg</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="pop_chg">0.0040551186</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_left" headers="city">Detroit</td>
<td class="gt_row gt_right" headers="pop_chg">0.0007530958</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_left" headers="city">New York</td>
<td class="gt_row gt_right" headers="pop_chg">0.0021226567</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_left" headers="city">San Diego</td>
<td class="gt_row gt_right" headers="pop_chg">0.0034579867</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="date">2006-02-01</td>
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="pop_chg">0.0040387411</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="date">2006-02-01</td>
<td class="gt_row gt_left" headers="city">Detroit</td>
<td class="gt_row gt_right" headers="pop_chg">0.0007525290</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="merge-data-and-check" class="level2">
<h2 class="anchored" data-anchor-id="merge-data-and-check">Merge data and check</h2>
<p>With all of the data gathered and each data set containing variables for city and date (monthly) along with at least one demographic or economic variable, they were ready to be merged.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>econ_data <span class="ot">&lt;-</span> <span class="fu">list</span>(hpi_data, unemp_data, gas_data, cps_data, acs_pop_data) <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">reduce</span>(inner_join, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"city"</span>, <span class="st">"date"</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>It would be a mistake to ever think that there is no more cleaning that can be done, so I skimmed the data using the <code>skimr()</code> function from the <a href="https://github.com/ropensci/skimr">skimr</a> <span class="citation" data-cites="skimr">(<a href="#ref-skimr" role="doc-biblioref">Waring et al. 2022</a>)</span> package.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(econ_data)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">econ_data</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">816</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">17</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Date</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">15</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">city</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: Date</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 17%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: left;">min</th>
<th style="text-align: left;">max</th>
<th style="text-align: left;">median</th>
<th style="text-align: right;">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">date</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">2006-01-01</td>
<td style="text-align: left;">2022-12-01</td>
<td style="text-align: left;">2014-06-16</td>
<td style="text-align: right;">204</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 16%">
<col style="width: 10%">
<col style="width: 15%">
<col style="width: 7%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 7%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">hpi</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">172.19</td>
<td style="text-align: right;">64.38</td>
<td style="text-align: right;">64.47</td>
<td style="text-align: right;">122.40</td>
<td style="text-align: right;">168.06</td>
<td style="text-align: right;">203.87</td>
<td style="text-align: right;">427.80</td>
<td style="text-align: left;">▆▇▃▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">unemp_rate</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">6.50</td>
<td style="text-align: right;">2.93</td>
<td style="text-align: right;">2.80</td>
<td style="text-align: right;">4.20</td>
<td style="text-align: right;">5.60</td>
<td style="text-align: right;">8.30</td>
<td style="text-align: right;">23.90</td>
<td style="text-align: left;">▇▃▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">avg_gas_price</td>
<td style="text-align: right;">144</td>
<td style="text-align: right;">0.82</td>
<td style="text-align: right;">2.95</td>
<td style="text-align: right;">0.76</td>
<td style="text-align: right;">1.36</td>
<td style="text-align: right;">2.38</td>
<td style="text-align: right;">2.84</td>
<td style="text-align: right;">3.48</td>
<td style="text-align: right;">6.29</td>
<td style="text-align: left;">▅▇▅▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_lt_18</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: left;">▂▇▇▃▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age_18_35</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: left;">▁▂▇▆▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">age_36_65</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: left;">▁▃▇▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">age_gt_65</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.07</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: left;">▃▇▆▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">educ_hs_less</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.35</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: left;">▁▃▇▇▃</td>
</tr>
<tr class="odd">
<td style="text-align: left;">educ_college</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">0.38</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: left;">▂▇▇▅▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">educ_grad</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: left;">▃▇▇▃▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">status_married</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.40</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: left;">▁▁▇▇▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">status_nev_mar</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.03</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.27</td>
<td style="text-align: right;">0.29</td>
<td style="text-align: right;">0.34</td>
<td style="text-align: left;">▂▆▇▇▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">status_other</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">0.32</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">0.34</td>
<td style="text-align: right;">0.46</td>
<td style="text-align: left;">▃▇▂▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">hispanic</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.22</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">0.02</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.30</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: left;">▅▁▆▇▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pop_chg</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: left;">▁▂▇▃▁</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Overall the data look good except for the <code>avg_gas_price</code> variable, which is the only variable that has any missing values. I’ll turn to that shortly, but I’ll briefly describe the variables in the data set below:</p>
<ul>
<li><p><code>city</code> : self-explanatory</p></li>
<li><p><code>date</code>: month expressed as the first day of the month</p></li>
<li><p><code>hpi</code>: Case-Shiller Home Price Index value</p></li>
<li><p><code>unemp_rate</code>: Unemployment rate</p></li>
<li><p><code>avg_gas_price</code>: Average gas price</p></li>
<li><p><code>age_lt_18</code>: Proportion of the population younger than 18 years old</p></li>
<li><p><code>age_18_35</code>: Proportion of the population between the ages of 18 and 35</p></li>
<li><p><code>age_36_65</code>: Proportion of the population between the ages of 36 and 65</p></li>
<li><p><code>age_gt_65</code>: Proportion of the population older than 65 years old</p></li>
<li><p><code>educ_hs_less</code>: Proportion of the population with up to a high school diploma</p></li>
<li><p><code>educ_college</code>: Proportion of the population with more than a high school diploma and up to a bachelor’s degree</p></li>
<li><p><code>educ_grad</code>: Proportion of the population with education higher than a bachelor’s degree</p></li>
<li><p><code>status_married</code>: Proportion of the population that is married; including separated</p></li>
<li><p><code>status_nev_mar</code>: Proportion of the population that has never been married</p></li>
<li><p><code>status_other</code>: Proportion of the population not categorized as either <code>status_married</code> or <code>status_nev_mar</code></p></li>
<li><p><code>hispanic</code>: Proportion of the population that reported Hispanic ethnicity</p></li>
<li><p><code>pop_chg</code>: Population change from one month to the next</p></li>
</ul>
<p>Once I skimmed the data, I took a closer look at the percent of <code>avg_gas_price</code> values that were missing for each city.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>econ_data <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">summarise</span>(<span class="at">pct_miss_gas =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(avg_gas_price)) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb13-4"><a href="#cb13-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> pct_miss_gas, <span class="at">x =</span> city)) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2c3e50"</span>) <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">1.1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb13-7"><a href="#cb13-7"></a>  <span class="fu">labs</span>(</span>
<span id="cb13-8"><a href="#cb13-8"></a>    <span class="at">y =</span> <span class="st">"Percent Missing"</span>,</span>
<span id="cb13-9"><a href="#cb13-9"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb13-10"><a href="#cb13-10"></a>    <span class="at">title =</span> <span class="st">"Missingness in avg_gas_price variable by city"</span></span>
<span id="cb13-11"><a href="#cb13-11"></a>  ) <span class="sc">+</span> </span>
<span id="cb13-12"><a href="#cb13-12"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-1_files/figure-html/check-avg-gas-missing-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Evidently data were missing only for San Diego. Below are the start and end dates of average gas price data for San Diego in this data set.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>econ_data <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">filter</span>(city <span class="sc">%in%</span> <span class="st">"San Diego"</span>, <span class="sc">!</span><span class="fu">is.na</span>(avg_gas_price)) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">summarise</span>(<span class="at">start_date =</span> <span class="fu">min</span>(date), <span class="at">end_date =</span> <span class="fu">max</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">gt_bold_head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="lzjxggqsch" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lzjxggqsch table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lzjxggqsch thead, #lzjxggqsch tbody, #lzjxggqsch tfoot, #lzjxggqsch tr, #lzjxggqsch td, #lzjxggqsch th {
  border-style: none;
}

#lzjxggqsch p {
  margin: 0;
  padding: 0;
}

#lzjxggqsch .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lzjxggqsch .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lzjxggqsch .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lzjxggqsch .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lzjxggqsch .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lzjxggqsch .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lzjxggqsch .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lzjxggqsch .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lzjxggqsch .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lzjxggqsch .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lzjxggqsch .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lzjxggqsch .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lzjxggqsch .gt_spanner_row {
  border-bottom-style: hidden;
}

#lzjxggqsch .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lzjxggqsch .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lzjxggqsch .gt_from_md > :first-child {
  margin-top: 0;
}

#lzjxggqsch .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lzjxggqsch .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lzjxggqsch .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lzjxggqsch .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lzjxggqsch .gt_row_group_first td {
  border-top-width: 2px;
}

#lzjxggqsch .gt_row_group_first th {
  border-top-width: 2px;
}

#lzjxggqsch .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lzjxggqsch .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lzjxggqsch .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lzjxggqsch .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lzjxggqsch .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lzjxggqsch .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lzjxggqsch .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lzjxggqsch .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lzjxggqsch .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lzjxggqsch .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lzjxggqsch .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lzjxggqsch .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lzjxggqsch .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lzjxggqsch .gt_left {
  text-align: left;
}

#lzjxggqsch .gt_center {
  text-align: center;
}

#lzjxggqsch .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lzjxggqsch .gt_font_normal {
  font-weight: normal;
}

#lzjxggqsch .gt_font_bold {
  font-weight: bold;
}

#lzjxggqsch .gt_font_italic {
  font-style: italic;
}

#lzjxggqsch .gt_super {
  font-size: 65%;
}

#lzjxggqsch .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lzjxggqsch .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lzjxggqsch .gt_indent_1 {
  text-indent: 5px;
}

#lzjxggqsch .gt_indent_2 {
  text-indent: 10px;
}

#lzjxggqsch .gt_indent_3 {
  text-indent: 15px;
}

#lzjxggqsch .gt_indent_4 {
  text-indent: 20px;
}

#lzjxggqsch .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="start_date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">start_date</th>
<th id="end_date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">end_date</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="start_date">2018-01-01</td>
<td class="gt_row gt_right" headers="end_date">2022-12-01</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>As it turns out, reports of average gas price data for San Diego start in January of 2018, which means that 12 years of data would be missing. With that many values missing for one of the cities it makes sense to drop the average gas price variable.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>econ_data <span class="ot">&lt;-</span> <span class="fu">select</span>(econ_data, <span class="sc">!</span>avg_gas_price)</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>econ_data <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div id="ggoamtlgsw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ggoamtlgsw table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ggoamtlgsw thead, #ggoamtlgsw tbody, #ggoamtlgsw tfoot, #ggoamtlgsw tr, #ggoamtlgsw td, #ggoamtlgsw th {
  border-style: none;
}

#ggoamtlgsw p {
  margin: 0;
  padding: 0;
}

#ggoamtlgsw .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ggoamtlgsw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ggoamtlgsw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ggoamtlgsw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ggoamtlgsw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ggoamtlgsw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ggoamtlgsw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ggoamtlgsw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ggoamtlgsw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ggoamtlgsw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ggoamtlgsw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ggoamtlgsw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ggoamtlgsw .gt_spanner_row {
  border-bottom-style: hidden;
}

#ggoamtlgsw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ggoamtlgsw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ggoamtlgsw .gt_from_md > :first-child {
  margin-top: 0;
}

#ggoamtlgsw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ggoamtlgsw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ggoamtlgsw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ggoamtlgsw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ggoamtlgsw .gt_row_group_first td {
  border-top-width: 2px;
}

#ggoamtlgsw .gt_row_group_first th {
  border-top-width: 2px;
}

#ggoamtlgsw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ggoamtlgsw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ggoamtlgsw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ggoamtlgsw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ggoamtlgsw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ggoamtlgsw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ggoamtlgsw .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ggoamtlgsw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ggoamtlgsw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ggoamtlgsw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ggoamtlgsw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ggoamtlgsw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ggoamtlgsw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ggoamtlgsw .gt_left {
  text-align: left;
}

#ggoamtlgsw .gt_center {
  text-align: center;
}

#ggoamtlgsw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ggoamtlgsw .gt_font_normal {
  font-weight: normal;
}

#ggoamtlgsw .gt_font_bold {
  font-weight: bold;
}

#ggoamtlgsw .gt_font_italic {
  font-style: italic;
}

#ggoamtlgsw .gt_super {
  font-size: 65%;
}

#ggoamtlgsw .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ggoamtlgsw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ggoamtlgsw .gt_indent_1 {
  text-indent: 5px;
}

#ggoamtlgsw .gt_indent_2 {
  text-indent: 10px;
}

#ggoamtlgsw .gt_indent_3 {
  text-indent: 15px;
}

#ggoamtlgsw .gt_indent_4 {
  text-indent: 20px;
}

#ggoamtlgsw .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="city" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">city</th>
<th id="date" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">date</th>
<th id="hpi" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">hpi</th>
<th id="unemp_rate" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">unemp_rate</th>
<th id="age_lt_18" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">age_lt_18</th>
<th id="age_18_35" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">age_18_35</th>
<th id="age_36_65" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">age_36_65</th>
<th id="age_gt_65" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">age_gt_65</th>
<th id="educ_hs_less" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">educ_hs_less</th>
<th id="educ_college" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">educ_college</th>
<th id="educ_grad" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">educ_grad</th>
<th id="status_married" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">status_married</th>
<th id="status_nev_mar" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">status_nev_mar</th>
<th id="status_other" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">status_other</th>
<th id="hispanic" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">hispanic</th>
<th id="pop_chg" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">pop_chg</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-01-01</td>
<td class="gt_row gt_right" headers="hpi">121.9108</td>
<td class="gt_row gt_right" headers="unemp_rate">5.1</td>
<td class="gt_row gt_right" headers="age_lt_18">0.2839770</td>
<td class="gt_row gt_right" headers="age_18_35">0.2751600</td>
<td class="gt_row gt_right" headers="age_36_65">0.3507462</td>
<td class="gt_row gt_right" headers="age_gt_65">0.08780246</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.3612863</td>
<td class="gt_row gt_right" headers="educ_college">0.3246959</td>
<td class="gt_row gt_right" headers="educ_grad">0.06969308</td>
<td class="gt_row gt_right" headers="status_married">0.4193003</td>
<td class="gt_row gt_right" headers="status_nev_mar">0.2093507</td>
<td class="gt_row gt_right" headers="status_other">0.3713489</td>
<td class="gt_row gt_right" headers="hispanic">0.2358966</td>
<td class="gt_row gt_right" headers="pop_chg">0.004055119</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-02-01</td>
<td class="gt_row gt_right" headers="hpi">121.3285</td>
<td class="gt_row gt_right" headers="unemp_rate">5.2</td>
<td class="gt_row gt_right" headers="age_lt_18">0.2955885</td>
<td class="gt_row gt_right" headers="age_18_35">0.2749812</td>
<td class="gt_row gt_right" headers="age_36_65">0.3499053</td>
<td class="gt_row gt_right" headers="age_gt_65">0.07952504</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.3534445</td>
<td class="gt_row gt_right" headers="educ_college">0.3474221</td>
<td class="gt_row gt_right" headers="educ_grad">0.05914608</td>
<td class="gt_row gt_right" headers="status_married">0.4186053</td>
<td class="gt_row gt_right" headers="status_nev_mar">0.2195799</td>
<td class="gt_row gt_right" headers="status_other">0.3618148</td>
<td class="gt_row gt_right" headers="hispanic">0.2640835</td>
<td class="gt_row gt_right" headers="pop_chg">0.004038741</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-03-01</td>
<td class="gt_row gt_right" headers="hpi">121.5217</td>
<td class="gt_row gt_right" headers="unemp_rate">5.0</td>
<td class="gt_row gt_right" headers="age_lt_18">0.2991726</td>
<td class="gt_row gt_right" headers="age_18_35">0.2852235</td>
<td class="gt_row gt_right" headers="age_36_65">0.3324601</td>
<td class="gt_row gt_right" headers="age_gt_65">0.08314374</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.3481381</td>
<td class="gt_row gt_right" headers="educ_college">0.3412725</td>
<td class="gt_row gt_right" headers="educ_grad">0.06266023</td>
<td class="gt_row gt_right" headers="status_married">0.4069059</td>
<td class="gt_row gt_right" headers="status_nev_mar">0.2147862</td>
<td class="gt_row gt_right" headers="status_other">0.3783079</td>
<td class="gt_row gt_right" headers="hispanic">0.2732806</td>
<td class="gt_row gt_right" headers="pop_chg">0.004022495</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-04-01</td>
<td class="gt_row gt_right" headers="hpi">122.3996</td>
<td class="gt_row gt_right" headers="unemp_rate">4.8</td>
<td class="gt_row gt_right" headers="age_lt_18">0.2938252</td>
<td class="gt_row gt_right" headers="age_18_35">0.2784571</td>
<td class="gt_row gt_right" headers="age_36_65">0.3445776</td>
<td class="gt_row gt_right" headers="age_gt_65">0.08314010</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.3324701</td>
<td class="gt_row gt_right" headers="educ_college">0.3589532</td>
<td class="gt_row gt_right" headers="educ_grad">0.06155738</td>
<td class="gt_row gt_right" headers="status_married">0.3932068</td>
<td class="gt_row gt_right" headers="status_nev_mar">0.2133219</td>
<td class="gt_row gt_right" headers="status_other">0.3934713</td>
<td class="gt_row gt_right" headers="hispanic">0.2540514</td>
<td class="gt_row gt_right" headers="pop_chg">0.004006380</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-05-01</td>
<td class="gt_row gt_right" headers="hpi">123.2863</td>
<td class="gt_row gt_right" headers="unemp_rate">4.9</td>
<td class="gt_row gt_right" headers="age_lt_18">0.2744636</td>
<td class="gt_row gt_right" headers="age_18_35">0.2824573</td>
<td class="gt_row gt_right" headers="age_36_65">0.3631222</td>
<td class="gt_row gt_right" headers="age_gt_65">0.07995692</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.3610289</td>
<td class="gt_row gt_right" headers="educ_college">0.3519889</td>
<td class="gt_row gt_right" headers="educ_grad">0.05978182</td>
<td class="gt_row gt_right" headers="status_married">0.4005990</td>
<td class="gt_row gt_right" headers="status_nev_mar">0.2167855</td>
<td class="gt_row gt_right" headers="status_other">0.3826155</td>
<td class="gt_row gt_right" headers="hispanic">0.2722199</td>
<td class="gt_row gt_right" headers="pop_chg">0.003990393</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="date">2006-06-01</td>
<td class="gt_row gt_right" headers="hpi">124.4985</td>
<td class="gt_row gt_right" headers="unemp_rate">5.3</td>
<td class="gt_row gt_right" headers="age_lt_18">0.2739175</td>
<td class="gt_row gt_right" headers="age_18_35">0.2861816</td>
<td class="gt_row gt_right" headers="age_36_65">0.3643186</td>
<td class="gt_row gt_right" headers="age_gt_65">0.07558240</td>
<td class="gt_row gt_right" headers="educ_hs_less">0.3512415</td>
<td class="gt_row gt_right" headers="educ_college">0.3512756</td>
<td class="gt_row gt_right" headers="educ_grad">0.06253083</td>
<td class="gt_row gt_right" headers="status_married">0.4065603</td>
<td class="gt_row gt_right" headers="status_nev_mar">0.2122996</td>
<td class="gt_row gt_right" headers="status_other">0.3811401</td>
<td class="gt_row gt_right" headers="hispanic">0.2734042</td>
<td class="gt_row gt_right" headers="pop_chg">0.003974533</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Finally, I’d like to visualize the densities of all of the variables by city just to make sure nothing jumps out that might need any correction.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>econ_data <span class="sc">|&gt;</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>  <span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">|&gt;</span></span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>city, <span class="at">names_to =</span> <span class="st">"variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> city)) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb16-6"><a href="#cb16-6"></a>  <span class="fu">facet_wrap</span>(<span class="st">"variable"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-1_files/figure-html/plot-densities-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>There are some interesting patterns, particularly in the differences across the age groups, but there’s nothing alarming. With all this data in hand, the next step is to perform some time series analysis on the Case-Shiller HPI which I’ll show in Part 2 of this set of posts.</p>


<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-fredr" class="csl-entry" role="listitem">
Boysel, Sam, and Davis Vaughan. 2021. <span>“Fredr: An r Client for the ’FRED’ API.”</span> <a href="https://CRAN.R-project.org/package=fredr">https://CRAN.R-project.org/package=fredr</a>.
</div>
<div id="ref-modeltime" class="csl-entry" role="listitem">
Dancho, Matt. 2023. <span>“Modeltime: The Tidymodels Extension for Time Series Modeling.”</span> <a href="https://CRAN.R-project.org/package=modeltime">https://CRAN.R-project.org/package=modeltime</a>.
</div>
<div id="ref-timetk" class="csl-entry" role="listitem">
Dancho, Matt, and Davis Vaughan. 2023. <span>“Timetk: A Tool Kit for Working with Time Series.”</span> <a href="https://CRAN.R-project.org/package=timetk">https://CRAN.R-project.org/package=timetk</a>.
</div>
<div id="ref-cpsR" class="csl-entry" role="listitem">
Saenz, Matt. 2023. <span>“cpsR: Load CPS Microdata into r Using the ’Census Bureau Data’ API.”</span> <a href="https://CRAN.R-project.org/package=cpsR">https://CRAN.R-project.org/package=cpsR</a>.
</div>
<div id="ref-tidycensus" class="csl-entry" role="listitem">
Walker, Kyle, and Matt Herman. 2024. <span>“Tidycensus: Load US Census Boundary and Attribute Data as ’Tidyverse’ and ’Sf’-Ready Data Frames.”</span> <a href="https://CRAN.R-project.org/package=tidycensus">https://CRAN.R-project.org/package=tidycensus</a>.
</div>
<div id="ref-skimr" class="csl-entry" role="listitem">
Waring, Elin, Michael Quinn, Amelia McNamara, Eduardo Arino de la Rubia, Hao Zhu, and Shannon Ellis. 2022. <span>“Skimr: Compact and Flexible Summaries of Data.”</span> <a href="https://CRAN.R-project.org/package=skimr">https://CRAN.R-project.org/package=skimr</a>.
</div>
<div id="ref-multidplyr" class="csl-entry" role="listitem">
Wickham, Hadley. 2023. <span>“Multidplyr: A Multi-Process ’Dplyr’ Backend.”</span> <a href="https://CRAN.R-project.org/package=multidplyr">https://CRAN.R-project.org/package=multidplyr</a>.
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span></span>Tidyverse<span></span>”</span> 4: 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("^(?:http:|https:)\/\/arcenis-r\.github\.io\/ajr-portfolio");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
        for (let i=0; i<annoteTargets.length; i++) {
          const annoteTarget = annoteTargets[i];
          const targetCell = annoteTarget.getAttribute("data-target-cell");
          const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
          const contentFn = () => {
            const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
            if (content) {
              const tipContent = content.cloneNode(true);
              tipContent.classList.add("code-annotation-tip-content");
              return tipContent.outerHTML;
            }
          }
          const config = {
            allowHTML: true,
            content: contentFn,
            onShow: (instance) => {
              selectCodeLines(instance.reference);
              instance.reference.classList.add('code-annotation-active');
              window.tippy.hideAll();
            },
            onHide: (instance) => {
              unselectCodeLines();
              instance.reference.classList.remove('code-annotation-active');
            },
            maxWidth: 300,
            delay: [50, 0],
            duration: [200, 0],
            offset: [5, 10],
            arrow: true,
            trigger: 'click',
            appendTo: function(el) {
              return el.parentElement.parentElement.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'quarto',
            placement: 'right',
            positionFixed: true,
            popperOptions: {
              modifiers: [
              {
                name: 'flip',
                options: {
                  flipVariations: false, // true by default
                  allowedAutoPlacements: ['right'],
                  fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
                },
              },
              {
                name: 'preventOverflow',
                options: {
                  mainAxis: false,
                  altAxis: false
                }
              }
              ]        
            }      
          };
          window.tippy(annoteTarget, config); 
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark">
<script>
  function loadGiscus() {
    // Function to get the theme based on body class
    const getTheme = () => {
      let baseTheme = document.getElementById('giscus-base-theme').value;
      let altTheme = document.getElementById('giscus-alt-theme').value;
      return document.body.classList.contains('quarto-dark') ? altTheme : baseTheme;
    };
    const script = document.createElement("script");
    script.src = "https://giscus.app/client.js";
    script.async = true;
    script.dataset.repo = "arcenis-r/ajr-portfolio";
    script.dataset.repoId = "MDEwOlJlcG9zaXRvcnkxNzg3MDY3MTM=";
    script.dataset.category = "General";
    script.dataset.categoryId = "DIC_kwDOCqbZGc4CdJXz";
    script.dataset.mapping = "title";
    script.dataset.reactionsEnabled = "1";
    script.dataset.emitMetadata = "0";
    script.dataset.inputPosition = "top";
    script.dataset.theme = getTheme();
    script.dataset.lang = "en";
    script.crossOrigin = "anonymous";
    // Append the script to the desired div instead of at the end of the body
    document.getElementById("quarto-content").appendChild(script);
  }
  loadGiscus();
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">---</span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="an">title:</span><span class="co"> "Forecasting with {modeltime} - Part I"</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="an">subtitle:</span><span class="co"> "Gathering data"</span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="an">author:</span><span class="co"> "Arcenis Rojas"</span></span>
<span id="cb17-5"><a href="#cb17-5"></a><span class="an">date:</span><span class="co"> "2/12/2024"</span></span>
<span id="cb17-6"><a href="#cb17-6"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="an">categories:</span></span>
<span id="cb17-8"><a href="#cb17-8"></a><span class="co">  - Time Series</span></span>
<span id="cb17-9"><a href="#cb17-9"></a><span class="co">  - Data Acquisition</span></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="co">  - Data Wrangling</span></span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="an">execute:</span></span>
<span id="cb17-12"><a href="#cb17-12"></a><span class="co">  warning: false</span></span>
<span id="cb17-13"><a href="#cb17-13"></a><span class="co">  error: false</span></span>
<span id="cb17-14"><a href="#cb17-14"></a><span class="co">  message: false</span></span>
<span id="cb17-15"><a href="#cb17-15"></a><span class="co">---</span></span>
<span id="cb17-16"><a href="#cb17-16"></a></span>
<span id="cb17-17"><a href="#cb17-17"></a><span class="fu">## Introduction</span></span>
<span id="cb17-18"><a href="#cb17-18"></a></span>
<span id="cb17-19"><a href="#cb17-19"></a><span class="co">[</span><span class="al">![Image by \[Images Money\](https://www.flickr.com/photos/59937401\@N07/)](images/5474453551_afc6ded9af_w.jpg)</span><span class="ot">{fig-alt="Monopoly houses on top of increasingly tall stacks of coins" fig-align="center"}</span><span class="co">](https://www.flickr.com/photos/59937401@N07/5474453551)</span></span>
<span id="cb17-20"><a href="#cb17-20"></a></span>
<span id="cb17-21"><a href="#cb17-21"></a>I learned about the <span class="co">[</span><span class="ot">modeltime</span><span class="co">](https://business-science.github.io/modeltime/)</span> <span class="co">[</span><span class="ot">@modeltime</span><span class="co">]</span> package – developed by the folks at <span class="co">[</span><span class="ot">Business Science</span><span class="co">](https://www.business-science.io/)</span> – in 2021 and hadn't had much chance to use it except for a few small coding exercises. With U.S. housing prices have being <span class="co">[</span><span class="ot">all over the news</span><span class="co">](https://www.forbes.com/advisor/mortgages/real-estate/housing-market-predictions/)</span> in recent times I thought about trying to forecast a housing price metric. My curiosity about housing price trends presented the perfect opportunity to take on a small project using <span class="co">[</span><span class="ot">modeltime</span><span class="co">](https://business-science.github.io/modeltime/)</span>. My goal for this project will be to model multiple time series together using various algorithms through a global modeling process then select the best models from that process and use those algorithms to run an iterative modeling process on the time series to try to get the best forecasts.</span>
<span id="cb17-22"><a href="#cb17-22"></a></span>
<span id="cb17-23"><a href="#cb17-23"></a>I've broken this project into five parts:</span>
<span id="cb17-24"><a href="#cb17-24"></a></span>
<span id="cb17-25"><a href="#cb17-25"></a><span class="ss">1.  </span>Gathering Data</span>
<span id="cb17-26"><a href="#cb17-26"></a></span>
<span id="cb17-27"><a href="#cb17-27"></a><span class="ss">2.  </span>Time series analysis</span>
<span id="cb17-28"><a href="#cb17-28"></a></span>
<span id="cb17-29"><a href="#cb17-29"></a><span class="ss">3.  </span>ARIMA with global and iterative modeling processes</span>
<span id="cb17-30"><a href="#cb17-30"></a></span>
<span id="cb17-31"><a href="#cb17-31"></a><span class="ss">4.  </span>Global forecasting models</span>
<span id="cb17-32"><a href="#cb17-32"></a></span>
<span id="cb17-33"><a href="#cb17-33"></a><span class="ss">5.  </span>Iterative forecasting models</span>
<span id="cb17-34"><a href="#cb17-34"></a></span>
<span id="cb17-35"><a href="#cb17-35"></a>This post will cover the first part: Gathering Data.</span>
<span id="cb17-36"><a href="#cb17-36"></a></span>
<span id="cb17-37"><a href="#cb17-37"></a><span class="fu">## Choosing house price data</span></span>
<span id="cb17-38"><a href="#cb17-38"></a></span>
<span id="cb17-39"><a href="#cb17-39"></a>To perform this analysis, obviously the first thing I would need is a data set. I wanted data that had sufficient observations with enough granularity to be able to identify seasonality and level changes. I also wanted to compare time series across different regions or cities of the U.S. This meant getting data that was available at a regional/metropolitan level that went back at least 10 years with very few missing values (ideally none). I looked at the data available through the <span class="co">[</span><span class="ot">Federal Reserve Bank of St. Louis</span><span class="co">](https://www.stlouisfed.org/)</span> which hosts one of the largest repositories of U.S. economic data available by using the <span class="co">[</span><span class="ot">fredr</span><span class="co">](https://sboysel.github.io/fredr/reference/fredr_series_search.html)</span> <span class="co">[</span><span class="ot">@fredr</span><span class="co">]</span> package and narrowed my search for data series down to either median home prices or the Case-Shiller Home Price Index. I chose the Case-Shiller HPI because I could get the data at the level of metro area rather than just U.S. region for a longer period of time, though there is the trade-off that this index only accounts for existing home sales. For my purposes this wasn't a problem.</span>
<span id="cb17-40"><a href="#cb17-40"></a></span>
<span id="cb17-41"><a href="#cb17-41"></a>The Case-Shiller HPI data was available through 2023, but population data (discussed below) was available only through 2022 and there were some other issues with data from before 2006, so I got data starting in January 2006 and ending in December 2022.</span>
<span id="cb17-42"><a href="#cb17-42"></a></span>
<span id="cb17-43"><a href="#cb17-43"></a>Once I chose a data source, the next step was to choose cities. I wanted to compare cities from different regions of the U.S. that were different in other characteristics as well, e.g., population, climate, etc., to see how forecasts might differ. I chose San Diego, Dallas, Detroit, and New York City.</span>
<span id="cb17-44"><a href="#cb17-44"></a></span>
<span id="cb17-45"><a href="#cb17-45"></a><span class="fu">## Additional data</span></span>
<span id="cb17-46"><a href="#cb17-46"></a></span>
<span id="cb17-47"><a href="#cb17-47"></a>One of the benefits of using <span class="co">[</span><span class="ot">modeltime</span><span class="co">](https://business-science.github.io/modeltime/)</span> it has functions for running models beyond ARIMA such as Prophet and eXtreme Gradient Boosting (XGB) for time series. To take advantage of this I wanted to add some features to my data. I chose to add unemployment rates, average gas prices, variables relating to demographic composition, and population for each city at the monthly level. I got the unemployment rate and average gas prices through <span class="co">[</span><span class="ot">fredr</span><span class="co">](https://sboysel.github.io/fredr/reference/fredr_series_search.html)</span>, population data from the U.S. Census's American Community Survey (ACS) using the <span class="co">[</span><span class="ot">tidycensus</span><span class="co">](https://walker-data.com/tidycensus/)</span> <span class="co">[</span><span class="ot">@tidycensus</span><span class="co">]</span> package, and other demographic data from the <span class="co">[</span><span class="ot">Current Population Survey (CPS)</span><span class="co">](https://www.census.gov/programs-surveys/cps.html)</span> (which is a joint program of the U.S. Census and the U.S. Bureau of Labor Statistics) using the <span class="co">[</span><span class="ot">cpsR</span><span class="co">](https://github.com/matt-saenz/cpsR)</span> <span class="co">[</span><span class="ot">@cpsR</span><span class="co">]</span> package.</span>
<span id="cb17-48"><a href="#cb17-48"></a></span>
<span id="cb17-49"><a href="#cb17-49"></a>::: callout-important</span>
<span id="cb17-50"><a href="#cb17-50"></a>Both <span class="in">`tidycensus`</span> and <span class="in">`cpsR`</span> require a <span class="co">[</span><span class="ot">U.S. Census API key</span><span class="co">](https://api.census.gov/data/key_signup.html)</span>. This post will not go into detail on how to obtain a key or how to set it up for use with the relevant packages.</span>
<span id="cb17-51"><a href="#cb17-51"></a>:::</span>
<span id="cb17-52"><a href="#cb17-52"></a></span>
<span id="cb17-53"><a href="#cb17-53"></a>::: {.callout-note collapse="true" title="Statistical Area Definitions"}</span>
<span id="cb17-54"><a href="#cb17-54"></a>Some of these data are at the metropolitan statistical area (MSA) level and others are at the core-based statistical area (CBSA) level. While these broadly overlap, which is why I didn't make a big fuss about mixing them, they are technically different. The U.S. Census provides some definitions <span class="co">[</span><span class="ot">here</span><span class="co">](https://www.census.gov/topics/housing/housing-patterns/about/core-based-statistical-areas.html)</span>.</span>
<span id="cb17-55"><a href="#cb17-55"></a>:::</span>
<span id="cb17-56"><a href="#cb17-56"></a></span>
<span id="cb17-57"><a href="#cb17-57"></a>As usual for me, I performed data importing and wrangling using various <span class="co">[</span><span class="ot">tidyverse</span><span class="co">](https://www.tidyverse.org/)</span> <span class="co">[</span><span class="ot">@tidyverse</span><span class="co">]</span>package functions. I also used <span class="co">[</span><span class="ot">multidplyr</span><span class="co">](https://multidplyr.tidyverse.org/)</span> <span class="co">[</span><span class="ot">@multidplyr</span><span class="co">]</span> to perform some operations in parallel.</span>
<span id="cb17-58"><a href="#cb17-58"></a></span>
<span id="cb17-59"><a href="#cb17-59"></a><span class="fu">## Loading Packages</span></span>
<span id="cb17-60"><a href="#cb17-60"></a></span>
<span id="cb17-61"><a href="#cb17-61"></a>To begin with, I first loaded my packages. I'll include the <span class="co">[</span><span class="ot">gt</span><span class="co">](https://gt.rstudio.com/)</span> package for displaying tables.</span>
<span id="cb17-62"><a href="#cb17-62"></a></span>
<span id="cb17-65"><a href="#cb17-65"></a><span class="in">```{r}</span></span>
<span id="cb17-66"><a href="#cb17-66"></a><span class="co">#| label: load-packages</span></span>
<span id="cb17-67"><a href="#cb17-67"></a><span class="co">#| warning: false</span></span>
<span id="cb17-68"><a href="#cb17-68"></a><span class="co">#| error: false</span></span>
<span id="cb17-69"><a href="#cb17-69"></a><span class="co">#| message: false</span></span>
<span id="cb17-70"><a href="#cb17-70"></a></span>
<span id="cb17-71"><a href="#cb17-71"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb17-72"><a href="#cb17-72"></a><span class="fu">library</span>(fredr)</span>
<span id="cb17-73"><a href="#cb17-73"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb17-74"><a href="#cb17-74"></a><span class="fu">library</span>(cpsR)</span>
<span id="cb17-75"><a href="#cb17-75"></a><span class="fu">library</span>(gt)</span>
<span id="cb17-76"><a href="#cb17-76"></a><span class="fu">library</span>(multidplyr)</span>
<span id="cb17-77"><a href="#cb17-77"></a></span>
<span id="cb17-78"><a href="#cb17-78"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb17-79"><a href="#cb17-79"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"lag"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb17-80"><a href="#cb17-80"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"between"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb17-81"><a href="#cb17-81"></a></span>
<span id="cb17-82"><a href="#cb17-82"></a><span class="in">```</span></span>
<span id="cb17-83"><a href="#cb17-83"></a></span>
<span id="cb17-86"><a href="#cb17-86"></a><span class="in">```{r}</span></span>
<span id="cb17-87"><a href="#cb17-87"></a><span class="co">#| label: get-tbl-func</span></span>
<span id="cb17-88"><a href="#cb17-88"></a><span class="co">#| include: false</span></span>
<span id="cb17-89"><a href="#cb17-89"></a></span>
<span id="cb17-90"><a href="#cb17-90"></a><span class="fu">source</span>(<span class="st">"../_common-resources/gt-bold-head.R"</span>)</span>
<span id="cb17-91"><a href="#cb17-91"></a><span class="in">```</span></span>
<span id="cb17-92"><a href="#cb17-92"></a></span>
<span id="cb17-93"><a href="#cb17-93"></a><span class="fu">## Getting Case-Shiller HPI data</span></span>
<span id="cb17-94"><a href="#cb17-94"></a></span>
<span id="cb17-95"><a href="#cb17-95"></a>I started by getting the appropriate Case-Shiller HPI series IDs for my cities of interest.</span>
<span id="cb17-96"><a href="#cb17-96"></a></span>
<span id="cb17-99"><a href="#cb17-99"></a><span class="in">```{r}</span></span>
<span id="cb17-100"><a href="#cb17-100"></a><span class="co">#| label: get-cs-ids</span></span>
<span id="cb17-101"><a href="#cb17-101"></a><span class="co">#| cache: true</span></span>
<span id="cb17-102"><a href="#cb17-102"></a></span>
<span id="cb17-103"><a href="#cb17-103"></a>hpi_ids <span class="ot">&lt;-</span> <span class="fu">fredr_series_search_text</span>(<span class="st">"Case-Shiller"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-104"><a href="#cb17-104"></a>  <span class="fu">filter</span>(</span>
<span id="cb17-105"><a href="#cb17-105"></a>    <span class="fu">str_detect</span>(</span>
<span id="cb17-106"><a href="#cb17-106"></a>      title,</span>
<span id="cb17-107"><a href="#cb17-107"></a>      <span class="st">"CA-San Diego|TX-Dallas|NY-New York|MI-Detroit Home Price Index"</span></span>
<span id="cb17-108"><a href="#cb17-108"></a>    ),</span>
<span id="cb17-109"><a href="#cb17-109"></a>    seasonal_adjustment_short <span class="sc">%in%</span> <span class="st">"NSA"</span>,</span>
<span id="cb17-110"><a href="#cb17-110"></a>    frequency <span class="sc">%in%</span> <span class="st">"Monthly"</span></span>
<span id="cb17-111"><a href="#cb17-111"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-112"><a href="#cb17-112"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">str_extract</span>(title, <span class="st">"New York|Dallas|San Diego|Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-113"><a href="#cb17-113"></a>  <span class="fu">select</span>(city, id)</span>
<span id="cb17-114"><a href="#cb17-114"></a></span>
<span id="cb17-115"><a href="#cb17-115"></a><span class="fu">gt</span>(hpi_ids) <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span>
<span id="cb17-116"><a href="#cb17-116"></a></span>
<span id="cb17-117"><a href="#cb17-117"></a><span class="in">```</span></span>
<span id="cb17-118"><a href="#cb17-118"></a></span>
<span id="cb17-119"><a href="#cb17-119"></a>Next I read in the Case-Shiller data and kept only the necessary variables.</span>
<span id="cb17-120"><a href="#cb17-120"></a></span>
<span id="cb17-123"><a href="#cb17-123"></a><span class="in">```{r}</span></span>
<span id="cb17-124"><a href="#cb17-124"></a><span class="co">#| label: import-hpi</span></span>
<span id="cb17-125"><a href="#cb17-125"></a><span class="co">#| cache: true</span></span>
<span id="cb17-126"><a href="#cb17-126"></a></span>
<span id="cb17-127"><a href="#cb17-127"></a>hpi_data <span class="ot">&lt;-</span> hpi_ids <span class="sc">|&gt;</span></span>
<span id="cb17-128"><a href="#cb17-128"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-129"><a href="#cb17-129"></a>    <span class="at">data =</span> <span class="fu">map</span>(</span>
<span id="cb17-130"><a href="#cb17-130"></a>      id,</span>
<span id="cb17-131"><a href="#cb17-131"></a>      \(x) <span class="fu">fredr</span>(</span>
<span id="cb17-132"><a href="#cb17-132"></a>        <span class="at">series_id =</span> x,</span>
<span id="cb17-133"><a href="#cb17-133"></a>        <span class="at">observation_start =</span> <span class="fu">ymd</span>(<span class="st">"2006-01-01"</span>),</span>
<span id="cb17-134"><a href="#cb17-134"></a>        <span class="at">observation_end =</span> <span class="fu">ymd</span>(<span class="st">"2023-12-31"</span>),</span>
<span id="cb17-135"><a href="#cb17-135"></a>        <span class="at">frequency =</span> <span class="st">"m"</span></span>
<span id="cb17-136"><a href="#cb17-136"></a>      )</span>
<span id="cb17-137"><a href="#cb17-137"></a>    )</span>
<span id="cb17-138"><a href="#cb17-138"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-139"><a href="#cb17-139"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">|&gt;</span></span>
<span id="cb17-140"><a href="#cb17-140"></a>  <span class="fu">unnest</span>(data) <span class="sc">|&gt;</span></span>
<span id="cb17-141"><a href="#cb17-141"></a>  <span class="fu">select</span>(city, date, <span class="at">hpi =</span> value)</span>
<span id="cb17-142"><a href="#cb17-142"></a></span>
<span id="cb17-143"><a href="#cb17-143"></a>hpi_data[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ] <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span>
<span id="cb17-144"><a href="#cb17-144"></a></span>
<span id="cb17-145"><a href="#cb17-145"></a><span class="in">```</span></span>
<span id="cb17-146"><a href="#cb17-146"></a></span>
<span id="cb17-147"><a href="#cb17-147"></a><span class="fu">## Getting unemployment rate and gas price data from FRED</span></span>
<span id="cb17-148"><a href="#cb17-148"></a></span>
<span id="cb17-149"><a href="#cb17-149"></a>Next I got series IDs for both average gas prices and unemployment rates for all four cities and got the data for the appropriate time span.</span>
<span id="cb17-150"><a href="#cb17-150"></a></span>
<span id="cb17-153"><a href="#cb17-153"></a><span class="in">```{r}</span></span>
<span id="cb17-154"><a href="#cb17-154"></a><span class="co">#| label: get-addtnl-fred-data</span></span>
<span id="cb17-155"><a href="#cb17-155"></a><span class="co">#| cache: true</span></span>
<span id="cb17-156"><a href="#cb17-156"></a></span>
<span id="cb17-157"><a href="#cb17-157"></a><span class="co"># Get average gas price for each CBSA by month</span></span>
<span id="cb17-158"><a href="#cb17-158"></a>gas_ids <span class="ot">&lt;-</span> <span class="fu">fredr_series_search_text</span>(</span>
<span id="cb17-159"><a href="#cb17-159"></a>  <span class="st">"Average Price: Gasoline, Unleaded Regular"</span></span>
<span id="cb17-160"><a href="#cb17-160"></a>) <span class="sc">|&gt;</span></span>
<span id="cb17-161"><a href="#cb17-161"></a>  <span class="fu">filter</span>(</span>
<span id="cb17-162"><a href="#cb17-162"></a>    <span class="fu">str_detect</span>(title, <span class="st">"New York|Dallas|San Diego|Detroit"</span>),</span>
<span id="cb17-163"><a href="#cb17-163"></a>    frequency <span class="sc">%in%</span> <span class="st">"Monthly"</span>,</span>
<span id="cb17-164"><a href="#cb17-164"></a>    seasonal_adjustment_short <span class="sc">%in%</span> <span class="st">"NSA"</span></span>
<span id="cb17-165"><a href="#cb17-165"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-166"><a href="#cb17-166"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">str_extract</span>(title, <span class="st">"New York|Dallas|San Diego|Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-167"><a href="#cb17-167"></a>  <span class="fu">select</span>(city, id)</span>
<span id="cb17-168"><a href="#cb17-168"></a></span>
<span id="cb17-169"><a href="#cb17-169"></a>gas_data <span class="ot">&lt;-</span> gas_ids <span class="sc">|&gt;</span></span>
<span id="cb17-170"><a href="#cb17-170"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-171"><a href="#cb17-171"></a>    <span class="at">data =</span> <span class="fu">map</span>(</span>
<span id="cb17-172"><a href="#cb17-172"></a>      id,</span>
<span id="cb17-173"><a href="#cb17-173"></a>      \(x) <span class="fu">fredr</span>(</span>
<span id="cb17-174"><a href="#cb17-174"></a>        <span class="at">series_id =</span> x,</span>
<span id="cb17-175"><a href="#cb17-175"></a>        <span class="at">observation_start =</span> <span class="fu">ymd</span>(<span class="st">"2000-01-01"</span>),</span>
<span id="cb17-176"><a href="#cb17-176"></a>        <span class="at">observation_end =</span> <span class="fu">ymd</span>(<span class="st">"2023-12-31"</span>),</span>
<span id="cb17-177"><a href="#cb17-177"></a>        <span class="at">frequency =</span> <span class="st">"m"</span></span>
<span id="cb17-178"><a href="#cb17-178"></a>      )</span>
<span id="cb17-179"><a href="#cb17-179"></a>    )</span>
<span id="cb17-180"><a href="#cb17-180"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-181"><a href="#cb17-181"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">|&gt;</span></span>
<span id="cb17-182"><a href="#cb17-182"></a>  <span class="fu">unnest</span>(data) <span class="sc">|&gt;</span></span>
<span id="cb17-183"><a href="#cb17-183"></a>  <span class="fu">select</span>(city, date, <span class="at">avg_gas_price =</span> value)</span>
<span id="cb17-184"><a href="#cb17-184"></a></span>
<span id="cb17-185"><a href="#cb17-185"></a><span class="co"># Get average unemployment rate for each MSA by month</span></span>
<span id="cb17-186"><a href="#cb17-186"></a>unemp_ids <span class="ot">&lt;-</span> <span class="fu">fredr_series_search_text</span>(<span class="st">"Unemployment: Rate"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-187"><a href="#cb17-187"></a>  <span class="fu">filter</span>(</span>
<span id="cb17-188"><a href="#cb17-188"></a>    <span class="fu">str_detect</span>(title, <span class="st">"New York|Dallas|San Diego|Detroit"</span>),</span>
<span id="cb17-189"><a href="#cb17-189"></a>    frequency <span class="sc">%in%</span> <span class="st">"Monthly"</span>,</span>
<span id="cb17-190"><a href="#cb17-190"></a>    seasonal_adjustment_short <span class="sc">%in%</span> <span class="st">"NSA"</span></span>
<span id="cb17-191"><a href="#cb17-191"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-192"><a href="#cb17-192"></a>  <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">str_extract</span>(title, <span class="st">"New York|Dallas|San Diego|Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-193"><a href="#cb17-193"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb17-194"><a href="#cb17-194"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-195"><a href="#cb17-195"></a>    <span class="at">rnum =</span> <span class="fu">n</span>(),</span>
<span id="cb17-196"><a href="#cb17-196"></a>    <span class="at">msa_str =</span> <span class="fu">str_detect</span>(title, <span class="st">"MSA"</span>)</span>
<span id="cb17-197"><a href="#cb17-197"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-198"><a href="#cb17-198"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-199"><a href="#cb17-199"></a>  <span class="fu">filter</span>(rnum <span class="sc">==</span> <span class="dv">1</span> <span class="sc">|</span> msa_str) <span class="sc">|&gt;</span></span>
<span id="cb17-200"><a href="#cb17-200"></a>  <span class="fu">select</span>(city, id)</span>
<span id="cb17-201"><a href="#cb17-201"></a></span>
<span id="cb17-202"><a href="#cb17-202"></a>unemp_data <span class="ot">&lt;-</span> unemp_ids <span class="sc">|&gt;</span></span>
<span id="cb17-203"><a href="#cb17-203"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-204"><a href="#cb17-204"></a>    <span class="at">data =</span> <span class="fu">map</span>(</span>
<span id="cb17-205"><a href="#cb17-205"></a>      id,</span>
<span id="cb17-206"><a href="#cb17-206"></a>      \(x) <span class="fu">fredr</span>(</span>
<span id="cb17-207"><a href="#cb17-207"></a>        <span class="at">series_id =</span> x,</span>
<span id="cb17-208"><a href="#cb17-208"></a>        <span class="at">observation_start =</span> <span class="fu">ymd</span>(<span class="st">"2000-01-01"</span>),</span>
<span id="cb17-209"><a href="#cb17-209"></a>        <span class="at">observation_end =</span> <span class="fu">ymd</span>(<span class="st">"2023-12-31"</span>),</span>
<span id="cb17-210"><a href="#cb17-210"></a>        <span class="at">frequency =</span> <span class="st">"m"</span></span>
<span id="cb17-211"><a href="#cb17-211"></a>      )</span>
<span id="cb17-212"><a href="#cb17-212"></a>    )</span>
<span id="cb17-213"><a href="#cb17-213"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-214"><a href="#cb17-214"></a>  <span class="fu">select</span>(<span class="sc">-</span>id) <span class="sc">|&gt;</span></span>
<span id="cb17-215"><a href="#cb17-215"></a>  <span class="fu">unnest</span>(data) <span class="sc">|&gt;</span></span>
<span id="cb17-216"><a href="#cb17-216"></a>  <span class="fu">select</span>(city, date, <span class="at">unemp_rate =</span> value)</span>
<span id="cb17-217"><a href="#cb17-217"></a></span>
<span id="cb17-218"><a href="#cb17-218"></a><span class="in">```</span></span>
<span id="cb17-219"><a href="#cb17-219"></a></span>
<span id="cb17-220"><a href="#cb17-220"></a><span class="fu">## Getting CPS data</span></span>
<span id="cb17-221"><a href="#cb17-221"></a></span>
<span id="cb17-222"><a href="#cb17-222"></a>Getting CPS data at the MSA level is a little more complicated than it is getting data series from FRED. CPS data can contain well over 100K rows for each month because the microdata are released at the household level and each data set has hundreds of variables. It also requires filtering and grouping the data by MSA code, which means getting the MSA codes that correspond to each MSA in my analysis. However, I knew that MSAs can change over time as population shifts. I felt confident that this wouldn't be the case for my chosen cities because of their population sizes, but I wanted to check anyway. Finally, I did thought that pulling in all of that data at once then filtering and aggregating would be computationally inefficient and slow, so, instead, I wrote a function to perform all of the necessary operations and ran it in parallel. I chose the method that I did because most of the time was spent connecting to the CPS API. Once data are imported, the computations are fairly simple.</span>
<span id="cb17-223"><a href="#cb17-223"></a></span>
<span id="cb17-224"><a href="#cb17-224"></a>The first step was to get the MSA codes that corresponded to my cities of interest and check that I had a unique set across all of my years of interest. The data for these MSA codes came from the U.S. Census's technical documentation page and MSA definitions only change once every few years.</span>
<span id="cb17-225"><a href="#cb17-225"></a></span>
<span id="cb17-228"><a href="#cb17-228"></a><span class="in">```{r}</span></span>
<span id="cb17-229"><a href="#cb17-229"></a><span class="co">#| label: get-msa-codes</span></span>
<span id="cb17-230"><a href="#cb17-230"></a><span class="co">#| cache: true</span></span>
<span id="cb17-231"><a href="#cb17-231"></a></span>
<span id="cb17-232"><a href="#cb17-232"></a>msa_code_tbl <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb17-233"><a href="#cb17-233"></a>  <span class="sc">~</span>start_yr, <span class="sc">~</span>end_yr,</span>
<span id="cb17-234"><a href="#cb17-234"></a>  <span class="dv">2003</span>, <span class="dv">2006</span>,</span>
<span id="cb17-235"><a href="#cb17-235"></a>  <span class="dv">2007</span>, <span class="dv">2011</span>,</span>
<span id="cb17-236"><a href="#cb17-236"></a>  <span class="dv">2012</span>, <span class="dv">2016</span>,</span>
<span id="cb17-237"><a href="#cb17-237"></a>  <span class="dv">2017</span>, <span class="dv">2021</span></span>
<span id="cb17-238"><a href="#cb17-238"></a>) <span class="sc">|&gt;</span></span>
<span id="cb17-239"><a href="#cb17-239"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-240"><a href="#cb17-240"></a>    <span class="at">suffix =</span> <span class="fu">str_sub</span>(start_yr, <span class="dv">3</span>, <span class="dv">4</span>),</span>
<span id="cb17-241"><a href="#cb17-241"></a>    <span class="at">msa_url =</span> <span class="fu">map_chr</span>(</span>
<span id="cb17-242"><a href="#cb17-242"></a>      suffix,</span>
<span id="cb17-243"><a href="#cb17-243"></a>      \(x) <span class="fu">str_c</span>(</span>
<span id="cb17-244"><a href="#cb17-244"></a>        <span class="st">"https://www2.census.gov/programs-surveys/cbp/technical-documentation/"</span>,</span>
<span id="cb17-245"><a href="#cb17-245"></a>        <span class="st">"reference/metro-area-geography-reference/msa_county_reference"</span>,</span>
<span id="cb17-246"><a href="#cb17-246"></a>        x,</span>
<span id="cb17-247"><a href="#cb17-247"></a>        <span class="st">".txt"</span></span>
<span id="cb17-248"><a href="#cb17-248"></a>      )</span>
<span id="cb17-249"><a href="#cb17-249"></a>    ),</span>
<span id="cb17-250"><a href="#cb17-250"></a>    <span class="at">msa_code_data =</span> <span class="fu">map</span>(</span>
<span id="cb17-251"><a href="#cb17-251"></a>      msa_url,</span>
<span id="cb17-252"><a href="#cb17-252"></a>      \(x) <span class="fu">read_delim</span>(x, <span class="at">delim =</span> <span class="st">","</span>, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-253"><a href="#cb17-253"></a>        <span class="fu">filter</span>(</span>
<span id="cb17-254"><a href="#cb17-254"></a>          <span class="fu">str_detect</span>(</span>
<span id="cb17-255"><a href="#cb17-255"></a>            name_msa,</span>
<span id="cb17-256"><a href="#cb17-256"></a>            <span class="st">"Dallas.*TX|San Diego.*CA|New York.*NY|Detroit.*MI"</span></span>
<span id="cb17-257"><a href="#cb17-257"></a>          )</span>
<span id="cb17-258"><a href="#cb17-258"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb17-259"><a href="#cb17-259"></a>        <span class="fu">mutate</span>(</span>
<span id="cb17-260"><a href="#cb17-260"></a>          <span class="at">city =</span> <span class="fu">str_extract</span>(name_msa, <span class="st">"Dallas|New York|San Diego|Detroit"</span>),</span>
<span id="cb17-261"><a href="#cb17-261"></a>          <span class="at">msa =</span> <span class="fu">as.character</span>(msa)</span>
<span id="cb17-262"><a href="#cb17-262"></a>        ) <span class="sc">|&gt;</span></span>
<span id="cb17-263"><a href="#cb17-263"></a>        <span class="fu">distinct</span>(city, msa)</span>
<span id="cb17-264"><a href="#cb17-264"></a>    )</span>
<span id="cb17-265"><a href="#cb17-265"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-266"><a href="#cb17-266"></a>  <span class="fu">distinct</span>(msa_code_data) <span class="sc">|&gt;</span></span>
<span id="cb17-267"><a href="#cb17-267"></a>  <span class="fu">unnest</span>(msa_code_data)</span>
<span id="cb17-268"><a href="#cb17-268"></a></span>
<span id="cb17-269"><a href="#cb17-269"></a>msa_code_tbl <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span>
<span id="cb17-270"><a href="#cb17-270"></a></span>
<span id="cb17-271"><a href="#cb17-271"></a><span class="in">```</span></span>
<span id="cb17-272"><a href="#cb17-272"></a></span>
<span id="cb17-273"><a href="#cb17-273"></a>In the next step I defined the function for importing, filtering, and aggregating CPS data.</span>
<span id="cb17-274"><a href="#cb17-274"></a></span>
<span id="cb17-277"><a href="#cb17-277"></a><span class="in">```{r}</span></span>
<span id="cb17-278"><a href="#cb17-278"></a><span class="co">#| label: define-cps-summary-function</span></span>
<span id="cb17-279"><a href="#cb17-279"></a><span class="co">#| cache: true</span></span>
<span id="cb17-280"><a href="#cb17-280"></a></span>
<span id="cb17-281"><a href="#cb17-281"></a>get_cps_summaries <span class="ot">&lt;-</span> <span class="cf">function</span>(cps_df, geographies) {</span>
<span id="cb17-282"><a href="#cb17-282"></a>  cps_df <span class="sc">|&gt;</span></span>
<span id="cb17-283"><a href="#cb17-283"></a>    <span class="fu">rename</span>(<span class="at">hispanic =</span> <span class="fu">matches</span>(<span class="st">"hspnon"</span>), <span class="at">msa =</span> <span class="fu">starts_with</span>(<span class="st">"gt"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-284"><a href="#cb17-284"></a>    <span class="fu">filter</span>(msa <span class="sc">%in%</span> geographies) <span class="sc">|&gt;</span></span>
<span id="cb17-285"><a href="#cb17-285"></a>    <span class="fu">relocate</span>(msa, pwsswgt, prtage, pemaritl, peeduca, hispanic) <span class="sc">|&gt;</span></span>
<span id="cb17-286"><a href="#cb17-286"></a>    <span class="fu">mutate</span>(</span>
<span id="cb17-287"><a href="#cb17-287"></a>      <span class="at">msa =</span> <span class="fu">as.character</span>(msa),</span>
<span id="cb17-288"><a href="#cb17-288"></a>      <span class="at">pwsswgt =</span> <span class="fu">as.numeric</span>(pwsswgt),</span>
<span id="cb17-289"><a href="#cb17-289"></a>      <span class="fu">across</span>(prtage<span class="sc">:</span>hispanic, as.integer),</span>
<span id="cb17-290"><a href="#cb17-290"></a>      <span class="fu">across</span>(prtage<span class="sc">:</span>hispanic, \(x) <span class="fu">na_if</span>(x, <span class="sc">-</span><span class="dv">1</span>)),</span>
<span id="cb17-291"><a href="#cb17-291"></a>      <span class="at">age_lt_18 =</span> prtage <span class="sc">&lt;</span> <span class="dv">18</span>,</span>
<span id="cb17-292"><a href="#cb17-292"></a>      <span class="at">age_18_35 =</span> <span class="fu">between</span>(prtage, <span class="dv">18</span>, <span class="dv">35</span>),</span>
<span id="cb17-293"><a href="#cb17-293"></a>      <span class="at">age_36_65 =</span> <span class="fu">between</span>(prtage, <span class="dv">36</span>, <span class="dv">65</span>),</span>
<span id="cb17-294"><a href="#cb17-294"></a>      <span class="at">age_gt_65 =</span> prtage <span class="sc">&gt;</span> <span class="dv">65</span>,</span>
<span id="cb17-295"><a href="#cb17-295"></a>      <span class="at">educ_hs_less =</span> peeduca <span class="sc">&lt;</span> <span class="dv">40</span>,</span>
<span id="cb17-296"><a href="#cb17-296"></a>      <span class="at">educ_college =</span> peeduca <span class="sc">%in%</span> <span class="dv">40</span><span class="sc">:</span><span class="dv">43</span>,</span>
<span id="cb17-297"><a href="#cb17-297"></a>      <span class="at">educ_grad =</span> peeduca <span class="sc">&gt;</span> <span class="dv">43</span>,</span>
<span id="cb17-298"><a href="#cb17-298"></a>      <span class="at">status_married =</span> pemaritl <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb17-299"><a href="#cb17-299"></a>      <span class="at">status_nev_mar =</span> pemaritl <span class="sc">==</span> <span class="dv">6</span>,</span>
<span id="cb17-300"><a href="#cb17-300"></a>      <span class="at">status_other =</span> <span class="sc">!</span>pemaritl <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">6</span>),</span>
<span id="cb17-301"><a href="#cb17-301"></a>      <span class="at">hispanic =</span> hispanic <span class="sc">==</span> <span class="dv">1</span>,</span>
<span id="cb17-302"><a href="#cb17-302"></a>      <span class="fu">across</span>(</span>
<span id="cb17-303"><a href="#cb17-303"></a>        <span class="fu">c</span>(age_lt_18<span class="sc">:</span>status_other, hispanic),</span>
<span id="cb17-304"><a href="#cb17-304"></a>        \(x) (x <span class="sc">*</span> pwsswgt)</span>
<span id="cb17-305"><a href="#cb17-305"></a>      )</span>
<span id="cb17-306"><a href="#cb17-306"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb17-307"><a href="#cb17-307"></a>    <span class="fu">group_by</span>(msa) <span class="sc">|&gt;</span></span>
<span id="cb17-308"><a href="#cb17-308"></a>    <span class="fu">summarise</span>(</span>
<span id="cb17-309"><a href="#cb17-309"></a>      <span class="fu">across</span>(</span>
<span id="cb17-310"><a href="#cb17-310"></a>        <span class="fu">c</span>(age_lt_18<span class="sc">:</span>status_other, hispanic),</span>
<span id="cb17-311"><a href="#cb17-311"></a>        \(x) <span class="fu">sum</span>(x <span class="sc">/</span> <span class="fu">sum</span>(pwsswgt), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-312"><a href="#cb17-312"></a>      )</span>
<span id="cb17-313"><a href="#cb17-313"></a>    )</span>
<span id="cb17-314"><a href="#cb17-314"></a>}</span>
<span id="cb17-315"><a href="#cb17-315"></a></span>
<span id="cb17-316"><a href="#cb17-316"></a><span class="in">```</span></span>
<span id="cb17-317"><a href="#cb17-317"></a></span>
<span id="cb17-318"><a href="#cb17-318"></a>With that function now defined, I move on to get CPS data using that function.</span>
<span id="cb17-319"><a href="#cb17-319"></a></span>
<span id="cb17-322"><a href="#cb17-322"></a><span class="in">```{r}</span></span>
<span id="cb17-323"><a href="#cb17-323"></a><span class="co">#| label: get-cps-data</span></span>
<span id="cb17-324"><a href="#cb17-324"></a><span class="co">#| cache: true</span></span>
<span id="cb17-325"><a href="#cb17-325"></a></span>
<span id="cb17-326"><a href="#cb17-326"></a><span class="co"># Set up a cluster to get all of the CPS data aggregations</span></span>
<span id="cb17-327"><a href="#cb17-327"></a>cps_clust <span class="ot">&lt;-</span> <span class="fu">new_cluster</span>(<span class="dv">12</span>)</span>
<span id="cb17-328"><a href="#cb17-328"></a><span class="fu">cluster_library</span>(cps_clust, <span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"cpsR"</span>))</span>
<span id="cb17-329"><a href="#cb17-329"></a><span class="fu">cluster_copy</span>(cps_clust, <span class="fu">c</span>(<span class="st">"get_cps_summaries"</span>, <span class="st">"msa_code_tbl"</span>))</span>
<span id="cb17-330"><a href="#cb17-330"></a></span>
<span id="cb17-331"><a href="#cb17-331"></a><span class="co"># Get CPS data aggregations</span></span>
<span id="cb17-332"><a href="#cb17-332"></a>cps_grid <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb17-333"><a href="#cb17-333"></a>  <span class="at">yr =</span> <span class="dv">2006</span><span class="sc">:</span><span class="dv">2023</span>,</span>
<span id="cb17-334"><a href="#cb17-334"></a>  <span class="at">mo =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb17-335"><a href="#cb17-335"></a>) <span class="sc">|&gt;</span></span>
<span id="cb17-336"><a href="#cb17-336"></a>  <span class="fu">partition</span>(cps_clust)</span>
<span id="cb17-337"><a href="#cb17-337"></a></span>
<span id="cb17-338"><a href="#cb17-338"></a>cps_data <span class="ot">&lt;-</span> cps_grid <span class="sc">|&gt;</span></span>
<span id="cb17-339"><a href="#cb17-339"></a>  <span class="fu">arrange</span>(yr, mo) <span class="sc">|&gt;</span></span>
<span id="cb17-340"><a href="#cb17-340"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-341"><a href="#cb17-341"></a>    <span class="at">cps =</span> <span class="fu">map2</span>(</span>
<span id="cb17-342"><a href="#cb17-342"></a>      yr, mo,</span>
<span id="cb17-343"><a href="#cb17-343"></a>      <span class="fu">possibly</span>(</span>
<span id="cb17-344"><a href="#cb17-344"></a>        \(y, m) {</span>
<span id="cb17-345"><a href="#cb17-345"></a>          <span class="fu">get_basic</span>(</span>
<span id="cb17-346"><a href="#cb17-346"></a>            y, m,</span>
<span id="cb17-347"><a href="#cb17-347"></a>            <span class="fu">c</span>(<span class="st">"gtcbsa"</span>, <span class="st">"prtage"</span>, <span class="st">"pemaritl"</span>, <span class="st">"peeduca"</span>, <span class="st">"pehspnon"</span>, <span class="st">"pwsswgt"</span>)</span>
<span id="cb17-348"><a href="#cb17-348"></a>          ) <span class="sc">|&gt;</span></span>
<span id="cb17-349"><a href="#cb17-349"></a>            <span class="fu">get_cps_summaries</span>(msa_code_tbl<span class="sc">$</span>msa)</span>
<span id="cb17-350"><a href="#cb17-350"></a>        }</span>
<span id="cb17-351"><a href="#cb17-351"></a>      )</span>
<span id="cb17-352"><a href="#cb17-352"></a>    )</span>
<span id="cb17-353"><a href="#cb17-353"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-354"><a href="#cb17-354"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-355"><a href="#cb17-355"></a>  <span class="fu">unnest</span>(cps) <span class="sc">|&gt;</span></span>
<span id="cb17-356"><a href="#cb17-356"></a>  <span class="fu">mutate</span>(<span class="at">msa =</span> <span class="fu">as.character</span>(msa)) <span class="sc">|&gt;</span></span>
<span id="cb17-357"><a href="#cb17-357"></a>  <span class="fu">left_join</span>(msa_code_tbl, <span class="at">by =</span> <span class="st">"msa"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-358"><a href="#cb17-358"></a>  <span class="fu">select</span>(<span class="sc">-</span>msa) <span class="sc">|&gt;</span></span>
<span id="cb17-359"><a href="#cb17-359"></a>  <span class="fu">unite</span>(<span class="st">"date"</span>, yr, mo, <span class="at">sep =</span> <span class="st">"-"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-360"><a href="#cb17-360"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ym</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb17-361"><a href="#cb17-361"></a>  <span class="fu">relocate</span>(city, date)</span>
<span id="cb17-362"><a href="#cb17-362"></a></span>
<span id="cb17-363"><a href="#cb17-363"></a><span class="in">```</span></span>
<span id="cb17-364"><a href="#cb17-364"></a></span>
<span id="cb17-367"><a href="#cb17-367"></a><span class="in">```{r}</span></span>
<span id="cb17-368"><a href="#cb17-368"></a><span class="co">#| label: cps-clean-up</span></span>
<span id="cb17-369"><a href="#cb17-369"></a><span class="co">#| include: false</span></span>
<span id="cb17-370"><a href="#cb17-370"></a></span>
<span id="cb17-371"><a href="#cb17-371"></a><span class="fu">rm</span>(cps_grid, cps_clust)</span>
<span id="cb17-372"><a href="#cb17-372"></a><span class="fu">gc</span>()</span>
<span id="cb17-373"><a href="#cb17-373"></a></span>
<span id="cb17-374"><a href="#cb17-374"></a><span class="in">```</span></span>
<span id="cb17-375"><a href="#cb17-375"></a></span>
<span id="cb17-376"><a href="#cb17-376"></a>This is what the CPS data looked like.</span>
<span id="cb17-377"><a href="#cb17-377"></a></span>
<span id="cb17-380"><a href="#cb17-380"></a><span class="in">```{r}</span></span>
<span id="cb17-381"><a href="#cb17-381"></a><span class="co">#| label: show-cps-data</span></span>
<span id="cb17-382"><a href="#cb17-382"></a></span>
<span id="cb17-383"><a href="#cb17-383"></a><span class="fu">head</span>(cps_data) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span>
<span id="cb17-384"><a href="#cb17-384"></a></span>
<span id="cb17-385"><a href="#cb17-385"></a><span class="in">```</span></span>
<span id="cb17-386"><a href="#cb17-386"></a></span>
<span id="cb17-387"><a href="#cb17-387"></a><span class="fu">## Getting population data</span></span>
<span id="cb17-388"><a href="#cb17-388"></a></span>
<span id="cb17-389"><a href="#cb17-389"></a>One would think that if any demographic data is simple to get, population data would be simple, right? I learned something different. I was interested in getting population data at a monthly level for each MSA of interest. I knew population was not counted monthly, but I thought I could get it from the CPS. In fact, one might notice that the code actually calls a population variable (<span class="in">`pwsswgt`</span> ) to perform some calculations. The problem here was that at the MSA level population estimates varied in some cases by as much as 16%. While I I didn't know if this was true or not I did believe (subjectively) that it was unlikely and I believed that CPS weights are not calibrated to MSAs. My understanding is that they are calibrated to the national and state levels. So, I thought a reasonable alternative would be to get data from the ACS 1-year survey and interpolate data from one year to the next. In fact, the reason that I started my time series in 2006 is that the ACS 1-year and 5-year survey data became available in 2005 and I needed one year before the time series for interpolation. However, there was wrinkle caused by COVID. The 1-year ACS was not released for 2020 because of understandable challenges with data collection. So, for 2020 I used ACS 5-year survey data. I started by getting all of the ACS 1-year data. Here again, I processed the data in parallel.</span>
<span id="cb17-390"><a href="#cb17-390"></a></span>
<span id="cb17-393"><a href="#cb17-393"></a><span class="in">```{r}</span></span>
<span id="cb17-394"><a href="#cb17-394"></a><span class="co">#| label: get-acs1-yr</span></span>
<span id="cb17-395"><a href="#cb17-395"></a><span class="co">#| cache: true</span></span>
<span id="cb17-396"><a href="#cb17-396"></a></span>
<span id="cb17-397"><a href="#cb17-397"></a><span class="co"># Create a cluster for getting ACS data</span></span>
<span id="cb17-398"><a href="#cb17-398"></a>acs_clust <span class="ot">&lt;-</span> <span class="fu">new_cluster</span>(<span class="dv">12</span>)</span>
<span id="cb17-399"><a href="#cb17-399"></a><span class="fu">cluster_library</span>(acs_clust, <span class="fu">c</span>(<span class="st">"tidyverse"</span>, <span class="st">"tidycensus"</span>))</span>
<span id="cb17-400"><a href="#cb17-400"></a></span>
<span id="cb17-401"><a href="#cb17-401"></a><span class="co"># Get ACS data for 2005 to 2019, 2021, and 2022</span></span>
<span id="cb17-402"><a href="#cb17-402"></a>acs1_pop_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2005</span><span class="sc">:</span><span class="dv">2019</span>, <span class="dv">2021</span><span class="sc">:</span><span class="dv">2022</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-403"><a href="#cb17-403"></a>  <span class="fu">partition</span>(acs_clust) <span class="sc">|&gt;</span></span>
<span id="cb17-404"><a href="#cb17-404"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-405"><a href="#cb17-405"></a>    <span class="at">pop_data =</span> <span class="fu">map</span>(</span>
<span id="cb17-406"><a href="#cb17-406"></a>      year,</span>
<span id="cb17-407"><a href="#cb17-407"></a>      \(x) <span class="fu">get_acs</span>(</span>
<span id="cb17-408"><a href="#cb17-408"></a>        <span class="at">year =</span> x,</span>
<span id="cb17-409"><a href="#cb17-409"></a>        <span class="at">variables =</span> <span class="st">"B01001_001"</span>,</span>
<span id="cb17-410"><a href="#cb17-410"></a>        <span class="at">geography =</span> <span class="st">"cbsa"</span>,</span>
<span id="cb17-411"><a href="#cb17-411"></a>        <span class="at">survey =</span> <span class="st">"acs1"</span>,</span>
<span id="cb17-412"><a href="#cb17-412"></a>        <span class="at">show_call =</span> <span class="cn">FALSE</span></span>
<span id="cb17-413"><a href="#cb17-413"></a>      ) <span class="sc">|&gt;</span></span>
<span id="cb17-414"><a href="#cb17-414"></a>        <span class="fu">filter</span>(<span class="fu">str_detect</span>(NAME, <span class="st">"New York|Dallas|San Diego|Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-415"><a href="#cb17-415"></a>        <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">str_extract</span>(NAME, <span class="st">"New York|Dallas|San Diego|Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-416"><a href="#cb17-416"></a>        <span class="fu">select</span>(city, <span class="at">population =</span> estimate)</span>
<span id="cb17-417"><a href="#cb17-417"></a>    )</span>
<span id="cb17-418"><a href="#cb17-418"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-419"><a href="#cb17-419"></a>  <span class="fu">collect</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-420"><a href="#cb17-420"></a>  <span class="fu">unnest</span>(pop_data) <span class="sc">|&gt;</span></span>
<span id="cb17-421"><a href="#cb17-421"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">str_c</span>(year, <span class="st">"12"</span>) <span class="sc">|&gt;</span> <span class="fu">ym</span>(), <span class="at">.keep =</span> <span class="st">"unused"</span>)</span>
<span id="cb17-422"><a href="#cb17-422"></a></span>
<span id="cb17-423"><a href="#cb17-423"></a><span class="in">```</span></span>
<span id="cb17-424"><a href="#cb17-424"></a></span>
<span id="cb17-427"><a href="#cb17-427"></a><span class="in">```{r}</span></span>
<span id="cb17-428"><a href="#cb17-428"></a><span class="co">#| label: acs-clean-up</span></span>
<span id="cb17-429"><a href="#cb17-429"></a><span class="co">#| include: false</span></span>
<span id="cb17-430"><a href="#cb17-430"></a></span>
<span id="cb17-431"><a href="#cb17-431"></a><span class="fu">rm</span>(acs_clust)</span>
<span id="cb17-432"><a href="#cb17-432"></a><span class="fu">gc</span>()</span>
<span id="cb17-433"><a href="#cb17-433"></a></span>
<span id="cb17-434"><a href="#cb17-434"></a><span class="in">```</span></span>
<span id="cb17-435"><a href="#cb17-435"></a></span>
<span id="cb17-436"><a href="#cb17-436"></a>Next I got the data for 2020 and combined it with the ACS 1-year data. I performed interpolation using the <span class="in">`ts_impute_vec()`</span> function from the <span class="co">[</span><span class="ot">timetk</span><span class="co">](https://business-science.github.io/timetk/)</span> <span class="co">[</span><span class="ot">@timetk</span><span class="co">]</span> package.</span>
<span id="cb17-437"><a href="#cb17-437"></a></span>
<span id="cb17-440"><a href="#cb17-440"></a><span class="in">```{r}</span></span>
<span id="cb17-441"><a href="#cb17-441"></a><span class="co">#| label: complete-acs-data</span></span>
<span id="cb17-442"><a href="#cb17-442"></a><span class="co">#| cache: true</span></span>
<span id="cb17-443"><a href="#cb17-443"></a></span>
<span id="cb17-444"><a href="#cb17-444"></a><span class="co"># Get data for 2020 separately since it wasn't available in the ACS 1-year</span></span>
<span id="cb17-445"><a href="#cb17-445"></a>acs5_pop_data <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(</span>
<span id="cb17-446"><a href="#cb17-446"></a>  <span class="at">year =</span> <span class="dv">2020</span>,</span>
<span id="cb17-447"><a href="#cb17-447"></a>  <span class="at">variables =</span> <span class="st">"B01001_001"</span>,</span>
<span id="cb17-448"><a href="#cb17-448"></a>  <span class="at">geography =</span> <span class="st">"cbsa"</span>,</span>
<span id="cb17-449"><a href="#cb17-449"></a>  <span class="at">survey =</span> <span class="st">"acs5"</span>,</span>
<span id="cb17-450"><a href="#cb17-450"></a>  <span class="at">show_call =</span> <span class="cn">FALSE</span></span>
<span id="cb17-451"><a href="#cb17-451"></a>) <span class="sc">|&gt;</span></span>
<span id="cb17-452"><a href="#cb17-452"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(NAME, <span class="st">"New York|Dallas|San Diego|Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-453"><a href="#cb17-453"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-454"><a href="#cb17-454"></a>    <span class="at">city =</span> <span class="fu">str_extract</span>(NAME, <span class="st">"New York|Dallas|San Diego|Detroit"</span>),</span>
<span id="cb17-455"><a href="#cb17-455"></a>    <span class="at">date =</span> <span class="fu">rep</span>(<span class="fu">ym</span>(<span class="st">"2020-12"</span>), <span class="dv">4</span>),</span>
<span id="cb17-456"><a href="#cb17-456"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-457"><a href="#cb17-457"></a>  <span class="fu">select</span>(city, date, <span class="at">population =</span> estimate)</span>
<span id="cb17-458"><a href="#cb17-458"></a></span>
<span id="cb17-459"><a href="#cb17-459"></a><span class="co"># Put together all the ACS population data and interpolate between annual</span></span>
<span id="cb17-460"><a href="#cb17-460"></a><span class="co"># estimates</span></span>
<span id="cb17-461"><a href="#cb17-461"></a>acs_pop_data <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb17-462"><a href="#cb17-462"></a>  <span class="at">yr =</span> <span class="dv">2006</span><span class="sc">:</span><span class="dv">2022</span>,</span>
<span id="cb17-463"><a href="#cb17-463"></a>  <span class="at">mo =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span></span>
<span id="cb17-464"><a href="#cb17-464"></a>) <span class="sc">|&gt;</span></span>
<span id="cb17-465"><a href="#cb17-465"></a>  <span class="fu">add_row</span>(<span class="at">yr =</span> <span class="dv">2005</span>, <span class="at">mo =</span> <span class="dv">12</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-466"><a href="#cb17-466"></a>  <span class="fu">expand_grid</span>(<span class="at">city =</span> <span class="fu">c</span>(<span class="st">"New York"</span>, <span class="st">"Dallas"</span>, <span class="st">"San Diego"</span>, <span class="st">"Detroit"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb17-467"><a href="#cb17-467"></a>  <span class="fu">unite</span>(date, yr, mo, <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">remove =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-468"><a href="#cb17-468"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ym</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb17-469"><a href="#cb17-469"></a>  <span class="fu">arrange</span>(date, city) <span class="sc">|&gt;</span></span>
<span id="cb17-470"><a href="#cb17-470"></a>  <span class="fu">left_join</span>(</span>
<span id="cb17-471"><a href="#cb17-471"></a>    <span class="fu">bind_rows</span>(acs1_pop_data, acs5_pop_data),</span>
<span id="cb17-472"><a href="#cb17-472"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"city"</span>, <span class="st">"date"</span>)</span>
<span id="cb17-473"><a href="#cb17-473"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-474"><a href="#cb17-474"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb17-475"><a href="#cb17-475"></a>  <span class="fu">arrange</span>(date) <span class="sc">|&gt;</span></span>
<span id="cb17-476"><a href="#cb17-476"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-477"><a href="#cb17-477"></a>    <span class="at">population =</span> timetk<span class="sc">::</span><span class="fu">ts_impute_vec</span>(population, <span class="at">period =</span> <span class="dv">1</span>),</span>
<span id="cb17-478"><a href="#cb17-478"></a>    <span class="at">pop_chg =</span> (population <span class="sc">/</span> <span class="fu">lag</span>(population)) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb17-479"><a href="#cb17-479"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb17-480"><a href="#cb17-480"></a>  <span class="fu">drop_na</span>(pop_chg) <span class="sc">|&gt;</span></span>
<span id="cb17-481"><a href="#cb17-481"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-482"><a href="#cb17-482"></a>  <span class="fu">select</span>(<span class="sc">!</span>population)</span>
<span id="cb17-483"><a href="#cb17-483"></a></span>
<span id="cb17-484"><a href="#cb17-484"></a><span class="fu">head</span>(acs_pop_data) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span>
<span id="cb17-485"><a href="#cb17-485"></a></span>
<span id="cb17-486"><a href="#cb17-486"></a><span class="in">```</span></span>
<span id="cb17-487"><a href="#cb17-487"></a></span>
<span id="cb17-488"><a href="#cb17-488"></a><span class="fu">## Merge data and check</span></span>
<span id="cb17-489"><a href="#cb17-489"></a></span>
<span id="cb17-490"><a href="#cb17-490"></a>With all of the data gathered and each data set containing variables for city and date (monthly) along with at least one demographic or economic variable, they were ready to be merged.</span>
<span id="cb17-491"><a href="#cb17-491"></a></span>
<span id="cb17-494"><a href="#cb17-494"></a><span class="in">```{r}</span></span>
<span id="cb17-495"><a href="#cb17-495"></a><span class="co">#| label: merge-data</span></span>
<span id="cb17-496"><a href="#cb17-496"></a></span>
<span id="cb17-497"><a href="#cb17-497"></a>econ_data <span class="ot">&lt;-</span> <span class="fu">list</span>(hpi_data, unemp_data, gas_data, cps_data, acs_pop_data) <span class="sc">|&gt;</span></span>
<span id="cb17-498"><a href="#cb17-498"></a>  <span class="fu">reduce</span>(inner_join, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"city"</span>, <span class="st">"date"</span>))</span>
<span id="cb17-499"><a href="#cb17-499"></a></span>
<span id="cb17-500"><a href="#cb17-500"></a><span class="in">```</span></span>
<span id="cb17-501"><a href="#cb17-501"></a></span>
<span id="cb17-502"><a href="#cb17-502"></a>It would be a mistake to ever think that there is no more cleaning that can be done, so I skimmed the data using the <span class="in">`skimr()`</span> function from the <span class="co">[</span><span class="ot">skimr</span><span class="co">](https://github.com/ropensci/skimr)</span> <span class="co">[</span><span class="ot">@skimr</span><span class="co">]</span> package.</span>
<span id="cb17-503"><a href="#cb17-503"></a></span>
<span id="cb17-506"><a href="#cb17-506"></a><span class="in">```{r}</span></span>
<span id="cb17-507"><a href="#cb17-507"></a><span class="co">#| label: skim-data</span></span>
<span id="cb17-508"><a href="#cb17-508"></a></span>
<span id="cb17-509"><a href="#cb17-509"></a>skimr<span class="sc">::</span><span class="fu">skim</span>(econ_data)</span>
<span id="cb17-510"><a href="#cb17-510"></a></span>
<span id="cb17-511"><a href="#cb17-511"></a><span class="in">```</span></span>
<span id="cb17-512"><a href="#cb17-512"></a></span>
<span id="cb17-513"><a href="#cb17-513"></a>Overall the data look good except for the <span class="in">`avg_gas_price`</span> variable, which is the only variable that has any missing values. I'll turn to that shortly, but I'll briefly describe the variables in the data set below:</span>
<span id="cb17-514"><a href="#cb17-514"></a></span>
<span id="cb17-515"><a href="#cb17-515"></a><span class="ss">-   </span><span class="in">`city`</span> : self-explanatory</span>
<span id="cb17-516"><a href="#cb17-516"></a></span>
<span id="cb17-517"><a href="#cb17-517"></a><span class="ss">-   </span><span class="in">`date`</span>: month expressed as the first day of the month</span>
<span id="cb17-518"><a href="#cb17-518"></a></span>
<span id="cb17-519"><a href="#cb17-519"></a><span class="ss">-   </span><span class="in">`hpi`</span>: Case-Shiller Home Price Index value</span>
<span id="cb17-520"><a href="#cb17-520"></a></span>
<span id="cb17-521"><a href="#cb17-521"></a><span class="ss">-   </span><span class="in">`unemp_rate`</span>: Unemployment rate</span>
<span id="cb17-522"><a href="#cb17-522"></a></span>
<span id="cb17-523"><a href="#cb17-523"></a><span class="ss">-   </span><span class="in">`avg_gas_price`</span>: Average gas price</span>
<span id="cb17-524"><a href="#cb17-524"></a></span>
<span id="cb17-525"><a href="#cb17-525"></a><span class="ss">-   </span><span class="in">`age_lt_18`</span>: Proportion of the population younger than 18 years old</span>
<span id="cb17-526"><a href="#cb17-526"></a></span>
<span id="cb17-527"><a href="#cb17-527"></a><span class="ss">-   </span><span class="in">`age_18_35`</span>: Proportion of the population between the ages of 18 and 35</span>
<span id="cb17-528"><a href="#cb17-528"></a></span>
<span id="cb17-529"><a href="#cb17-529"></a><span class="ss">-   </span><span class="in">`age_36_65`</span>: Proportion of the population between the ages of 36 and 65</span>
<span id="cb17-530"><a href="#cb17-530"></a></span>
<span id="cb17-531"><a href="#cb17-531"></a><span class="ss">-   </span><span class="in">`age_gt_65`</span>: Proportion of the population older than 65 years old</span>
<span id="cb17-532"><a href="#cb17-532"></a></span>
<span id="cb17-533"><a href="#cb17-533"></a><span class="ss">-   </span><span class="in">`educ_hs_less`</span>: Proportion of the population with up to a high school diploma</span>
<span id="cb17-534"><a href="#cb17-534"></a></span>
<span id="cb17-535"><a href="#cb17-535"></a><span class="ss">-   </span><span class="in">`educ_college`</span>: Proportion of the population with more than a high school diploma and up to a bachelor's degree</span>
<span id="cb17-536"><a href="#cb17-536"></a></span>
<span id="cb17-537"><a href="#cb17-537"></a><span class="ss">-   </span><span class="in">`educ_grad`</span>: Proportion of the population with education higher than a bachelor's degree</span>
<span id="cb17-538"><a href="#cb17-538"></a></span>
<span id="cb17-539"><a href="#cb17-539"></a><span class="ss">-   </span><span class="in">`status_married`</span>: Proportion of the population that is married; including separated</span>
<span id="cb17-540"><a href="#cb17-540"></a></span>
<span id="cb17-541"><a href="#cb17-541"></a><span class="ss">-   </span><span class="in">`status_nev_mar`</span>: Proportion of the population that has never been married</span>
<span id="cb17-542"><a href="#cb17-542"></a></span>
<span id="cb17-543"><a href="#cb17-543"></a><span class="ss">-   </span><span class="in">`status_other`</span>: Proportion of the population not categorized as either <span class="in">`status_married`</span> or <span class="in">`status_nev_mar`</span></span>
<span id="cb17-544"><a href="#cb17-544"></a></span>
<span id="cb17-545"><a href="#cb17-545"></a><span class="ss">-   </span><span class="in">`hispanic`</span>: Proportion of the population that reported Hispanic ethnicity</span>
<span id="cb17-546"><a href="#cb17-546"></a></span>
<span id="cb17-547"><a href="#cb17-547"></a><span class="ss">-   </span><span class="in">`pop_chg`</span>: Population change from one month to the next</span>
<span id="cb17-548"><a href="#cb17-548"></a></span>
<span id="cb17-549"><a href="#cb17-549"></a>Once I skimmed the data, I took a closer look at the percent of <span class="in">`avg_gas_price`</span> values that were missing for each city.</span>
<span id="cb17-550"><a href="#cb17-550"></a></span>
<span id="cb17-553"><a href="#cb17-553"></a><span class="in">```{r}</span></span>
<span id="cb17-554"><a href="#cb17-554"></a><span class="co">#| label: check-avg-gas-missing</span></span>
<span id="cb17-555"><a href="#cb17-555"></a></span>
<span id="cb17-556"><a href="#cb17-556"></a>econ_data <span class="sc">|&gt;</span></span>
<span id="cb17-557"><a href="#cb17-557"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb17-558"><a href="#cb17-558"></a>  <span class="fu">summarise</span>(<span class="at">pct_miss_gas =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(avg_gas_price)) <span class="sc">/</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span></span>
<span id="cb17-559"><a href="#cb17-559"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> pct_miss_gas, <span class="at">x =</span> city)) <span class="sc">+</span></span>
<span id="cb17-560"><a href="#cb17-560"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"#2c3e50"</span>) <span class="sc">+</span></span>
<span id="cb17-561"><a href="#cb17-561"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="fl">1.1</span>), <span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb17-562"><a href="#cb17-562"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-563"><a href="#cb17-563"></a>    <span class="at">y =</span> <span class="st">"Percent Missing"</span>,</span>
<span id="cb17-564"><a href="#cb17-564"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb17-565"><a href="#cb17-565"></a>    <span class="at">title =</span> <span class="st">"Missingness in avg_gas_price variable by city"</span></span>
<span id="cb17-566"><a href="#cb17-566"></a>  ) <span class="sc">+</span> </span>
<span id="cb17-567"><a href="#cb17-567"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb17-568"><a href="#cb17-568"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb17-569"><a href="#cb17-569"></a></span>
<span id="cb17-570"><a href="#cb17-570"></a><span class="in">```</span></span>
<span id="cb17-571"><a href="#cb17-571"></a></span>
<span id="cb17-572"><a href="#cb17-572"></a>Evidently data were missing only for San Diego. Below are the start and end dates of average gas price data for San Diego in this data set.</span>
<span id="cb17-573"><a href="#cb17-573"></a></span>
<span id="cb17-576"><a href="#cb17-576"></a><span class="in">```{r}</span></span>
<span id="cb17-577"><a href="#cb17-577"></a><span class="co">#| label: show-avg-gas-dates</span></span>
<span id="cb17-578"><a href="#cb17-578"></a></span>
<span id="cb17-579"><a href="#cb17-579"></a>econ_data <span class="sc">|&gt;</span></span>
<span id="cb17-580"><a href="#cb17-580"></a>  <span class="fu">filter</span>(city <span class="sc">%in%</span> <span class="st">"San Diego"</span>, <span class="sc">!</span><span class="fu">is.na</span>(avg_gas_price)) <span class="sc">|&gt;</span></span>
<span id="cb17-581"><a href="#cb17-581"></a>  <span class="fu">summarise</span>(<span class="at">start_date =</span> <span class="fu">min</span>(date), <span class="at">end_date =</span> <span class="fu">max</span>(date)) <span class="sc">|&gt;</span></span>
<span id="cb17-582"><a href="#cb17-582"></a>  <span class="fu">gt</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-583"><a href="#cb17-583"></a>  <span class="fu">gt_bold_head</span>()</span>
<span id="cb17-584"><a href="#cb17-584"></a></span>
<span id="cb17-585"><a href="#cb17-585"></a><span class="in">```</span></span>
<span id="cb17-586"><a href="#cb17-586"></a></span>
<span id="cb17-587"><a href="#cb17-587"></a>As it turns out, reports of average gas price data for San Diego start in January of 2018, which means that 12 years of data would be missing. With that many values missing for one of the cities it makes sense to drop the average gas price variable.</span>
<span id="cb17-588"><a href="#cb17-588"></a></span>
<span id="cb17-591"><a href="#cb17-591"></a><span class="in">```{r}</span></span>
<span id="cb17-592"><a href="#cb17-592"></a><span class="co">#| label: drop-avg-gas</span></span>
<span id="cb17-593"><a href="#cb17-593"></a></span>
<span id="cb17-594"><a href="#cb17-594"></a>econ_data <span class="ot">&lt;-</span> <span class="fu">select</span>(econ_data, <span class="sc">!</span>avg_gas_price)</span>
<span id="cb17-595"><a href="#cb17-595"></a></span>
<span id="cb17-596"><a href="#cb17-596"></a>econ_data <span class="sc">|&gt;</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">|&gt;</span> <span class="fu">gt</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span>
<span id="cb17-597"><a href="#cb17-597"></a></span>
<span id="cb17-598"><a href="#cb17-598"></a><span class="in">```</span></span>
<span id="cb17-599"><a href="#cb17-599"></a></span>
<span id="cb17-600"><a href="#cb17-600"></a>Finally, I'd like to visualize the densities of all of the variables by city just to make sure nothing jumps out that might need any correction.</span>
<span id="cb17-601"><a href="#cb17-601"></a></span>
<span id="cb17-604"><a href="#cb17-604"></a><span class="in">```{r}</span></span>
<span id="cb17-605"><a href="#cb17-605"></a><span class="co">#| label: plot-densities</span></span>
<span id="cb17-606"><a href="#cb17-606"></a></span>
<span id="cb17-607"><a href="#cb17-607"></a>econ_data <span class="sc">|&gt;</span></span>
<span id="cb17-608"><a href="#cb17-608"></a>  <span class="fu">select</span>(<span class="sc">-</span>date) <span class="sc">|&gt;</span></span>
<span id="cb17-609"><a href="#cb17-609"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>city, <span class="at">names_to =</span> <span class="st">"variable"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-610"><a href="#cb17-610"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> value, <span class="at">fill =</span> city)) <span class="sc">+</span></span>
<span id="cb17-611"><a href="#cb17-611"></a>  <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb17-612"><a href="#cb17-612"></a>  <span class="fu">facet_wrap</span>(<span class="st">"variable"</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb17-613"><a href="#cb17-613"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb17-614"><a href="#cb17-614"></a></span>
<span id="cb17-615"><a href="#cb17-615"></a><span class="in">```</span></span>
<span id="cb17-616"><a href="#cb17-616"></a></span>
<span id="cb17-617"><a href="#cb17-617"></a>There are some interesting patterns, particularly in the differences across the age groups, but there's nothing alarming. With all this data in hand, the next step is to perform some time series analysis on the Case-Shiller HPI which I'll show in Part 2 of this set of posts.</span>
</code></pre></div><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>