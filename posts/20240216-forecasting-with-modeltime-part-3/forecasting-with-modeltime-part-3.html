<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Arcenis Rojas">
<meta name="dcterms.date" content="2024-02-16">

<title>Arcenis Rojas - Forecasting with {modeltime} - Part III</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Arcenis Rojas</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html"> 
<span class="menu-text">Personal Projects</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../ce-dashboards.html"> 
<span class="menu-text">Dashboards</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://linkedin.com/in/arcenisrojas" target="_blank"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/arcenis-r" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#time-series-analysis-review" id="toc-time-series-analysis-review" class="nav-link active" data-scroll-target="#time-series-analysis-review">Time Series Analysis Review</a></li>
  <li><a href="#differences-between-global-and-iterative-modeling" id="toc-differences-between-global-and-iterative-modeling" class="nav-link" data-scroll-target="#differences-between-global-and-iterative-modeling">Differences between global and iterative modeling</a></li>
  <li><a href="#building-a-global-arima-model" id="toc-building-a-global-arima-model" class="nav-link" data-scroll-target="#building-a-global-arima-model">Building a global ARIMA model</a>
  <ul class="collapse">
  <li><a href="#splitting-data" id="toc-splitting-data" class="nav-link" data-scroll-target="#splitting-data">Splitting data</a></li>
  <li><a href="#specifying-a-modeling-workflow-and-fit-the-model" id="toc-specifying-a-modeling-workflow-and-fit-the-model" class="nav-link" data-scroll-target="#specifying-a-modeling-workflow-and-fit-the-model">Specifying a modeling workflow and fit the model</a></li>
  <li><a href="#model-evaluation" id="toc-model-evaluation" class="nav-link" data-scroll-target="#model-evaluation">Model evaluation</a></li>
  <li><a href="#forecasting-the-future" id="toc-forecasting-the-future" class="nav-link" data-scroll-target="#forecasting-the-future">Forecasting the future</a></li>
  </ul></li>
  <li><a href="#building-an-iterative-arima-model" id="toc-building-an-iterative-arima-model" class="nav-link" data-scroll-target="#building-an-iterative-arima-model">Building an iterative ARIMA model</a>
  <ul class="collapse">
  <li><a href="#splitting-data-1" id="toc-splitting-data-1" class="nav-link" data-scroll-target="#splitting-data-1">Splitting data</a></li>
  <li><a href="#specifying-a-modeling-workflow-and-fit-the-model-1" id="toc-specifying-a-modeling-workflow-and-fit-the-model-1" class="nav-link" data-scroll-target="#specifying-a-modeling-workflow-and-fit-the-model-1">Specifying a modeling workflow and fit the model</a></li>
  <li><a href="#model-evaluation-1" id="toc-model-evaluation-1" class="nav-link" data-scroll-target="#model-evaluation-1">Model evaluation</a></li>
  <li><a href="#forecasting-the-future-1" id="toc-forecasting-the-future-1" class="nav-link" data-scroll-target="#forecasting-the-future-1">Forecasting the future</a></li>
  </ul></li>
  <li><a href="#comparison" id="toc-comparison" class="nav-link" data-scroll-target="#comparison">Comparison</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Forecasting with {modeltime} - Part III</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Global vs.&nbsp;iterative modeling</p>
  <div class="quarto-categories">
    <div class="quarto-category">time series analysis</div>
    <div class="quarto-category">econometrics</div>
    <div class="quarto-category">data viz</div>
  </div>
  </div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Arcenis Rojas </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 16, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>In my previous post on this topic – <a href="../../posts/20240215-forecasting-with-modeltime-part-2/forecasting-with-modeltime-part-2.html">Forecasting with {modeltime} - Part II</a> – I performed a basic analysis of the Case-Shiller HPI time series for four U.S. cities (Dallas, Detroit, NYC, and San Diego). In this post I’m going to use some of the conclusions from that analysis to build ARIMA models using both a “global” modeling process and an “iterative” modeling process using the <a href="https://business-science.github.io/modeltime/index.html">modeltime</a> <span class="citation" data-cites="modeltime">(<a href="#ref-modeltime" role="doc-biblioref">Dancho 2023</a>)</span> and <a href="https://www.tidymodels.org/">tidymodels</a> <span class="citation" data-cites="tidymodels">(<a href="#ref-tidymodels" role="doc-biblioref">Kuhn and Wickham 2020</a>)</span> frameworks.</p>
<p>One of the distinguishing features of <code>modeltime</code> among other time series modeling frameworks is that it works very well with <code>tidymodels</code>. In fact, like <code>tidymodels</code> , <code>modeltime</code> serves as a platform for building consistent workflows using algorithms from other packages. <code>modeltime</code> builds on top of <code>tidymodels</code> to create a framework for dealing with the specific challenges of time series modelling and putting it all in a convenient, consistent API.</p>
<p>I’ll also be using <a href="https://www.tidyverse.org/">tidyverse</a> <span class="citation" data-cites="tidyverse">(<a href="#ref-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span> and <a href="https://gt.rstudio.com/">gt</a> <span class="citation" data-cites="gt">(<a href="#ref-gt" role="doc-biblioref">Iannone et al. 2024</a>)</span>, per usual, and <a href="https://business-science.github.io/timetk/">timetk</a> <span class="citation" data-cites="timetk">(<a href="#ref-timetk" role="doc-biblioref">Dancho and Vaughan 2023</a>)</span>. <code>modeltime</code> and <code>timetk</code> are developed and maintained by the good people at <a href="https://www.business-science.io/">Business Science</a> and <code>tidyverse</code>, <code>tidymodels</code>, and <code>gt</code> are developed and maintained by the generous folks at <a href="https://posit.co/">Posit</a>.</p>
<section id="time-series-analysis-review" class="level2">
<h2 class="anchored" data-anchor-id="time-series-analysis-review">Time Series Analysis Review</h2>
<p>In the aforementioned time series analysis I found that the time series data for all four cities had a strong trend and a strong seasonal component. The trend was mostly muted by using a lag of 1 and the seasonal component of each series was generally muted by differencing twelve times, which makes sense given that the data are monthly (annual seasonal cycle). I was able to use these methods to greatly reduce the influence of non-stationary components according to the Augmented Dickey-Fuller test. The ACF and PACF plots led me to conclude to use an AR(3) and MA(5) ARIMA model. To deal with the seasonality I differenced the data twelve times. This will translate to a seasonal differencing component of (1) in the ARIMA model. In the previous post I wrote that I would be performing ARIMA rather than SARIMA… things change.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(timetk)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(modeltime)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="fu">library</span>(gt)</span>
<span id="cb1-6"><a href="#cb1-6"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb1-7"><a href="#cb1-7"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"lag"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">tidymodels_prefer</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="differences-between-global-and-iterative-modeling" class="level2">
<h2 class="anchored" data-anchor-id="differences-between-global-and-iterative-modeling">Differences between global and iterative modeling</h2>
<p>Conventionally, time series models work by regressing the outcome – the most recent or future observation(s) – on previous observations of itself. We can refer to this as a “local” model because the variance in the data corresponds to only the single time series. A global model, on the other hand, pools the data to get a global variance and uses that information to make forecasts.</p>
<p>The primary advantages of a global model are speed and scalability. A second advantage is that each, individual forecasting model can “learn” from the history of the other time series that it’s pooled with. The disadvantage is that each individual model will likely be less accurate than if it was fit on an individual basis.</p>
<p>The advantage of modeling time series locally and iteratively is that this process most likely yields the highest quality fit and accuracy for each, individual model. The disadvantage is that as the number of models grows, so do the computational burden and processing time.</p>
<p>In two sections below I’ll demonstrate both processes with an ARIMA model using the parameters mentioned above and in the last section I’ll compare the results from both.</p>
</section>
<section id="building-a-global-arima-model" class="level2">
<h2 class="anchored" data-anchor-id="building-a-global-arima-model">Building a global ARIMA model</h2>
<p>As mentioned above, <code>modeltime</code> follows the Tidymodels convention. As such, it starts with partitioning data into training and testing data sets, continues with writing a recipe and model specification (and combining them in a <code>workflow</code> object), follows with fitting the model, and continues with model evaluation and selection.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>For more information on the Tidymodels framework, please check out <a href="https://www.tmwr.org/" class="uri">https://www.tmwr.org/</a>.</p>
</div>
</div>
<section id="splitting-data" class="level3">
<h3 class="anchored" data-anchor-id="splitting-data">Splitting data</h3>
<p>For a global modeling process one can use the timetk::time_series_split() function which will create a list containing the data set, one vector of training data IDs and one of testing data IDs, and a 1-column data set containing all IDs.</p>
<p>The time_series_split() function uses 5 initial cross-validation periods by default with each one being progressively longer using a specified period of time as the assessment period. This assessment period is specified by the asses argument.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>econ_splits_global <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">time_series_split</span>(</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="at">assess =</span> <span class="st">"2 year"</span>,</span>
<span id="cb2-4"><a href="#cb2-4"></a>    <span class="at">cumulative =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-5"><a href="#cb2-5"></a>    <span class="at">date_var =</span> date   </span>
<span id="cb2-6"><a href="#cb2-6"></a>  )</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="fu">str</span>(econ_splits_global)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>List of 4
 $ data  : tibble [816 × 3] (S3: tbl_df/tbl/data.frame)
  ..$ city: chr [1:816] "Dallas" "San Diego" "New York" "Detroit" ...
  ..$ date: Date[1:816], format: "2006-01-01" "2006-01-01" ...
  ..$ hpi : num [1:816] 122 247 213 127 121 ...
 $ in_id : int [1:720] 1 2 3 4 5 6 7 8 9 10 ...
 $ out_id: int [1:96] 721 722 723 724 725 726 727 728 729 730 ...
 $ id    : tibble [1 × 1] (S3: tbl_df/tbl/data.frame)
  ..$ id: chr "Slice1"
 - attr(*, "class")= chr [1:2] "ts_cv_split" "rsplit"</code></pre>
</div>
</div>
</section>
<section id="specifying-a-modeling-workflow-and-fit-the-model" class="level3">
<h3 class="anchored" data-anchor-id="specifying-a-modeling-workflow-and-fit-the-model">Specifying a modeling workflow and fit the model</h3>
<p>To specify the workflow I’ll first write the recipe…</p>
<div class="callout callout-style-default callout-caution callout-titled" title="Lagging/Differencing as a recipe step">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lagging/Differencing as a recipe step
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>One might be tempted to add lags and differences in the recipe, but this leads to a mess that’s really difficult to get out of. It all starts with the fact that a lagged and/or differenced variable will have a different name and will create missing values. I found that it’s best to handle these operations in the model specification.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>arima_rec_global <span class="ot">&lt;-</span> <span class="fu">recipe</span>(hpi <span class="sc">~</span> date, <span class="at">data =</span> <span class="fu">training</span>(econ_splits_global))</span>
<span id="cb4-2"><a href="#cb4-2"></a></span>
<span id="cb4-3"><a href="#cb4-3"></a>arima_rec_global <span class="sc">|&gt;</span> <span class="fu">summary</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="yxbcuknfdq" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#yxbcuknfdq table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#yxbcuknfdq thead, #yxbcuknfdq tbody, #yxbcuknfdq tfoot, #yxbcuknfdq tr, #yxbcuknfdq td, #yxbcuknfdq th {
  border-style: none;
}

#yxbcuknfdq p {
  margin: 0;
  padding: 0;
}

#yxbcuknfdq .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#yxbcuknfdq .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#yxbcuknfdq .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#yxbcuknfdq .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#yxbcuknfdq .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yxbcuknfdq .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yxbcuknfdq .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#yxbcuknfdq .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#yxbcuknfdq .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#yxbcuknfdq .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#yxbcuknfdq .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#yxbcuknfdq .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#yxbcuknfdq .gt_spanner_row {
  border-bottom-style: hidden;
}

#yxbcuknfdq .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#yxbcuknfdq .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#yxbcuknfdq .gt_from_md > :first-child {
  margin-top: 0;
}

#yxbcuknfdq .gt_from_md > :last-child {
  margin-bottom: 0;
}

#yxbcuknfdq .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#yxbcuknfdq .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#yxbcuknfdq .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#yxbcuknfdq .gt_row_group_first td {
  border-top-width: 2px;
}

#yxbcuknfdq .gt_row_group_first th {
  border-top-width: 2px;
}

#yxbcuknfdq .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yxbcuknfdq .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#yxbcuknfdq .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#yxbcuknfdq .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yxbcuknfdq .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#yxbcuknfdq .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#yxbcuknfdq .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#yxbcuknfdq .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#yxbcuknfdq .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#yxbcuknfdq .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yxbcuknfdq .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yxbcuknfdq .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#yxbcuknfdq .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#yxbcuknfdq .gt_left {
  text-align: left;
}

#yxbcuknfdq .gt_center {
  text-align: center;
}

#yxbcuknfdq .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#yxbcuknfdq .gt_font_normal {
  font-weight: normal;
}

#yxbcuknfdq .gt_font_bold {
  font-weight: bold;
}

#yxbcuknfdq .gt_font_italic {
  font-style: italic;
}

#yxbcuknfdq .gt_super {
  font-size: 65%;
}

#yxbcuknfdq .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#yxbcuknfdq .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#yxbcuknfdq .gt_indent_1 {
  text-indent: 5px;
}

#yxbcuknfdq .gt_indent_2 {
  text-indent: 10px;
}

#yxbcuknfdq .gt_indent_3 {
  text-indent: 15px;
}

#yxbcuknfdq .gt_indent_4 {
  text-indent: 20px;
}

#yxbcuknfdq .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">variable</th>
<th id="type" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">type</th>
<th id="role" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">role</th>
<th id="source" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">source</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="variable">date</td>
<td class="gt_row gt_center" headers="type">date</td>
<td class="gt_row gt_left" headers="role">predictor</td>
<td class="gt_row gt_left" headers="source">original</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="variable">hpi</td>
<td class="gt_row gt_center" headers="type">double, numeric</td>
<td class="gt_row gt_left" headers="role">outcome</td>
<td class="gt_row gt_left" headers="source">original</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>… then the model object.</p>
<p>The model specification below will be used for both processes.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-4"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="1">1</button><span id="annotated-cell-4-1" class="code-annotation-target"><a href="#annotated-cell-4-1"></a>arima_spec <span class="ot">&lt;-</span> <span class="fu">arima_reg</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="2">2</button><span id="annotated-cell-4-2" class="code-annotation-target"><a href="#annotated-cell-4-2"></a>  <span class="at">non_seasonal_ar =</span> <span class="dv">3</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="3">3</button><span id="annotated-cell-4-3" class="code-annotation-target"><a href="#annotated-cell-4-3"></a>  <span class="at">non_seasonal_ma =</span> <span class="dv">5</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="4">4</button><span id="annotated-cell-4-4" class="code-annotation-target"><a href="#annotated-cell-4-4"></a>  <span class="at">non_seasonal_differences =</span> <span class="dv">1</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="5">5</button><span id="annotated-cell-4-5" class="code-annotation-target"><a href="#annotated-cell-4-5"></a>  <span class="at">seasonal_differences =</span> <span class="dv">1</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="6">6</button><span id="annotated-cell-4-6" class="code-annotation-target"><a href="#annotated-cell-4-6"></a>  <span class="at">seasonal_period =</span> <span class="dv">12</span></span>
<span id="annotated-cell-4-7"><a href="#annotated-cell-4-7"></a>) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-4" data-target-annotation="7">7</button><span id="annotated-cell-4-8" class="code-annotation-target"><a href="#annotated-cell-4-8"></a>  <span class="fu">set_engine</span>(<span class="st">"arima"</span>)</span>
<span id="annotated-cell-4-9"><a href="#annotated-cell-4-9"></a></span>
<span id="annotated-cell-4-10"><a href="#annotated-cell-4-10"></a>arima_spec</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-4" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="1" data-code-annotation="1">Call the API for building ARIMA models</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="2" data-code-annotation="2">Set the AR order (<em>p</em> in conventional notation)</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="3" data-code-annotation="3">Set the MA order (<em>q</em> in conventional notation)</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="4" data-code-annotation="4">Set the degree of non-seasonal differencing (<em>d</em> in conventional notation)</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="5" data-code-annotation="5">Set the degree of seasonal differencing (<em>D</em> in conventional notation)</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="6" data-code-annotation="6">Set the length of the seasonal period</span>
</dd>
<dt data-target-cell="annotated-cell-4" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-4" data-code-lines="8" data-code-annotation="7">Set the modeling engine to <code>stats::arima()</code></span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>ARIMA Regression Model Specification (regression)

Main Arguments:
  seasonal_period = 12
  non_seasonal_ar = 3
  non_seasonal_differences = 1
  non_seasonal_ma = 5
  seasonal_differences = 1

Computational engine: arima </code></pre>
</div>
</div>
<p>Now that those are complete I can put them together in a <code>workflow</code> object.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-5"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="1">1</button><span id="annotated-cell-5-1" class="code-annotation-target"><a href="#annotated-cell-5-1"></a>arima_wflow_global <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="2">2</button><span id="annotated-cell-5-2" class="code-annotation-target"><a href="#annotated-cell-5-2"></a>  <span class="fu">add_model</span>(arima_spec) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-5" data-target-annotation="3">3</button><span id="annotated-cell-5-3" class="code-annotation-target"><a href="#annotated-cell-5-3"></a>  <span class="fu">add_recipe</span>(arima_rec_global)</span>
<span id="annotated-cell-5-4"><a href="#annotated-cell-5-4"></a></span>
<span id="annotated-cell-5-5"><a href="#annotated-cell-5-5"></a>arima_wflow_global</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-5" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="1" data-code-annotation="1">Create a container for a <code>workflow</code> object</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="2" data-code-annotation="2">Add the above model specification</span>
</dd>
<dt data-target-cell="annotated-cell-5" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-5" data-code-lines="3" data-code-annotation="3">Add the recipe</span>
</dd>
</dl>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: arima_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
0 Recipe Steps

── Model ───────────────────────────────────────────────────────────────────────
ARIMA Regression Model Specification (regression)

Main Arguments:
  seasonal_period = 12
  non_seasonal_ar = 3
  non_seasonal_differences = 1
  non_seasonal_ma = 5
  seasonal_differences = 1

Computational engine: arima </code></pre>
</div>
</div>
<p>The final step here is to fit the model</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>global_fit_start <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb7-2"><a href="#cb7-2"></a></span>
<span id="cb7-3"><a href="#cb7-3"></a>arima_fit_global <span class="ot">&lt;-</span> arima_wflow_global <span class="sc">|&gt;</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="fu">fit</span>(<span class="fu">training</span>(econ_splits_global))</span>
<span id="cb7-5"><a href="#cb7-5"></a></span>
<span id="cb7-6"><a href="#cb7-6"></a>global_fit_end <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a>arima_fit_global</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow [trained] ══════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: arima_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
0 Recipe Steps

── Model ───────────────────────────────────────────────────────────────────────
Series: outcome 
ARIMA(3,1,5)(0,1,0)[12] 

Coefficients:
          ar1      ar2      ar3     ma1     ma2      ma3     ma4     ma5
      -1.0582  -0.9518  -0.8510  0.3737  0.1482  -0.2853  0.3877  0.5537
s.e.   0.0215   0.0290   0.0211  0.0424  0.0587   0.0406  0.0251  0.0324

sigma^2 = 1.659:  log likelihood = -1186.55
AIC=2391.11   AICc=2391.37   BIC=2432.16</code></pre>
</div>
</div>
</section>
<section id="model-evaluation" class="level3">
<h3 class="anchored" data-anchor-id="model-evaluation">Model evaluation</h3>
<p>To deal with some of the characteristics specific to time series modeling, the <code>modeltime</code> framework uses conventions like the <code>mdl_time_tbl</code> (modeltime table) class to store a variety of elements of a time series model including accuracy metrics. This class is also used in model calibration and refitting for future forecasting. Here I’ll write the modeltime table for the global process.</p>
<p>I’m showing the model time table using a <code>print()</code> method rather than as a <code>gt</code> table because the list in the second column (list) would render in a cumbersome way.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>arima_mtt_global <span class="ot">&lt;-</span> <span class="fu">modeltime_table</span>(arima_fit_global)</span>
<span id="cb9-2"><a href="#cb9-2"></a></span>
<span id="cb9-3"><a href="#cb9-3"></a>arima_mtt_global</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Modeltime Table
# A tibble: 1 × 3
  .model_id .model     .model_desc            
      &lt;int&gt; &lt;list&gt;     &lt;chr&gt;                  
1         1 &lt;workflow&gt; ARIMA(3,1,5)(0,1,0)[12]</code></pre>
</div>
</div>
<p>This table contains the model and some additional information about it. I’ll now use this table to calibrate the global model to the individual time series with</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>arima_calib_global <span class="ot">&lt;-</span> arima_mtt_global <span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>  <span class="fu">modeltime_calibrate</span>(<span class="at">new_data =</span> <span class="fu">testing</span>(econ_splits_global), <span class="at">id =</span> <span class="st">"city"</span>)</span>
<span id="cb11-3"><a href="#cb11-3"></a></span>
<span id="cb11-4"><a href="#cb11-4"></a>arima_calib_global</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Modeltime Table
# A tibble: 1 × 5
  .model_id .model     .model_desc             .type .calibration_data
      &lt;int&gt; &lt;list&gt;     &lt;chr&gt;                   &lt;chr&gt; &lt;list&gt;           
1         1 &lt;workflow&gt; ARIMA(3,1,5)(0,1,0)[12] Test  &lt;tibble [96 × 5]&gt;</code></pre>
</div>
</div>
<p>With the calibration done I can now look at the accuracy of the model both at a global level and at an individual model level.</p>
<p>Getting the accuracy is done by the same function: <code>modeltime_accuracy()</code>. Whether it outputs global or local model accuracy is determined by the <code>acc_by_id</code> argument.</p>
<section id="global-model-accuracy" class="level4">
<h4 class="anchored" data-anchor-id="global-model-accuracy">Global model accuracy</h4>
<div id="tbl-acc-global" class="cell anchored">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>arima_calib_global <span class="sc">|&gt;</span></span>
<span id="cb13-2"><a href="#cb13-2"></a>  <span class="fu">modeltime_accuracy</span>(<span class="at">acc_by_id =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb13-3"><a href="#cb13-3"></a>  <span class="fu">table_modeltime_accuracy</span>(<span class="at">.interactive =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="wjoqrmulpw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#wjoqrmulpw table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#wjoqrmulpw thead, #wjoqrmulpw tbody, #wjoqrmulpw tfoot, #wjoqrmulpw tr, #wjoqrmulpw td, #wjoqrmulpw th {
  border-style: none;
}

#wjoqrmulpw p {
  margin: 0;
  padding: 0;
}

#wjoqrmulpw .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#wjoqrmulpw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#wjoqrmulpw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#wjoqrmulpw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#wjoqrmulpw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wjoqrmulpw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wjoqrmulpw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#wjoqrmulpw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#wjoqrmulpw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#wjoqrmulpw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#wjoqrmulpw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#wjoqrmulpw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#wjoqrmulpw .gt_spanner_row {
  border-bottom-style: hidden;
}

#wjoqrmulpw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#wjoqrmulpw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#wjoqrmulpw .gt_from_md > :first-child {
  margin-top: 0;
}

#wjoqrmulpw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#wjoqrmulpw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#wjoqrmulpw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#wjoqrmulpw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#wjoqrmulpw .gt_row_group_first td {
  border-top-width: 2px;
}

#wjoqrmulpw .gt_row_group_first th {
  border-top-width: 2px;
}

#wjoqrmulpw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wjoqrmulpw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#wjoqrmulpw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#wjoqrmulpw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wjoqrmulpw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#wjoqrmulpw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#wjoqrmulpw .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#wjoqrmulpw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#wjoqrmulpw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#wjoqrmulpw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wjoqrmulpw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wjoqrmulpw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#wjoqrmulpw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#wjoqrmulpw .gt_left {
  text-align: left;
}

#wjoqrmulpw .gt_center {
  text-align: center;
}

#wjoqrmulpw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#wjoqrmulpw .gt_font_normal {
  font-weight: normal;
}

#wjoqrmulpw .gt_font_bold {
  font-weight: bold;
}

#wjoqrmulpw .gt_font_italic {
  font-style: italic;
}

#wjoqrmulpw .gt_super {
  font-size: 65%;
}

#wjoqrmulpw .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#wjoqrmulpw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#wjoqrmulpw .gt_indent_1 {
  text-indent: 5px;
}

#wjoqrmulpw .gt_indent_2 {
  text-indent: 10px;
}

#wjoqrmulpw .gt_indent_3 {
  text-indent: 15px;
}

#wjoqrmulpw .gt_indent_4 {
  text-indent: 20px;
}

#wjoqrmulpw .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="9" class="gt_heading gt_title gt_font_normal gt_bottom_border">Accuracy Table</th>
</tr>
<tr class="odd gt_col_headings">
<th id=".model_id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">.model_id</th>
<th id=".model_desc" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.model_desc</th>
<th id=".type" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.type</th>
<th id="mae" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mae</th>
<th id="mape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mape</th>
<th id="mase" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mase</th>
<th id="smape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">smape</th>
<th id="rmse" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rmse</th>
<th id="rsq" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rsq</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">1</td>
<td class="gt_row gt_left" headers=".model_desc">ARIMA(3,1,5)(0,1,0)[12]</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">19.61</td>
<td class="gt_row gt_right" headers="mape">6.3</td>
<td class="gt_row gt_right" headers="mase">0.18</td>
<td class="gt_row gt_right" headers="smape">6.6</td>
<td class="gt_row gt_right" headers="rmse">29.38</td>
<td class="gt_row gt_right" headers="rsq">0.94</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="local-model-accuracy" class="level4">
<h4 class="anchored" data-anchor-id="local-model-accuracy">Local model accuracy</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>arima_calib_global <span class="sc">|&gt;</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">modeltime_accuracy</span>(<span class="at">acc_by_id =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">table_modeltime_accuracy</span>(<span class="at">.interactive =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-acc-global-local" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-acc-global-local-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: global model accuracy table
</figcaption>
<div aria-describedby="tbl-acc-global-local-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="oqowoivqxm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#oqowoivqxm table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#oqowoivqxm thead, #oqowoivqxm tbody, #oqowoivqxm tfoot, #oqowoivqxm tr, #oqowoivqxm td, #oqowoivqxm th {
  border-style: none;
}

#oqowoivqxm p {
  margin: 0;
  padding: 0;
}

#oqowoivqxm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#oqowoivqxm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#oqowoivqxm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#oqowoivqxm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#oqowoivqxm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oqowoivqxm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oqowoivqxm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oqowoivqxm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#oqowoivqxm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#oqowoivqxm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#oqowoivqxm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#oqowoivqxm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#oqowoivqxm .gt_spanner_row {
  border-bottom-style: hidden;
}

#oqowoivqxm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#oqowoivqxm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#oqowoivqxm .gt_from_md > :first-child {
  margin-top: 0;
}

#oqowoivqxm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#oqowoivqxm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#oqowoivqxm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#oqowoivqxm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#oqowoivqxm .gt_row_group_first td {
  border-top-width: 2px;
}

#oqowoivqxm .gt_row_group_first th {
  border-top-width: 2px;
}

#oqowoivqxm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oqowoivqxm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#oqowoivqxm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#oqowoivqxm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oqowoivqxm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oqowoivqxm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#oqowoivqxm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#oqowoivqxm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#oqowoivqxm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oqowoivqxm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oqowoivqxm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oqowoivqxm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oqowoivqxm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oqowoivqxm .gt_left {
  text-align: left;
}

#oqowoivqxm .gt_center {
  text-align: center;
}

#oqowoivqxm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#oqowoivqxm .gt_font_normal {
  font-weight: normal;
}

#oqowoivqxm .gt_font_bold {
  font-weight: bold;
}

#oqowoivqxm .gt_font_italic {
  font-style: italic;
}

#oqowoivqxm .gt_super {
  font-size: 65%;
}

#oqowoivqxm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#oqowoivqxm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#oqowoivqxm .gt_indent_1 {
  text-indent: 5px;
}

#oqowoivqxm .gt_indent_2 {
  text-indent: 10px;
}

#oqowoivqxm .gt_indent_3 {
  text-indent: 15px;
}

#oqowoivqxm .gt_indent_4 {
  text-indent: 20px;
}

#oqowoivqxm .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="10" class="gt_heading gt_title gt_font_normal gt_bottom_border">Accuracy Table</th>
</tr>
<tr class="odd gt_col_headings">
<th id=".model_id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">.model_id</th>
<th id=".model_desc" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.model_desc</th>
<th id=".type" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.type</th>
<th id="city" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">city</th>
<th id="mae" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mae</th>
<th id="mape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mape</th>
<th id="mase" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mase</th>
<th id="smape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">smape</th>
<th id="rmse" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rmse</th>
<th id="rsq" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rsq</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">1</td>
<td class="gt_row gt_left" headers=".model_desc">ARIMA(3,1,5)(0,1,0)[12]</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers="mae">23.44</td>
<td class="gt_row gt_right" headers="mape">8.36</td>
<td class="gt_row gt_right" headers="mase">4.48</td>
<td class="gt_row gt_right" headers="smape">8.85</td>
<td class="gt_row gt_right" headers="rmse">27.63</td>
<td class="gt_row gt_right" headers="rsq">0.86</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers=".model_id">1</td>
<td class="gt_row gt_left" headers=".model_desc">ARIMA(3,1,5)(0,1,0)[12]</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_left" headers="city">Detroit</td>
<td class="gt_row gt_right" headers="mae">6.47</td>
<td class="gt_row gt_right" headers="mape">3.89</td>
<td class="gt_row gt_right" headers="mase">3.68</td>
<td class="gt_row gt_right" headers="smape">3.74</td>
<td class="gt_row gt_right" headers="rmse">9.62</td>
<td class="gt_row gt_right" headers="rsq">0.82</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers=".model_id">1</td>
<td class="gt_row gt_left" headers=".model_desc">ARIMA(3,1,5)(0,1,0)[12]</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_left" headers="city">New York</td>
<td class="gt_row gt_right" headers="mae">3.80</td>
<td class="gt_row gt_right" headers="mape">1.45</td>
<td class="gt_row gt_right" headers="mase">1.60</td>
<td class="gt_row gt_right" headers="smape">1.43</td>
<td class="gt_row gt_right" headers="rmse">5.15</td>
<td class="gt_row gt_right" headers="rsq">0.95</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers=".model_id">1</td>
<td class="gt_row gt_left" headers=".model_desc">ARIMA(3,1,5)(0,1,0)[12]</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_left" headers="city">San Diego</td>
<td class="gt_row gt_right" headers="mae">44.73</td>
<td class="gt_row gt_right" headers="mape">11.49</td>
<td class="gt_row gt_right" headers="mase">5.93</td>
<td class="gt_row gt_right" headers="smape">12.36</td>
<td class="gt_row gt_right" headers="rmse">50.70</td>
<td class="gt_row gt_right" headers="rsq">0.68</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>For comparison you can jump ahead to see the <a href="#tbl-acc-iterative" class="quarto-xref">iterative model accuracy table&nbsp;2</a>.</p>
</section>
<section id="accuracy-plot" class="level4">
<h4 class="anchored" data-anchor-id="accuracy-plot">Accuracy plot</h4>
<p>Below is a visual representation of how the models performed against the test data (the last 2 years).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="annotated-cell-11"><pre class="sourceCode numberSource r code-annotation-code number-lines code-with-copy code-annotated"><code class="sourceCode r"><button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="1">1</button><span id="annotated-cell-11-1" class="code-annotation-target"><a href="#annotated-cell-11-1"></a>arima_calib_global <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="2">2</button><span id="annotated-cell-11-2" class="code-annotation-target"><a href="#annotated-cell-11-2"></a>  <span class="fu">modeltime_forecast</span>(</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="3">3</button><span id="annotated-cell-11-3" class="code-annotation-target"><a href="#annotated-cell-11-3"></a>    <span class="at">new_data =</span> <span class="fu">testing</span>(econ_splits_global),</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="4">4</button><span id="annotated-cell-11-4" class="code-annotation-target"><a href="#annotated-cell-11-4"></a>    <span class="at">actual_data =</span> econ_data,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="5">5</button><span id="annotated-cell-11-5" class="code-annotation-target"><a href="#annotated-cell-11-5"></a>    <span class="at">conf_by_id =</span> <span class="cn">TRUE</span>,</span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="6">6</button><span id="annotated-cell-11-6" class="code-annotation-target"><a href="#annotated-cell-11-6"></a>    <span class="at">keep_data =</span> <span class="cn">TRUE</span></span>
<span id="annotated-cell-11-7"><a href="#annotated-cell-11-7"></a>  ) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="7">7</button><span id="annotated-cell-11-8" class="code-annotation-target"><a href="#annotated-cell-11-8"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<button class="code-annotation-anchor" data-target-cell="annotated-cell-11" data-target-annotation="8">8</button><span id="annotated-cell-11-9" class="code-annotation-target"><a href="#annotated-cell-11-9"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="annotated-cell-11-10"><a href="#annotated-cell-11-10"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="annotated-cell-11-11"><a href="#annotated-cell-11-11"></a>    <span class="at">.title =</span> <span class="st">"Forecast of Test Data - Global"</span>,</span>
<span id="annotated-cell-11-12"><a href="#annotated-cell-11-12"></a>    <span class="at">.facet_ncol =</span> <span class="dv">2</span></span>
<span id="annotated-cell-11-13"><a href="#annotated-cell-11-13"></a>  ) <span class="sc">+</span></span>
<span id="annotated-cell-11-14"><a href="#annotated-cell-11-14"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span><div class="code-annotation-gutter-bg"></div><div class="code-annotation-gutter"></div></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-annotation">
<dl class="code-annotation-container-hidden code-annotation-container-grid">
<dt data-target-cell="annotated-cell-11" data-target-annotation="1">1</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="1" data-code-annotation="1">Call up the object containing the calibrated models</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="2">2</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="2" data-code-annotation="2">Call the <code>modeltime_forecast()</code> function</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="3">3</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="3" data-code-annotation="3">Specify the new data to test forecasts against; in this case it’s the testing split from the object created by <code>time_series_split()</code></span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="4">4</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="4" data-code-annotation="4">Specify what to use as the actual data; in this case it’s the original <code>econ_data</code> object</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="5">5</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="5" data-code-annotation="5">Specify whether to generate confidence intervals by individual data series</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="6">6</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="6" data-code-annotation="6">Specify whether to keep the columns from the actual data; I specified <code>TRUE</code> to keep the “city” column</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="7">7</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="8" data-code-annotation="7">Group by city to generate the forecasts by city</span>
</dd>
<dt data-target-cell="annotated-cell-11" data-target-annotation="8">8</dt>
<dd>
<span data-code-cell="annotated-cell-11" data-code-lines="9" data-code-annotation="8">Plot the forecasts as a stationary plot</span>
</dd>
</dl>
</div>
<div class="cell-output-display">
<div id="fig-acc-global" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-acc-global-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="forecasting-with-modeltime-part-3_files/figure-html/fig-acc-global-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-acc-global-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: global model accuracy plot
</figcaption>
</figure>
</div>
</div>
</div>
<p>For comparison you can jump ahead to see the <a href="#fig-acc-iterative" class="quarto-xref">iterative model accuracy plot&nbsp;3</a>.</p>
</section>
</section>
<section id="forecasting-the-future" class="level3">
<h3 class="anchored" data-anchor-id="forecasting-the-future">Forecasting the future</h3>
<p>The first step in getting forecasts for the future (with respect to the available data) is to refit the model using all of the training data after calibrating the model. That is done with the <code>modeltime_refit()</code> function for a global process.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>global_refit_start <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb15-2"><a href="#cb15-2"></a></span>
<span id="cb15-3"><a href="#cb15-3"></a>arima_refit_global <span class="ot">&lt;-</span> <span class="fu">modeltime_refit</span>(arima_calib_global, <span class="at">data =</span> econ_data) </span>
<span id="cb15-4"><a href="#cb15-4"></a></span>
<span id="cb15-5"><a href="#cb15-5"></a>global_refit_end <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb15-6"><a href="#cb15-6"></a></span>
<span id="cb15-7"><a href="#cb15-7"></a>arima_refit_global</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Modeltime Table
# A tibble: 1 × 5
  .model_id .model     .model_desc             .type .calibration_data
      &lt;int&gt; &lt;list&gt;     &lt;chr&gt;                   &lt;chr&gt; &lt;list&gt;           
1         1 &lt;workflow&gt; ARIMA(3,1,5)(0,1,0)[12] Test  &lt;tibble [96 × 5]&gt;</code></pre>
</div>
</div>
<p>The next step is to build a container for the data that has all the correct dates and ID columns. This is done with <code>timetk::future_frame()</code> .</p>
<div class="callout callout-style-default callout-caution callout-titled" title="future_frame() with multiple series">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
future_frame() with multiple series
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>future_frame()</code> only generates one series per data set fed to it, so it’s really important to group the data before executing the function if you have multiple series or you’ll only get one series of future dates.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>arima_future_global <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb17-3"><a href="#cb17-3"></a>  <span class="fu">future_frame</span>(<span class="at">.length_out =</span> <span class="dv">12</span>, <span class="at">.bind_data =</span> <span class="cn">FALSE</span>, <span class="at">.date_var =</span> date)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>And finally one can generate a plot of the forecasts with <code>modeltime_forecast()</code> and plot the time series with <code>plot_modeltime_forecast()</code> . Better not forget to group by series!</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>forecast_future_global <span class="ot">&lt;-</span> arima_refit_global <span class="sc">|&gt;</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="fu">modeltime_forecast</span>(</span>
<span id="cb18-3"><a href="#cb18-3"></a>    <span class="at">new_data =</span> arima_future_global,</span>
<span id="cb18-4"><a href="#cb18-4"></a>    <span class="at">actual_data =</span> econ_data,</span>
<span id="cb18-5"><a href="#cb18-5"></a>    <span class="at">conf_by_id =</span> <span class="cn">TRUE</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>  )</span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a>forecast_future_global <span class="sc">|&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb18-10"><a href="#cb18-10"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="cb18-11"><a href="#cb18-11"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb18-12"><a href="#cb18-12"></a>    <span class="at">.title =</span> <span class="st">"1 Year Forecast into the Future - Global"</span>,</span>
<span id="cb18-13"><a href="#cb18-13"></a>    <span class="at">.facet_ncol =</span> <span class="dv">2</span></span>
<span id="cb18-14"><a href="#cb18-14"></a>  ) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-forecast-future-global" class="quarto-figure quarto-figure-center quarto-float anchored" width="768">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-forecast-future-global-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="forecasting-with-modeltime-part-3_files/figure-html/fig-forecast-future-global-1.png" id="fig-forecast-future-global" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-forecast-future-global-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="building-an-iterative-arima-model" class="level2">
<h2 class="anchored" data-anchor-id="building-an-iterative-arima-model">Building an iterative ARIMA model</h2>
<p>Now I’ll go through an iterative modeling workflow with the same model parameters for comparison. A key difference in the workflow is that the iterative model requires the construction of a nested table.</p>
<p>In <code>modeltime</code> iterative forecasting is called <a href="https://business-science.github.io/modeltime/articles/nested-forecasting.html?q=nested#nested-forecasting">“Nested Forecasting”</a>.</p>
<section id="splitting-data-1" class="level3">
<h3 class="anchored" data-anchor-id="splitting-data-1">Splitting data</h3>
<p>One of the big differences in building a nested model from building a global model in <code>modeltime</code> happens right at the beginning with splitting the data. With this method the future dates are added right up front with <code>extend_timeseries()</code> , the length of actual data is distinguished from that of future periods in <code>nest_timeseries()</code> and the train/test split is created with <code>split_nested_timeseries()</code> .</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>econ_splits_iterative <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  <span class="fu">extend_timeseries</span>(</span>
<span id="cb19-3"><a href="#cb19-3"></a>    <span class="at">.id_var =</span> city,</span>
<span id="cb19-4"><a href="#cb19-4"></a>    <span class="at">.date_var =</span> date,</span>
<span id="cb19-5"><a href="#cb19-5"></a>    <span class="at">.length_future =</span> <span class="dv">12</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-7"><a href="#cb19-7"></a>  <span class="fu">nest_timeseries</span>(</span>
<span id="cb19-8"><a href="#cb19-8"></a>    <span class="at">.id_var =</span> city,</span>
<span id="cb19-9"><a href="#cb19-9"></a>    <span class="at">.length_future =</span> <span class="dv">12</span>,</span>
<span id="cb19-10"><a href="#cb19-10"></a>    <span class="at">.length_actual =</span> <span class="dv">17</span> <span class="sc">*</span> <span class="dv">12</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb19-12"><a href="#cb19-12"></a>  <span class="fu">split_nested_timeseries</span>(<span class="at">.length_test =</span> <span class="dv">24</span>)</span>
<span id="cb19-13"><a href="#cb19-13"></a></span>
<span id="cb19-14"><a href="#cb19-14"></a>econ_splits_iterative</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  city      .actual_data       .future_data      .splits         
  &lt;chr&gt;     &lt;list&gt;             &lt;list&gt;            &lt;list&gt;          
1 Dallas    &lt;tibble [204 × 2]&gt; &lt;tibble [12 × 2]&gt; &lt;split [180|24]&gt;
2 Detroit   &lt;tibble [204 × 2]&gt; &lt;tibble [12 × 2]&gt; &lt;split [180|24]&gt;
3 New York  &lt;tibble [204 × 2]&gt; &lt;tibble [12 × 2]&gt; &lt;split [180|24]&gt;
4 San Diego &lt;tibble [204 × 2]&gt; &lt;tibble [12 × 2]&gt; &lt;split [180|24]&gt;</code></pre>
</div>
</div>
</section>
<section id="specifying-a-modeling-workflow-and-fit-the-model-1" class="level3">
<h3 class="anchored" data-anchor-id="specifying-a-modeling-workflow-and-fit-the-model-1">Specifying a modeling workflow and fit the model</h3>
<p>I’ll use the same model specification as above, but the recipe has to be specified to use the new splits object.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>arima_rec_iterative <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb21-2"><a href="#cb21-2"></a>  hpi <span class="sc">~</span> date,</span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">extract_nested_train_split</span>(econ_splits_iterative)</span>
<span id="cb21-4"><a href="#cb21-4"></a>)</span>
<span id="cb21-5"><a href="#cb21-5"></a></span>
<span id="cb21-6"><a href="#cb21-6"></a>arima_rec_iterative <span class="sc">|&gt;</span> <span class="fu">summary</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="qvypoaypxa" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#qvypoaypxa table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#qvypoaypxa thead, #qvypoaypxa tbody, #qvypoaypxa tfoot, #qvypoaypxa tr, #qvypoaypxa td, #qvypoaypxa th {
  border-style: none;
}

#qvypoaypxa p {
  margin: 0;
  padding: 0;
}

#qvypoaypxa .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qvypoaypxa .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qvypoaypxa .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qvypoaypxa .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qvypoaypxa .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qvypoaypxa .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qvypoaypxa .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qvypoaypxa .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qvypoaypxa .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qvypoaypxa .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qvypoaypxa .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qvypoaypxa .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qvypoaypxa .gt_spanner_row {
  border-bottom-style: hidden;
}

#qvypoaypxa .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qvypoaypxa .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qvypoaypxa .gt_from_md > :first-child {
  margin-top: 0;
}

#qvypoaypxa .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qvypoaypxa .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qvypoaypxa .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qvypoaypxa .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qvypoaypxa .gt_row_group_first td {
  border-top-width: 2px;
}

#qvypoaypxa .gt_row_group_first th {
  border-top-width: 2px;
}

#qvypoaypxa .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qvypoaypxa .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qvypoaypxa .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qvypoaypxa .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qvypoaypxa .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qvypoaypxa .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qvypoaypxa .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#qvypoaypxa .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qvypoaypxa .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qvypoaypxa .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qvypoaypxa .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qvypoaypxa .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qvypoaypxa .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qvypoaypxa .gt_left {
  text-align: left;
}

#qvypoaypxa .gt_center {
  text-align: center;
}

#qvypoaypxa .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qvypoaypxa .gt_font_normal {
  font-weight: normal;
}

#qvypoaypxa .gt_font_bold {
  font-weight: bold;
}

#qvypoaypxa .gt_font_italic {
  font-style: italic;
}

#qvypoaypxa .gt_super {
  font-size: 65%;
}

#qvypoaypxa .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#qvypoaypxa .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qvypoaypxa .gt_indent_1 {
  text-indent: 5px;
}

#qvypoaypxa .gt_indent_2 {
  text-indent: 10px;
}

#qvypoaypxa .gt_indent_3 {
  text-indent: 15px;
}

#qvypoaypxa .gt_indent_4 {
  text-indent: 20px;
}

#qvypoaypxa .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_col_headings">
<th id="variable" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">variable</th>
<th id="type" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">type</th>
<th id="role" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">role</th>
<th id="source" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" style="font-weight: bold; border-top-width: 2px; border-top-style: solid; border-top-color: #000000; border-bottom-width: 2px; border-bottom-style: solid; border-bottom-color: #000000" scope="col">source</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="variable">date</td>
<td class="gt_row gt_center" headers="type">date</td>
<td class="gt_row gt_left" headers="role">predictor</td>
<td class="gt_row gt_left" headers="source">original</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="variable">hpi</td>
<td class="gt_row gt_center" headers="type">double, numeric</td>
<td class="gt_row gt_left" headers="role">outcome</td>
<td class="gt_row gt_left" headers="source">original</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>I’ll also create a new workflow object that just updates the previous one with the new recipe.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>arima_wflow_iterative <span class="ot">&lt;-</span> arima_wflow_global <span class="sc">|&gt;</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="fu">update_recipe</span>(arima_rec_iterative)</span>
<span id="cb22-3"><a href="#cb22-3"></a></span>
<span id="cb22-4"><a href="#cb22-4"></a>arima_wflow_iterative</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: arima_reg()

── Preprocessor ────────────────────────────────────────────────────────────────
0 Recipe Steps

── Model ───────────────────────────────────────────────────────────────────────
ARIMA Regression Model Specification (regression)

Main Arguments:
  seasonal_period = 12
  non_seasonal_ar = 3
  non_seasonal_differences = 1
  non_seasonal_ma = 5
  seasonal_differences = 1

Computational engine: arima </code></pre>
</div>
</div>
<p>And now I’ll fit the model to all four cities iteratively using <code>modeltime_nested_fit()</code> .</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>iterative_fit_start <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a>arima_fit_iterative <span class="ot">&lt;-</span> econ_splits_iterative <span class="sc">|&gt;</span></span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="fu">modeltime_nested_fit</span>(arima_wflow_iterative)</span>
<span id="cb24-5"><a href="#cb24-5"></a></span>
<span id="cb24-6"><a href="#cb24-6"></a>iterative_fit_end <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb24-7"><a href="#cb24-7"></a></span>
<span id="cb24-8"><a href="#cb24-8"></a>arima_fit_iterative</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Nested Modeltime Table
  # A tibble: 4 × 5
  city      .actual_data       .future_data .splits          .modeltime_tables 
  &lt;chr&gt;     &lt;list&gt;             &lt;list&gt;       &lt;list&gt;           &lt;list&gt;            
1 Dallas    &lt;tibble [204 × 2]&gt; &lt;tibble&gt;     &lt;split [180|24]&gt; &lt;mdl_tm_t [1 × 5]&gt;
2 Detroit   &lt;tibble [204 × 2]&gt; &lt;tibble&gt;     &lt;split [180|24]&gt; &lt;mdl_tm_t [1 × 5]&gt;
3 New York  &lt;tibble [204 × 2]&gt; &lt;tibble&gt;     &lt;split [180|24]&gt; &lt;mdl_tm_t [1 × 5]&gt;
4 San Diego &lt;tibble [204 × 2]&gt; &lt;tibble&gt;     &lt;split [180|24]&gt; &lt;mdl_tm_t [1 × 5]&gt;</code></pre>
</div>
</div>
</section>
<section id="model-evaluation-1" class="level3">
<h3 class="anchored" data-anchor-id="model-evaluation-1">Model evaluation</h3>
<section id="local-model-accuracy-1" class="level4">
<h4 class="anchored" data-anchor-id="local-model-accuracy-1">Local model accuracy</h4>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>arima_fit_iterative <span class="sc">|&gt;</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="fu">extract_nested_test_accuracy</span>() <span class="sc">|&gt;</span></span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="fu">table_modeltime_accuracy</span>(<span class="at">.interactive =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-acc-iterative" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-acc-iterative-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: iterative model accuracy table
</figcaption>
<div aria-describedby="tbl-acc-iterative-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="lpharqqdit" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#lpharqqdit table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#lpharqqdit thead, #lpharqqdit tbody, #lpharqqdit tfoot, #lpharqqdit tr, #lpharqqdit td, #lpharqqdit th {
  border-style: none;
}

#lpharqqdit p {
  margin: 0;
  padding: 0;
}

#lpharqqdit .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#lpharqqdit .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#lpharqqdit .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#lpharqqdit .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#lpharqqdit .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lpharqqdit .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lpharqqdit .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#lpharqqdit .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#lpharqqdit .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#lpharqqdit .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#lpharqqdit .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#lpharqqdit .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#lpharqqdit .gt_spanner_row {
  border-bottom-style: hidden;
}

#lpharqqdit .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#lpharqqdit .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#lpharqqdit .gt_from_md > :first-child {
  margin-top: 0;
}

#lpharqqdit .gt_from_md > :last-child {
  margin-bottom: 0;
}

#lpharqqdit .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#lpharqqdit .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#lpharqqdit .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#lpharqqdit .gt_row_group_first td {
  border-top-width: 2px;
}

#lpharqqdit .gt_row_group_first th {
  border-top-width: 2px;
}

#lpharqqdit .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lpharqqdit .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#lpharqqdit .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#lpharqqdit .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lpharqqdit .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#lpharqqdit .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#lpharqqdit .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#lpharqqdit .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#lpharqqdit .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#lpharqqdit .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lpharqqdit .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lpharqqdit .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#lpharqqdit .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#lpharqqdit .gt_left {
  text-align: left;
}

#lpharqqdit .gt_center {
  text-align: center;
}

#lpharqqdit .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#lpharqqdit .gt_font_normal {
  font-weight: normal;
}

#lpharqqdit .gt_font_bold {
  font-weight: bold;
}

#lpharqqdit .gt_font_italic {
  font-style: italic;
}

#lpharqqdit .gt_super {
  font-size: 65%;
}

#lpharqqdit .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#lpharqqdit .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#lpharqqdit .gt_indent_1 {
  text-indent: 5px;
}

#lpharqqdit .gt_indent_2 {
  text-indent: 10px;
}

#lpharqqdit .gt_indent_3 {
  text-indent: 15px;
}

#lpharqqdit .gt_indent_4 {
  text-indent: 20px;
}

#lpharqqdit .gt_indent_5 {
  text-indent: 25px;
}
</style>

<table class="gt_table do-not-create-environment cell table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="header gt_heading">
<th colspan="10" class="gt_heading gt_title gt_font_normal gt_bottom_border">Accuracy Table</th>
</tr>
<tr class="odd gt_col_headings">
<th id="city" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">city</th>
<th id=".model_id" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">.model_id</th>
<th id=".model_desc" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.model_desc</th>
<th id=".type" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">.type</th>
<th id="mae" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mae</th>
<th id="mape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mape</th>
<th id="mase" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">mase</th>
<th id="smape" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">smape</th>
<th id="rmse" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rmse</th>
<th id="rsq" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">rsq</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="city">Dallas</td>
<td class="gt_row gt_right" headers=".model_id">1</td>
<td class="gt_row gt_left" headers=".model_desc">ARIMA</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">40.94</td>
<td class="gt_row gt_right" headers="mape">14.63</td>
<td class="gt_row gt_right" headers="mase">7.82</td>
<td class="gt_row gt_right" headers="smape">16.09</td>
<td class="gt_row gt_right" headers="rmse">46.48</td>
<td class="gt_row gt_right" headers="rsq">0.81</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">Detroit</td>
<td class="gt_row gt_right" headers=".model_id">1</td>
<td class="gt_row gt_left" headers=".model_desc">ARIMA</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">4.64</td>
<td class="gt_row gt_right" headers="mape">2.84</td>
<td class="gt_row gt_right" headers="mase">2.64</td>
<td class="gt_row gt_right" headers="smape">2.88</td>
<td class="gt_row gt_right" headers="rmse">5.38</td>
<td class="gt_row gt_right" headers="rsq">0.84</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="city">New York</td>
<td class="gt_row gt_right" headers=".model_id">1</td>
<td class="gt_row gt_left" headers=".model_desc">ARIMA</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">5.35</td>
<td class="gt_row gt_right" headers="mape">2.04</td>
<td class="gt_row gt_right" headers="mase">2.25</td>
<td class="gt_row gt_right" headers="smape">2.07</td>
<td class="gt_row gt_right" headers="rmse">6.91</td>
<td class="gt_row gt_right" headers="rsq">0.89</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="city">San Diego</td>
<td class="gt_row gt_right" headers=".model_id">1</td>
<td class="gt_row gt_left" headers=".model_desc">ARIMA</td>
<td class="gt_row gt_left" headers=".type">Test</td>
<td class="gt_row gt_right" headers="mae">30.24</td>
<td class="gt_row gt_right" headers="mape">7.81</td>
<td class="gt_row gt_right" headers="mase">4.01</td>
<td class="gt_row gt_right" headers="smape">8.23</td>
<td class="gt_row gt_right" headers="rmse">35.85</td>
<td class="gt_row gt_right" headers="rsq">0.65</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<p>You can jump back to compare this with the <a href="#tbl-acc-global-local" class="quarto-xref">global model accuracy table&nbsp;1</a>.</p>
</section>
<section id="accuracy-plot-1" class="level4">
<h4 class="anchored" data-anchor-id="accuracy-plot-1">Accuracy plot</h4>
<p>Below is a visual representation of how the models from the iterative modeling process performed against the test data (the last 2 years).</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>arima_fit_iterative <span class="sc">|&gt;</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">extract_nested_test_forecast</span>() <span class="sc">|&gt;</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb27-4"><a href="#cb27-4"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="cb27-5"><a href="#cb27-5"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb27-6"><a href="#cb27-6"></a>    <span class="at">.title =</span> <span class="st">"Forecast of Test Data - Iterative"</span>,</span>
<span id="cb27-7"><a href="#cb27-7"></a>    <span class="at">.facet_ncol =</span> <span class="dv">2</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>  ) <span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-acc-iterative" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-acc-iterative-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="forecasting-with-modeltime-part-3_files/figure-html/fig-acc-iterative-1.png" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-acc-iterative-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: iterative model accuracy plot
</figcaption>
</figure>
</div>
</div>
</div>
<p>You can jump back to compare this with the <a href="#fig-acc-global" class="quarto-xref">global model accuracy plot&nbsp;1</a>.</p>
</section>
</section>
<section id="forecasting-the-future-1" class="level3">
<h3 class="anchored" data-anchor-id="forecasting-the-future-1">Forecasting the future</h3>
<p>As with the global process above, the first step here will be to refit the model to the full training data set. Note that the iterative model process requires the use of <code>modeltime_nested_refit()</code> rather than <code>modeltime_refit()</code> .</p>
<div class="callout callout-style-default callout-caution callout-titled" title="control_* functions">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
control_* functions
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p><code>modeltime</code> has separate <code>control_*</code> functions for different purposes such as this case in which <code>modeltime_refit()</code> has <code>control_refit()</code> and <code>modeltime_nested_refit()</code> has <code>control_nested_refit()</code>. Make sure to use the correct one.</p>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a>iterative_refit_start <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb28-2"><a href="#cb28-2"></a></span>
<span id="cb28-3"><a href="#cb28-3"></a>arima_refit_iterative <span class="ot">&lt;-</span> arima_fit_iterative <span class="sc">|&gt;</span></span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="fu">modeltime_nested_refit</span>(<span class="at">control =</span> <span class="fu">control_nested_refit</span>(<span class="at">verbose =</span> <span class="cn">FALSE</span>))</span>
<span id="cb28-5"><a href="#cb28-5"></a></span>
<span id="cb28-6"><a href="#cb28-6"></a>iterative_refit_end <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb28-7"><a href="#cb28-7"></a></span>
<span id="cb28-8"><a href="#cb28-8"></a>arima_refit_iterative</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># Nested Modeltime Table
  # A tibble: 4 × 5
  city      .actual_data       .future_data .splits          .modeltime_tables 
  &lt;chr&gt;     &lt;list&gt;             &lt;list&gt;       &lt;list&gt;           &lt;list&gt;            
1 Dallas    &lt;tibble [204 × 2]&gt; &lt;tibble&gt;     &lt;split [180|24]&gt; &lt;mdl_tm_t [1 × 5]&gt;
2 Detroit   &lt;tibble [204 × 2]&gt; &lt;tibble&gt;     &lt;split [180|24]&gt; &lt;mdl_tm_t [1 × 5]&gt;
3 New York  &lt;tibble [204 × 2]&gt; &lt;tibble&gt;     &lt;split [180|24]&gt; &lt;mdl_tm_t [1 × 5]&gt;
4 San Diego &lt;tibble [204 × 2]&gt; &lt;tibble&gt;     &lt;split [180|24]&gt; &lt;mdl_tm_t [1 × 5]&gt;</code></pre>
</div>
</div>
<p>Since the future data container was already created in the splitting object, I can go right to forecasting the future here.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>forecast_future_iterative <span class="ot">&lt;-</span> arima_refit_iterative <span class="sc">|&gt;</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>  <span class="fu">extract_nested_future_forecast</span>()</span>
<span id="cb30-3"><a href="#cb30-3"></a></span>
<span id="cb30-4"><a href="#cb30-4"></a>forecast_future_iterative <span class="sc">|&gt;</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb30-6"><a href="#cb30-6"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="cb30-7"><a href="#cb30-7"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb30-8"><a href="#cb30-8"></a>    <span class="at">.title =</span> <span class="st">"1 Year Forecast into the Future - Global"</span>,</span>
<span id="cb30-9"><a href="#cb30-9"></a>    <span class="at">.facet_ncol =</span> <span class="dv">2</span></span>
<span id="cb30-10"><a href="#cb30-10"></a>  ) <span class="sc">+</span></span>
<span id="cb30-11"><a href="#cb30-11"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-forecast-future-iterative" class="quarto-figure quarto-figure-center quarto-float anchored" width="768">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-forecast-future-iterative-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="forecasting-with-modeltime-part-3_files/figure-html/fig-forecast-future-iterative-1.png" id="fig-forecast-future-iterative" class="img-fluid figure-img" width="768">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-forecast-future-iterative-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4
</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="comparison" class="level2">
<h2 class="anchored" data-anchor-id="comparison">Comparison</h2>
<p>The two processes follow the same workflow, but have some key operational differences:</p>
<ul>
<li><p>Different structures for the data split objects</p></li>
<li><p>The iterative workflow does not require calibration to the individual time series</p></li>
<li><p>Processing time</p></li>
</ul>
<p>Below are two tables showing the processing times for fitting and refitting the global and iterative models.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>global_fit_time <span class="ot">&lt;-</span> (global_fit_end <span class="sc">-</span> global_fit_start) <span class="sc">|&gt;</span></span>
<span id="cb31-2"><a href="#cb31-2"></a>  <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"metric"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(value), <span class="at">model_process =</span> <span class="st">"Global Fit"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-4"><a href="#cb31-4"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb31-5"><a href="#cb31-5"></a></span>
<span id="cb31-6"><a href="#cb31-6"></a>iterative_fit_time <span class="ot">&lt;-</span> (iterative_fit_end <span class="sc">-</span> iterative_fit_start) <span class="sc">|&gt;</span></span>
<span id="cb31-7"><a href="#cb31-7"></a>  <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"metric"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-8"><a href="#cb31-8"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(value), <span class="at">model_process =</span> <span class="st">"Iterative Fit"</span>) <span class="sc">|&gt;</span></span>
<span id="cb31-9"><a href="#cb31-9"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb31-10"><a href="#cb31-10"></a></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="fu">bind_rows</span>(global_fit_time, iterative_fit_time) <span class="sc">|&gt;</span></span>
<span id="cb31-12"><a href="#cb31-12"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb31-13"><a href="#cb31-13"></a>    <span class="fu">aes</span>(<span class="at">x =</span> metric, <span class="at">y =</span> value, <span class="at">fill =</span> model_process, <span class="at">group =</span> model_process)</span>
<span id="cb31-14"><a href="#cb31-14"></a>  ) <span class="sc">+</span></span>
<span id="cb31-15"><a href="#cb31-15"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb31-16"><a href="#cb31-16"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-17"><a href="#cb31-17"></a>    <span class="at">fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb31-18"><a href="#cb31-18"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb31-19"><a href="#cb31-19"></a>    <span class="at">y =</span> <span class="st">"Time in seconds"</span>,</span>
<span id="cb31-20"><a href="#cb31-20"></a>    <span class="at">title =</span> <span class="st">"Comparison of Model Fit Processing Times"</span></span>
<span id="cb31-21"><a href="#cb31-21"></a>  ) <span class="sc">+</span></span>
<span id="cb31-22"><a href="#cb31-22"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb31-23"><a href="#cb31-23"></a>  theme_timetk <span class="sc">+</span></span>
<span id="cb31-24"><a href="#cb31-24"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-fit-proc-times" class="quarto-figure quarto-figure-center quarto-float anchored" width="576">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fit-proc-times-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="forecasting-with-modeltime-part-3_files/figure-html/fig-fit-proc-times-1.png" id="fig-fit-proc-times" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-fit-proc-times-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5
</figcaption>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a>global_refit_time <span class="ot">&lt;-</span> (global_refit_end <span class="sc">-</span> global_refit_start) <span class="sc">|&gt;</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>  <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"metric"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(value), <span class="at">model_process =</span> <span class="st">"Global Refit"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a>iterative_refit_time <span class="ot">&lt;-</span> (iterative_refit_end <span class="sc">-</span> iterative_refit_start) <span class="sc">|&gt;</span></span>
<span id="cb32-7"><a href="#cb32-7"></a>  <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"metric"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-8"><a href="#cb32-8"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(value), <span class="at">model_process =</span> <span class="st">"Iterative Refit"</span>) <span class="sc">|&gt;</span></span>
<span id="cb32-9"><a href="#cb32-9"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb32-10"><a href="#cb32-10"></a></span>
<span id="cb32-11"><a href="#cb32-11"></a><span class="fu">bind_rows</span>(global_refit_time, iterative_refit_time) <span class="sc">|&gt;</span></span>
<span id="cb32-12"><a href="#cb32-12"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb32-13"><a href="#cb32-13"></a>    <span class="fu">aes</span>(<span class="at">x =</span> metric, <span class="at">y =</span> value, <span class="at">fill =</span> model_process, <span class="at">group =</span> model_process)</span>
<span id="cb32-14"><a href="#cb32-14"></a>  ) <span class="sc">+</span></span>
<span id="cb32-15"><a href="#cb32-15"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb32-16"><a href="#cb32-16"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-17"><a href="#cb32-17"></a>    <span class="at">fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb32-18"><a href="#cb32-18"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb32-19"><a href="#cb32-19"></a>    <span class="at">y =</span> <span class="st">"Time in seconds"</span>,</span>
<span id="cb32-20"><a href="#cb32-20"></a>    <span class="at">title =</span> <span class="st">"Model Refit Processing Times"</span></span>
<span id="cb32-21"><a href="#cb32-21"></a>  ) <span class="sc">+</span></span>
<span id="cb32-22"><a href="#cb32-22"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb32-23"><a href="#cb32-23"></a>  theme_timetk <span class="sc">+</span></span>
<span id="cb32-24"><a href="#cb32-24"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-refit-proc-times" class="quarto-figure quarto-figure-center quarto-float anchored" width="576">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-refit-proc-times-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="forecasting-with-modeltime-part-3_files/figure-html/fig-refit-proc-times-1.png" id="fig-refit-proc-times" class="img-fluid figure-img" width="576">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-refit-proc-times-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6
</figcaption>
</figure>
</div>
</div>
</div>
<p>Besides these operational differences, the processes yield different levels of accuracy due to differences in the data on which they are trained (or to which they are initially fit). It’s also clear that the differences in models can yield some very big differences in forecasts. Global models have performed well in competitions that involved thousands of time series, so it’s possible that the variance across the four time series in this analysis is too high to make global modeling worthwhile.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb33-2"><a href="#cb33-2"></a>  forecast_future_global <span class="sc">|&gt;</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="cb33-5"><a href="#cb33-5"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-6"><a href="#cb33-6"></a>    <span class="at">.title =</span> <span class="st">"1 Year Forecast into the Future - Global"</span>,</span>
<span id="cb33-7"><a href="#cb33-7"></a>    <span class="at">.facet_ncol =</span> <span class="dv">1</span></span>
<span id="cb33-8"><a href="#cb33-8"></a>  ) <span class="sc">+</span></span>
<span id="cb33-9"><a href="#cb33-9"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)),</span>
<span id="cb33-10"><a href="#cb33-10"></a>  forecast_future_iterative <span class="sc">|&gt;</span></span>
<span id="cb33-11"><a href="#cb33-11"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb33-12"><a href="#cb33-12"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="cb33-13"><a href="#cb33-13"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-14"><a href="#cb33-14"></a>    <span class="at">.title =</span> <span class="st">"1 Year Forecast into the Future - Global"</span>,</span>
<span id="cb33-15"><a href="#cb33-15"></a>    <span class="at">.facet_ncol =</span> <span class="dv">1</span></span>
<span id="cb33-16"><a href="#cb33-16"></a>  ) <span class="sc">+</span></span>
<span id="cb33-17"><a href="#cb33-17"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb33-18"><a href="#cb33-18"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="forecasting-with-modeltime-part-3_files/figure-html/show-both-forecasts-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>In the next post I’ll run a global modeling process with a few different algorithms and specifications to get a few hundred models and find which ones run best.</p>


<!-- -->


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-modeltime" class="csl-entry" role="listitem">
Dancho, Matt. 2023. <span>“Modeltime: The Tidymodels Extension for Time Series Modeling.”</span> <a href="https://CRAN.R-project.org/package=modeltime">https://CRAN.R-project.org/package=modeltime</a>.
</div>
<div id="ref-timetk" class="csl-entry" role="listitem">
Dancho, Matt, and Davis Vaughan. 2023. <span>“Timetk: A Tool Kit for Working with Time Series.”</span> <a href="https://CRAN.R-project.org/package=timetk">https://CRAN.R-project.org/package=timetk</a>.
</div>
<div id="ref-gt" class="csl-entry" role="listitem">
Iannone, Richard, Joe Cheng, Barret Schloerke, Ellis Hughes, Alexandra Lauer, and JooYoung Seo. 2024. <span>“Gt: Easily Create Presentation-Ready Display Tables.”</span> <a href="https://CRAN.R-project.org/package=gt">https://CRAN.R-project.org/package=gt</a>.
</div>
<div id="ref-tidymodels" class="csl-entry" role="listitem">
Kuhn, Max, and Hadley Wickham. 2020. <span>“Tidymodels: A Collection of Packages for Modeling and Machine Learning Using Tidyverse Principles.”</span> <a href="https://www.tidymodels.org">https://www.tidymodels.org</a>.
</div>
<div id="ref-tidyverse" class="csl-entry" role="listitem">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span></span>Tidyverse<span></span>”</span> 4: 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("^(?:http:|https:)\/\/www\.arcenis-r\.github\.io\/ajr-portfolio");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
          // default icon
          link.classList.add("external");
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          trigger: 'click',
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          positionFixed: true,
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://giscus.app/client.js" data-repo="arcenis-r/ajr-portfolio" data-repo-id="MDEwOlJlcG9zaXRvcnkxNzg3MDY3MTM=" data-category="General" data-category-id="DIC_kwDOCqbZGc4CdJXz" data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="en" crossorigin="anonymous" async="">
</script>
<input type="hidden" id="giscus-base-theme" value="light">
<input type="hidden" id="giscus-alt-theme" value="dark"><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb34" data-shortcodes="false"><pre class="sourceCode numberSource markdown number-lines code-with-copy"><code class="sourceCode markdown"><span id="cb34-1"><a href="#cb34-1"></a><span class="co">---</span></span>
<span id="cb34-2"><a href="#cb34-2"></a><span class="an">title:</span><span class="co"> "Forecasting with {modeltime} - Part III"</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="an">subtitle:</span><span class="co"> "Global vs. iterative modeling"</span></span>
<span id="cb34-4"><a href="#cb34-4"></a><span class="an">author:</span><span class="co"> "Arcenis Rojas"</span></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="an">date:</span><span class="co"> "2/16/2024"</span></span>
<span id="cb34-6"><a href="#cb34-6"></a><span class="an">bibliography:</span><span class="co"> references.bib</span></span>
<span id="cb34-7"><a href="#cb34-7"></a><span class="an">categories:</span></span>
<span id="cb34-8"><a href="#cb34-8"></a><span class="co">  - time series analysis</span></span>
<span id="cb34-9"><a href="#cb34-9"></a><span class="co">  - econometrics</span></span>
<span id="cb34-10"><a href="#cb34-10"></a><span class="co">  - data viz</span></span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="an">fig-height:</span><span class="co"> 6</span></span>
<span id="cb34-12"><a href="#cb34-12"></a><span class="an">fig-width:</span><span class="co"> 8</span></span>
<span id="cb34-13"><a href="#cb34-13"></a><span class="co">---</span></span>
<span id="cb34-14"><a href="#cb34-14"></a></span>
<span id="cb34-15"><a href="#cb34-15"></a>In my previous post on this topic – <span class="co">[</span><span class="ot">Forecasting with {modeltime} - Part II</span><span class="co">](../20240215-forecasting-with-modeltime-part-2/forecasting-with-modeltime-part-2.qmd)</span> – I performed a basic analysis of the Case-Shiller HPI time series for four U.S. cities (Dallas, Detroit, NYC, and San Diego). In this post I'm going to use some of the conclusions from that analysis to build ARIMA models using both a "global" modeling process and an "iterative" modeling process using the <span class="co">[</span><span class="ot">modeltime</span><span class="co">](https://business-science.github.io/modeltime/index.html)</span> <span class="co">[</span><span class="ot">@modeltime</span><span class="co">]</span> and <span class="co">[</span><span class="ot">tidymodels</span><span class="co">](https://www.tidymodels.org/)</span> <span class="co">[</span><span class="ot">@tidymodels</span><span class="co">]</span> frameworks.</span>
<span id="cb34-16"><a href="#cb34-16"></a></span>
<span id="cb34-17"><a href="#cb34-17"></a>One of the distinguishing features of <span class="in">`modeltime`</span> among other time series modeling frameworks is that it works very well with <span class="in">`tidymodels`</span>. In fact, like <span class="in">`tidymodels`</span> , <span class="in">`modeltime`</span> serves as a platform for building consistent workflows using algorithms from other packages. <span class="in">`modeltime`</span> builds on top of <span class="in">`tidymodels`</span> to create a framework for dealing with the specific challenges of time series modelling and putting it all in a convenient, consistent API.</span>
<span id="cb34-18"><a href="#cb34-18"></a></span>
<span id="cb34-19"><a href="#cb34-19"></a>I'll also be using <span class="co">[</span><span class="ot">tidyverse</span><span class="co">](https://www.tidyverse.org/)</span> <span class="co">[</span><span class="ot">@tidyverse</span><span class="co">]</span> and <span class="co">[</span><span class="ot">gt</span><span class="co">](https://gt.rstudio.com/)</span> <span class="co">[</span><span class="ot">@gt</span><span class="co">]</span>, per usual, and <span class="co">[</span><span class="ot">timetk</span><span class="co">](https://business-science.github.io/timetk/)</span> <span class="co">[</span><span class="ot">@timetk</span><span class="co">]</span>. <span class="in">`modeltime`</span> and <span class="in">`timetk`</span> are developed and maintained by the good people at <span class="co">[</span><span class="ot">Business Science</span><span class="co">](https://www.business-science.io/)</span> and <span class="in">`tidyverse`</span>, <span class="in">`tidymodels`</span>, and <span class="in">`gt`</span> are developed and maintained by the generous folks at <span class="co">[</span><span class="ot">Posit</span><span class="co">](https://posit.co/)</span>.</span>
<span id="cb34-20"><a href="#cb34-20"></a></span>
<span id="cb34-21"><a href="#cb34-21"></a><span class="fu">## Time Series Analysis Review</span></span>
<span id="cb34-22"><a href="#cb34-22"></a></span>
<span id="cb34-23"><a href="#cb34-23"></a>In the aforementioned time series analysis I found that the time series data for all four cities had a strong trend and a strong seasonal component. The trend was mostly muted by using a lag of 1 and the seasonal component of each series was generally muted by differencing twelve times, which makes sense given that the data are monthly (annual seasonal cycle). I was able to use these methods to greatly reduce the influence of non-stationary components according to the Augmented Dickey-Fuller test. The ACF and PACF plots led me to conclude to use an AR(3) and MA(5) ARIMA model. To deal with the seasonality I differenced the data twelve times. This will translate to a seasonal differencing component of (1) in the ARIMA model. In the previous post I wrote that I would be performing ARIMA rather than SARIMA... things change.</span>
<span id="cb34-24"><a href="#cb34-24"></a></span>
<span id="cb34-27"><a href="#cb34-27"></a><span class="in">```{r}</span></span>
<span id="cb34-28"><a href="#cb34-28"></a><span class="co">#| label: load-packages</span></span>
<span id="cb34-29"><a href="#cb34-29"></a></span>
<span id="cb34-30"><a href="#cb34-30"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb34-31"><a href="#cb34-31"></a><span class="fu">library</span>(timetk)</span>
<span id="cb34-32"><a href="#cb34-32"></a><span class="fu">library</span>(modeltime)</span>
<span id="cb34-33"><a href="#cb34-33"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb34-34"><a href="#cb34-34"></a><span class="fu">library</span>(gt)</span>
<span id="cb34-35"><a href="#cb34-35"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb34-36"><a href="#cb34-36"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="st">"lag"</span>, <span class="st">"dplyr"</span>)</span>
<span id="cb34-37"><a href="#cb34-37"></a><span class="fu">tidymodels_prefer</span>()</span>
<span id="cb34-38"><a href="#cb34-38"></a><span class="in">```</span></span>
<span id="cb34-39"><a href="#cb34-39"></a></span>
<span id="cb34-42"><a href="#cb34-42"></a><span class="in">```{r}</span></span>
<span id="cb34-43"><a href="#cb34-43"></a><span class="co">#| label: import-data</span></span>
<span id="cb34-44"><a href="#cb34-44"></a><span class="co">#| include: false</span></span>
<span id="cb34-45"><a href="#cb34-45"></a></span>
<span id="cb34-46"><a href="#cb34-46"></a>econ_data <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"../../common-resources/econ-data.Rds"</span>)  <span class="sc">|&gt;</span> </span>
<span id="cb34-47"><a href="#cb34-47"></a>  <span class="fu">select</span>(city, date, hpi)</span>
<span id="cb34-48"><a href="#cb34-48"></a></span>
<span id="cb34-49"><a href="#cb34-49"></a><span class="fu">source</span>(<span class="st">"../../common-resources/gt-bold-head.R"</span>)</span>
<span id="cb34-50"><a href="#cb34-50"></a></span>
<span id="cb34-51"><a href="#cb34-51"></a>theme_timetk <span class="ot">&lt;-</span> <span class="fu">read_rds</span>(<span class="st">"../../common-resources/theme-timetk.Rds"</span>) </span>
<span id="cb34-52"><a href="#cb34-52"></a></span>
<span id="cb34-53"><a href="#cb34-53"></a>series_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#2c3e50"</span>, <span class="st">"red"</span>)</span>
<span id="cb34-54"><a href="#cb34-54"></a><span class="in">```</span></span>
<span id="cb34-55"><a href="#cb34-55"></a></span>
<span id="cb34-56"><a href="#cb34-56"></a><span class="fu">## Differences between global and iterative modeling</span></span>
<span id="cb34-57"><a href="#cb34-57"></a></span>
<span id="cb34-58"><a href="#cb34-58"></a>Conventionally, time series models work by regressing the outcome – the most recent or future observation(s) – on previous observations of itself. We can refer to this as a "local" model because the variance in the data corresponds to only the single time series. A global model, on the other hand, pools the data to get a global variance and uses that information to make forecasts.</span>
<span id="cb34-59"><a href="#cb34-59"></a></span>
<span id="cb34-60"><a href="#cb34-60"></a>The primary advantages of a global model are speed and scalability. A second advantage is that each, individual forecasting model can "learn" from the history of the other time series that it's pooled with. The disadvantage is that each individual model will likely be less accurate than if it was fit on an individual basis.</span>
<span id="cb34-61"><a href="#cb34-61"></a></span>
<span id="cb34-62"><a href="#cb34-62"></a>The advantage of modeling time series locally and iteratively is that this process most likely yields the highest quality fit and accuracy for each, individual model. The disadvantage is that as the number of models grows, so do the computational burden and processing time.</span>
<span id="cb34-63"><a href="#cb34-63"></a></span>
<span id="cb34-64"><a href="#cb34-64"></a>In two sections below I'll demonstrate both processes with an ARIMA model using the parameters mentioned above and in the last section I'll compare the results from both.</span>
<span id="cb34-65"><a href="#cb34-65"></a></span>
<span id="cb34-66"><a href="#cb34-66"></a><span class="fu">## Building a global ARIMA model</span></span>
<span id="cb34-67"><a href="#cb34-67"></a></span>
<span id="cb34-68"><a href="#cb34-68"></a>As mentioned above, <span class="in">`modeltime`</span> follows the Tidymodels convention. As such, it starts with partitioning data into training and testing data sets, continues with writing a recipe and model specification (and combining them in a <span class="in">`workflow`</span> object), follows with fitting the model, and continues with model evaluation and selection.</span>
<span id="cb34-69"><a href="#cb34-69"></a></span>
<span id="cb34-70"><a href="#cb34-70"></a>::: callout-tip</span>
<span id="cb34-71"><a href="#cb34-71"></a>For more information on the Tidymodels framework, please check out <span class="ot">&lt;https://www.tmwr.org/&gt;</span>.</span>
<span id="cb34-72"><a href="#cb34-72"></a>:::</span>
<span id="cb34-73"><a href="#cb34-73"></a></span>
<span id="cb34-74"><a href="#cb34-74"></a><span class="fu">### Splitting data</span></span>
<span id="cb34-75"><a href="#cb34-75"></a></span>
<span id="cb34-76"><a href="#cb34-76"></a>For a global modeling process one can use the timetk::time_series_split() function which will create a list containing the data set, one vector of training data IDs and one of testing data IDs, and a 1-column data set containing all IDs.</span>
<span id="cb34-77"><a href="#cb34-77"></a></span>
<span id="cb34-78"><a href="#cb34-78"></a>The time_series_split() function uses 5 initial cross-validation periods by default with each one being progressively longer using a specified period of time as the assessment period. This assessment period is specified by the asses argument.</span>
<span id="cb34-79"><a href="#cb34-79"></a></span>
<span id="cb34-82"><a href="#cb34-82"></a><span class="in">```{r}</span></span>
<span id="cb34-83"><a href="#cb34-83"></a><span class="co">#| label: splits-global</span></span>
<span id="cb34-84"><a href="#cb34-84"></a></span>
<span id="cb34-85"><a href="#cb34-85"></a>econ_splits_global <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="cb34-86"><a href="#cb34-86"></a>  <span class="fu">time_series_split</span>(</span>
<span id="cb34-87"><a href="#cb34-87"></a>    <span class="at">assess =</span> <span class="st">"2 year"</span>,</span>
<span id="cb34-88"><a href="#cb34-88"></a>    <span class="at">cumulative =</span> <span class="cn">TRUE</span>,</span>
<span id="cb34-89"><a href="#cb34-89"></a>    <span class="at">date_var =</span> date   </span>
<span id="cb34-90"><a href="#cb34-90"></a>  )</span>
<span id="cb34-91"><a href="#cb34-91"></a></span>
<span id="cb34-92"><a href="#cb34-92"></a><span class="fu">str</span>(econ_splits_global)</span>
<span id="cb34-93"><a href="#cb34-93"></a><span class="in">```</span></span>
<span id="cb34-94"><a href="#cb34-94"></a></span>
<span id="cb34-95"><a href="#cb34-95"></a><span class="fu">### Specifying a modeling workflow and fit the model</span></span>
<span id="cb34-96"><a href="#cb34-96"></a></span>
<span id="cb34-97"><a href="#cb34-97"></a>To specify the workflow I'll first write the recipe...</span>
<span id="cb34-98"><a href="#cb34-98"></a></span>
<span id="cb34-99"><a href="#cb34-99"></a>::: {.callout-caution title="Lagging/Differencing as a recipe step" collapse="true"}</span>
<span id="cb34-100"><a href="#cb34-100"></a>One might be tempted to add lags and differences in the recipe, but this leads to a mess that's really difficult to get out of. It all starts with the fact that a lagged and/or differenced variable will have a different name and will create missing values. I found that it's best to handle these operations in the model specification.</span>
<span id="cb34-101"><a href="#cb34-101"></a>:::</span>
<span id="cb34-102"><a href="#cb34-102"></a></span>
<span id="cb34-105"><a href="#cb34-105"></a><span class="in">```{r}</span></span>
<span id="cb34-106"><a href="#cb34-106"></a><span class="co">#| label: rec-global</span></span>
<span id="cb34-107"><a href="#cb34-107"></a></span>
<span id="cb34-108"><a href="#cb34-108"></a>arima_rec_global <span class="ot">&lt;-</span> <span class="fu">recipe</span>(hpi <span class="sc">~</span> date, <span class="at">data =</span> <span class="fu">training</span>(econ_splits_global))</span>
<span id="cb34-109"><a href="#cb34-109"></a></span>
<span id="cb34-110"><a href="#cb34-110"></a>arima_rec_global <span class="sc">|&gt;</span> <span class="fu">summary</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span>
<span id="cb34-111"><a href="#cb34-111"></a><span class="in">```</span></span>
<span id="cb34-112"><a href="#cb34-112"></a></span>
<span id="cb34-113"><a href="#cb34-113"></a>... then the model object.</span>
<span id="cb34-114"><a href="#cb34-114"></a></span>
<span id="cb34-115"><a href="#cb34-115"></a>The model specification below will be used for both processes.</span>
<span id="cb34-116"><a href="#cb34-116"></a></span>
<span id="cb34-119"><a href="#cb34-119"></a><span class="in">```{r}</span></span>
<span id="cb34-120"><a href="#cb34-120"></a><span class="co">#| label: mod-spec</span></span>
<span id="cb34-121"><a href="#cb34-121"></a></span>
<span id="cb34-122"><a href="#cb34-122"></a>arima_spec <span class="ot">&lt;-</span> <span class="fu">arima_reg</span>(         <span class="co"># &lt;1&gt;</span></span>
<span id="cb34-123"><a href="#cb34-123"></a>  <span class="at">non_seasonal_ar =</span> <span class="dv">3</span>,           <span class="co"># &lt;2&gt;</span></span>
<span id="cb34-124"><a href="#cb34-124"></a>  <span class="at">non_seasonal_ma =</span> <span class="dv">5</span>,           <span class="co"># &lt;3&gt;</span></span>
<span id="cb34-125"><a href="#cb34-125"></a>  <span class="at">non_seasonal_differences =</span> <span class="dv">1</span>,  <span class="co"># &lt;4&gt;</span></span>
<span id="cb34-126"><a href="#cb34-126"></a>  <span class="at">seasonal_differences =</span> <span class="dv">1</span>,      <span class="co"># &lt;5&gt;</span></span>
<span id="cb34-127"><a href="#cb34-127"></a>  <span class="at">seasonal_period =</span> <span class="dv">12</span>           <span class="co"># &lt;6&gt;</span></span>
<span id="cb34-128"><a href="#cb34-128"></a>) <span class="sc">|&gt;</span></span>
<span id="cb34-129"><a href="#cb34-129"></a>  <span class="fu">set_engine</span>(<span class="st">"arima"</span>)            <span class="co"># &lt;7&gt;</span></span>
<span id="cb34-130"><a href="#cb34-130"></a></span>
<span id="cb34-131"><a href="#cb34-131"></a>arima_spec</span>
<span id="cb34-132"><a href="#cb34-132"></a><span class="in">```</span></span>
<span id="cb34-133"><a href="#cb34-133"></a></span>
<span id="cb34-134"><a href="#cb34-134"></a><span class="ss">1.  </span>Call the API for building ARIMA models</span>
<span id="cb34-135"><a href="#cb34-135"></a><span class="ss">2.  </span>Set the AR order (*p* in conventional notation)</span>
<span id="cb34-136"><a href="#cb34-136"></a><span class="ss">3.  </span>Set the MA order (*q* in conventional notation)</span>
<span id="cb34-137"><a href="#cb34-137"></a><span class="ss">4.  </span>Set the degree of non-seasonal differencing (*d* in conventional notation)</span>
<span id="cb34-138"><a href="#cb34-138"></a><span class="ss">5.  </span>Set the degree of seasonal differencing (*D* in conventional notation)</span>
<span id="cb34-139"><a href="#cb34-139"></a><span class="ss">6.  </span>Set the length of the seasonal period</span>
<span id="cb34-140"><a href="#cb34-140"></a><span class="ss">7.  </span>Set the modeling engine to <span class="in">`stats::arima()`</span></span>
<span id="cb34-141"><a href="#cb34-141"></a></span>
<span id="cb34-142"><a href="#cb34-142"></a>Now that those are complete I can put them together in a <span class="in">`workflow`</span> object.</span>
<span id="cb34-143"><a href="#cb34-143"></a></span>
<span id="cb34-146"><a href="#cb34-146"></a><span class="in">```{r}</span></span>
<span id="cb34-147"><a href="#cb34-147"></a><span class="co">#| label: workflow-global</span></span>
<span id="cb34-148"><a href="#cb34-148"></a></span>
<span id="cb34-149"><a href="#cb34-149"></a>arima_wflow_global <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">|&gt;</span>   <span class="co"># &lt;1&gt;</span></span>
<span id="cb34-150"><a href="#cb34-150"></a>  <span class="fu">add_model</span>(arima_spec) <span class="sc">|&gt;</span>            <span class="co"># &lt;2&gt;</span></span>
<span id="cb34-151"><a href="#cb34-151"></a>  <span class="fu">add_recipe</span>(arima_rec_global)        <span class="co"># &lt;3&gt;</span></span>
<span id="cb34-152"><a href="#cb34-152"></a></span>
<span id="cb34-153"><a href="#cb34-153"></a>arima_wflow_global</span>
<span id="cb34-154"><a href="#cb34-154"></a><span class="in">```</span></span>
<span id="cb34-155"><a href="#cb34-155"></a></span>
<span id="cb34-156"><a href="#cb34-156"></a><span class="ss">1.  </span>Create a container for a <span class="in">`workflow`</span> object</span>
<span id="cb34-157"><a href="#cb34-157"></a><span class="ss">2.  </span>Add the above model specification</span>
<span id="cb34-158"><a href="#cb34-158"></a><span class="ss">3.  </span>Add the recipe</span>
<span id="cb34-159"><a href="#cb34-159"></a></span>
<span id="cb34-160"><a href="#cb34-160"></a>The final step here is to fit the model</span>
<span id="cb34-161"><a href="#cb34-161"></a></span>
<span id="cb34-164"><a href="#cb34-164"></a><span class="in">```{r}</span></span>
<span id="cb34-165"><a href="#cb34-165"></a><span class="co">#| label: fit-global</span></span>
<span id="cb34-166"><a href="#cb34-166"></a><span class="co">#| cache: true</span></span>
<span id="cb34-167"><a href="#cb34-167"></a></span>
<span id="cb34-168"><a href="#cb34-168"></a>global_fit_start <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb34-169"><a href="#cb34-169"></a></span>
<span id="cb34-170"><a href="#cb34-170"></a>arima_fit_global <span class="ot">&lt;-</span> arima_wflow_global <span class="sc">|&gt;</span></span>
<span id="cb34-171"><a href="#cb34-171"></a>  <span class="fu">fit</span>(<span class="fu">training</span>(econ_splits_global))</span>
<span id="cb34-172"><a href="#cb34-172"></a></span>
<span id="cb34-173"><a href="#cb34-173"></a>global_fit_end <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb34-174"><a href="#cb34-174"></a></span>
<span id="cb34-175"><a href="#cb34-175"></a>arima_fit_global</span>
<span id="cb34-176"><a href="#cb34-176"></a><span class="in">```</span></span>
<span id="cb34-177"><a href="#cb34-177"></a></span>
<span id="cb34-178"><a href="#cb34-178"></a><span class="fu">### Model evaluation</span></span>
<span id="cb34-179"><a href="#cb34-179"></a></span>
<span id="cb34-180"><a href="#cb34-180"></a>To deal with some of the characteristics specific to time series modeling, the <span class="in">`modeltime`</span> framework uses conventions like the <span class="in">`mdl_time_tbl`</span> (modeltime table) class to store a variety of elements of a time series model including accuracy metrics. This class is also used in model calibration and refitting for future forecasting. Here I'll write the modeltime table for the global process.</span>
<span id="cb34-181"><a href="#cb34-181"></a></span>
<span id="cb34-182"><a href="#cb34-182"></a>I'm showing the model time table using a <span class="in">`print()`</span> method rather than as a <span class="in">`gt`</span> table because the list in the second column (list) would render in a cumbersome way.</span>
<span id="cb34-183"><a href="#cb34-183"></a></span>
<span id="cb34-186"><a href="#cb34-186"></a><span class="in">```{r}</span></span>
<span id="cb34-187"><a href="#cb34-187"></a><span class="co">#| label: mtt-global</span></span>
<span id="cb34-188"><a href="#cb34-188"></a></span>
<span id="cb34-189"><a href="#cb34-189"></a>arima_mtt_global <span class="ot">&lt;-</span> <span class="fu">modeltime_table</span>(arima_fit_global)</span>
<span id="cb34-190"><a href="#cb34-190"></a></span>
<span id="cb34-191"><a href="#cb34-191"></a>arima_mtt_global</span>
<span id="cb34-192"><a href="#cb34-192"></a><span class="in">```</span></span>
<span id="cb34-193"><a href="#cb34-193"></a></span>
<span id="cb34-194"><a href="#cb34-194"></a>This table contains the model and some additional information about it. I'll now use this table to calibrate the global model to the individual time series with</span>
<span id="cb34-195"><a href="#cb34-195"></a></span>
<span id="cb34-198"><a href="#cb34-198"></a><span class="in">```{r}</span></span>
<span id="cb34-199"><a href="#cb34-199"></a><span class="co">#| label: calibrate-global</span></span>
<span id="cb34-200"><a href="#cb34-200"></a><span class="co">#| cache: true</span></span>
<span id="cb34-201"><a href="#cb34-201"></a></span>
<span id="cb34-202"><a href="#cb34-202"></a>arima_calib_global <span class="ot">&lt;-</span> arima_mtt_global <span class="sc">|&gt;</span></span>
<span id="cb34-203"><a href="#cb34-203"></a>  <span class="fu">modeltime_calibrate</span>(<span class="at">new_data =</span> <span class="fu">testing</span>(econ_splits_global), <span class="at">id =</span> <span class="st">"city"</span>)</span>
<span id="cb34-204"><a href="#cb34-204"></a></span>
<span id="cb34-205"><a href="#cb34-205"></a>arima_calib_global</span>
<span id="cb34-206"><a href="#cb34-206"></a><span class="in">```</span></span>
<span id="cb34-207"><a href="#cb34-207"></a></span>
<span id="cb34-208"><a href="#cb34-208"></a>With the calibration done I can now look at the accuracy of the model both at a global level and at an individual model level.</span>
<span id="cb34-209"><a href="#cb34-209"></a></span>
<span id="cb34-210"><a href="#cb34-210"></a>Getting the accuracy is done by the same function: <span class="in">`modeltime_accuracy()`</span>. Whether it outputs global or local model accuracy is determined by the <span class="in">`acc_by_id`</span> argument.</span>
<span id="cb34-211"><a href="#cb34-211"></a></span>
<span id="cb34-212"><a href="#cb34-212"></a><span class="fu">#### Global model accuracy</span></span>
<span id="cb34-213"><a href="#cb34-213"></a></span>
<span id="cb34-216"><a href="#cb34-216"></a><span class="in">```{r}</span></span>
<span id="cb34-217"><a href="#cb34-217"></a><span class="co">#| label: tbl-acc-global</span></span>
<span id="cb34-218"><a href="#cb34-218"></a></span>
<span id="cb34-219"><a href="#cb34-219"></a>arima_calib_global <span class="sc">|&gt;</span></span>
<span id="cb34-220"><a href="#cb34-220"></a>  <span class="fu">modeltime_accuracy</span>(<span class="at">acc_by_id =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span>  </span>
<span id="cb34-221"><a href="#cb34-221"></a>  <span class="fu">table_modeltime_accuracy</span>(<span class="at">.interactive =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-222"><a href="#cb34-222"></a><span class="in">```</span></span>
<span id="cb34-223"><a href="#cb34-223"></a></span>
<span id="cb34-224"><a href="#cb34-224"></a><span class="fu">#### Local model accuracy</span></span>
<span id="cb34-225"><a href="#cb34-225"></a></span>
<span id="cb34-228"><a href="#cb34-228"></a><span class="in">```{r}</span></span>
<span id="cb34-229"><a href="#cb34-229"></a><span class="co">#| label: tbl-acc-global-local</span></span>
<span id="cb34-230"><a href="#cb34-230"></a><span class="co">#| tbl-cap: "global model accuracy table"</span></span>
<span id="cb34-231"><a href="#cb34-231"></a></span>
<span id="cb34-232"><a href="#cb34-232"></a>arima_calib_global <span class="sc">|&gt;</span></span>
<span id="cb34-233"><a href="#cb34-233"></a>  <span class="fu">modeltime_accuracy</span>(<span class="at">acc_by_id =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-234"><a href="#cb34-234"></a>  <span class="fu">table_modeltime_accuracy</span>(<span class="at">.interactive =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-235"><a href="#cb34-235"></a><span class="in">```</span></span>
<span id="cb34-236"><a href="#cb34-236"></a></span>
<span id="cb34-237"><a href="#cb34-237"></a>For comparison you can jump ahead to see the <span class="co">[</span><span class="ot">iterative model accuracy table @tbl-acc-iterative</span><span class="co">]</span>.</span>
<span id="cb34-238"><a href="#cb34-238"></a></span>
<span id="cb34-239"><a href="#cb34-239"></a><span class="fu">#### Accuracy plot</span></span>
<span id="cb34-240"><a href="#cb34-240"></a></span>
<span id="cb34-241"><a href="#cb34-241"></a>Below is a visual representation of how the models performed against the test data (the last 2 years).</span>
<span id="cb34-242"><a href="#cb34-242"></a></span>
<span id="cb34-245"><a href="#cb34-245"></a><span class="in">```{r}</span></span>
<span id="cb34-246"><a href="#cb34-246"></a><span class="co">#| label: fig-acc-global</span></span>
<span id="cb34-247"><a href="#cb34-247"></a><span class="co">#| fig-cap: "global model accuracy plot"</span></span>
<span id="cb34-248"><a href="#cb34-248"></a></span>
<span id="cb34-249"><a href="#cb34-249"></a>arima_calib_global <span class="sc">|&gt;</span>                            <span class="co"># &lt;1&gt;</span></span>
<span id="cb34-250"><a href="#cb34-250"></a>  <span class="fu">modeltime_forecast</span>(                            <span class="co"># &lt;2&gt;</span></span>
<span id="cb34-251"><a href="#cb34-251"></a>    <span class="at">new_data =</span> <span class="fu">testing</span>(econ_splits_global),      <span class="co"># &lt;3&gt;</span></span>
<span id="cb34-252"><a href="#cb34-252"></a>    <span class="at">actual_data =</span> econ_data,                     <span class="co"># &lt;4&gt;</span></span>
<span id="cb34-253"><a href="#cb34-253"></a>    <span class="at">conf_by_id =</span> <span class="cn">TRUE</span>,                           <span class="co"># &lt;5&gt;</span></span>
<span id="cb34-254"><a href="#cb34-254"></a>    <span class="at">keep_data =</span> <span class="cn">TRUE</span>                             <span class="co"># &lt;6&gt;</span></span>
<span id="cb34-255"><a href="#cb34-255"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb34-256"><a href="#cb34-256"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span>                              <span class="co"># &lt;7&gt;</span></span>
<span id="cb34-257"><a href="#cb34-257"></a>  <span class="fu">plot_modeltime_forecast</span>(                       <span class="co"># &lt;8&gt;</span></span>
<span id="cb34-258"><a href="#cb34-258"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-259"><a href="#cb34-259"></a>    <span class="at">.title =</span> <span class="st">"Forecast of Test Data - Global"</span>,</span>
<span id="cb34-260"><a href="#cb34-260"></a>    <span class="at">.facet_ncol =</span> <span class="dv">2</span></span>
<span id="cb34-261"><a href="#cb34-261"></a>  ) <span class="sc">+</span></span>
<span id="cb34-262"><a href="#cb34-262"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb34-263"><a href="#cb34-263"></a><span class="in">```</span></span>
<span id="cb34-264"><a href="#cb34-264"></a></span>
<span id="cb34-265"><a href="#cb34-265"></a><span class="ss">1.  </span>Call up the object containing the calibrated models</span>
<span id="cb34-266"><a href="#cb34-266"></a><span class="ss">2.  </span>Call the <span class="in">`modeltime_forecast()`</span> function</span>
<span id="cb34-267"><a href="#cb34-267"></a><span class="ss">3.  </span>Specify the new data to test forecasts against; in this case it's the testing split from the object created by <span class="in">`time_series_split()`</span></span>
<span id="cb34-268"><a href="#cb34-268"></a><span class="ss">4.  </span>Specify what to use as the actual data; in this case it's the original <span class="in">`econ_data`</span> object</span>
<span id="cb34-269"><a href="#cb34-269"></a><span class="ss">5.  </span>Specify whether to generate confidence intervals by individual data series</span>
<span id="cb34-270"><a href="#cb34-270"></a><span class="ss">6.  </span>Specify whether to keep the columns from the actual data; I specified <span class="in">`TRUE`</span> to keep the "city" column</span>
<span id="cb34-271"><a href="#cb34-271"></a><span class="ss">7.  </span>Group by city to generate the forecasts by city</span>
<span id="cb34-272"><a href="#cb34-272"></a><span class="ss">8.  </span>Plot the forecasts as a stationary plot</span>
<span id="cb34-273"><a href="#cb34-273"></a></span>
<span id="cb34-274"><a href="#cb34-274"></a>For comparison you can jump ahead to see the <span class="co">[</span><span class="ot">iterative model accuracy plot @fig-acc-iterative</span><span class="co">]</span>.</span>
<span id="cb34-275"><a href="#cb34-275"></a></span>
<span id="cb34-276"><a href="#cb34-276"></a><span class="fu">### Forecasting the future</span></span>
<span id="cb34-277"><a href="#cb34-277"></a></span>
<span id="cb34-278"><a href="#cb34-278"></a>The first step in getting forecasts for the future (with respect to the available data) is to refit the model using all of the training data after calibrating the model. That is done with the <span class="in">`modeltime_refit()`</span> function for a global process.</span>
<span id="cb34-279"><a href="#cb34-279"></a></span>
<span id="cb34-282"><a href="#cb34-282"></a><span class="in">```{r}</span></span>
<span id="cb34-283"><a href="#cb34-283"></a><span class="co">#| label: refit-global</span></span>
<span id="cb34-284"><a href="#cb34-284"></a><span class="co">#| cache: true</span></span>
<span id="cb34-285"><a href="#cb34-285"></a></span>
<span id="cb34-286"><a href="#cb34-286"></a>global_refit_start <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb34-287"><a href="#cb34-287"></a></span>
<span id="cb34-288"><a href="#cb34-288"></a>arima_refit_global <span class="ot">&lt;-</span> <span class="fu">modeltime_refit</span>(arima_calib_global, <span class="at">data =</span> econ_data) </span>
<span id="cb34-289"><a href="#cb34-289"></a></span>
<span id="cb34-290"><a href="#cb34-290"></a>global_refit_end <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb34-291"><a href="#cb34-291"></a></span>
<span id="cb34-292"><a href="#cb34-292"></a>arima_refit_global</span>
<span id="cb34-293"><a href="#cb34-293"></a><span class="in">```</span></span>
<span id="cb34-294"><a href="#cb34-294"></a></span>
<span id="cb34-295"><a href="#cb34-295"></a>The next step is to build a container for the data that has all the correct dates and ID columns. This is done with <span class="in">`timetk::future_frame()`</span> .</span>
<span id="cb34-296"><a href="#cb34-296"></a></span>
<span id="cb34-297"><a href="#cb34-297"></a>::: {.callout-caution title="future_frame() with multiple series" collapse="true"}</span>
<span id="cb34-298"><a href="#cb34-298"></a><span class="in">`future_frame()`</span> only generates one series per data set fed to it, so it's really important to group the data before executing the function if you have multiple series or you'll only get one series of future dates.</span>
<span id="cb34-299"><a href="#cb34-299"></a>:::</span>
<span id="cb34-300"><a href="#cb34-300"></a></span>
<span id="cb34-303"><a href="#cb34-303"></a><span class="in">```{r}</span></span>
<span id="cb34-304"><a href="#cb34-304"></a><span class="co">#| label: future-reframe-global</span></span>
<span id="cb34-305"><a href="#cb34-305"></a>arima_future_global <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="cb34-306"><a href="#cb34-306"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb34-307"><a href="#cb34-307"></a>  <span class="fu">future_frame</span>(<span class="at">.length_out =</span> <span class="dv">12</span>, <span class="at">.bind_data =</span> <span class="cn">FALSE</span>, <span class="at">.date_var =</span> date)</span>
<span id="cb34-308"><a href="#cb34-308"></a><span class="in">```</span></span>
<span id="cb34-309"><a href="#cb34-309"></a></span>
<span id="cb34-310"><a href="#cb34-310"></a>And finally one can generate a plot of the forecasts with <span class="in">`modeltime_forecast()`</span> and plot the time series with <span class="in">`plot_modeltime_forecast()`</span> . Better not forget to group by series!</span>
<span id="cb34-311"><a href="#cb34-311"></a></span>
<span id="cb34-314"><a href="#cb34-314"></a><span class="in">```{r}</span></span>
<span id="cb34-315"><a href="#cb34-315"></a><span class="co">#| label: fig-forecast-future-global</span></span>
<span id="cb34-316"><a href="#cb34-316"></a></span>
<span id="cb34-317"><a href="#cb34-317"></a>forecast_future_global <span class="ot">&lt;-</span> arima_refit_global <span class="sc">|&gt;</span></span>
<span id="cb34-318"><a href="#cb34-318"></a>  <span class="fu">modeltime_forecast</span>(</span>
<span id="cb34-319"><a href="#cb34-319"></a>    <span class="at">new_data =</span> arima_future_global,</span>
<span id="cb34-320"><a href="#cb34-320"></a>    <span class="at">actual_data =</span> econ_data,</span>
<span id="cb34-321"><a href="#cb34-321"></a>    <span class="at">conf_by_id =</span> <span class="cn">TRUE</span></span>
<span id="cb34-322"><a href="#cb34-322"></a>  )</span>
<span id="cb34-323"><a href="#cb34-323"></a></span>
<span id="cb34-324"><a href="#cb34-324"></a>forecast_future_global <span class="sc">|&gt;</span></span>
<span id="cb34-325"><a href="#cb34-325"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb34-326"><a href="#cb34-326"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="cb34-327"><a href="#cb34-327"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-328"><a href="#cb34-328"></a>    <span class="at">.title =</span> <span class="st">"1 Year Forecast into the Future - Global"</span>,</span>
<span id="cb34-329"><a href="#cb34-329"></a>    <span class="at">.facet_ncol =</span> <span class="dv">2</span></span>
<span id="cb34-330"><a href="#cb34-330"></a>  ) <span class="sc">+</span></span>
<span id="cb34-331"><a href="#cb34-331"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb34-332"><a href="#cb34-332"></a><span class="in">```</span></span>
<span id="cb34-333"><a href="#cb34-333"></a></span>
<span id="cb34-334"><a href="#cb34-334"></a><span class="fu">## Building an iterative ARIMA model</span></span>
<span id="cb34-335"><a href="#cb34-335"></a></span>
<span id="cb34-336"><a href="#cb34-336"></a>Now I'll go through an iterative modeling workflow with the same model parameters for comparison. A key difference in the workflow is that the iterative model requires the construction of a nested table.</span>
<span id="cb34-337"><a href="#cb34-337"></a></span>
<span id="cb34-338"><a href="#cb34-338"></a>In <span class="in">`modeltime`</span> iterative forecasting is called <span class="co">[</span><span class="ot">"Nested Forecasting"</span><span class="co">](https://business-science.github.io/modeltime/articles/nested-forecasting.html?q=nested#nested-forecasting)</span>.</span>
<span id="cb34-339"><a href="#cb34-339"></a></span>
<span id="cb34-340"><a href="#cb34-340"></a><span class="fu">### Splitting data</span></span>
<span id="cb34-341"><a href="#cb34-341"></a></span>
<span id="cb34-342"><a href="#cb34-342"></a>One of the big differences in building a nested model from building a global model in <span class="in">`modeltime`</span> happens right at the beginning with splitting the data. With this method the future dates are added right up front with <span class="in">`extend_timeseries()`</span> , the length of actual data is distinguished from that of future periods in <span class="in">`nest_timeseries()`</span> and the train/test split is created with <span class="in">`split_nested_timeseries()`</span> .</span>
<span id="cb34-343"><a href="#cb34-343"></a></span>
<span id="cb34-346"><a href="#cb34-346"></a><span class="in">```{r}</span></span>
<span id="cb34-347"><a href="#cb34-347"></a><span class="co">#| label: splits-iterative</span></span>
<span id="cb34-348"><a href="#cb34-348"></a></span>
<span id="cb34-349"><a href="#cb34-349"></a>econ_splits_iterative <span class="ot">&lt;-</span> econ_data <span class="sc">|&gt;</span></span>
<span id="cb34-350"><a href="#cb34-350"></a>  <span class="fu">extend_timeseries</span>(</span>
<span id="cb34-351"><a href="#cb34-351"></a>    <span class="at">.id_var =</span> city,</span>
<span id="cb34-352"><a href="#cb34-352"></a>    <span class="at">.date_var =</span> date,</span>
<span id="cb34-353"><a href="#cb34-353"></a>    <span class="at">.length_future =</span> <span class="dv">12</span></span>
<span id="cb34-354"><a href="#cb34-354"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb34-355"><a href="#cb34-355"></a>  <span class="fu">nest_timeseries</span>(</span>
<span id="cb34-356"><a href="#cb34-356"></a>    <span class="at">.id_var =</span> city,</span>
<span id="cb34-357"><a href="#cb34-357"></a>    <span class="at">.length_future =</span> <span class="dv">12</span>,</span>
<span id="cb34-358"><a href="#cb34-358"></a>    <span class="at">.length_actual =</span> <span class="dv">17</span> <span class="sc">*</span> <span class="dv">12</span></span>
<span id="cb34-359"><a href="#cb34-359"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb34-360"><a href="#cb34-360"></a>  <span class="fu">split_nested_timeseries</span>(<span class="at">.length_test =</span> <span class="dv">24</span>)</span>
<span id="cb34-361"><a href="#cb34-361"></a></span>
<span id="cb34-362"><a href="#cb34-362"></a>econ_splits_iterative</span>
<span id="cb34-363"><a href="#cb34-363"></a><span class="in">```</span></span>
<span id="cb34-364"><a href="#cb34-364"></a></span>
<span id="cb34-365"><a href="#cb34-365"></a><span class="fu">### Specifying a modeling workflow and fit the model</span></span>
<span id="cb34-366"><a href="#cb34-366"></a></span>
<span id="cb34-367"><a href="#cb34-367"></a>I'll use the same model specification as above, but the recipe has to be specified to use the new splits object.</span>
<span id="cb34-368"><a href="#cb34-368"></a></span>
<span id="cb34-371"><a href="#cb34-371"></a><span class="in">```{r}</span></span>
<span id="cb34-372"><a href="#cb34-372"></a><span class="co">#| label: rec-iterative </span></span>
<span id="cb34-373"><a href="#cb34-373"></a></span>
<span id="cb34-374"><a href="#cb34-374"></a>arima_rec_iterative <span class="ot">&lt;-</span> <span class="fu">recipe</span>(</span>
<span id="cb34-375"><a href="#cb34-375"></a>  hpi <span class="sc">~</span> date,</span>
<span id="cb34-376"><a href="#cb34-376"></a>  <span class="fu">extract_nested_train_split</span>(econ_splits_iterative)</span>
<span id="cb34-377"><a href="#cb34-377"></a>)</span>
<span id="cb34-378"><a href="#cb34-378"></a></span>
<span id="cb34-379"><a href="#cb34-379"></a>arima_rec_iterative <span class="sc">|&gt;</span> <span class="fu">summary</span>() <span class="sc">|&gt;</span> <span class="fu">gt_bold_head</span>()</span>
<span id="cb34-380"><a href="#cb34-380"></a><span class="in">```</span></span>
<span id="cb34-381"><a href="#cb34-381"></a></span>
<span id="cb34-382"><a href="#cb34-382"></a>I'll also create a new workflow object that just updates the previous one with the new recipe.</span>
<span id="cb34-383"><a href="#cb34-383"></a></span>
<span id="cb34-386"><a href="#cb34-386"></a><span class="in">```{r}</span></span>
<span id="cb34-387"><a href="#cb34-387"></a><span class="co">#| label: workflow-iterative</span></span>
<span id="cb34-388"><a href="#cb34-388"></a></span>
<span id="cb34-389"><a href="#cb34-389"></a>arima_wflow_iterative <span class="ot">&lt;-</span> arima_wflow_global <span class="sc">|&gt;</span></span>
<span id="cb34-390"><a href="#cb34-390"></a>  <span class="fu">update_recipe</span>(arima_rec_iterative)</span>
<span id="cb34-391"><a href="#cb34-391"></a></span>
<span id="cb34-392"><a href="#cb34-392"></a>arima_wflow_iterative</span>
<span id="cb34-393"><a href="#cb34-393"></a><span class="in">```</span></span>
<span id="cb34-394"><a href="#cb34-394"></a></span>
<span id="cb34-395"><a href="#cb34-395"></a>And now I'll fit the model to all four cities iteratively using <span class="in">`modeltime_nested_fit()`</span> .</span>
<span id="cb34-396"><a href="#cb34-396"></a></span>
<span id="cb34-399"><a href="#cb34-399"></a><span class="in">```{r}</span></span>
<span id="cb34-400"><a href="#cb34-400"></a><span class="co">#| label: fit-iterative</span></span>
<span id="cb34-401"><a href="#cb34-401"></a><span class="co">#| cache: true</span></span>
<span id="cb34-402"><a href="#cb34-402"></a></span>
<span id="cb34-403"><a href="#cb34-403"></a>iterative_fit_start <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb34-404"><a href="#cb34-404"></a></span>
<span id="cb34-405"><a href="#cb34-405"></a>arima_fit_iterative <span class="ot">&lt;-</span> econ_splits_iterative <span class="sc">|&gt;</span></span>
<span id="cb34-406"><a href="#cb34-406"></a>  <span class="fu">modeltime_nested_fit</span>(arima_wflow_iterative)</span>
<span id="cb34-407"><a href="#cb34-407"></a></span>
<span id="cb34-408"><a href="#cb34-408"></a>iterative_fit_end <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb34-409"><a href="#cb34-409"></a></span>
<span id="cb34-410"><a href="#cb34-410"></a>arima_fit_iterative</span>
<span id="cb34-411"><a href="#cb34-411"></a><span class="in">```</span></span>
<span id="cb34-412"><a href="#cb34-412"></a></span>
<span id="cb34-413"><a href="#cb34-413"></a><span class="fu">### Model evaluation</span></span>
<span id="cb34-414"><a href="#cb34-414"></a></span>
<span id="cb34-415"><a href="#cb34-415"></a><span class="fu">#### Local model accuracy</span></span>
<span id="cb34-416"><a href="#cb34-416"></a></span>
<span id="cb34-419"><a href="#cb34-419"></a><span class="in">```{r}</span></span>
<span id="cb34-420"><a href="#cb34-420"></a><span class="co">#| label: tbl-acc-iterative</span></span>
<span id="cb34-421"><a href="#cb34-421"></a><span class="co">#| tbl-cap: "iterative model accuracy table"</span></span>
<span id="cb34-422"><a href="#cb34-422"></a></span>
<span id="cb34-423"><a href="#cb34-423"></a>arima_fit_iterative <span class="sc">|&gt;</span></span>
<span id="cb34-424"><a href="#cb34-424"></a>  <span class="fu">extract_nested_test_accuracy</span>() <span class="sc">|&gt;</span></span>
<span id="cb34-425"><a href="#cb34-425"></a>  <span class="fu">table_modeltime_accuracy</span>(<span class="at">.interactive =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-426"><a href="#cb34-426"></a><span class="in">```</span></span>
<span id="cb34-427"><a href="#cb34-427"></a></span>
<span id="cb34-428"><a href="#cb34-428"></a>You can jump back to compare this with the <span class="co">[</span><span class="ot">global model accuracy table @tbl-acc-global-local</span><span class="co">]</span>.</span>
<span id="cb34-429"><a href="#cb34-429"></a></span>
<span id="cb34-430"><a href="#cb34-430"></a><span class="fu">#### Accuracy plot</span></span>
<span id="cb34-431"><a href="#cb34-431"></a></span>
<span id="cb34-432"><a href="#cb34-432"></a>Below is a visual representation of how the models from the iterative modeling process performed against the test data (the last 2 years).</span>
<span id="cb34-433"><a href="#cb34-433"></a></span>
<span id="cb34-436"><a href="#cb34-436"></a><span class="in">```{r}</span></span>
<span id="cb34-437"><a href="#cb34-437"></a><span class="co">#| label: fig-acc-iterative</span></span>
<span id="cb34-438"><a href="#cb34-438"></a><span class="co">#| fig-cap: "iterative model accuracy plot"</span></span>
<span id="cb34-439"><a href="#cb34-439"></a></span>
<span id="cb34-440"><a href="#cb34-440"></a>arima_fit_iterative <span class="sc">|&gt;</span></span>
<span id="cb34-441"><a href="#cb34-441"></a>  <span class="fu">extract_nested_test_forecast</span>() <span class="sc">|&gt;</span></span>
<span id="cb34-442"><a href="#cb34-442"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb34-443"><a href="#cb34-443"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="cb34-444"><a href="#cb34-444"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-445"><a href="#cb34-445"></a>    <span class="at">.title =</span> <span class="st">"Forecast of Test Data - Iterative"</span>,</span>
<span id="cb34-446"><a href="#cb34-446"></a>    <span class="at">.facet_ncol =</span> <span class="dv">2</span></span>
<span id="cb34-447"><a href="#cb34-447"></a>  ) <span class="sc">+</span></span>
<span id="cb34-448"><a href="#cb34-448"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb34-449"><a href="#cb34-449"></a><span class="in">```</span></span>
<span id="cb34-450"><a href="#cb34-450"></a></span>
<span id="cb34-451"><a href="#cb34-451"></a>You can jump back to compare this with the <span class="co">[</span><span class="ot">global model accuracy plot @fig-acc-global</span><span class="co">]</span>.</span>
<span id="cb34-452"><a href="#cb34-452"></a></span>
<span id="cb34-453"><a href="#cb34-453"></a><span class="fu">### Forecasting the future</span></span>
<span id="cb34-454"><a href="#cb34-454"></a></span>
<span id="cb34-455"><a href="#cb34-455"></a>As with the global process above, the first step here will be to refit the model to the full training data set. Note that the iterative model process requires the use of <span class="in">`modeltime_nested_refit()`</span> rather than <span class="in">`modeltime_refit()`</span> .</span>
<span id="cb34-456"><a href="#cb34-456"></a></span>
<span id="cb34-457"><a href="#cb34-457"></a>::: {.callout-caution title="control_* functions" collapse="true"}</span>
<span id="cb34-458"><a href="#cb34-458"></a><span class="in">`modeltime`</span> has separate <span class="in">`control_*`</span> functions for different purposes such as this case in which <span class="in">`modeltime_refit()`</span> has <span class="in">`control_refit()`</span> and <span class="in">`modeltime_nested_refit()`</span> has <span class="in">`control_nested_refit()`</span>. Make sure to use the correct one.</span>
<span id="cb34-459"><a href="#cb34-459"></a>:::</span>
<span id="cb34-460"><a href="#cb34-460"></a></span>
<span id="cb34-463"><a href="#cb34-463"></a><span class="in">```{r}</span></span>
<span id="cb34-464"><a href="#cb34-464"></a><span class="co">#| label: refit-iterative</span></span>
<span id="cb34-465"><a href="#cb34-465"></a><span class="co">#| cache: true</span></span>
<span id="cb34-466"><a href="#cb34-466"></a></span>
<span id="cb34-467"><a href="#cb34-467"></a>iterative_refit_start <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb34-468"><a href="#cb34-468"></a></span>
<span id="cb34-469"><a href="#cb34-469"></a>arima_refit_iterative <span class="ot">&lt;-</span> arima_fit_iterative <span class="sc">|&gt;</span></span>
<span id="cb34-470"><a href="#cb34-470"></a>  <span class="fu">modeltime_nested_refit</span>(<span class="at">control =</span> <span class="fu">control_nested_refit</span>(<span class="at">verbose =</span> <span class="cn">FALSE</span>))</span>
<span id="cb34-471"><a href="#cb34-471"></a></span>
<span id="cb34-472"><a href="#cb34-472"></a>iterative_refit_end <span class="ot">&lt;-</span> <span class="fu">proc.time</span>()</span>
<span id="cb34-473"><a href="#cb34-473"></a></span>
<span id="cb34-474"><a href="#cb34-474"></a>arima_refit_iterative</span>
<span id="cb34-475"><a href="#cb34-475"></a><span class="in">```</span></span>
<span id="cb34-476"><a href="#cb34-476"></a></span>
<span id="cb34-477"><a href="#cb34-477"></a>Since the future data container was already created in the splitting object, I can go right to forecasting the future here.</span>
<span id="cb34-478"><a href="#cb34-478"></a></span>
<span id="cb34-481"><a href="#cb34-481"></a><span class="in">```{r}</span></span>
<span id="cb34-482"><a href="#cb34-482"></a><span class="co">#| label: fig-forecast-future-iterative </span></span>
<span id="cb34-483"><a href="#cb34-483"></a></span>
<span id="cb34-484"><a href="#cb34-484"></a>forecast_future_iterative <span class="ot">&lt;-</span> arima_refit_iterative <span class="sc">|&gt;</span></span>
<span id="cb34-485"><a href="#cb34-485"></a>  <span class="fu">extract_nested_future_forecast</span>()</span>
<span id="cb34-486"><a href="#cb34-486"></a></span>
<span id="cb34-487"><a href="#cb34-487"></a>forecast_future_iterative <span class="sc">|&gt;</span></span>
<span id="cb34-488"><a href="#cb34-488"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb34-489"><a href="#cb34-489"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="cb34-490"><a href="#cb34-490"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-491"><a href="#cb34-491"></a>    <span class="at">.title =</span> <span class="st">"1 Year Forecast into the Future - Global"</span>,</span>
<span id="cb34-492"><a href="#cb34-492"></a>    <span class="at">.facet_ncol =</span> <span class="dv">2</span></span>
<span id="cb34-493"><a href="#cb34-493"></a>  ) <span class="sc">+</span></span>
<span id="cb34-494"><a href="#cb34-494"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb34-495"><a href="#cb34-495"></a><span class="in">```</span></span>
<span id="cb34-496"><a href="#cb34-496"></a></span>
<span id="cb34-497"><a href="#cb34-497"></a><span class="fu">## Comparison</span></span>
<span id="cb34-498"><a href="#cb34-498"></a></span>
<span id="cb34-499"><a href="#cb34-499"></a>The two processes follow the same workflow, but have some key operational differences:</span>
<span id="cb34-500"><a href="#cb34-500"></a></span>
<span id="cb34-501"><a href="#cb34-501"></a><span class="ss">-   </span>Different structures for the data split objects</span>
<span id="cb34-502"><a href="#cb34-502"></a></span>
<span id="cb34-503"><a href="#cb34-503"></a><span class="ss">-   </span>The iterative workflow does not require calibration to the individual time series</span>
<span id="cb34-504"><a href="#cb34-504"></a></span>
<span id="cb34-505"><a href="#cb34-505"></a><span class="ss">-   </span>Processing time</span>
<span id="cb34-506"><a href="#cb34-506"></a></span>
<span id="cb34-507"><a href="#cb34-507"></a>Below are two tables showing the processing times for fitting and refitting the global and iterative models.</span>
<span id="cb34-508"><a href="#cb34-508"></a></span>
<span id="cb34-511"><a href="#cb34-511"></a><span class="in">```{r}</span></span>
<span id="cb34-512"><a href="#cb34-512"></a><span class="co">#| label: fig-fit-proc-times</span></span>
<span id="cb34-513"><a href="#cb34-513"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb34-514"><a href="#cb34-514"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb34-515"><a href="#cb34-515"></a></span>
<span id="cb34-516"><a href="#cb34-516"></a>global_fit_time <span class="ot">&lt;-</span> (global_fit_end <span class="sc">-</span> global_fit_start) <span class="sc">|&gt;</span></span>
<span id="cb34-517"><a href="#cb34-517"></a>  <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"metric"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-518"><a href="#cb34-518"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(value), <span class="at">model_process =</span> <span class="st">"Global Fit"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-519"><a href="#cb34-519"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb34-520"><a href="#cb34-520"></a></span>
<span id="cb34-521"><a href="#cb34-521"></a>iterative_fit_time <span class="ot">&lt;-</span> (iterative_fit_end <span class="sc">-</span> iterative_fit_start) <span class="sc">|&gt;</span></span>
<span id="cb34-522"><a href="#cb34-522"></a>  <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"metric"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-523"><a href="#cb34-523"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(value), <span class="at">model_process =</span> <span class="st">"Iterative Fit"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-524"><a href="#cb34-524"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb34-525"><a href="#cb34-525"></a></span>
<span id="cb34-526"><a href="#cb34-526"></a><span class="fu">bind_rows</span>(global_fit_time, iterative_fit_time) <span class="sc">|&gt;</span></span>
<span id="cb34-527"><a href="#cb34-527"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb34-528"><a href="#cb34-528"></a>    <span class="fu">aes</span>(<span class="at">x =</span> metric, <span class="at">y =</span> value, <span class="at">fill =</span> model_process, <span class="at">group =</span> model_process)</span>
<span id="cb34-529"><a href="#cb34-529"></a>  ) <span class="sc">+</span></span>
<span id="cb34-530"><a href="#cb34-530"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb34-531"><a href="#cb34-531"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-532"><a href="#cb34-532"></a>    <span class="at">fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb34-533"><a href="#cb34-533"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb34-534"><a href="#cb34-534"></a>    <span class="at">y =</span> <span class="st">"Time in seconds"</span>,</span>
<span id="cb34-535"><a href="#cb34-535"></a>    <span class="at">title =</span> <span class="st">"Comparison of Model Fit Processing Times"</span></span>
<span id="cb34-536"><a href="#cb34-536"></a>  ) <span class="sc">+</span></span>
<span id="cb34-537"><a href="#cb34-537"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb34-538"><a href="#cb34-538"></a>  theme_timetk <span class="sc">+</span></span>
<span id="cb34-539"><a href="#cb34-539"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb34-540"><a href="#cb34-540"></a><span class="in">```</span></span>
<span id="cb34-541"><a href="#cb34-541"></a></span>
<span id="cb34-544"><a href="#cb34-544"></a><span class="in">```{r}</span></span>
<span id="cb34-545"><a href="#cb34-545"></a><span class="co">#| label: fig-refit-proc-times</span></span>
<span id="cb34-546"><a href="#cb34-546"></a><span class="co">#| fig-width: 6</span></span>
<span id="cb34-547"><a href="#cb34-547"></a><span class="co">#| fig-height: 4</span></span>
<span id="cb34-548"><a href="#cb34-548"></a></span>
<span id="cb34-549"><a href="#cb34-549"></a>global_refit_time <span class="ot">&lt;-</span> (global_refit_end <span class="sc">-</span> global_refit_start) <span class="sc">|&gt;</span></span>
<span id="cb34-550"><a href="#cb34-550"></a>  <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"metric"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-551"><a href="#cb34-551"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(value), <span class="at">model_process =</span> <span class="st">"Global Refit"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-552"><a href="#cb34-552"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb34-553"><a href="#cb34-553"></a></span>
<span id="cb34-554"><a href="#cb34-554"></a>iterative_refit_time <span class="ot">&lt;-</span> (iterative_refit_end <span class="sc">-</span> iterative_refit_start) <span class="sc">|&gt;</span></span>
<span id="cb34-555"><a href="#cb34-555"></a>  <span class="fu">enframe</span>(<span class="at">name =</span> <span class="st">"metric"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-556"><a href="#cb34-556"></a>  <span class="fu">mutate</span>(<span class="at">value =</span> <span class="fu">as.numeric</span>(value), <span class="at">model_process =</span> <span class="st">"Iterative Refit"</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-557"><a href="#cb34-557"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb34-558"><a href="#cb34-558"></a></span>
<span id="cb34-559"><a href="#cb34-559"></a><span class="fu">bind_rows</span>(global_refit_time, iterative_refit_time) <span class="sc">|&gt;</span></span>
<span id="cb34-560"><a href="#cb34-560"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb34-561"><a href="#cb34-561"></a>    <span class="fu">aes</span>(<span class="at">x =</span> metric, <span class="at">y =</span> value, <span class="at">fill =</span> model_process, <span class="at">group =</span> model_process)</span>
<span id="cb34-562"><a href="#cb34-562"></a>  ) <span class="sc">+</span></span>
<span id="cb34-563"><a href="#cb34-563"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb34-564"><a href="#cb34-564"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-565"><a href="#cb34-565"></a>    <span class="at">fill =</span> <span class="cn">NULL</span>,</span>
<span id="cb34-566"><a href="#cb34-566"></a>    <span class="at">x =</span> <span class="cn">NULL</span>,</span>
<span id="cb34-567"><a href="#cb34-567"></a>    <span class="at">y =</span> <span class="st">"Time in seconds"</span>,</span>
<span id="cb34-568"><a href="#cb34-568"></a>    <span class="at">title =</span> <span class="st">"Model Refit Processing Times"</span></span>
<span id="cb34-569"><a href="#cb34-569"></a>  ) <span class="sc">+</span></span>
<span id="cb34-570"><a href="#cb34-570"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb34-571"><a href="#cb34-571"></a>  theme_timetk <span class="sc">+</span></span>
<span id="cb34-572"><a href="#cb34-572"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb34-573"><a href="#cb34-573"></a><span class="in">```</span></span>
<span id="cb34-574"><a href="#cb34-574"></a></span>
<span id="cb34-575"><a href="#cb34-575"></a>Besides these operational differences, the processes yield different levels of accuracy due to differences in the data on which they are trained (or to which they are initially fit). It's also clear that the differences in models can yield some very big differences in forecasts. Global models have performed well in competitions that involved thousands of time series, so it's possible that the variance across the four time series in this analysis is too high to make global modeling worthwhile.</span>
<span id="cb34-576"><a href="#cb34-576"></a></span>
<span id="cb34-579"><a href="#cb34-579"></a><span class="in">```{r}</span></span>
<span id="cb34-580"><a href="#cb34-580"></a><span class="co">#| label: show-both-forecasts</span></span>
<span id="cb34-581"><a href="#cb34-581"></a><span class="co">#| fig-width: 12</span></span>
<span id="cb34-582"><a href="#cb34-582"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb34-583"><a href="#cb34-583"></a></span>
<span id="cb34-584"><a href="#cb34-584"></a>patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(</span>
<span id="cb34-585"><a href="#cb34-585"></a>  forecast_future_global <span class="sc">|&gt;</span></span>
<span id="cb34-586"><a href="#cb34-586"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb34-587"><a href="#cb34-587"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="cb34-588"><a href="#cb34-588"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-589"><a href="#cb34-589"></a>    <span class="at">.title =</span> <span class="st">"1 Year Forecast into the Future - Global"</span>,</span>
<span id="cb34-590"><a href="#cb34-590"></a>    <span class="at">.facet_ncol =</span> <span class="dv">1</span></span>
<span id="cb34-591"><a href="#cb34-591"></a>  ) <span class="sc">+</span></span>
<span id="cb34-592"><a href="#cb34-592"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)),</span>
<span id="cb34-593"><a href="#cb34-593"></a>  forecast_future_iterative <span class="sc">|&gt;</span></span>
<span id="cb34-594"><a href="#cb34-594"></a>  <span class="fu">group_by</span>(city) <span class="sc">|&gt;</span></span>
<span id="cb34-595"><a href="#cb34-595"></a>  <span class="fu">plot_modeltime_forecast</span>(</span>
<span id="cb34-596"><a href="#cb34-596"></a>    <span class="at">.interactive =</span> <span class="cn">FALSE</span>,</span>
<span id="cb34-597"><a href="#cb34-597"></a>    <span class="at">.title =</span> <span class="st">"1 Year Forecast into the Future - Global"</span>,</span>
<span id="cb34-598"><a href="#cb34-598"></a>    <span class="at">.facet_ncol =</span> <span class="dv">1</span></span>
<span id="cb34-599"><a href="#cb34-599"></a>  ) <span class="sc">+</span></span>
<span id="cb34-600"><a href="#cb34-600"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb34-601"><a href="#cb34-601"></a>)</span>
<span id="cb34-602"><a href="#cb34-602"></a><span class="in">```</span></span>
<span id="cb34-603"><a href="#cb34-603"></a></span>
<span id="cb34-604"><a href="#cb34-604"></a>In the next post I'll run a global modeling process with a few different algorithms and specifications to get a few hundred models and find which ones run best.</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>